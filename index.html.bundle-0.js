BUNDLE=[[]],"undefined"!=typeof window&&("ontouchstart"in window||(window.Touch=null),document._montageTiming={},document._montageTiming.loadStartTime=Date.now(),window.addEventListener("DOMContentLoaded",function(){var e=1e3;document._montageStartBootstrappingTimeout=setTimeout(function(){document._montageStartBootstrappingTimeout=null;var e=document.documentElement;e.classList?e.classList.add("montage-app-bootstrapping"):e.className=e.className+" montage-app-bootstrapping",document._montageTiming.bootstrappingStartTime=Date.now()},e)})),function(e){"undefined"!=typeof require?e.call("undefined"!=typeof global?global:this,require,exports,module):e({},{},{})}(function(e,t){global=this,t.initMontage=function(){var e=t.getPlatform();e.bootstrap(function(n,i,r){var a=e.getParams(),o={location:n.getLocation()},l=r.resolve(o.location,a.montageLocation);o.moduleTypes=["html","meta"],o.makeLoader=function(e){return t.ReelLoader(e,n.makeLoader(e))},o.makeCompiler=function(e){return t.MetaCompiler(e,t.SerializationCompiler(e,t.TemplateCompiler(e,n.makeCompiler(e))))};var c=r.resolve(o.location,a["package"]||"."),u=a.applicationHash;if("object"==typeof BUNDLE){var h={},d=function(e){return h[e]=h[e]||i.defer()};global.bundleLoaded=function(e){d(e).resolve()};var p=i.defer();o.preloaded=p.promise;var f=i.resolve();BUNDLE.forEach(function(e){f=f.then(function(){return i.all(e.map(function(e){return s.load(e),d(e).promise}))})}),p.resolve(f.then(function(){delete BUNDLE,delete bundleLoaded}))}var m;if("remoteTrigger"in a){var g=i.defer();window.postMessage({type:"montageReady"},"*");var v=function(e){if(a.remoteTrigger===e.origin&&(e.source===window||e.source===window.parent))switch(e.data.type){case"montageInit":window.removeEventListener("message",v),g.resolve([e.data.location,e.data.injections]);break;case"isMontageReady":window.postMessage({type:"montageReady"},"*")}};window.addEventListener("message",v),m=g.promise.spread(function(e,t){var i=n.loadPackage({location:e,hash:u},o);return t&&(i=i.then(function(n){e=r.resolve(e,".");var i,a,s=t.packageDescriptions,o=t.packageDescriptionLocations,l=t.mappings,c=t.dependencies;if(s)for(a=s.length,i=0;a>i;i++)n.injectPackageDescription(s[i].location,s[i].description);if(o)for(a=o.length,i=0;a>i;i++)n.injectPackageDescriptionLocation(o[i].location,o[i].descriptionLocation);if(l)for(a=l.length,i=0;a>i;i++)n.injectMapping(l[i].dependency,l[i].name);if(c)for(a=c.length,i=0;a>i;i++)n.injectDependency(c[i].name,c[i].version);return n})),i})}else{if("autoPackage"in a)n.injectPackageDescription(c,{dependencies:{montage:"*"}},o);else if(".json"===c.slice(c.length-5)){var _=c;c=r.resolve(c,"."),n.injectPackageDescriptionLocation(c,_,o)}m=n.loadPackage({location:c,hash:u},o)}m.then(function(t){t.loadPackage({location:l,hash:a.montageHash}).then(function(e){var t;return t=a.promiseLocation?r.resolve(n.getLocation(),a.promiseLocation):r.resolve(l,"packages/mr/packages/q"),[e,e.loadPackage({location:t,hash:a.promiseHash})]}).spread(function(n,s){n.inject("core/mini-url",r),n.inject("core/promise",{Promise:i}),s.inject("q",i),o.lint=function(e){n.async("core/jshint").then(function(t){t.JSHINT(e.text)||(console.warn("JSHint Error: "+e.location),t.JSHINT.errors.forEach(function(e){e&&(console.warn("Problem at line "+e.line+" character "+e.character+": "+e.reason),e.evidence&&console.warn("    "+e.evidence))}))}).done()},global.require=t,global.montageRequire=n,e.initMontage(n,t,a)})}).done()})};var n=/((.*)\.reel)\/\2$/,i=function(e,t){return t};t.SerializationCompiler=function(e,t){return function(e){if(t(e),e.factory){var r=e.factory;return e.factory=function(e,t,a){r.call(this,e,t,a);for(var s in t){var o=t[s];if(o instanceof Object)if(o.hasOwnProperty("_montage_metadata")&&!o._montage_metadata.isInstance)o._montage_metadata.aliases.push(s),o._montage_metadata.objectName=s;else if(!Object.isSealed(o)){var l=a.id.replace(n,i);Object.defineProperty(o,"_montage_metadata",{value:{require:e,module:l,moduleId:l,property:s,objectName:s,aliases:[s],isInstance:!1}})}}},e}}};var r=/([^\/]+)\.reel$/;t.ReelLoader=function(e,t){return function(e,n){var i=r.exec(e);return i?(n.redirect=e+"/"+i[1],n):t(e,n)}};var a=/\.meta/;t.MetaCompiler=function(e,t){return function(e){var n=(e.location||"").match(a);return n?(e.exports=JSON.parse(e.text),e):t(e)}},t.TemplateCompiler=function(e,t){return function(e){if(e.location){var n=e.location.match(/(.*\/)?(?=[^\/]+\.html(?:\.load\.js)?$)/);return n?(e.dependencies=e.dependencies||[],e.exports={directory:n[1],content:e.text},Object.defineProperty(e.exports,"root",{get:function(){return"object"==typeof console&&console.warn("'root' property is deprecated on template modules.  Use 'directory' instead of root[1]"),n}}),e):(t(e),void 0)}}},t.getPlatform=function(){if("undefined"!=typeof window&&window&&window.document)return s;if("undefined"!=typeof process)return e("./node.js");throw Error("Platform not supported.")};var s={makeResolve:function(){var e=document.querySelector("head"),t=document.createElement("base"),n=document.createElement("a");return t.href="",function(i,r){var a=e.querySelector("base");if(a||(e.appendChild(t),a=t),i+="",!/^[\w\-]+:/.test(i))throw Error("Can't resolve from a relative location: "+JSON.stringify(i)+" "+JSON.stringify(r));var s=a.href;a.href=i,n.href=r;var o=n.href;return a.href=s,a===t&&e.removeChild(a),o}},load:function(e){var t=document.createElement("script");t.src=e,t.onload=function(){t.parentNode.removeChild(t)},document.getElementsByTagName("head")[0].appendChild(t)},getParams:function(){var e,t,n,i,r,a,s;if(!this._params){this._params={};var o=document.getElementsByTagName("script");for(e=0;o.length>e;e++)if(i=o[e],r=!1,i.src&&(n=i.src.match(/^(.*)montage.js(?:[\?\.]|$)/i))&&(this._params.montageLocation=n[1],r=!0),i.hasAttribute("data-montage-location")&&(this._params.montageLocation=i.getAttribute("data-montage-location"),r=!0),r){if(i.dataset)for(s in i.dataset)this._params[s]=i.dataset[s];else if(i.attributes){var l=/-([a-z])/g,c=function(e,t){return t.toUpperCase()};for(t=0;i.attributes.length>t;t++)a=i.attributes[t],n=a.name.match(/^data-(.*)$/),n&&(this._params[n[1].replace(l,c)]=a.value)}i.parentNode.removeChild(i);break}}return this._params},bootstrap:function(e){function t(){document.removeEventListener("DOMContentLoaded",t,!0),o=!0,r()}function n(e){if(!g[e]&&m[e]){var t=g[e]={};g[e]=m[e](n,t)||t}return g[e]}function i(){c=n("mini-url"),l=n("promise"),a=n("require"),delete global.bootstrap,r()}function r(){o&&a&&e(a,l,c)}var a,o,l,c,u=this.getParams(),h=this.makeResolve();/interactive|complete/.test(document.readyState)?t():document.addEventListener("DOMContentLoaded",t,!0);var d={require:"packages/mr/require.js","require/browser":"packages/mr/browser.js",promise:"packages/mr/packages/q/q.js"};if("undefined"==typeof BUNDLE){var p=h(window.location,u.montageLocation);for(var f in d)s.load(h(p,d[f]))}var m={};global.bootstrap=function(e,t){m[e]=t,delete d[e];for(var e in d)return;delete global.bootstrap,i()},global.bootstrap("mini-url",function(e,t){t.resolve=h});var g={}},initMontage:function(e,t,n){var i=["core/core","core/event/event-manager","core/serialization/deserializer/montage-reviver","core/logger","core/deprecate"],r=e("core/promise").Promise;return r.all(i.map(e.deepLoad)).then(function(){i.forEach(e),e("core/core").Montage;var a,s,o=e("core/event/event-manager").EventManager,l=e("core/serialization/deserializer/montage-reviver").MontageReviver,c=e("core/logger").logger,u=e("core/deprecate");c("Promise stacktrace support",function(e){r.longStackSupport=!!e}),a=(new o).initWithWindow(window),"function"==typeof global.montageWillLoad&&global.montageWillLoad();var h,d,p=t.packageDescription.applicationPrototype;return p?(h=l.parseObjectLocationId(p),d=t.async(h.moduleId)):d=e.async("core/application"),d.then(function(e){var i=e[h?h.objectName:"Application"];s=new i,Object.defineProperty(window.document,"application",{get:u.deprecateMethod(null,function(){return e.application},'document.application is deprecated, use require("montage/core/application").application instead.')}),a.application=s,s.eventManager=a,s._load(t,function(){n.module&&t.async(n.module).done(),"function"==typeof global.montageDidLoad&&global.montageDidLoad()})})}).done()}};"undefined"!=typeof window?global.__MONTAGE_LOADED__?console.warn("Montage already loaded!"):(global.__MONTAGE_LOADED__=!0,t.initMontage()):t.getPlatform()}),function(e){if("undefined"!=typeof bootstrap)"undefined"!=typeof window?bootstrap("require",function(t,n){var i=t("promise"),r=t("mini-url");e(n,i,r),t("require/browser")}):bootstrap("require",function(t,n){var i=t("promise").Promise,r=t("mini-url");e(n,i,r)});else{if("undefined"==typeof process)throw Error("Can't support require on this platform");var t=require("q"),n=require("url");e(exports,t,n),require("./node")}}(function(e,t,n){function i(t,i){if(i=i||{},"string"==typeof t&&(t={location:t}),t.main&&(t.location=i.mainPackageLocation),t.name&&i.registry&&i.registry[t.name]&&(t.location=i.registry[t.name]),!t.location&&i.packagesDirectory&&t.name&&(t.location=n.resolve(i.packagesDirectory,t.name+"/")),!t.location)return t;if(/\/$/.test(t.location)||(t.location+="/"),!e.isAbsolute(t.location)){if(!i.location)throw Error("Dependency locations must be fully qualified: "+JSON.stringify(t));t.location=n.resolve(i.location,t.location)}return t.name&&(i.registry[t.name]=t.location),t}function r(t,r,a){/\/$/.test(t)||(t+="/");var o=Object.create(a);o.name=r.name,o.location=t||e.getLocation(),o.packageDescription=r,o.useScriptInjection=r.useScriptInjection,void 0!==r.production&&(o.production=r.production);var c=o.modules=o.modules||{},u=o.registry;void 0===o.name||u[o.name]||(u[o.name]=o.location);var h=r.overlay||{};"string"==typeof r.browser?h.browser={redirects:{"":r.browser}}:"object"==typeof r.browser&&(h.browser={redirects:r.browser}),o.overlays=o.overlays||e.overlays,o.overlays.forEach(function(e){if(h[e]){var t=h[e];for(var n in t)r[n]=t[n]}}),delete r.overlay,o.packagesDirectory=n.resolve(t,"node_modules/"),void 0!==r.main&&(c[""]={id:"",redirect:l(s(r.main,"")),location:o.location});var d=r.redirects;void 0!==d&&Object.keys(d).forEach(function(e){c[e]={id:e,redirect:l(s(d[e],e)),location:n.resolve(t,e)}});var p=r.mappings||{};return[r.dependencies,o.production?null:r.devDependencies].forEach(function(e){e&&Object.keys(e).forEach(function(t){p[t]||(p[t]={name:t,version:e[t]})})}),Object.keys(p).forEach(function(e){p[e]=i(p[e],o,e)}),o.mappings=p,o}function a(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function s(e,t){e+="";var n=e.split("/"),i=[];if(n.length&&"."===n[0]||".."===n[0]){var r=t.split("/");r.pop(),n.unshift.apply(n,r)}for(var a=0,s=n.length;s>a;a++){var o=n[a];""===o||"."===o||(".."===o?i.length&&i.pop():i.push(o))}return i.join("/")}if(!this)throw Error("Require does not work in strict mode.");e.makeRequire=function(r){function o(e){var t=e.toLowerCase();return a(g,t)||(g[t]={id:e,display:(r.name||r.location)+"#"+e,require:m}),g[t]}function u(e,t){var i=o(e);i.exports=t,i.location=n.resolve(r.location,e),i.directory=n.resolve(i.location,"./"),i.injected=!0,delete i.redirect,delete i.mappingRedirect}function h(e,n,i){var r=o(e);return i=i||{},a(i,e)?void 0:(i[e]=!0,v(e,n).then(function(){return t.all(r.dependencies.map(function(t){t=s(t,e);var n=o(t),r=n.dependees=n.dependees||{};return r[e]=!0,h(t,e,i)}))},function(e){r.error=e}))}function d(e,t){var i=o(e);if(i.id!==e)throw Error("Can't require module "+JSON.stringify(i.id)+" by alternate spelling "+JSON.stringify(e));if(i.error){var r=Error("Can't require module "+JSON.stringify(i.id)+" via "+JSON.stringify(t)+" because "+i.error.message);throw r.cause=i.error,r}if(void 0!==i.redirect)return d(i.redirect,t);if(void 0!==i.mappingRedirect)return i.mappingRequire(i.mappingRedirect,t);if(void 0!==i.exports)return i.exports;if(void 0===i.factory)throw Error("Can't require module "+JSON.stringify(e)+" via "+JSON.stringify(t));i.directory=n.resolve(i.location,"./"),i.exports={};var a;try{a=i.factory.call(void 0,f(e),i.exports,i)}catch(s){throw delete i.exports,s}return void 0!==a&&(i.exports=a),i.exports}function p(e,t,n){var i=r.location;if(t.location===i)return e;var s=!!n;if(n=n||{},a(n,i))return null;n[i]=!0;for(var o in r.mappings){var l=r.mappings[o];if(i=l.location,r.hasPackage(i)){var c=r.getPackage(i),u=c.identify(e,t,n);if(null!==u)return""===u?o:o+"/"+u}}if(s)return null;throw Error("Can't identify "+e+" from "+t.location)}function f(t){var n=function(e){var n=s(e,t);return d(n,t)};return n.async=function(e){var i=s(e,t);return o(e),h(i,t).then(function(){return n(i)})},n.resolve=function(e){return l(s(e,t))},n.getModule=o,n.getModuleDescriptor=o,n.load=v,n.deepLoad=h,n.loadPackage=function(t,n){return n?e.loadPackage(t,n):r.loadPackage(t,r)},n.hasPackage=function(e){return r.hasPackage(e)},n.getPackage=function(e){return r.getPackage(e)},n.isMainPackage=function(){return n.location===r.mainPackageLocation},n.injectPackageDescription=function(t,n){e.injectPackageDescription(t,n,r)},n.injectPackageDescriptionLocation=function(t,n){e.injectPackageDescriptionLocation(t,n,r)},n.injectMapping=function(e,t){e=i(e,r,t),t=t||e.name,r.mappings[t]=e},n.injectDependency=function(e){n.injectMapping({name:e},e)},n.identify=p,n.inject=u,r.exposedConfigs.forEach(function(e){n[e]=r[e]}),n.config=r,n.read=r.read,n}var m;r=r||{},r.location=n.resolve(r.location||e.getLocation(),"./"),r.paths=r.paths||[r.location],r.mappings=r.mappings||{},r.exposedConfigs=r.exposedConfigs||e.exposedConfigs,r.moduleTypes=r.moduleTypes||[],r.makeLoader=r.makeLoader||e.makeLoader,r.load=r.load||r.makeLoader(r),r.makeCompiler=r.makeCompiler||e.makeCompiler,r.compile=r.compile||r.makeCompiler(r),r.parseDependencies=r.parseDependencies||e.parseDependencies,r.read=r.read||e.read;var g=r.modules=r.modules||{},v=c(function(e){var n=o(e);return t.fcall(function(){return void 0===n.factory&&void 0===n.exports&&void 0===n.redirect?t.fcall(r.load,e,n):void 0}).then(function(){r.compile(n);var e=n.dependencies=n.dependencies||[];void 0!==n.redirect&&e.push(n.redirect),void 0!==n.extraDependencies&&Array.prototype.push.apply(n.dependencies,n.extraDependencies)})});return m=f("")},e.injectPackageDescription=function(e,n,i){var r=i.descriptions=i.descriptions||{};r[e]=t.resolve(n)},e.injectPackageDescriptionLocation=function(e,t,n){var i=n.descriptionLocations=n.descriptionLocations||{};i[e]=t},e.loadPackageDescription=function(t,i){var r=t.location,a=i.descriptions=i.descriptions||{};if(void 0===a[r]){var s,o=i.descriptionLocations=i.descriptionLocations||{};s=o[r]?o[r]:n.resolve(r,"package.json"),a[r]=(i.read||e.read)(s).then(function(e){try{return JSON.parse(e)}catch(t){throw t.message=t.message+" in "+JSON.stringify(s),t}})}return a[r]},e.loadPackage=function(t,n){if(t=i(t,n),!t.location)throw Error("Can't find dependency: "+JSON.stringify(t));var a=t.location;n=Object.create(n||null);var s=n.loadingPackages=n.loadingPackages||{},o=n.packages={};n.registry=n.registry||Object.create(null),n.mainPackageLocation=a,n.hasPackage=function(e){if(e=i(e,n),!e.location)return!1;var t=e.location;return!!o[t]},n.getPackage=function(e){if(e=i(e,n),!e.location)throw Error("Can't find dependency: "+JSON.stringify(e)+" from "+n.location);var t=e.location;if(!o[t])throw s[t]?Error("Dependency has not finished loading: "+JSON.stringify(e)):Error("Dependency was not loaded: "+JSON.stringify(e));return o[t]},n.loadPackage=function(t,a){if(t=i(t,a),!t.location)throw Error("Can't find dependency: "+JSON.stringify(t)+" from "+n.location);var l=t.location;return s[l]||(s[l]=e.loadPackageDescription(t,n).then(function(t){var i=r(l,t,n),a=e.makeRequire(i);return o[l]=a,a})),s[l]};var l=n.loadPackage(t);return l.location=a,l.async=function(e,t){return l.then(function(n){return n.async(e,t)})},l},e.resolve=s;var o=/\.([^\/\.]+)$/;e.extension=function(e){var t=o.exec(e);return t?t[1]:void 0},e.isAbsolute=function(e){return/^[\w\-]+:/.test(e)},e.parseDependencies=function(e){var t={};return(e+"").replace(/(?:^|[^\w\$_.])require\s*\(\s*["']([^"']*)["']\s*\)/g,function(e,n){t[n]=!0}),Object.keys(t)},e.DependenciesCompiler=function(t,n){return function(i){return i.dependencies||void 0===i.text||(i.dependencies=t.parseDependencies(i.text)),n(i),i&&!i.dependencies&&(i.dependencies=i.text||i.factory?e.parseDependencies(i.text||i.factory):[]),i}},e.ShebangCompiler=function(e,t){return function(e){e.text&&(e.text=e.text.replace(/^#!/,"//#!")),t(e)}},e.LintCompiler=function(e,n){return function(i){try{n(i)}catch(r){throw e.lint&&t.nextTick(function(){e.lint(i)}),r}}},e.exposedConfigs=["paths","mappings","location","packageDescription","packages","modules"],e.makeCompiler=function(t){return e.JsonCompiler(t,e.ShebangCompiler(t,e.DependenciesCompiler(t,e.LintCompiler(t,e.Compiler(t)))))},e.JsonCompiler=function(e,t){return function(e){var n=(e.location||"").match(/\.json$/);return n?(e.exports=JSON.parse(e.text),e):t(e)}},e.MappingsLoader=function(t,n){return t.mappings=t.mappings||{},t.name=t.name,function(i,r){var a=t.mappings,s=Object.keys(a),o=s.length;if(e.isAbsolute(i))return n(i,r);void 0!==t.name&&0===i.indexOf(t.name)&&"/"===i.charAt(t.name.length)&&console.warn("Package reflexive module ignored:",i);var l,c;for(l=0;o>l;l++)if(c=s[l],i===c||0===i.indexOf(c)&&"/"===i.charAt(c.length)){var u=a[c],h=i.slice(c.length+1);return t.loadPackage(u,t).then(function(e){return r.mappingRedirect=h,r.mappingRequire=e,e.deepLoad(h,t.location)})}return n(i,r)}},e.LocationLoader=function(t,i){return function(r,a){var s=r,o=e.extension(r);(!o||"js"!==o&&"json"!==o&&-1===t.moduleTypes.indexOf(o))&&(s+=".js");var l=n.resolve(t.location,s);return i(l,a)}},e.MemoizedLoader=function(e,t){var n=e.cache=e.cache||{};return c(t,n)};var l=function(e){var t=/^(.*)\.js$/.exec(e);return t&&(e=t[1]),e},c=function(e,n){return n=n||{},function(i,r){return a(n,i)||(n[i]=t.fcall(e,i,r)),n[i]}}}),bootstrap("require/browser",function(e){function t(e){return 200===e.status||0===e.status&&e.responseText}var n,i=e("require"),r=e("promise"),a=e("mini-url"),s="GET",o="application/javascript";i.getLocation=function(){if(!n){var e=document.querySelector("head > base");n=e?e.href:window.location,n=a.resolve(n,".")}return n},i.overlays=["window","browser","montage"],i.read=function(e){function n(){t(a)?l.resolve(a.responseText):i()}function i(){l.reject(Error("Can't XHR "+JSON.stringify(e)))}var a=new XMLHttpRequest,l=r.defer();try{a.open(s,e,!0),a.overrideMimeType&&a.overrideMimeType(o),a.onreadystatechange=function(){4===a.readyState&&n()},a.onload=a.load=n,a.onerror=a.error=i}catch(c){l.reject(c)}return a.send(),l.promise};var l=eval,c="__",u="_",h="(function ",d="(require, exports, module) {",p="//*/\n})\n//# sourceURL=";i.Compiler=function(e){return function(t){if(t.factory||void 0===t.text)return t;if(e.useScriptInjection)throw Error("Can't use eval.");var n=(t.require.config.name+c+t.id).replace(/[^\w\d]|^\d/g,u);try{t.factory=l(h+n+d+t.text+p+t.location)}catch(i){throw i.message=i.message+" in "+t.location,i}t.factory.displayName=n}},i.XhrLoader=function(e){return function(t,n){return e.read(t).then(function(e){n.type="javascript",n.text=e,n.location=t})}};var f={},m=function(e,t){return f[e]=f[e]||{},f[e][t]=f[e][t]||r.defer(),f[e][t]},g=function(e,t,n){n&&n.isPending()?n.then(function(){t.isPending()&&i.loadScript(e)}).done():t.isPending()&&i.loadScript(e)};montageDefine=function(e,t,n){m(e,t).resolve(n)},i.loadScript=function(e){var t=document.createElement("script");t.onload=function(){t.parentNode.removeChild(t)},t.onerror=function(){t.parentNode.removeChild(t)},t.src=e,t.defer=!0,document.getElementsByTagName("head")[0].appendChild(t)},i.ScriptLoader=function(e){var t=e.packageDescription.hash;return function(n,i){return r.fcall(function(){if(f[t]&&f[t][i.id])return f[t][i.id].promise;/\.js$/.test(n)?n=n.replace(/\.js$/,".load.js"):n+=".load.js";var r=m(t,i.id).promise;return g(n,r,e.preloaded),r}).then(function(e){delete f[t][i.id];for(var r in e)i[r]=e[r];i.location=n,i.directory=a.resolve(n,".")})}};var v=i.loadPackageDescription;i.loadPackageDescription=function(e,t){if(e.hash){var n=m(e.hash,"package.json").promise,i=a.resolve(e.location,"package.json.load.js");return g(i,n,t.preloaded),n.get("exports")}return v(e,t)},i.makeLoader=function(e){var t;return t=e.useScriptInjection?i.ScriptLoader:i.XhrLoader,i.MappingsLoader(e,i.LocationLoader(e,i.MemoizedLoader(e,t(e))))}}),function(e){if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else Q=e()}(function(){"use strict";function e(e){return function(){return X.apply(e,arguments)}}function t(e){return e===Object(e)}function n(e){return"[object StopIteration]"===tt(e)||e instanceof W}function i(e,t){if(F&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(nt)){for(var n=[],i=t;i;i=i.source)i.stack&&n.unshift(i.stack);n.unshift(e.stack);var a=n.join("\n"+nt+"\n");e.stack=r(a)}}function r(e){for(var t=e.split("\n"),n=[],i=0;t.length>i;++i){var r=t[i];o(r)||a(r)||!r||n.push(r)}return n.join("\n")}function a(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function s(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var i=/.*@(.+):(\d+)$/.exec(e);return i?[i[1],Number(i[2])]:void 0}function o(e){var t=s(e);if(!t)return!1;var n=t[0],i=t[1];return n===V&&i>=H&&st>=i}function l(){if(F)try{throw Error()}catch(e){var t=e.stack.split("\n"),n=t[0].indexOf("@")>0?t[1]:t[2],i=s(n);if(!i)return;return V=i[0],i[1]}}function c(e,t,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t+" is deprecated, use "+n+" instead.",Error("").stack),e.apply(e,arguments)}}function u(e){return v(e)?e:_(e)?S(e):E(e)}function h(){function e(e){t=e,a.source=e,K(n,function(t,n){Y(function(){e.promiseDispatch.apply(e,n)})},void 0),n=void 0,i=void 0}var t,n=[],i=[],r=$(h.prototype),a=$(f.prototype);if(a.promiseDispatch=function(e,r,a){var s=G(arguments);n?(n.push(s),"when"===r&&a[1]&&i.push(a[1])):Y(function(){t.promiseDispatch.apply(t,s)})},a.valueOf=function(){if(n)return a;var e=g(t);return v(e)&&(t=e),e},a.inspect=function(){return t?t.inspect():{state:"pending"}},u.longStackSupport&&F)try{throw Error()}catch(s){a.stack=s.stack.substring(s.stack.indexOf("\n")+1)}return r.promise=a,r.resolve=function(n){t||e(u(n))},r.fulfill=function(n){t||e(E(n))},r.reject=function(n){t||e(M(n))},r.notify=function(e){t||K(i,function(t,n){Y(function(){n(e)})},void 0)},r}function d(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=h();try{e(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}return t.promise}function p(e){return d(function(t,n){for(var i=0,r=e.length;r>i;i++)u(e[i]).then(t,n)})}function f(e,t,n){void 0===t&&(t=function(e){return M(Error("Promise does not support operation: "+e))}),void 0===n&&(n=function(){return{state:"unknown"}});var i=$(f.prototype);if(i.promiseDispatch=function(n,r,a){var s;try{s=e[r]?e[r].apply(i,a):t.call(i,r,a)}catch(o){s=M(o)}n&&n(s)},i.inspect=n,n){var r=n();"rejected"===r.state&&(i.exception=r.reason),i.valueOf=function(){var e=n();return"pending"===e.state||"rejected"===e.state?i:e.value}}return i}function m(e,t,n,i){return u(e).then(t,n,i)}function g(e){if(v(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function v(e){return t(e)&&"function"==typeof e.promiseDispatch&&"function"==typeof e.inspect}function _(e){return t(e)&&"function"==typeof e.then}function b(e){return v(e)&&"pending"===e.inspect().state}function y(e){return!v(e)||"fulfilled"===e.inspect().state}function w(e){return v(e)&&"rejected"===e.inspect().state}function C(){it.length=0,rt.length=0,at||(at=!0)}function L(e,t){at&&(rt.push(e),t&&void 0!==t.stack?it.push(t.stack):it.push("(no stack) "+t))}function x(e){if(at){var t=Z(rt,e);-1!==t&&(rt.splice(t,1),it.splice(t,1))}}function M(e){var t=f({when:function(t){return t&&x(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return L(t,e),t}function E(e){return f({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},"delete":function(t){delete e[t]},post:function(t,n){return null===t||void 0===t?e.apply(void 0,n):e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return et(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function S(e){var t=h();return Y(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}}),t.promise}function O(e){return f({isDef:function(){}},function(t,n){return A(e,t,n)},function(){return u(e).inspect()})}function T(e,t,n){return u(e).spread(t,n)}function z(e){return function(){function t(e,t){var s;if("undefined"==typeof StopIteration){try{s=i[e](t)}catch(o){return M(o)}return s.done?s.value:m(s.value,r,a)}try{s=i[e](t)}catch(o){return n(o)?o.value:M(o)}return m(s,r,a)}var i=e.apply(this,arguments),r=t.bind(t,"next"),a=t.bind(t,"throw");return r()}}function P(e){u.done(u.async(e)())}function D(e){throw new W(e)}function k(e){return function(){return T([this,j(arguments)],function(t,n){return e.apply(t,n)})}}function A(e,t,n){return u(e).dispatch(t,n)}function j(e){return m(e,function(e){var t=0,n=h();return K(e,function(i,r,a){var s;v(r)&&"fulfilled"===(s=r.inspect()).state?e[a]=s.value:(++t,m(r,function(i){e[a]=i,0===--t&&n.resolve(e)},n.reject,function(e){n.notify({index:a,value:e})}))},void 0),0===t&&n.resolve(e),n.promise})}function B(e){return m(e,function(e){return e=J(e,u),m(j(J(e,function(e){return m(e,U,U)})),function(){return e})})}function I(e){return u(e).allSettled()}function R(e,t){return u(e).then(void 0,void 0,t)}function N(e,t){return u(e).nodeify(t)}var F=!1;try{throw Error()}catch(q){F=!!q.stack}var V,W,H=l(),U=function(){},Y=function(){function e(){for(;t.next;){t=t.next;var n=t.task;t.task=void 0;var r=t.domain;r&&(t.domain=void 0,r.enter());try{n()}catch(s){if(a)throw r&&r.exit(),setTimeout(e,0),r&&r.enter(),s;setTimeout(function(){throw s},0)}r&&r.exit()}i=!1}var t={task:void 0,next:null},n=t,i=!1,r=void 0,a=!1;if(Y=function(e){n=n.next={task:e,domain:a&&process.domain,next:null},i||(i=!0,r())},"undefined"!=typeof process&&process.nextTick)a=!0,r=function(){process.nextTick(e)};else if("function"==typeof setImmediate)r="undefined"!=typeof window?setImmediate.bind(window,e):function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var s=new MessageChannel;s.port1.onmessage=function(){r=o,s.port1.onmessage=e,e()};var o=function(){s.port2.postMessage(0)};r=function(){setTimeout(e,0),o()}}else r=function(){setTimeout(e,0)};return Y}(),X=Function.call,G=e(Array.prototype.slice),K=e(Array.prototype.reduce||function(e,t){var n=0,i=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=i)throw new TypeError}for(;i>n;n++)n in this&&(t=e(t,this[n],n));return t}),Z=e(Array.prototype.indexOf||function(e){for(var t=0;this.length>t;t++)if(this[t]===e)return t;return-1}),J=e(Array.prototype.map||function(e,t){var n=this,i=[];return K(n,function(r,a,s){i.push(e.call(t,a,s,n))},void 0),i}),$=Object.create||function(e){function t(){}return t.prototype=e,new t},Q=e(Object.prototype.hasOwnProperty),et=Object.keys||function(e){var t=[];for(var n in e)Q(e,n)&&t.push(n);return t},tt=e(Object.prototype.toString);W="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var nt="From previous event:";u.resolve=u,u.nextTick=Y,u.longStackSupport=!1,u.defer=h,h.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(G(arguments,1)):e.resolve(n)}},u.Promise=d,u.promise=d,d.race=p,d.all=j,d.reject=M,d.resolve=u,u.passByCopy=function(e){return e},f.prototype.passByCopy=function(){return this},u.join=function(e,t){return u(e).join(t)},f.prototype.join=function(e){return u([this,e]).spread(function(e,t){if(e===t)return e;throw Error("Can't join: not the same: "+e+" "+t)})},u.race=p,f.prototype.race=function(){return this.then(u.race)},u.makePromise=f,f.prototype.toString=function(){return"[object Promise]"},f.prototype.then=function(e,t,n){function r(t){try{return"function"==typeof e?e(t):t}catch(n){return M(n)}}function a(e){if("function"==typeof t){i(e,o);try{return t(e)}catch(n){return M(n)}}return M(e)}function s(e){return"function"==typeof n?n(e):e}var o=this,l=h(),c=!1;return Y(function(){o.promiseDispatch(function(e){c||(c=!0,l.resolve(r(e)))},"when",[function(e){c||(c=!0,l.resolve(a(e)))}])}),o.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=s(e)}catch(i){if(n=!0,!u.onerror)throw i;u.onerror(i)}n||l.notify(t)}]),l.promise},u.when=m,f.prototype.thenResolve=function(e){return this.then(function(){return e})},u.thenResolve=function(e,t){return u(e).thenResolve(t)},f.prototype.thenReject=function(e){return this.then(function(){throw e})},u.thenReject=function(e,t){return u(e).thenReject(t)},u.nearer=g,u.isPromise=v,u.isPromiseAlike=_,u.isPending=b,f.prototype.isPending=function(){return"pending"===this.inspect().state},u.isFulfilled=y,f.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},u.isRejected=w,f.prototype.isRejected=function(){return"rejected"===this.inspect().state};var it=[],rt=[],at=!0;u.resetUnhandledRejections=C,u.getUnhandledReasons=function(){return it.slice()},u.stopUnhandledRejectionTracking=function(){C(),at=!1},C(),u.reject=M,u.fulfill=E,u.master=O,u.spread=T,f.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},u.async=z,u.spawn=P,u["return"]=D,u.promised=k,u.dispatch=A,f.prototype.dispatch=function(e,t){var n=this,i=h();return Y(function(){n.promiseDispatch(i.resolve,e,t)}),i.promise},u.get=function(e,t){return u(e).dispatch("get",[t])},f.prototype.get=function(e){return this.dispatch("get",[e])},u.set=function(e,t,n){return u(e).dispatch("set",[t,n])},f.prototype.set=function(e,t){return this.dispatch("set",[e,t])},u.del=u["delete"]=function(e,t){return u(e).dispatch("delete",[t])},f.prototype.del=f.prototype["delete"]=function(e){return this.dispatch("delete",[e])},u.mapply=u.post=function(e,t,n){return u(e).dispatch("post",[t,n])},f.prototype.mapply=f.prototype.post=function(e,t){return this.dispatch("post",[e,t])},u.send=u.mcall=u.invoke=function(e,t){return u(e).dispatch("post",[t,G(arguments,2)])},f.prototype.send=f.prototype.mcall=f.prototype.invoke=function(e){return this.dispatch("post",[e,G(arguments,1)])},u.fapply=function(e,t){return u(e).dispatch("apply",[void 0,t])},f.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},u["try"]=u.fcall=function(e){return u(e).dispatch("apply",[void 0,G(arguments,1)])},f.prototype.fcall=function(){return this.dispatch("apply",[void 0,G(arguments)])},u.fbind=function(e){var t=u(e),n=G(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(G(arguments))])}},f.prototype.fbind=function(){var e=this,t=G(arguments);return function(){return e.dispatch("apply",[this,t.concat(G(arguments))])}},u.keys=function(e){return u(e).dispatch("keys",[])},f.prototype.keys=function(){return this.dispatch("keys",[])},u.all=j,f.prototype.all=function(){return j(this)},u.allResolved=c(B,"allResolved","allSettled"),f.prototype.allResolved=function(){return B(this)},u.allSettled=I,f.prototype.allSettled=function(){return this.then(function(e){return j(J(e,function(e){function t(){return e.inspect()}return e=u(e),e.then(t,t)}))})},u.fail=u["catch"]=function(e,t){return u(e).then(void 0,t)},f.prototype.fail=f.prototype["catch"]=function(e){return this.then(void 0,e)},u.progress=R,f.prototype.progress=function(e){return this.then(void 0,void 0,e)
},u.fin=u["finally"]=function(e,t){return u(e)["finally"](t)},f.prototype.fin=f.prototype["finally"]=function(e){return e=u(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},u.done=function(e,t,n,i){return u(e).done(t,n,i)},f.prototype.done=function(e,t,n){var r=function(e){Y(function(){if(i(e,a),!u.onerror)throw e;u.onerror(e)})},a=e||t||n?this.then(e,t,n):this;"object"==typeof process&&process&&process.domain&&(r=process.domain.bind(r)),a.then(void 0,r)},u.timeout=function(e,t,n){return u(e).timeout(t,n)},f.prototype.timeout=function(e,t){var n=h(),i=setTimeout(function(){n.reject(Error(t||"Timed out after "+e+" ms"))},e);return this.then(function(e){clearTimeout(i),n.resolve(e)},function(e){clearTimeout(i),n.reject(e)},n.notify),n.promise},u.delay=function(e,t){return void 0===t&&(t=e,e=void 0),u(e).delay(t)},f.prototype.delay=function(e){return this.then(function(t){var n=h();return setTimeout(function(){n.resolve(t)},e),n.promise})},u.nfapply=function(e,t){return u(e).nfapply(t)},f.prototype.nfapply=function(e){var t=h(),n=G(e);return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},u.nfcall=function(e){var t=G(arguments,1);return u(e).nfapply(t)},f.prototype.nfcall=function(){var e=G(arguments),t=h();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},u.nfbind=u.denodeify=function(e){var t=G(arguments,1);return function(){var n=t.concat(G(arguments)),i=h();return n.push(i.makeNodeResolver()),u(e).fapply(n).fail(i.reject),i.promise}},f.prototype.nfbind=f.prototype.denodeify=function(){var e=G(arguments);return e.unshift(this),u.denodeify.apply(void 0,e)},u.nbind=function(e,t){var n=G(arguments,2);return function(){function i(){return e.apply(t,arguments)}var r=n.concat(G(arguments)),a=h();return r.push(a.makeNodeResolver()),u(i).fapply(r).fail(a.reject),a.promise}},f.prototype.nbind=function(){var e=G(arguments,0);return e.unshift(this),u.nbind.apply(void 0,e)},u.nmapply=u.npost=function(e,t,n){return u(e).npost(t,n)},f.prototype.nmapply=f.prototype.npost=function(e,t){var n=G(t||[]),i=h();return n.push(i.makeNodeResolver()),this.dispatch("post",[e,n]).fail(i.reject),i.promise},u.nsend=u.nmcall=u.ninvoke=function(e,t){var n=G(arguments,2),i=h();return n.push(i.makeNodeResolver()),u(e).dispatch("post",[t,n]).fail(i.reject),i.promise},f.prototype.nsend=f.prototype.nmcall=f.prototype.ninvoke=function(e){var t=G(arguments,1),n=h();return t.push(n.makeNodeResolver()),this.dispatch("post",[e,t]).fail(n.reject),n.promise},u.nodeify=N,f.prototype.nodeify=function(e){return e?(this.then(function(t){Y(function(){e(null,t)})},function(t){Y(function(){e(t)})}),void 0):this};var st=l();return u}),montageDefine("703617f","package.json",{exports:{name:"albumexperience",version:"0.1.0",dependencies:{montage:"~0.14.2",digit:"~0.5.0"},bundle:["ui/main.reel"],shard:4,hash:"703617f",mappings:{montage:{name:"montage",hash:"b15df60",location:"packages/montage@b15df60/"},digit:{name:"digit",hash:"69f9379",location:"packages/digit@69f9379/"}},production:!0,useScriptInjection:!0}}),montageDefine("b15df60","package.json",{exports:{name:"montage",version:"0.14.10",description:"Build your next application with a browser based platform that really gets the web.",repository:{type:"git",url:"https://github.com/montagejs/montage.git"},main:"core/core",dependencies:{collections:"~1.0.0",frb:"~0.2.17",mousse:"~0.3.0",htmlparser2:"~3.0.5"},devDependencies:{"montage-testing":"~0.4.0",mr:"~0.15.3",q:"1.0.0","q-io":"~1.11.0",jshint:"~2.4.4"},scripts:{test:"node test/node/node-spec.js",jsdoc:"node ../montagejs.org/build/jsdoc/jsdoc.js -out $PWD/builds/jsdoc/ montage@npm-link"},exclude:["test","tools"],readmeFilename:"README.md",bugs:{url:"https://github.com/montagejs/montage/issues"},homepage:"https://github.com/montagejs/montage",_id:"montage@0.14.10",dist:{shasum:"303a2ee21abc5f1838b30234188e740577e59d9d"},_from:"montage@~0.14.2",_resolved:"https://registry.npmjs.org/montage/-/montage-0.14.10.tgz",redirects:{montage:"core/core"},mappings:{mr:{name:"mr",hash:"7366ba0",location:"../mr@7366ba0/"},q:{name:"q",hash:"318ab79",location:"../q@318ab79/"},collections:{name:"collections",hash:"2a4cabc",location:"../collections@2a4cabc/"},frb:{name:"frb",hash:"99596c3",location:"../frb@99596c3/"},mousse:{name:"mousse",hash:"d1a4ba1",location:"../mousse@d1a4ba1/"},htmlparser2:{name:"htmlparser2",hash:"8309129",location:"../htmlparser2@8309129/"}},hash:"b15df60",production:!0,useScriptInjection:!0}}),montageDefine("d1a4ba1","package.json",{exports:{name:"mousse",version:"0.3.0",description:"Deserialization of JavaScript objects",keywords:["deserialization","serialization"],author:{name:"António Afonso",email:"antonio.afonso@gmail.com",url:"http://github.com/aadsm/"},contributors:[{name:"António Afonso",email:"antonio.afonso@gmail.com",url:"http://github.com/aadsm/"}],bugs:{url:"http://github.com/montagejs/mousse/issues"},licenses:[{type:"BSD",url:"http://github.com/montagejs/mousse/raw/master/LICENSE.md"}],repository:{type:"git",url:"http://github.com/montagejs/mousse.git"},main:"mousse",dependencies:{q:"~0.9.6",collections:"~0.1.21"},devDependencies:{"jasmine-node":"~1.9.1"},scripts:{test:"jasmine-node spec"},readmeFilename:"README.md",homepage:"https://github.com/montagejs/mousse",_id:"mousse@0.3.0",_from:"mousse@~0.3.0",hash:"d1a4ba1",mappings:{q:{name:"q",hash:"318ab79",location:"../q@318ab79/"},collections:{name:"collections",hash:"2a4cabc",location:"../collections@2a4cabc/"}},production:!0,useScriptInjection:!0}}),montageDefine("2a4cabc","package.json",{exports:{name:"collections",version:"1.0.2",description:"data structures with idiomatic JavaScript collection interfaces",homepage:"http://github.com/montagejs/collections",author:{name:"Kris Kowal",email:"kris@cixar.com",url:"http://github.com/kriskowal"},keywords:["collections","data structures","observable","list","set","map","splay"],bugs:{url:"http://github.com/montagejs/collections/issues"},licenses:[{type:"MIT",url:"https://raw.github.com/montagejs/collections/master/LICENSE.md"}],repository:{type:"git",url:"http://github.com/montagejs/collections.git"},dependencies:{"weak-map":"1.0.0"},devDependencies:{"jasmine-node":"*",istanbul:"*",opener:"*"},scripts:{test:"jasmine-node spec",cover:"istanbul cover node_modules/jasmine-node/bin/jasmine-node spec && istanbul report html && opener coverage/index.html"},readmeFilename:"README.md",_id:"collections@1.0.2",_from:"collections@~1.0.0",hash:"2a4cabc",mappings:{"weak-map":{name:"weak-map",hash:"39386c7",location:"../weak-map@39386c7/"}},production:!0,useScriptInjection:!0}}),montageDefine("99596c3","package.json",{exports:{name:"frb",version:"0.2.17",description:"Functional reactive bindings",keywords:["functional","reactive","bindings","observe","change"],author:{name:"Kris Kowal",email:"kris@cixar.com",url:"http://github.com/kriskowal/"},contributors:[{name:"Kris Kowal",email:"kris@cixar.com",url:"http://github.com/kriskowal/"}],bugs:{url:"http://github.com/kriskowal/frb/issues"},licenses:[{type:"MIT",url:"http://github.com/kriskowal/frb/raw/master/LICENSE.md"}],repository:{type:"git",url:"http://github.com/kriskowal/frb.git"},main:"bindings",dependencies:{collections:"~0.2.2"},devDependencies:{"jasmine-node":"1.x.x",pegjs:"git://github.com/dmajda/pegjs.git"},scripts:{test:"jasmine-node spec","build-parser":"pegjs --allowed-start-rules expression,sheet grammar.pegjs"},readmeFilename:"README.md",homepage:"https://github.com/kriskowal/frb",_id:"frb@0.2.17",_from:"frb@~0.2.17",hash:"99596c3",mappings:{collections:{name:"collections",hash:"2a4cabc",location:"../collections@2a4cabc/"}},production:!0,useScriptInjection:!0}}),montageDefine("318ab79","package.json",{exports:{name:"q",version:"1.0.1",description:"A library for promises (CommonJS/Promises/A,B,D)",homepage:"https://github.com/kriskowal/q",author:"Kris Kowal <kris@cixar.com> (https://github.com/kriskowal)",keywords:["q","promise","promises","promises-a","promises-aplus","deferred","future","async","flow control","fluent","browser","node"],contributors:["Kris Kowal <kris@cixar.com> (https://github.com/kriskowal)","Irakli Gozalishvili <rfobic@gmail.com> (http://jeditoolkit.com)","Domenic Denicola <domenic@domenicdenicola.com> (http://domenicdenicola.com)"],bugs:{mail:"kris@cixar.com",url:"http://github.com/kriskowal/q/issues"},license:{type:"MIT",url:"http://github.com/kriskowal/q/raw/master/LICENSE"},main:"q.js",repository:{type:"git",url:"git://github.com/kriskowal/q.git"},engines:{node:">=0.6.0",teleport:">=0.2.0"},dependencies:{},devDependencies:{jshint:"~2.1.9",cover:"*","jasmine-node":"1.11.0",opener:"*","promises-aplus-tests":"1.x",grunt:"~0.4.1","grunt-cli":"~0.1.9","grunt-contrib-uglify":"~0.2.2",matcha:"~0.2.0"},scripts:{test:"jasmine-node spec && promises-aplus-tests spec/aplus-adapter","test-browser":"opener spec/q-spec.html",benchmark:"matcha",lint:"jshint q.js",cover:"cover run node_modules/jasmine-node/bin/jasmine-node spec && cover report html && opener cover_html/index.html",minify:"grunt",prepublish:"grunt"},directories:{test:"./spec"},hash:"318ab79",mappings:{},production:!0,useScriptInjection:!0}}),montageDefine("39386c7","package.json",{exports:{name:"weak-map",version:"1.0.0",main:"weak-map.js",_id:"weak-map@1.0.0",_from:"weak-map@1.0.0",hash:"39386c7",mappings:{},production:!0,useScriptInjection:!0}}),montageDefine("69f9379","package.json",{exports:{name:"digit",version:"0.5.1",repository:{type:"git",url:"https://github.com/montagejs/digit.git"},dependencies:{montage:"~0.14.0",matte:"~0.2.0"},devDependencies:{"montage-testing":"~0.4.0"},exclude:["overview.html","overview","run-tests.html","test"],readmeFilename:"README.md",description:"![digit](overview/assets/images/icon.png)",bugs:{url:"https://github.com/montagejs/digit/issues"},homepage:"https://github.com/montagejs/digit",_id:"digit@0.5.1",_from:"digit@~0.5.0",hash:"69f9379",mappings:{montage:{name:"montage",hash:"b15df60",location:"../montage@b15df60/"},matte:{name:"matte",hash:"ba9c197",location:"../matte@ba9c197/"}},production:!0,useScriptInjection:!0}}),montageDefine("ba9c197","package.json",{exports:{name:"matte",version:"0.2.0",repository:{type:"git",url:"https://github.com/montagejs/matte.git"},dependencies:{montage:"~0.14.0","native":"~0.2.0"},devDependencies:{"montage-testing":"~0.4.0"},exclude:["overview.html","overview","run-tests.html","test"],readmeFilename:"README.md",description:"matte ==============",bugs:{url:"https://github.com/montagejs/matte/issues"},homepage:"https://github.com/montagejs/matte",_id:"matte@0.2.0",_from:"matte@~0.2.0",hash:"ba9c197",mappings:{montage:{name:"montage",hash:"b15df60",location:"../montage@b15df60/"},"native":{name:"native",hash:"192b8e1",location:"../native@192b8e1/"}},production:!0,useScriptInjection:!0}}),montageDefine("703617f","index.html",{text:'<!DOCTYPE html><html><head>\n    <meta name=viewport content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">\n    <link rel=stylesheet type=text/css href=css/base.css>\n    <title>iTunes LP for Nine Inch Nails - Ghost</title>\n    <script src=packages/montage@b15df60/montage.js data-package=.></script>\n    <script type=text/montage-serialization>{"facade":{"prototype":"ui/facade.reel","properties":{"element":{"#":"facade"}}}}</script>\n</head>\n<body>\n    <div data-montage-id=bleed class=bleed>\n      <div data-montage-id=facade></div>\n    </div>\n\n\n\n</body></html>'}),montageDefine("703617f","ui/facade.reel/facade",{dependencies:["montage/core/core","montage/ui/component"],factory:function(e,t){var n=(e("montage/core/core").Montage,e("montage/ui/component").Component);t.Facade=n.specialize({iTunes:{value:!1,serializable:!0},appData:{value:null,serializable:!0},audioLoop:{value:null,serializable:!0},slot:{value:null,serializable:!0},homeContent:{value:null,serializable:!0},galleryContent:{value:null,serializable:!0},songlistContent:{value:null,serializable:!0},songContent:{value:null,serializable:!0},creditsContent:{value:null,serializable:!0},player:{value:null,serializable:!0},playList:{value:!1,serializable:!0},currentSong:{value:null,serializable:!0},currentSection:{value:null,serializable:!0},templateDidLoad:{value:function(){this.application.facade=this}},enterDocument:{value:function(){window.iTunes&&(this.iTunes=!0,window.addEventListener("play",this,!1)),this.currentSong=this.appData.songs[0].src,document.addEventListener("touchmove",function(e){e.preventDefault()},!1),this.startApp()}},startApp:{value:function(){this.switchView("home")}},playerStopped:{value:function(){this.playNextSong()}},playSong:{value:function(e){this.currentSong=e,this.iTunes?window.iTunes.play(this.currentSong):(this.songContent.switchVisualizer(),this.player.playSong(this.currentSong))}},playNextSong:{value:function(){var e=this.getNextSong(this.currentSong);this.playSong(e)}},getNextSong:{value:function(e){for(var t=null,n=this.appData.songs,i=0,r=n.length;r>i;i++)if(n[i].src==e){t=n[i+1]?n[i+1].src:n[0].src;break}return t}},playPrevSong:{value:function(){var e=this.getPrevSong(this.currentSong);this.playSong(e)}},getPrevSong:{value:function(e){for(var t=null,n=this.appData.songs,i=0,r=n.length;r>i;i++)if(n[i].src==e){t=n[i-1]?n[i-1].src:n[r-1].src;break}return t}},buildNonLibraryPlayList:{value:function(e){for(var t=iTunes.createTempPlaylist(),n=[],i=0;e.length>i;i++){var r={};r.url=e[i].src,r.title=e[i].title,r.artist=this.appData.feature.artist,r.album=this.appData.feature.title,n.push(r)}return t.addURLs(n),t}},playSonglistSong:{value:function(e){this.songContent.backParameter="songlist",this.switchView("song"),this.playSong(e)}},playAlbum:{value:function(){if(this.songContent.backParameter="home",this.switchView("song"),this.iTunes){var e=this.buildNonLibraryPlayList(this.appData.songs);e.play()}else this.playSong(this.appData.songs[0].src)}},switchView:{value:function(e){this.currentSection=this[e+"Content"]}},goBackFrom:{value:function(){this.switchView("home")}}})}}),montageDefine("703617f","ui/facade.reel/facade.html",{text:'<!DOCTYPE html><html><head>\n        <meta http-equiv=content-type content="text/html; charset=utf-8">\n\n        <link rel=stylesheet type=text/css href=facade.css>\n\n        <script type=text/montage-serialization>{"appdata":{"prototype":"model/appdata"},"slot":{"prototype":"montage/ui/slot.reel","properties":{"element":{"#":"facade-content"}},"bindings":{"content":{"<-":"@owner.currentSection"}}},"home":{"prototype":"ui/home.reel"},"gallery":{"prototype":"ui/gallery.reel"},"songlist":{"prototype":"ui/songlist.reel"},"song":{"prototype":"ui/song.reel"},"credits":{"prototype":"ui/credits.reel"},"player":{"prototype":"ui/player.reel","properties":{"element":{"#":"player"}}},"owner":{"prototype":"ui/facade.reel","properties":{"element":{"#":"facade"},"appData":{"@":"appdata"},"slot":{"@":"slot"},"homeContent":{"@":"home"},"galleryContent":{"@":"gallery"},"creditsContent":{"@":"credits"},"songlistContent":{"@":"songlist"},"songContent":{"@":"song"},"player":{"@":"player"}}}}</script>\n\n    </head>\n\n    <body>\n        <div data-montage-id=facade class=facade>\n            <div data-montage-id=facade-content class=facade-content></div>\n            <div data-montage-id=player class=player></div>\n        </div>\n        <div data-montage-id=home class=home></div>\n        <div data-montage-id=gallery class=gallery></div>\n    \n\n\n</body></html>'}),montageDefine("703617f","model/appdata",{dependencies:["montage/core/core"],factory:function(e,t){var n=e("montage/core/core").Montage;t.Appdata=n.create(n,{feature:{value:{artist:"Nine Inch Nails",title:"Ghost I-IV"}},gallery:{value:[{src:"ui/gallery.reel/images/1.jpg"},{src:"ui/gallery.reel/images/2.jpg"},{src:"ui/gallery.reel/images/3.jpg"},{src:"ui/gallery.reel/images/4.jpg"},{src:"ui/gallery.reel/images/5.jpg"},{src:"ui/gallery.reel/images/6.jpg"},{src:"ui/gallery.reel/images/7.jpg"},{src:"ui/gallery.reel/images/8.jpg"},{src:"ui/gallery.reel/images/9.jpg"},{src:"ui/gallery.reel/images/10.jpg"},{src:"ui/gallery.reel/images/11.jpg"},{src:"ui/gallery.reel/images/12.jpg"},{src:"ui/gallery.reel/images/13.jpg"},{src:"ui/gallery.reel/images/14.jpg"},{src:"ui/gallery.reel/images/15.jpg"},{src:"ui/gallery.reel/images/17.jpg"},{src:"ui/gallery.reel/images/18.jpg"},{src:"ui/gallery.reel/images/19.jpg"},{src:"ui/gallery.reel/images/20.jpg"},{src:"ui/gallery.reel/images/21.jpg"},{src:"ui/gallery.reel/images/22.jpg"},{src:"ui/gallery.reel/images/23.jpg"}]},songs:{value:[{src:"assets/tracks/01.mp3",title:"1 Ghosts I",duration:"2:48"},{src:"assets/tracks/02.mp3",title:"2 Ghosts I",duration:"3:16"},{src:"assets/tracks/03.mp3",title:"3 Ghosts I",duration:"3:51"},{src:"assets/tracks/04.mp3",title:"4 Ghosts I",duration:"2:13"},{src:"assets/tracks/05.mp3",title:"5 Ghosts I",duration:"2:51"},{src:"assets/tracks/06.mp3",title:"6 Ghosts I",duration:"4:18"},{src:"assets/tracks/07.mp3",title:"7 Ghosts I",duration:"2:00"},{src:"assets/tracks/08.mp3",title:"8 Ghosts I",duration:"2:56"},{src:"assets/tracks/09.mp3",title:"9 Ghosts I",duration:"2:47"}]}})}}),montageDefine("703617f","ui/home.reel/home",{dependencies:["montage/core/core","montage/ui/component"],factory:function(e,t){var n=e("montage/core/core").Montage,i=e("montage/ui/component").Component;t.Home=n.create(i,{handleGoSongListAction:{value:function(){this.application.facade.switchView("songlist")}},handleGoGalleryAction:{value:function(){this.application.facade.switchView("gallery")}},handleGoCreditsAction:{value:function(){this.application.facade.switchView("credits")}},handlePlayAlbumAction:{value:function(){this.application.facade.playAlbum()}}})}}),montageDefine("703617f","ui/gallery.reel/gallery",{dependencies:["montage/core/core","montage/ui/component"],factory:function(e,t){var n=e("montage/core/core").Montage,i=e("montage/ui/component").Component;t.Gallery=n.create(i,{flow:{serializable:!0,value:null},enterDocument:{value:function(){this.flow.scroll=999999}},handleGoBackAction:{value:function(){this.application.facade.goBackFrom(this)}}})}}),montageDefine("703617f","ui/songlist.reel/songlist",{dependencies:["montage/core/core","montage/ui/component"],factory:function(e,t){var n=e("montage/core/core").Montage,i=e("montage/ui/component").Component;t.Songlist=n.create(i,{buttonController:{value:null,serializable:!0},enterDocument:{value:function(e){e&&this.buttonController.addPathChangeListener("selectedIndexes",function(e,t,n){console.log("selectedIndexes",n)},!1)}},handleGoBackAction:{value:function(){this.application.facade.goBackFrom(this)}}})}}),montageDefine("703617f","ui/song.reel/song",{dependencies:["montage/core/core","montage/ui/component"],factory:function(e,t){var n=e("montage/core/core").Montage,i=e("montage/ui/component").Component;t.Song=n.create(i,{_paused:{value:!0},paused:{set:function(e){this._paused=e,this.playButton.label=e?"Play":"Pause"},get:function(){return this._paused}},currentVisualizer:{value:0},visElement:{value:null},playButton:{value:null},backParameter:{value:null},visualizers:{value:["song1","song2","song3","song4","song5","song6","song10","song7","song8","song9"]},handleGoBackAction:{value:function(){this.visElement.classList.remove("on"),this.visElement.classList.remove(this.visualizers[this.currentVisualizer]),this.application.facade.switchView(this.backParameter)}},handleTogglePlayPauseAction:{value:function(){this.application.facade.player.togglePlayPause()}},handlePlayNextSongAction:{value:function(){this.visElement&&this.application.facade.playNextSong()}},handlePlayPrevSongAction:{value:function(){this.visElement&&this.application.facade.playPrevSong()}},willDraw:{value:function(){this.application.facade.iTunes&&(this.playButton.element.hidden=!0);var e=this;setTimeout(function(){e.visElement.classList.add(e.visualizers[e.currentVisualizer]),e.visElement.classList.add("on")},300)}},switchVisualizer:{value:function(){if(this.visElement){for(this.visElement.classList.remove("on"),this.visElement.classList.remove(this.visualizers[this.currentVisualizer]);this.visElement.hasChildNodes();)this.visElement.removeChild(this.visElement.lastChild);if(this.currentVisualizer+1<this.visualizers.length?this.currentVisualizer++:this.currentVisualizer=0,"song10"!=this.visualizers[this.currentVisualizer]){var e=document.createElement("div");e.classList.add("outer");var t=document.createElement("div");t.classList.add("inner"),e.appendChild(t),this.visElement.appendChild(e)}else if("song10"==this.visualizers[this.currentVisualizer]){var e=document.createElement("div");e.classList.add("outer");var t=document.createElement("div");t.classList.add("inner"),t.appendChild(document.createElement("div")),t.lastChild.appendChild(document.createElement("div")),t.lastChild.lastChild.appendChild(document.createElement("div")),e.appendChild(t),this.visElement.appendChild(e)}this.visElement.classList.add("on"),this.visElement.classList.add(this.visualizers[this.currentVisualizer])}}}})}}),montageDefine("703617f","ui/credits.reel/credits",{dependencies:["montage/core/core","montage/ui/component"],factory:function(e,t){var n=e("montage/core/core").Montage,i=e("montage/ui/component").Component;t.Credits=n.create(i,{prepareForActivationEvents:{value:function(){this.addEventListener("action",this)}},handleGoBackAction:{value:function(){this.application.facade.goBackFrom(this)}}})}}),montageDefine("703617f","ui/player.reel/player",{dependencies:["montage/core/core","montage/ui/component"],factory:function(e,t){var n=e("montage/core/core").Montage,i=e("montage/ui/component").Component;t.Player=n.create(i,{audioTag:{value:null,serializable:!0},paused:{value:!0,serializable:!0},prepareForActivationEvents:{value:function(){this.eventManager.addEventListener("playerPlaySong",this,!1),this.eventManager.addEventListener("togglePlayPause",this,!1),this.audioTag.addEventListener("ended",this,!1)}},playSong:{value:function(e){this.audioTag.src=e,this.audioTag.load(),this.audioTag.play(),this.paused=!1,console.log("player play song",e)}},handleEnded:{value:function(){this.application.facade.playerStopped(),this.audioTag.addEventListener("ended",this,!1)}},togglePlayPause:{value:function(){this.paused?(this.audioTag.play(),this.paused=!1):(this.audioTag.pause(),this.paused=!0)}}})}}),montageDefine("703617f","ui/home.reel/home.html",{text:'<!DOCTYPE html><html><head>\n        <meta http-equiv=content-type content="text/html; charset=utf-8">\n\n        <link rel=stylesheet type=text/css href=home.css>\n\n        <script type=text/montage-serialization>{"owner":{"prototype":"ui/home.reel","properties":{"element":{"#":"home"}}},"play":{"prototype":"digit/ui/button.reel","properties":{"element":{"#":"play-btn"},"identifier":"playAlbum"},"listeners":[{"type":"action","listener":{"@":"owner"}}]},"gallery":{"prototype":"digit/ui/button.reel","properties":{"element":{"#":"gallery-btn"},"identifier":"goGallery"},"listeners":[{"type":"action","listener":{"@":"owner"}}]},"songlist":{"prototype":"digit/ui/button.reel","properties":{"element":{"#":"songlist-btn"},"identifier":"goSongList"},"listeners":[{"type":"action","listener":{"@":"owner"}}]},"credits":{"prototype":"digit/ui/button.reel","properties":{"element":{"#":"credits-btn"},"identifier":"goCredits"},"listeners":[{"type":"action","listener":{"@":"owner"}}]}}</script>\n\n    </head>\n\n    <body>\n          <div data-montage-id=home class=home>\n              <button data-montage-id=play-btn class=play-btn>▶ Play</button>\n              <div class="menu dark">\n                  <button data-montage-id=songlist-btn class=songlist-btn>Song List</button>\n                  <button data-montage-id=gallery-btn class=gallery-btn>Gallery</button>\n                  <button data-montage-id=credits-btn class=credits-btn>Credits</button>\n              </div>\n        </div>\n\n    \n\n\n</body></html>'}),montageDefine("703617f","ui/gallery.reel/gallery.html",{text:'<!DOCTYPE html><html><head>\n        <meta http-equiv=content-type content="text/html; charset=utf-8">\n\n        <link rel=stylesheet type=text/css href=gallery.css>\n\n        <script type=text/montage-serialization>{"arraycontroller":{"prototype":"montage/core/range-controller","properties":{"selectObjectsOnAddition":true,"automaticallyOrganizeObjects":true},"bindings":{"content":{"<-":"@owner.application.facade.appData.gallery"}}},"list":{"prototype":"montage/ui/flow.reel","properties":{"element":{"#":"gallery-container"},"contentController":{"@":"arraycontroller"},"cameraPosition":[-220,0,350],"cameraTargetPoint":[-145,0,0],"stride":1,"cameraFov":80,"paths":[{"knots":[{"knotPosition":[-2100,0,-2100],"previousHandlerPosition":[-2200,0,-2200],"nextHandlerPosition":[-2000,0,-2000],"previousDensity":1,"nextDensity":1,"opacity":0,"rotateY":0,"rotateZ":0},{"knotPosition":[-1800,0,-1800],"previousHandlerPosition":[-1900,0,-1900],"nextHandlerPosition":[-1700,0,-1700],"previousDensity":1,"nextDensity":1,"opacity":0.25,"rotateY":0,"rotateZ":0},{"knotPosition":[-1500,0,-1500],"previousHandlerPosition":[-1600,0,-1600],"nextHandlerPosition":[-1400,0,-1400],"previousDensity":1,"nextDensity":1,"opacity":0.5,"rotateY":0,"rotateZ":0},{"knotPosition":[-1200,0,-1200],"previousHandlerPosition":[-1300,0,-1300],"nextHandlerPosition":[-1100,0,-1100],"previousDensity":1,"nextDensity":1,"opacity":0.75,"rotateY":0,"rotateZ":0},{"knotPosition":[-900,0,-900],"previousHandlerPosition":[-1000,0,-1000],"nextHandlerPosition":[-800,0,-800],"previousDensity":1,"nextDensity":1,"opacity":0.999,"rotateY":0,"rotateZ":0},{"knotPosition":[-600,0,-600],"previousHandlerPosition":[-700,0,-700],"nextHandlerPosition":[-500,0,-500],"previousDensity":1,"nextDensity":1,"opacity":0.999,"rotateY":0,"rotateZ":0},{"knotPosition":[-300,0,-300],"previousHandlerPosition":[-400,0,-400],"nextHandlerPosition":[-200,0,-200],"previousDensity":1,"nextDensity":1,"opacity":0.999,"rotateY":0,"rotateZ":0},{"knotPosition":[0,0,0],"previousHandlerPosition":[-100,0,-100],"nextHandlerPosition":[100,0,100],"previousDensity":1,"nextDensity":1,"opacity":0.999,"rotateY":-0.21,"rotateZ":0},{"knotPosition":[300,60,300],"previousHandlerPosition":[200,40,200],"previousDensity":1,"nextDensity":1,"opacity":0,"rotateY":-0.42,"rotateZ":0.4}],"headOffset":7,"tailOffset":7,"units":{"opacity":"","rotateZ":"rad","rotateY":"rad"}}]}},"galleryimage":{"prototype":"ui/image.reel","properties":{"element":{"#":"gallery-image"}},"bindings":{"src":{"<-":"@list:iteration.object.src"}}},"homebtn":{"prototype":"digit/ui/button.reel","properties":{"element":{"#":"home-btn"},"identifier":"goBack"},"listeners":[{"type":"action","listener":{"@":"owner"}}]},"owner":{"module":"ui/gallery.reel","name":"Gallery","properties":{"element":{"#":"gallery"},"flow":{"@":"list"}}}}</script>\n\n    </head>\n\n    <body>\n\n        <div data-montage-id=gallery class=gallery>\n          <div class=buttons>\n              <button data-montage-id=home-btn class=home-btn>Home</button>\n          </div>\n          <div data-montage-id=gallery-container class=gallery-container>\n                <div data-montage-id=gallery-image class=gallery-image></div>\n          </div>\n\n        </div>\n\n    \n\n\n</body></html>'}),montageDefine("703617f","ui/songlist.reel/songlist.html",{text:'<!DOCTYPE html><html><head>\n        <meta http-equiv=content-type content="text/html; charset=utf-8">\n\n        <link rel=stylesheet type=text/css href=songlist.css>\n\n        <script type=text/montage-serialization>{"arraycontroller":{"prototype":"montage/core/range-controller","properties":{"selectObjectsOnAddition":true,"automaticallyOrganizeObjects":true},"bindings":{"content":{"<-":"@owner.application.facade.appData.songs"}}},"list":{"prototype":"digit/ui/list.reel","properties":{"element":{"#":"songs-container"},"isSelectionEnabled":true,"contentController":{"@":"arraycontroller"},"axis":"vertical"}},"dynamictext":{"prototype":"montage/ui/text.reel","properties":{"element":{"#":"title"}},"bindings":{"value":{"<-":"@list:iteration.object.title"}}},"duration":{"prototype":"montage/ui/text.reel","properties":{"element":{"#":"duration"}},"bindings":{"value":{"<-":"@list:iteration.object.duration"}}},"homebtn":{"prototype":"digit/ui/button.reel","properties":{"element":{"#":"home-btn"},"identifier":"goBack"},"listeners":[{"type":"action","listener":{"@":"owner"}}]},"owner":{"prototype":"ui/songlist.reel","properties":{"element":{"#":"songlist"},"buttonController":{"@":"arraycontroller"}}}}</script>\n\n    </head>\n\n    <body>\n\n        <div data-montage-id=songlist class=songlist>\n\n            <div class=buttons>\n                <button data-montage-id=home-btn class=home-btn>Home</button>\n            </div>\n\n            <div class="cover play"></div>\n\n            <div data-montage-id=songs-container class=songs-container>\n                <div data-montage-id=song-button class=song-button>\n                     <div class=title><span data-montage-id=title></span><span data-montage-id=duration class=duration></span></div>\n                </div>\n            </div>\n\n        </div>\n\n    \n\n\n</body></html>'}),montageDefine("703617f","ui/credits.reel/credits.html",{text:'<!DOCTYPE html><html><head>\n        <meta http-equiv=content-type content="text/html; charset=utf-8">\n\n        <link rel=stylesheet type=text/css href=credits.css>\n\n        <script type=text/montage-serialization>{"homebtn":{"prototype":"digit/ui/button.reel","properties":{"element":{"#":"home-btn"},"identifier":"goBack"},"listeners":[{"type":"action","listener":{"@":"owner"}}]},"scroller":{"prototype":"ui/scroller.reel","properties":{"element":{"#":"credits-container"}}},"owner":{"prototype":"ui/credits.reel","properties":{"element":{"#":"credits"}}}}</script>\n\n    </head>\n\n    <body>\n\n        <div data-montage-id=credits class=credits>\n\n            <div class=buttons>\n                <button data-montage-id=home-btn class=home-btn>Home</button>\n            </div>\n\n            <div data-montage-id=credits-container class=credits-container>\n\n                <ul class=credits-content>\n                    <li>\n                        <h3>NINE INCH NAILS: GHOSTS I-IV</h3>\n                        <p>Trent Reznor: all performance except as noted, production<br>\n                            Atticus Ross: programming, arranging, production<br>\n                            Alan Moulder: engineering, mix engineering, production\n                        </p>\n\n                        <p>Rob Sheridan: art direction, with Trent Reznor and Artist In Residence With special guests Alessandro Cortini, Adrian Belew and Brian Viglione<br>\n                            Support: Brett Bachemin, Dustin Mosley, Michael Tuller and Alynn Dotson<br>\n                            Management: Rebel Waltz</p>\n\n                        <p>Mastered by Tom Baker, Precision Mastering, Hollywood CA.</p>\n\n                        <p>Photography by Phillip Graybill and Rob Sheridan<br>\n                            Additional photography: Tamar Levine</p>\n\n                        <p>Business management: William Harper and Michael Walsh for Gelfand, Rennert &amp; Feldman, LLP</p>\n\n                        <p>Legal: Gary Stiffelman and David Byrnes Worldwide<br>\n                            booking: Marc Geiger for William Morris Agency</p>\n\n                        <p>Label: The Null Corporation</p>\n\n                        <p>Press: US Steve Martin (Nasty Little Man) UK Frances McCahon (RMP)</p>\n\n                        <p>The Null Corporation Europe: Didi Parlevliet</p>\n                        <p>Web integration: Sudjam</p>\n\n\n                        <p>This album is licensed under a Creative Commons Attribution-Noncommercial Share Alike license. More information: <a href=http://creativecommons.org>creativecommons.org</a></p>\n                        <p><img src=images/nin-logo.png alt="NIN logo"><br>\n                            halo twenty six</p>\n                        <p>©2008 NIN <a href=http://nin.com>nin.com</a></p>\n                    </li>\n\n                    <li>\n                        <h3>Thank you:</h3>\n                        <ul>\n                            <li>Bruno Bondanelli</li>\n                            <li>Andrew Grad</li>\n                            <li>Andrew “Hans” Buscher</li>\n                            <li>Angela Sidlow</li>\n                            <li>Christina Lum</li>\n                            <li>Cori Bardo</li>\n                            <li>Craig Johnston</li>\n                            <li>Guitar Center</li>\n                            <li>Irina Volodarsky</li>\n                            <li>Jeff Anderson</li>\n                            <li>Jeff Davis</li>\n                            <li>Jeff Masud</li>\n                            <li>Jim Scheel</li>\n                            <li>Miles Rogers and Digidesign</li>\n                            <li>Pablo La Rosa and Native Instruments</li>\n                            <li>Paul Cox</li>\n                            <li>Paul Haines</li>\n                            <li>Paul J. Cox Studio Systems</li>\n                            <li>Phillip Scholes and SSL</li>\n                            <li>Ricky Chao</li>\n                            <li>Rock-It Cargo</li>\n                            <li>Roger Cordell and Big City Music</li>\n                            <li>Ross Rosen</li>\n                            <li>Scott Rodger</li>\n                            <li>Shawn Cleary and Analogue Haven</li>\n                            <li>Steve “Coco” Brandon</li>\n                            <li>Vintage King</li>\n                            <li>Westlake Audio</li>\n                            <li>West L.A. Music</li>\n                            <li>Zia Modabber</li>\n                        </ul>\n                    </li>\n\n                </ul>\n\n            </div>\n\n\n        </div>\n\n    \n\n\n</body></html>'}),montageDefine("703617f","ui/song.reel/song.html",{text:'<!DOCTYPE html><html><head>\n        <meta http-equiv=content-type content="text/html; charset=utf-8">\n\n        <link rel=stylesheet type=text/css href=song.css>\n        <link rel=stylesheet type=text/css href=song-visuals.css>\n\n        <script type=text/montage-serialization>{"homebtn":{"prototype":"digit/ui/button.reel","properties":{"element":{"#":"home-btn"},"identifier":"goBack"},"listeners":[{"type":"action","listener":{"@":"owner"}}]},"playbtn":{"prototype":"digit/ui/button.reel","properties":{"element":{"#":"play-btn"},"identifier":"togglePlayPause"},"listeners":[{"type":"action","listener":{"@":"owner"}}]},"nextbtn":{"prototype":"digit/ui/button.reel","properties":{"element":{"#":"next-btn"},"identifier":"playNextSong"},"listeners":[{"type":"action","listener":{"@":"owner"}}]},"prevbtn":{"prototype":"digit/ui/button.reel","properties":{"element":{"#":"prev-btn"},"identifier":"playPrevSong"},"listeners":[{"type":"action","listener":{"@":"owner"}}]},"owner":{"prototype":"ui/song.reel","properties":{"element":{"#":"song"},"visElement":{"#":"visualizer"},"backButton":{"@":"homebtn"},"playButton":{"@":"playbtn"}},"bindings":{"paused":{"<-":"@owner.application.facade.player.paused"}}}}</script>\n\n    </head>\n\n    <body>\n\n        <div data-montage-id=song class=song>\n\n            <div class=buttons>\n                <button data-montage-id=home-btn class=home-btn>Back</button>\n                <button data-montage-id=play-btn class=play-btn>Pause</button>\n            </div>\n            <div class=audio-buttons>\n                <button data-montage-id=prev-btn class=prev-btn>◀</button>\n                <button data-montage-id=next-btn class=next-btn>▶</button>\n            </div>\n\n            <div data-montage-id=visualizer class=visualizer>\n                <div class=outer>\n                    <div class=inner></div>\n                </div>\n            </div>\n\n\n\n\n        </div>\n\n    \n\n\n</body></html>'}),montageDefine("703617f","ui/player.reel/player.html",{text:'<!DOCTYPE html><html><head>\n        <meta http-equiv=content-type content="text/html; charset=utf-8">\n\n        <link rel=stylesheet type=text/css href=player.css>\n\n        <script type=text/montage-serialization>{"owner":{"prototype":"ui/player.reel","properties":{"element":{"#":"player"},"audioTag":{"#":"audio-tag"}}}}</script>\n\n    </head>\n\n    <body>\n\n        <div data-montage-id=player class=player>\n            <audio data-montage-id=audio-tag class=audio-tag></audio>\n        </div>\n\n    \n\n\n</body></html>'}),montageDefine("703617f","ui/image.reel/image",{dependencies:["montage","montage/ui/component"],factory:function(e,t){var n=e("montage").Montage,i=e("montage/ui/component").Component;
t.Image=n.create(i,{_src:{value:null},src:{set:function(e){e!==this._src&&(this._src=e,this.needsDraw=!0)}},draw:{value:function(){this._element.style.backgroundImage="url("+this._src+")"}}})}}),montageDefine("703617f","ui/scroller.reel/scroller",{dependencies:["montage","montage/ui/component"],factory:function(e,t){var n=e("montage").Montage,i=e("montage/ui/component").Component;t.Scroller=n.create(i,{_scrollX:{value:0},scrollX:{get:function(){return this._scrollX},set:function(e){this._scrollX=e,this.needsDraw=!0},serializable:!0},_scrollY:{value:0},scrollY:{get:function(){return this._scrollY},set:function(e){this._scrollY=e,this.needsDraw=!0},serializable:!0},_maxTranslateX:{value:0},_maxTranslateY:{value:0},_axis:{value:"auto"},axis:{get:function(){return this._axis},set:function(e){this._axis=e,this.needsDraw=!0},serializable:!0},_displayScrollbars:{value:"auto"},displayScrollbars:{get:function(){return this._displayScrollbars},set:function(e){switch(e){case"vertical":case"horizontal":case"both":case"auto":this._displayScrollbars=e;break;default:this._displayScrollbars="none"}this.needsDraw=!0},serializable:!0},_hasMomentum:{value:!0},hasMomentum:{get:function(){return this._hasMomentum},set:function(e){this._hasMomentum=e},serializable:!0},_content:{value:null,serializable:!0},_scrollBars:{value:null,serializable:!0},handleTranslateStart:{value:function(){this._scrollBars.opacity=.5}},handleTranslateEnd:{value:function(){this._scrollBars.opacity=0}},canDraw:{value:function(){return this.needsDraw=!0,i.canDraw.apply(this,arguments)}},willDraw:{value:function(){this._left=this._element.offsetLeft,this._top=this._element.offsetTop,this._width=this._element.offsetWidth,this._height=this._element.offsetHeight,this._maxTranslateX=this._content.scrollWidth-this._width,0>this._maxTranslateX&&(this._maxTranslateX=0),this._maxTranslateY=this._content.offsetHeight-this._height,0>this._maxTranslateY&&(this._maxTranslateY=0);var e=this.callDelegateMethod("didSetMaxScroll",{x:this._maxTranslateX,y:this._maxTranslateY});switch(e&&(this._maxTranslateX=e.x,this._maxTranslateY=e.y),this._displayScrollbars){case"horizontal":this._scrollBars.displayHorizontal=!0,this._scrollBars.displayVertical=!1;break;case"vertical":this._scrollBars.displayHorizontal=!1,this._scrollBars.displayVertical=!0;break;case"both":this._scrollBars.displayHorizontal=!0,this._scrollBars.displayVertical=!0;break;case"auto":this._scrollBars.displayHorizontal=!!this._maxTranslateX,this._scrollBars.displayVertical=!!this._maxTranslateY;break;case"none":this._scrollBars.displayHorizontal=!1,this._scrollBars.displayVertical=!1}this._scrollBars.displayHorizontal&&(this._content.scrollWidth?(this._scrollBars.horizontalLength=this._width/this._content.scrollWidth,this._scrollBars.horizontalScroll=this._scrollX/this._content.scrollWidth):(this._scrollBars.horizontalLength=1,this._scrollBars.horizontalScroll=0)),this._scrollBars.displayVertical&&(this._content.offsetHeight?(this._scrollBars.verticalLength=this._height/this._content.offsetHeight,this._scrollBars.verticalScroll=this._scrollY/this._content.offsetHeight):(this._scrollBars.verticalLength=1,this._scrollBars.verticalScroll=0))}},draw:{value:function(){this._content.style.webkitTransform="translate3d("+-this._scrollX+"px, "+-this._scrollY+"px, 0)"}}})}}),montageDefine("703617f","ui/image.reel/image.html",{text:'<!DOCTYPE html><html><head>\n    <script type=text/montage-serialization>{"owner":{"prototype":"ui/image.reel","properties":{"element":{"#":"image"}}}}</script>\n</head>\n<body>\n    <div data-montage-id=image class=Image></div>\n\n\n</body></html>'}),montageDefine("703617f","ui/scroller.reel/scroller.html",{text:'<!DOCTYPE html><html><head>\n    <title></title>\n    <link rel=stylesheet type=text/css href=scroller.css>\n    <script type=text/montage-serialization>{"scrollbars":{"prototype":"ui/scroll-bars.reel","properties":{"element":{"#":"scrollbars"}}},"translateComposer1":{"prototype":"montage/composer/translate-composer","properties":{"component":{"@":"owner"},"minTranslateX":0,"minTranslateY":0,"invertAxis":true},"bindings":{"translateX":{"<->":"@owner.scrollX"},"translateY":{"<->":"@owner.scrollY"},"maxTranslateX":{"<-":"@owner._maxTranslateX"},"maxTranslateY":{"<-":"@owner._maxTranslateY"},"axis":{"<-":"@owner.axis"},"hasMomentum":{"<-":"@owner.hasMomentum"}},"listeners":[{"type":"translateStart","listener":{"@":"owner"}},{"type":"translateEnd","listener":{"@":"owner"}}]},"slot":{"prototype":"montage/ui/slot.reel","properties":{"element":{"#":"content"}},"bindings":{"domContent":{"<-":"@owner.domContent"}}},"owner":{"prototype":"ui/scroller.reel","properties":{"_content":{"#":"content"},"element":{"#":"montage-scroller"},"_scrollBars":{"@":"scrollbars"}}}}</script>\n</head>\n<body>\n    <div data-montage-id=montage-scroller class=montage-scroller>\n        <div data-montage-id=scrollbars></div>\n        <div data-montage-id=content class=content>\n        	<div data-param=*></div>\n        </div>\n\n    </div>\n\n\n</body></html>'}),montageDefine("703617f","ui/scroll-bars.reel/scroll-bars",{dependencies:["montage","montage/ui/component"],factory:function(e,t){var n=e("montage").Montage,i=e("montage/ui/component").Component;t.ScrollBars=n.create(i,{_verticalScroll:{value:0},_horizontalScroll:{value:0},_verticalLength:{value:0},_horizontalLength:{value:0},verticalScroll:{get:function(){return this._verticalScroll},set:function(e){this._verticalScroll=e,this.needsDraw=!0},serializable:!0},horizontalScroll:{get:function(){return this._horizontalScroll},set:function(e){this._horizontalScroll=e,this.needsDraw=!0},serializable:!0},verticalLength:{get:function(){return this._verticalLength},set:function(e){this._verticalLength=e,this.needsDraw=!0},serializable:!0},horizontalLength:{get:function(){return this._horizontalLength},set:function(e){this._horizontalLength=e,this.needsDraw=!0},serializable:!0},_opacity:{value:0},opacity:{get:function(){return this._opacity},set:function(e){this._opacity=e,this.needsDraw=!0},serializable:!0},_isDisplayUpdated:{value:!1},_displayVertical:{value:!1},displayVertical:{get:function(){return this._displayVertical},set:function(e){this._displayVertical!==e&&(this._displayVertical=e,this._isDisplayUpdated=!0,this.needsDraw=!0)},serializable:!0},_displayHorizontal:{value:!1},displayHorizontal:{get:function(){return this._displayHorizontal},set:function(e){this._displayHorizontal!==e&&(this._displayHorizontal=e,this._isDisplayUpdated=!0,this.needsDraw=!0)},serializable:!0},_top:{value:!1,serializable:!0},_bottomClip:{value:!1,serializable:!0},_bottom:{value:!1,serializable:!0},_left:{value:!1,serializable:!0},_rightClip:{value:!1,serializable:!0},_right:{value:!1,serializable:!0},_hasResizedHorizontal:{value:!1},_hasResizedVertical:{value:!1},willDraw:{value:function(){this._offsetWidth!==this._element.offsetWidth&&(this._offsetWidth=this._element.offsetWidth,this._hasResizedHorizontal=!0),this._offsetHeight!==this._element.offsetHeight&&(this._offsetHeight=this._element.offsetHeight,this._hasResizedVertical=!0)}},draw:{value:function(){var e,t,n,i;if(this._isDisplayUpdated){var r=this._displayVertical?"block":"none",a=this._displayHorizontal?"block":"none";this._top.style.display=this._bottomClip.style.display=r,this._left.style.display=this._rightClip.style.display=a,this._isDisplayUpdated=!1}this._hasResizedHorizontal&&this._displayHorizontal&&(this._rightClip.style.width=this._right.style.width=this._offsetWidth-4+"px",this._rightClip.style.clip="rect(-1px,"+(this._offsetWidth-3)+"px,6px,3px)",this._hasResizedHorizontal=!1),this._hasResizedVertical&&this._displayVertical&&(this._bottomClip.style.height=this._bottom.style.height=this._offsetHeight-4+"px",this._bottomClip.style.clip="rect(3px,6px,"+(this._offsetHeight-3)+"px,-1px)",this._hasResizedVertical=!1),this._opacity?(this._displayHorizontal&&(n=this._offsetWidth-9-(this._displayVertical?6:0),e=Math.floor(n*this._horizontalLength),i=n-e,t=1-this._horizontalLength?Math.floor(i*this._horizontalScroll/(1-this._horizontalLength)):0,0>t&&(e+=t,0>e&&(e=0),t=0),t>i&&(e+=Math.floor(i-t),0>e&&(e=0),t=n-e),this._right.style.webkitTransform="translate3d("+(e-this._offsetWidth+9)+"px,0,0)",this._left.style.webkitTransform=this._rightClip.style.webkitTransform="translate3d("+(t+2)+"px,0,0)",this._left.style.webkitTransition=this._right.style.webkitTransition="none",this._left.style.opacity=this._right.style.opacity=this._opacity),this._displayVertical&&(n=this._offsetHeight-9-(this._displayHorizontal?6:0),e=Math.floor(n*this._verticalLength),i=n-e,t=1-this._verticalLength?Math.floor(i*this._verticalScroll/(1-this._verticalLength)):0,0>t&&(e+=t,0>e&&(e=0),t=0),t>i&&(e+=Math.floor(i-t),0>e&&(e=0),t=n-e),this._bottom.style.webkitTransform="translate3d(0,"+(e-this._offsetHeight+9)+"px,0)",this._top.style.webkitTransform=this._bottomClip.style.webkitTransform="translate3d(0,"+(t+2)+"px,0)",this._top.style.webkitTransition=this._bottom.style.webkitTransition="none",this._top.style.opacity=this._bottom.style.opacity=this._opacity)):(this._displayHorizontal&&(this._left.style.webkitTransition=this._right.style.webkitTransition="300ms opacity",this._left.style.opacity=this._right.style.opacity=0),this._displayVertical&&(this._top.style.webkitTransition=this._bottom.style.webkitTransition="300ms opacity",this._top.style.opacity=this._bottom.style.opacity=0))}}})}}),montageDefine("703617f","ui/scroll-bars.reel/scroll-bars.html",{text:'<!DOCTYPE html><html><head>\n    <title></title>\n    <script type=text/montage-serialization>{"owner":{"properties":{"element":{"#":"montage-scroll-bars"},"_top":{"#":"top"},"_bottomClip":{"#":"bottom-clip"},"_bottom":{"#":"bottom"},"_left":{"#":"left"},"_rightClip":{"#":"right-clip"},"_right":{"#":"right"}}}}</script>\n    \n</head>\n<body>\n    <div data-montage-id=montage-scroll-bars class=montage-scroll-bars>\n        <div data-montage-id=top class=top></div>\n        <div data-montage-id=bottom-clip class=bottom-clip>\n            <div data-montage-id=bottom class=bottom></div>\n        </div>\n        <div data-montage-id=left class=left></div>\n        <div data-montage-id=right-clip class=right-clip>\n            <div data-montage-id=right class=right></div>\n        </div>\n    </div>\n\n\n</body></html>'}),montageDefine("b15df60","core/core",{dependencies:["collections/shim","./shim/object","./shim/array","./shim/string","./extras/object","./extras/date","./extras/element","./extras/function","./extras/regexp","./extras/string","./deprecate","./uuid","collections/listen/property-changes","frb","collections/weak-map","collections/map","frb/parse","frb/evaluate","frb/assign","frb/observe","frb/bind","frb/compile-observer","frb/scope","frb/observers","./serialization/bindings","./promise"],factory:function(e,t){function n(e,t){var i=a+t+r;return e.hasOwnProperty(i)?e[i]:Object.defineProperty(e,i,{enumerable:!1,configurable:!1,writable:!0,value:Object.create(n(Object.getPrototypeOf(e),t))})[i]}e("collections/shim"),e("./shim/object"),e("./shim/array"),e("./shim/string"),e("./extras/object"),e("./extras/date"),e("./extras/element"),e("./extras/function"),e("./extras/regexp"),e("./extras/string");var i=e("./deprecate"),r="AttributeProperties",a="_",s="__proto__",o="value",l="enumerable",c="distinct",u="serializable",h=Array.prototype,d=Object.prototype,p=!0,f=t.Montage=function f(){};f.deprecate=i.deprecateMethod(f,i.deprecateMethod,"Montage.deprecate","deprecate module's deprecateMethod"),f.callDeprecatedFunction=i.deprecateMethod(f,i.callDeprecatedFunction,"Montage.callDeprecatedFunction","deprecate module's callDeprecatedFunction");var m={}.__proto__===Object.prototype,g={_montage_metadata:1,__state__:1},v=Object.getOwnPropertyNames(Function);if(Object.defineProperty(f,"specialize",{value:function(e,t){var n,r,a,s,o,l,c,u=this,h=void 0===this.specialize;if(e=e||Object.empty,t=t||Object.empty,n=e.constructor&&e.constructor.value?e.constructor.value:e.didCreate&&e.didCreate.value?f.deprecate(null,e.didCreate.value,"didCreate","constructor"):function(){return this.superForValue("constructor")()||this},m)n.__proto__=u;else{a=Object.getOwnPropertyNames(u);for(var l=0;a.length>l;l++)s=a[l],g.hasOwnProperty(s)||(o=Object.getOwnPropertyDescriptor(n,s),(!o||o.configurable)&&f.defineProperty(n,s,Object.getOwnPropertyDescriptor(u,s)));n.__constructorProto__=u,f.defineProperty(n,"isPrototypeOf",{value:function(e){for(;null!==e;){if(Object.getPrototypeOf(e)===this)return!0;e=Object.getPrototypeOf(e)}return!1},enumerable:!1})}if(r=Object.create(this.prototype),h){for(a=Object.getOwnPropertyNames(f),l=0;a.length>l;l++)s=a[l],o=Object.getOwnPropertyDescriptor(n,s),(!o||o.configurable)&&f.defineProperty(n,s,Object.getOwnPropertyDescriptor(f,s));for(a=Object.getOwnPropertyNames(f.prototype),l=0;a.length>l;l++)s=a[l],o=Object.getOwnPropertyDescriptor(n,s),(!o||o.configurable)&&f.defineProperty(r,s,Object.getOwnPropertyDescriptor(f.prototype,s))}if(f.defineProperties(r,e),p){c=function(e,t,n){function r(){return this===t&&i.deprecationWarning(f.getInfoForObject(t).objectName+"."+n+" should be moved to constructorProperties",null,3),e.apply(this,arguments)}return r.deprecatedFunction=e,r};for(s in e)v.has(s)?delete e[s]:(o=e[s],o.value&&"function"==typeof o.value&&!o.value.__isConstructor__?o.value=c(o.value,n,s):(o.get&&(o.get=c(o.get,n,s)),o.set&&(o.set=c(o.set,n,s))));f.defineProperties(n,e),f.defineProperty(n,"create",{value:function(){return new n},enumerable:!1})}return f.defineProperties(n,t),f.defineProperty(n,"__isConstructor__",{value:!0,enumerable:!1}),f.defineProperty(n,"_superCache",{value:{},enumerable:!1}),n.prototype=r,f.defineProperty(r,"constructor",{value:n,enumerable:!1}),n},writable:!0,configurable:!0,enumerable:!1}),!m){var _=Object.getPrototypeOf;Object.getPrototypeOf=function(e){return"function"==typeof e&&e.__constructorProto__?e.__constructorProto__:_.apply(Object,arguments)}}Object.defineProperty(f,"create",{configurable:!0,value:function(e,t){if(void 0!==e&&"object"!=typeof e&&"function"!=typeof e)throw new TypeError("Object prototype may only be an Object or null, not '"+e+"'");if(e=void 0===e?this:e,"function"==typeof e)return t?e.specialize(t):new e;var n=Object.create(e);return t&&f.defineProperties(n,t),n}});var b=[u];b.forEach(function(e){Object.defineProperty(Object.prototype,a+e+r,{enumerable:!1,configurable:!1,writable:!0,value:{}})}),Object.defineProperty(f,"defineProperty",{value:function(e,t,i){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object must be an object, not '"+e+"'");var r=o in i;if(c in i&&!r)throw new TypeError("Cannot use distinct attribute on non-value property '"+t+"'");if(s in i)i.__proto__=r?"function"==typeof i.value?C:w:y;else{var p;p=r?"function"==typeof i.value?C:w:y;for(var f in p)f in i||(i[f]=p[f])}if(i.hasOwnProperty(l)||t.charAt(0)!==a||(i.enumerable=!1),i.hasOwnProperty(u)||(i.enumerable?i.get&&!i.set?i.serializable=!1:i.writable===!1&&(i.serializable=!1):i.serializable=!1),u in i&&(n(e,u)[t]=i.serializable),i.distinct!==!0||"object"!=typeof i.value){var m,g,v;if(e._superDependencies){if("function"==typeof i.value&&(m=e._superDependencies[t+".value"]))for(g=0,v=m.length;v>g;g++)delete m[g]._superCache[t+".value"];if("function"==typeof i.get&&(m=e._superDependencies[t+".get"]))for(g=0,v=m.length;v>g;g++)delete m[g]._superCache[t+".get"];if("function"==typeof i.set&&(m=e._superDependencies[t+".set"]))for(g=0,v=m.length;v>g;g++)delete m[g]._superCache[t+".set"]}return Object.defineProperty(e,t,i)}(function(e,t,n,i){var r=function(e,t,n){Object.defineProperty(e,t,{enumerable:!1,configurable:!0,writable:!0,value:n})};n.constructor===Object&&Object.getPrototypeOf(n)===d?0!==Object.keys(n).length?Object.defineProperty(i,e,{configurable:!0,get:function(){var e=this[t];if(!e){var i;e={};for(i in n)e[i]=n[i];this.hasOwnProperty(t)?this[t]=e:r(this,t,e)}return e},set:function(e){this.hasOwnProperty(t)?this[t]=e:r(this,t,e)}}):Object.defineProperty(i,e,{configurable:!0,get:function(){var e=this[t];return e||(e={},this.hasOwnProperty(t)?this[t]=e:r(this,t,e)),e},set:function(e){this.hasOwnProperty(t)?this[t]=e:r(this,t,e)}}):(n.__proto__||Object.getPrototypeOf(n))===h?0!==n.length?Object.defineProperty(i,e,{configurable:!0,get:function(){var e=this[t];if(!e){var i,a;for(e=[],i=0;void 0!==(a=n[i]);i++)e[i]=a;this.hasOwnProperty(t)?this[t]=e:r(this,t,e)}return e},set:function(e){this.hasOwnProperty(t)?this[t]=e:r(this,t,e)}}):Object.defineProperty(i,e,{configurable:!0,get:function(){var e=this[t];return e||(e=[],this.hasOwnProperty(t)?this[t]=e:r(this,t,e)),e},set:function(e){this.hasOwnProperty(t)?this[t]=e:r(this,t,e)}}):n.constructor.prototype===Object.getPrototypeOf(n)?Object.defineProperty(i,e,{configurable:!0,get:function(){var e=this[t];if(!e){var i;e=new n.constructor;for(i in n)e[i]=n[i];this.hasOwnProperty(t)?this[t]=e:r(this,t,e)}return e},set:function(e){this.hasOwnProperty(t)?this[t]=e:r(this,t,e)}}):Object.defineProperty(i,e,{configurable:!0,get:function(){var e=this[t];return e||(e=Object.create(n.__proto__||Object.getPrototypeOf(n)),this.hasOwnProperty(t)?this[t]=e:r(this,t,e)),e},set:function(e){this.hasOwnProperty(t)?this[t]=e:r(this,t,e)}})})(t,a+t,i.value,e)}}),Object.defineProperty(f,"defineProperties",{value:function(e,t){if("object"!=typeof t||null===t)throw new TypeError("Properties must be an object, not '"+t+"'");for(var n in t)"_bindingDescriptors"!==n&&this.defineProperty(e,n,t[n]);return e}});var y={enumerable:!0,configurable:!0,serializable:!0},w={writable:!0,enumerable:!0,configurable:!0,serializable:"reference"},C={writable:!0,enumerable:!1,configurable:!0,serializable:!1};f.defineProperty(f,"didCreate",{value:Function.noop});var L=function(e,t){var n,i,r,a,s,o,l,c,u;if(!t._superPropertyName||!t._superPropertyType)for(f.defineProperty(t,"_superPropertyType",{value:null}),f.defineProperty(t,"_superPropertyName",{value:null}),l=e;!c&&null!==l;){for(n=Object.getOwnPropertyNames(l),i=Object.getPrototypeOf(l),r=0,a=n.length,r;a>r;r++){if(s=n[r],u=Object.getOwnPropertyDescriptor(l,s),null!=(o=u.value)&&(o===t||o.deprecatedFunction===t)){t._superPropertyType="value",t._superPropertyName=s,c=!0;break}if(null!=(o=u.get)&&(o===t||o.deprecatedFunction===t)){t._superPropertyType="get",t._superPropertyName=s,c=!0;break}if(null!=(o=u.set)&&(o===t||o.deprecatedFunction===t)){t._superPropertyType="set",t._superPropertyName=s,c=!0;break}}l=i}return M(e,t._superPropertyType,t._superPropertyName)},x=function(){if("function"!=typeof x.caller)throw new TypeError("Can't get super without caller. Use this.superForValue(methodName) if using strict mode.");var e=L(this,x.caller);return"function"==typeof e?e.bind(this):Function.noop},M=function(e,t,n){var i,r,a,s,o,l=e,c=n+"."+t;if(e._superContext||f.defineProperty(e,"_superContext",{value:{}}),e._superContext[c])l=e._superContext[c];else for(l=e;null!==l&&(!l.hasOwnProperty(n)||(a=Object.getOwnPropertyDescriptor(l,n),"function"!=typeof a[t]));)l=Object.getPrototypeOf(l);if(s=l.constructor,s._superCache&&s._superCache[c])return o=function(e,t,n,i){return function(){t._superContext[e]=n;var r=i.apply(t,arguments);return delete t._superContext[e],r}}(c,e,s._superCache[c].owner,s._superCache[c].func);for(r=l;void 0===i&&(r=Object.getPrototypeOf(r));)if(r._superDependencies||f.defineProperty(r,"_superDependencies",{value:{}}),r._superDependencies[c]||(r._superDependencies[c]=[]),r._superDependencies[c].push(s),a=Object.getOwnPropertyDescriptor(r,n)){if("function"==typeof a[t]){i=a[t];break}break}return"function"==typeof i?(o=function(e,t,n,i){return function(){t._superContext[e]=n;var r=i.apply(t,arguments);return delete t._superContext[e],r}}(c,e,r,i),s._superCache||f.defineProperty(s,"_superCache",{value:{}}),s._superCache[c]={func:i,owner:r},o):Function.noop},E=function(e){return M(this,"value",e)},S=function(e){return M(this,"get",e)},O=function(e){return M(this,"set",e)};f.defineProperty(f,"super",{get:x,enumerable:!1}),f.defineProperty(f.prototype,"super",{get:x,enumerable:!1}),f.defineProperty(f,"superForValue",{value:E,enumerable:!1}),f.defineProperty(f.prototype,"superForValue",{value:E,enumerable:!1}),f.defineProperty(f,"superForGet",{value:S,enumerable:!1}),f.defineProperty(f.prototype,"superForGet",{value:S,enumerable:!1}),f.defineProperty(f,"superForSet",{value:O,enumerable:!1}),f.defineProperty(f.prototype,"superForSet",{value:O,enumerable:!1}),f.defineProperty(f,"getSerializablePropertyNames",{value:function(e){var t=[],n=e._serializableAttributeProperties;if(n)for(var i in n)n[i]&&t.push(i);return t}}),f.defineProperty(f,"getPropertyAttribute",{value:function(e,t,n){var i=a+n+r,s=e[i];return s?s[t]:void 0}}),f.defineProperty(f,"getPropertyAttributes",{value:function(e,t){var n={},i=a+t+r,s=e[i];if(s){for(var o in s)n[o]=s[o];return n}}});var T={isInstance:{value:!0}},z={objectName:{value:"Function"},isInstance:{value:!0}};f.defineProperty(f,"getInfoForObject",{value:function(e){var t,n;if(D.call(e,"_montage_metadata"))return e._montage_metadata;if(t=e._montage_metadata||e.constructor&&e.constructor._montage_metadata||null,n=e.constructor===Function?z:T,e===Object.prototype)return Object.create(t,n);try{return Object.defineProperty(e,"_montage_metadata",{enumerable:!1,writable:!0,value:Object.create(t,n)})._montage_metadata}catch(i){return e._montage_metadata=Object.create(t,n)}}});var P=e("./uuid");"undefined"!=typeof window&&(window.uuid=P.generate());var D=Object.prototype.hasOwnProperty,k=function(){var e=P.generate(),t=f.getInfoForObject(this);try{null!==t&&t.isInstance===!1?(this._uuid=e,Object.defineProperty(this,"uuid",{get:function(){return this.hasOwnProperty("uuid")?this._uuid:k.call(this)}})):(t.isInstance&&Object.defineProperty(this,"uuid",{configurable:!0,enumerable:!1,writable:!1,value:e}),!(this instanceof Element)&&t.isInstance&&o in(Object.getOwnPropertyDescriptor(this,"uuid")||{})&&s in this||(this._uuid=e))}catch(n){}return this._uuid=e,e},A=function A(){return D.call(this,"_uuid")?this._uuid:k.call(this)};Object.defineProperty(Object.prototype,"_uuid",{enumerable:!1,value:null,writable:!0}),Object.defineProperty(Object.prototype,"uuid",{configurable:!0,get:A,set:function(){}}),f.defineProperty(f,"identifier",{value:null,serializable:!0}),f.defineProperty(f.prototype,"identifier",{value:null,serializable:!0}),f.defineProperty(f.prototype,"equals",{value:function(e){return e?this===e||this.uuid===e.uuid:!1}}),f.defineProperty(f,"equals",{value:f.prototype.equals}),f.defineProperty(f.prototype,"callDelegateMethod",{value:function(e){var t,n,i=this.delegate;return"string"==typeof this.identifier&&(t=this.identifier+e.toCapitalized(),i&&"function"==typeof(n=i[t]))?(h.shift.call(arguments),n.apply(i,arguments)):i&&"function"==typeof(n=i[e])?(h.shift.call(arguments),n.apply(i,arguments)):void 0}});var j=e("collections/listen/property-changes");Object.addEach(f,j.prototype),Object.addEach(f.prototype,j.prototype);var B=t.Bindings=e("frb"),I={defineBinding:{value:function(e,t,n){return B.defineBinding(this,e,t,n)}},defineBindings:{value:function(e,t){return B.defineBindings(this,e,t)}},cancelBinding:{value:function(e){return B.cancelBinding(this,e)}},cancelBindings:{value:function(){return B.cancelBindings(this)}},getBinding:{value:function(e){return B.getBinding(this,e)}},getBindings:{value:function(){return B.getBindings(this)}}};f.defineProperties(f,I),f.defineProperties(f.prototype,I);var R=e("collections/weak-map"),N=e("collections/map"),F=e("frb/parse"),q=e("frb/evaluate"),V=e("frb/assign");e("frb/observe"),e("frb/bind");var W=e("frb/compile-observer"),H=e("frb/scope"),U=e("frb/observers"),Y=U.autoCancelPrevious,X=new R,G={getPath:{value:function(e,t,n,i){return q(e,this,t||this,n,i)}},setPath:{value:function(e,t,n,i,r){return V(this,e,t,n||this,i,r)}},observePath:{value:function(e,t){var n=F(e),i=W(n);return i(Y(t),new H(this))}},addRangeAtPathChangeListener:{value:function(e,t,n,i,r,a){function s(e,i,r){if(t[n])t[n](e,i,r);else{if(!t.call)throw Error("Can't dispatch range change to "+t);t.call(null,e,i,r)}}n=n||"handleRangeChange";var o=[];return this.addPathChangeListener(e,function(e){return e&&e.toArray&&e.addRangeChangeListener?(s(e.toArray(),o.toArray(),0),o=e,e.addRangeChangeListener(s)):(e=[],s(e,o,0),o=e,void 0)},void 0,void 0,i,r,a)}},getPathChangeDescriptors:{value:function(){return X.has(this)||X.set(this,{}),X.get(this)}},getPathChangeDescriptor:{value:function(e,t,n){var i=f.getPathChangeDescriptors.call(this);return Object.owns(i,e)||(i[e]={willChangeListeners:new N,changeListeners:new N}),i=i[e],i=n?i.willChangeListeners:i.changeListeners,i.has(t)||i.set(t,{path:e,handler:t,beforeChange:n,cancel:Function.noop}),i.get(t)}},addPathChangeListener:{value:function(e,t,n,i,r,a,s){var o=this;t=t||Function.noop;var l=f.getPathChangeDescriptor.call(this,e,t,i);l.cancel();var c,u,h,d=F(e);if(t===Function.noop)h=function(t){if(u)throw Error("Path change handler needs a handler because it emits new values when the source changes: "+JSON.stringify(e));u=!0,c=t};else if(n)h=function(i){return t[n].call(t,i,e,o)};else if(t.handlePathChange)h=function(n){return t.handlePathChange.call(t,n,e,o)};else{if("function"!=typeof t)throw Error("Can't recognize handler type: "+t+". Must be function or delegate implementing handlePathChange.");h=function(n){return t.call(o,n,e,o)}}var p=W(d),m=new H(this);m.beforeChange=i,m.parameters=r,m.document=a,m.components=s;var g=p(Y(h),m);return l.cancel=g,u?c:g}},removePathChangeListener:{value:function(e,t,n){t=t||Function.noop;var i=f.getPathChangeDescriptors.call(this),r=n?"willChangeListeners":"changeListeners";if(!Object.owns(i,e))throw Error("Can't find "+r+" for "+JSON.stringify(e));var a=i[e],s=a[r];if(!s.has(t))throw Error("Can't find "+r+" for "+JSON.stringify(e));var o=s.get(t);o.cancel(),s["delete"](t),0===a.willChangeListeners.length&&0===a.changeListeners.length&&delete i[e];for(var l in i)return;X["delete"](this)}},addBeforePathChangeListener:{value:function(e,t,n,i,r,a){return f.addPathChangeListener.call(this,e,t,n,!0,i,r,a)}},removeBeforePathChangeListener:{value:function(e,t){return f.removePathChangeListener.call(this,e,t,!0)}}};f.defineProperties(f,G),f.defineProperties(f.prototype,G),e("./serialization/bindings"),t._blueprintModuleIdDescriptor={serializable:!1,enumerable:!1,get:function(){var e=f.getInfoForObject(this),t=e&&!e.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(t,"_blueprintModuleId")||!t._blueprintModuleId){e=f.getInfoForObject(t);var n=e.moduleId,i=n.lastIndexOf("/"),r=n.lastIndexOf(".");i=-1===i?0:i+1,r=-1===r?n.length:r,r=i>r?n.length:r,f.defineProperty(t,"_blueprintModuleId",{enumerable:!1,value:n.slice(0,r)+".meta"})}return t._blueprintModuleId}},t._blueprintDescriptor={serializable:!1,enumerable:!1,get:function(){var n=f.getInfoForObject(this),i=n&&!n.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(i,"_blueprint")||!i._blueprint){var r=i.blueprintModuleId;if(""===r)throw new TypeError("Blueprint moduleId undefined for the module '"+JSON.stringify(i)+"'");t._blueprintDescriptor.BlueprintModulePromise||(t._blueprintDescriptor.BlueprintModulePromise=e.async("core/meta/module-blueprint").get("ModuleBlueprint")),f.defineProperty(i,"_blueprint",{enumerable:!1,value:t._blueprintDescriptor.BlueprintModulePromise.then(function(e){var t=f.getInfoForObject(i);return e.getBlueprintWithModuleId(r,t.require).fail(function(t){if(-1!==t.message.indexOf("Can't XHR"))return e.createDefaultBlueprintForObject(i).then(function(e){return e});throw t})})})}return i._blueprint},set:function(t){var n,i=f.getInfoForObject(this),r=i&&!i.isInstance?this:this.constructor;if(null===t)n=null;else{if("function"==typeof t.then)throw new TypeError("Object blueprint should not be a promise");t.blueprintInstanceModule=r.blueprintModule,n=e("./promise").Promise.resolve(t)}f.defineProperty(r,"_blueprint",{enumerable:!1,value:n})}}}}),montageDefine("b15df60","core/event/event-manager",{dependencies:["../core","../uuid","./mutable-event","../serialization"],factory:function(e,t){var n,i=e("../core").Montage,r=e("../uuid"),a=e("./mutable-event").MutableEvent,s=e("../serialization").Serializer,o=e("../serialization").Deserializer;if("undefined"!=typeof window){void 0===window.Touch&&"ontouchstart"in window&&(window.Touch=function(){},function(){var e;document.addEventListener("touchstart",e=function(t){window.Touch=t.touches[0].constructor,document.nativeRemoveEventListener?document.nativeRemoveEventListener("touchstart",e,!0):document.removeEventListener("touchstart",e,!0),n&&n.isStoringPointerEvents&&(n.isStoringPointerEvents=!1,n.isStoringPointerEvents=!0)},!0)}()),i.specialize({type:{value:null},listener:{value:null},capture:{value:null}}),s.defineSerializationUnit("listeners",function(e,t){var i,r,a,s=n,o=t.uuid,l=[];for(var c in s.registeredEventListeners)if(i=s.registeredEventListeners[c],r=i&&i[o])for(var u in r.listeners)a=r.listeners[u],l.push({type:c,listener:e.addObjectReference(a.listener),capture:a.capture});return l.length>0?l:void 0}),o.defineDeserializationUnit("listeners",function(e,t,n){for(var i,r=0;i=n[r];r++)t.addEventListener(i.type,i.listener,i.capture)});var l=Event.NONE,c=Event.CAPTURING_PHASE,u=Event.AT_TARGET,h=Event.BUBBLING_PHASE,d="function";t.EventManager=i.specialize({constructor:{value:function(){this.super()}},eventDefinitions:{value:{abort:{bubbles:!1,cancelable:!1},beforeunload:{bubbles:!1},blur:{bubbles:!1,cancelable:!1},change:{bubbles:!0,cancelable:!1},click:{bubbles:!0,cancelable:!0},close:{bubbles:!1,cancelable:!1},compositionend:{bubbles:!0,cancelable:!1},compositionstart:{bubbles:!0,cancelable:!0},compositionupdate:{bubbles:!0,cancelable:!1},contextmenu:{bubbles:!0,cancelable:!0},copy:{bubbles:!0,cancelable:!0},cut:{bubbles:!0,cancelable:!0},dblclick:{bubbles:!0,cancelable:!1},DOMActivate:{bubbles:!0,cancelable:!0,deprecated:!0},DOMMouseScroll:{bubbles:!0},drag:{bubbles:!0,cancelable:!0},dragend:{bubbles:!0,cancelable:!1},dragenter:{bubbles:!0,cancelable:!0},dragleave:{bubbles:!0,cancelable:!1},dragover:{bubbles:!0,cancelable:!0},dragstart:{bubbles:!0,cancelable:!0},drop:{bubbles:!0,cancelable:!0},error:{bubbles:function(e){return!(XMLHttpRequest.prototype.isPrototypeOf(e)||e.tagName&&"VIDEO"===e.tagName.toUpperCase()||e.tagName&&"AUDIO"===e.tagName.toUpperCase())},cancelable:!1},focus:{bubbles:!1,cancelable:!1},focusin:{bubbles:!0,cancelable:!1},focusout:{bubbles:!0,cancelable:!1},input:{bubbles:!0,cancelable:!1},keydown:{bubbles:!0,cancelable:!1},keypress:{bubbles:!0,cancelable:!1},keyup:{bubbles:!0,cancelable:!1},load:{bubbles:!1,cancelable:!1},loadend:{bubbles:!1,cancelable:!1},loadstart:{bubbles:!1,cancelable:!1},message:{bubbles:!1,cancelable:!1},mousedown:{bubbles:!0,cancelable:!0},mouseenter:{bubbles:!1,cancelable:!1},mouseleave:{bubbles:!1,cancelable:!1},mousemove:{bubbles:!0,cancelable:!0},mouseout:{bubbles:!0,cancelable:!0},mouseover:{bubbles:!0,cancelable:!0},mouseup:{bubbles:!0,cancelable:!0},mousewheel:{bubbles:!0},orientationchange:{bubbles:!1},paste:{bubbles:!0,cancelable:!0},progress:{bubbles:!1,cancelable:!1},reset:{bubbles:!0,cancelable:!1},resize:{bubbles:!1,cancelable:!1},scroll:{bubbles:function(e){return!!e.defaultView},cancelable:!1},select:{bubbles:!0,cancelable:!1},submit:{bubbles:!0,cancelable:!0},touchcancel:{bubbles:!0,cancelable:!1},touchend:{bubbles:!0,cancelable:!0},touchmove:{bubbles:!0,cancelable:!0},touchstart:{bubbles:!0,cancelable:!0},unload:{bubbles:!1,cancelable:!1},wheel:{bubbles:!0,cancelable:!0}}},_DOMPasteboardElement:{value:null,enumerable:!1},_delegate:{value:null,enumerable:!1},delegate:{enumerable:!1,get:function(){return this._delegate},set:function(e){this._delegate=e}},_application:{value:null,enumerable:!1},application:{enumerable:!1,get:function(){return this._application},set:function(e){this._application=e}},_registeredWindows:{value:null,enumerable:!1},_windowsAwaitingFinalRegistration:{value:{},enumerable:!1},initWithWindow:{enumerable:!1,value:function(e){if(this._registeredWindows)throw"EventManager has already been initialized";
return this.registerWindow(e),this}},registerWindow:{enumerable:!1,value:function(e){if(e.defaultEventManager&&e.defaultEventManager!==this)throw"EventManager cannot register a window already registered to another EventManager";if(this._registeredWindows&&this._registeredWindows.indexOf(e)>=0)throw"EventManager cannot register a window more than once";if(this._registeredWindows||(this._registeredWindows=[]),e.uuid&&0!==e.uuid.length||(e.uuid=r.generate()),this._windowsAwaitingFinalRegistration[e.uuid]!==e){if(e.Element.prototype.nativeAddEventListener=e.Element.prototype.addEventListener,Object.defineProperty(e,"nativeAddEventListener",{configurable:!0,value:e.addEventListener}),Object.getPrototypeOf(e.document).nativeAddEventListener=e.document.addEventListener,e.XMLHttpRequest.prototype.nativeAddEventListener=e.XMLHttpRequest.prototype.addEventListener,e.Worker&&(e.Worker.prototype.nativeAddEventListener=e.Worker.prototype.addEventListener),e.MediaController&&(e.MediaController.prototype.nativeAddEventListener=e.MediaController.prototype.addEventListener),e.Element.prototype.nativeRemoveEventListener=e.Element.prototype.removeEventListener,Object.defineProperty(e,"nativeRemoveEventListener",{configurable:!0,value:e.removeEventListener}),Object.getPrototypeOf(e.document).nativeRemoveEventListener=e.document.removeEventListener,e.XMLHttpRequest.prototype.nativeRemoveEventListener=e.XMLHttpRequest.prototype.removeEventListener,e.Worker&&(e.Worker.prototype.nativeRemoveEventListener=e.Worker.prototype.removeEventListener),e.MediaController&&(e.MediaController.prototype.nativeRemoveEventListener=e.MediaController.prototype.removeEventListener),Object.defineProperty(e,"addEventListener",{configurable:!0,value:e.XMLHttpRequest.prototype.addEventListener=e.Element.prototype.addEventListener=Object.getPrototypeOf(e.document).addEventListener=function(t,n,i){return e.defaultEventManager.registerEventListener(this,t,n,!!i)}}),e.Worker&&(e.Worker.prototype.addEventListener=e.addEventListener),e.MediaController&&(e.MediaController.prototype.addEventListener=e.addEventListener),Object.defineProperty(e,"removeEventListener",{configurable:!0,value:e.XMLHttpRequest.prototype.removeEventListener=e.Element.prototype.removeEventListener=Object.getPrototypeOf(e.document).removeEventListener=function(t,n,i){return e.defaultEventManager.unregisterEventListener(this,t,n,!!i)}}),e.Worker&&(e.Worker.prototype.removeEventListener=e.removeEventListener),e.MediaController&&(e.MediaController.prototype.removeEventListener=e.removeEventListener),e.HTMLDivElement.prototype.addEventListener!==e.Element.prototype.nativeAddEventListener&&e.HTMLElement&&"addEventListener"in e.HTMLElement.prototype){var a,s,o=Object.getOwnPropertyNames(e),l=0,c=o.length;for(l;c>l;l++)a=o[l],a.match(/^HTML\w*Element$/)&&"function"==typeof a&&(s=a.prototype,s.nativeAddEventListener=s.addEventListener,s.addEventListener=e.Element.prototype.addEventListener,s.nativeRemoveEventListener=s.removeEventListener,s.removeEventListener=e.Element.prototype.removeEventListener)}i.defineProperty(e.Element.prototype,"eventHandlerUUID",{value:void 0,enumerable:!1}),i.defineProperty(e.Element.prototype,"component",{get:function(){return n._elementEventHandlerByUUID[this.eventHandlerUUID]},enumerable:!1}),n=e.defaultEventManager=t.defaultEventManager=this,this._registeredWindows.push(e),this._windowsAwaitingFinalRegistration[e.uuid]=e,/loaded|complete|interactive/.test(e.document.readyState)?this._finalizeWindowRegistration(e):e.document.addEventListener("DOMContentLoaded",this,!0)}}},_finalizeWindowRegistration:{enumerable:!1,value:function(e){if(this._windowsAwaitingFinalRegistration[e.uuid]!==e)throw"EventManager wasn't expecting to register this window";delete this._windowsAwaitingFinalRegistration[e.uuid],this._listenToWindow(e)}},unregisterWindow:{enumerable:!1,value:function(e){if(0>this._registeredWindows.indexOf(e))throw"EventManager cannot unregister an unregistered window";if(this._registeredWindows=this._registeredWindows.filter(function(t){return e!==t}),delete e.defaultEventManager,e.Element.prototype.addEventListener=e.Element.prototype.nativeAddEventListener,Object.defineProperty(e,"addEventListener",{configurable:!0,value:e.nativeAddEventListener}),Object.getPrototypeOf(e.document).addEventListener=e.document.nativeAddEventListener,e.XMLHttpRequest.prototype.addEventListener=e.XMLHttpRequest.prototype.nativeAddEventListener,e.Worker&&(e.Worker.prototype.addEventListener=e.Worker.prototype.nativeAddEventListener),e.Element.prototype.removeEventListener=e.Element.prototype.nativeRemoveEventListener,Object.defineProperty(e,"removeEventListener",{configurable:!0,value:e.nativeRemoveEventListener}),Object.getPrototypeOf(e.document).removeEventListener=e.document.nativeRemoveEventListener,e.XMLHttpRequest.prototype.removeEventListener=e.XMLHttpRequest.prototype.nativeRemoveEventListener,e.Worker&&(e.Worker.prototype.removeEventListener=e.Worker.prototype.nativeRemoveEventListener),e.HTMLDivElement.prototype.nativeAddEventListener!==e.Element.prototype.addEventListener&&e.HTMLElement&&"addEventListener"in e.HTMLElement.prototype&&e.Components&&e.Components.interfaces){var t,n;for(t in Components.interfaces)t.match(/^nsIDOMHTML\w*Element$/)&&(t=t.replace(/^nsIDOM/,""),(t=window[t])&&(n=t.prototype,n.addEventListener=n.nativeAddEventListener,delete n.nativeAddEventListener,n.removeEventListener=n.nativeRemoveEventListener,delete n.nativeRemoveEventListener))}delete e.Element.prototype.nativeAddEventListener,delete e.nativeAddEventListener,delete Object.getPrototypeOf(e.document).nativeAddEventListener,delete e.XMLHttpRequest.prototype.nativeAddEventListener,e.Worker&&delete e.Worker.prototype.nativeAddEventListener,delete e.Element.prototype.nativeRemoveEventListener,delete e.nativeRemoveEventListener,delete Object.getPrototypeOf(e.document).nativeRemoveEventListener,delete e.XMLHttpRequest.prototype.nativeRemoveEventListener,e.Worker&&delete e.Worker.prototype.nativeRemoveEventListener,delete e.Element.prototype.eventHandlerUUID,delete e.Element.prototype.component,this._stopListeningToWindow(e)}},unregisterWindows:{enumerable:!1,value:function(){this._registeredWindows.forEach(this.unregisterWindow)}},registeredEventListeners:{enumerable:!1,value:{}},registeredEventListenersForEventType_:{value:function(e){var t,n,i,r,a=this.registeredEventListeners[e];if(!a)return null;r={};for(t in a){n=a[t].listeners;for(i in n)r[i]=n[i]}return r}},registeredEventListenersForEventType_onTarget_:{enumerable:!1,value:function(e,t,n){var i,r;return i=t===n?n.eventManager.registeredEventListeners[e]:this.registeredEventListeners[e],i?(r=i[t.uuid],r?r.listeners:null):null}},registeredEventListenersOnTarget_:{value:function(e){var t,n,i=[];for(t in this.registeredEventListeners)n=this.registeredEventListeners[t],e.uuid in n&&i.push(n);return i}},registerEventListener:{enumerable:!1,value:function(e,t,n,i){var r,a,s,o=this.registeredEventListeners[t],l=!1,c=!1;if(void 0===e.uuid)throw Error("EventManager cannot observe a target without a uuid: "+(e.outerHTML||e));return o?((r=o[e.uuid])||(r=o[e.uuid]={target:e,listeners:{}},l=!0),a=r.listeners[n.uuid],s=i?"capture":"bubble",a?(a[s]=!0,c=!0):(a={listener:n,capture:i,bubble:!i},r.listeners[n.uuid]=a,c=!0)):(o=this.registeredEventListeners[t]={},o[e.uuid]={target:e,listeners:{}},o[e.uuid].listeners[n.uuid]={listener:n,capture:i,bubble:!i},l=!0,c=!0),l&&"function"==typeof e.nativeAddEventListener&&this._observeTarget_forEventType_(e,t),c}},unregisterEventListener:{enumerable:!1,value:function(e,t,n,i){var r,a,s,o,l,c=this.registeredEventListeners[t];if(c&&(r=c[e.uuid])){if(a=r.listeners[n.uuid],!a){for(o in r.listeners)if(l=r.listeners[o].listener,l.originalListener&&l.originalListener.uuid===n.uuid){a=r.listeners[o],n=l;break}if(!a)return}s=i?"capture":"bubble",a[s]=!1,a.bubble||a.capture||(delete r.listeners[n.uuid],0===Object.keys(r.listeners).length&&(delete c[e.uuid],0===Object.keys(c).length&&(delete this.registeredEventListeners[t],this._stopObservingTarget_forEventType_(e,t))))}}},actualDOMTargetForEventTypeOnTarget:{value:function(e,t){if(t.nativeAddEventListener){if(t.defaultView)return t;var n,i=this.eventDefinitions[e];return i?(n=typeof i.bubbles===d?i.bubbles(t):i.bubbles,n?t.screen?t.document:t.ownerDocument:t):t}return null}},_observedTarget_byEventType_:{value:{}},_observeTarget_forEventType_:{enumerable:!1,value:function(e,t){var n;!(n=this.actualDOMTargetForEventTypeOnTarget(t,e))||this._observedTarget_byEventType_[t]&&this._observedTarget_byEventType_[t][n.uuid]||(this._observedTarget_byEventType_[t]||(this._observedTarget_byEventType_[t]={}),this._observedTarget_byEventType_[t][n.uuid]=this,n.nativeAddEventListener(t,this,!0))}},_stopObservingTarget_forEventType_:{enumerable:!1,value:function(e,t){var n;n=this.actualDOMTargetForEventTypeOnTarget(t,e),n&&(delete this._observedTarget_byEventType_[t][n.uuid],n.nativeRemoveEventListener(t,this,!0))}},_activationHandler:{enumerable:!0,value:null},_listenToWindow:{enumerable:!1,value:function(e){if(!this._activationHandler){var t=this;this._activationHandler=function(e){var n,i=e.type;if("focus"===i||"mousedown"===i||"touchstart"===i)if(e.changedTouches){n=e.changedTouches.length;for(var r=0;n>r;r++)t._prepareComponentsForActivation(e.changedTouches[r].target)}else t._prepareComponentsForActivation(e.target)}}if(e.Touch?e.document.nativeAddEventListener("touchstart",this._activationHandler,!0):e.document.nativeAddEventListener("mousedown",this._activationHandler,!0),e.document.nativeAddEventListener("focus",this._activationHandler,!0),this.application){var n,i=this.registeredEventListenersOnTarget_(this.application);for(n in i)this._observeTarget_forEventType_(e,n)}}},_stopListeningToWindow:{enumerable:!1,value:function(e){var t,n=this.registeredEventListenersOnTarget_(this.application),i=this.registeredEventListenersOnTarget_(e);for(t in n)this._stopObservingTarget_forEventType_(e,t);for(t in i)this._stopObservingTarget_forEventType_(e,t)}},reset:{enumerable:!1,value:function(){var e,t,n,i;for(e in this.registeredEventListeners){t=this.registeredEventListeners[e];for(n in t.targets)i=t.targets[n],this._stopObservingTarget_forEventType_(i.target,e)}this.registeredEventListeners={},this._claimedPointers={}}},unload:{enumerable:!1,value:function(){this._stopListening()}},methodNameForBubblePhaseOfEventType:{enumerable:!1,value:function(e){return function(t,n){var i=n?t+"+"+n:t;return e[i]||(e[i]="handle"+(n?n.toCapitalized():"")+t.toCapitalized())}}({})},_methodNameForCapturePhaseByEventType_:{value:{}},methodNameForCapturePhaseOfEventType:{enumerable:!1,value:function(e){return function(t,n){var i=n?t+"+"+n:t;return e[i]||(e[i]="capture"+(n?n.toCapitalized():"")+t.toCapitalized())}}({})},_claimedPointers:{enumerable:!1,distinct:!0,value:{}},componentClaimingPointer:{value:function(e){return this._claimedPointers[e]}},isPointerClaimedByComponent:{value:function(e,t){if(!t)throw"Must specify a valid component to see if it claims the specified pointer, '"+t+"' is not valid.";return this._claimedPointers[e]===t}},claimPointer:{value:function(e,t){if(!e&&0!==e)throw"Must specify a valid pointer to claim, '"+e+"' is not valid.";if(!t)throw"Must specify a valid component to claim a pointer, '"+t+"' is not valid.";var n=this._claimedPointers[e];return n===t?!0:n?n.surrenderPointer(e,t)?(this._claimedPointers[e]=t,!0):!1:(this._claimedPointers[e]=t,!0)}},forfeitPointer:{value:function(e,t){if(t!==this._claimedPointers[e])throw"Not allowed to forfeit pointer '"+e+"' claimed by another component";delete this._claimedPointers[e]}},forfeitAllPointers:{value:function(e){var t,n;for(t in this._claimedPointers)n=this._claimedPointers[t],e===n&&delete this._claimedPointers[t]}},_isStoringPointerEvents:{enumerable:!1,value:!1},isStoringPointerEvents:{enumerable:!0,get:function(){return this._isStoringPointerEvents},set:function(e){e===!0?this._isStoringPointerEvents||(this._isStoringPointerEvents=!0,window.Touch&&Object.defineProperty(Touch.prototype,"velocity",{get:function(){return n.pointerMotion(this.identifier).velocity},set:function(){}})):(this._isStoringPointerEvents=!1,this._pointerStorage.memory={},this._isMouseDragging=!1)}},_isStoringMouseEventsWhileDraggingOnly:{enumerable:!1,value:!0},isStoringMouseEventsWhileDraggingOnly:{enumerable:!0,get:function(){return this._isStoringMouseEventsWhileDraggingOnly},set:function(e){this._isStoringMouseEventsWhileDraggingOnly=e===!0?!0:!1}},_isMouseDragging:{enumerable:!1,value:!1},_pointerStorage:{enumerable:!1,value:{memory:{},add:function(e,t){this.memory[e]||(this.memory[e]={data:Array(32),size:0,pos:0}),this.memory[e].data[this.memory[e].pos]=t,this.memory[e].size<this.memory[e].data.length&&this.memory[e].size++,this.memory[e].pos=(this.memory[e].pos+1)%this.memory[e].data.length},remove:function(e){delete this.memory[e]},clear:function(e){this.memory[e]&&(this.memory[e].size=0)},getMemory:function(e){return this.memory[e]},isStored:function(e){return this.memory[e]&&this.memory[e].size>0},storeEvent:function(e){var t;switch(e.type){case"mousedown":n._isMouseDragging=!0;case"mousemove":n._isStoringMouseEventsWhileDraggingOnly?n._isMouseDragging&&(this.add("mouse",{clientX:e.clientX,clientY:e.clientY,timeStamp:e.timeStamp}),Object.defineProperty(e,"velocity",{get:function(){return n.pointerMotion("mouse").velocity},set:function(){}})):(this.add("mouse",{clientX:e.clientX,clientY:e.clientY,timeStamp:e.timeStamp}),Object.defineProperty(e,"velocity",{get:function(){return n.pointerMotion("mouse").velocity},set:function(){}}));break;case"mouseup":this.add("mouse",{clientX:e.clientX,clientY:e.clientY,timeStamp:e.timeStamp}),Object.defineProperty(e,"velocity",{get:function(){return n.pointerMotion("mouse").velocity},set:function(){}});break;case"touchstart":case"touchmove":for(t=0;e.touches.length>t;t++)this.add(e.touches[t].identifier,{clientX:e.touches[t].clientX,clientY:e.touches[t].clientY,timeStamp:e.timeStamp});break;case"touchend":for(t=0;e.changedTouches.length>t;t++)this.add(e.changedTouches[t].identifier,{clientX:e.changedTouches[t].clientX,clientY:e.changedTouches[t].clientY,timeStamp:e.timeStamp})}},removeEvent:function(e){var t;switch(e.type){case"mouseup":n._isMouseDragging=!1,n._isStoringMouseEventsWhileDraggingOnly&&this.clear("mouse");break;case"touchend":for(t=0;e.changedTouches.length>t;t++)this.remove(e.changedTouches[t].identifier)}}}},_getPointerVelocityData:{enumerable:!1,value:function(e){var t,i,r,a,s,o,l,c,u,h=0,d=!0,p={x:[],y:[],time:[]};for(t=n._pointerStorage.getMemory(e),i=t.data.length,r=t.data[(t.pos-1+i)%i],a=s=o=r.timeStamp,l=r.clientX,c=r.clientY;d&&s>a-350&&t.size>h;)r=t.data[(t.pos-h-1+i)%i],s=r.timeStamp,u=l*l+c*c,u>2&&50>=o-s?(p.x.push(r.clientX),p.y.push(r.clientY),p.time.push(s),o=s,l=r.clientX,c=r.clientY,h++):d=!1;return p}},_fitPointerCurve:{enumerable:!1,value:function(e,t){var n,i,r,a,s,o,l,c,u,h,d,p,f,m,g,v,_,b,y,w,C,L,x,M,E,S,O,T,z,P,D,k,A,j,B,I,R,N,F=1e-4,q=t.length;do{for(d=0,p=0,f=0,m=0,g=0,v=0,b=0,y=0,w=0,C=0,L=0,x=0,E=0,S=0,O=0,T=0,z=0,P=0,k=0,A=0,j=0,B=0,I=0,R=0,h=0;q>h;h++)s=t[h],o=s.t,c=o*o,u=c*o,l=s.v,_=F*(6*(c-o)-u+2),M=6*F*(u-2*c+o),D=6*F*(c-u),N=2*F*u,v+=_*_,x+=M*M,P+=D*D,R+=N*N,d+=l*_,b+=l*M,E+=l*D,k+=l*N,f-=_,w-=M,O-=D,j-=N,p-=_*o,y-=M*o,S-=D*o,A-=N*o,m-=_*c,C-=M*c,T-=D*c,B-=N*c,g-=_*u,L-=M*u,z-=D*u,I-=N*u;F*=2}while(0===v||0===x||0===P||0===R);for(o=F/v,d*=o,p*=3*o,f*=o,m*=3*o,g*=o,o=F/x,b*=o,y*=3*o,w*=o,C*=3*o,L*=o,o=F/P,E*=o,S*=3*o,O*=o,T*=3*o,z*=o,o=F/R,k*=o,A*=3*o,j*=o,B*=3*o,I*=o,v=e[0],x=e[1],P=e[2],R=e[3],n=3*(x-P)+R-v,i=v+P-2*x,r=x-v,a=v,h=0;20>h;h++)o=d+a*f+r*p+i*m+n*g,v+=o,a+=o,n-=o,i+=o,r-=o,o=b+a*w+r*y+i*C+n*L,x+=o,n+=3*o,i-=o+o,r+=o,o=E+a*O+r*S+i*T+n*z,P+=o,n-=3*o,i+=o,o=k+a*j+r*A+i*B+n*I,R+=o,n+=o;e[0]=v,e[1]=x,e[2]=P,e[3]=R}},_pointerBezierValue:{enumerable:!1,value:function(e,t){var n=1-e;return n*n*n*t[0]+3*n*n*e*t[1]+3*n*e*e*t[2]+e*e*e*t[3]}},_calculatePointerVelocity:{enumerable:!1,value:function(e,t){var n,i,r=e.length,a=e[0],s=e[0],o=0;for(i=1;r>i;i++)a>e[i]&&(a=e[i],o=i);if(n=s-a){if(r>5){var l,c,u,h=[];for(i=0;r>i;i++)h[i]={v:t[i],t:(e[i]-a)/n};return l=h[o].v,c=h[0].v,u=[l,(2*l+c)/3,(l+2*c)/3,c],this._fitPointerCurve(u,h),5e3*(this._pointerBezierValue(.8,u)-this._pointerBezierValue(.6,u))/n}return r>1?1e3*(t[0]-t[o])/n:0}return 0}},pointerMotion:{value:function(e){if(n._pointerStorage.isStored(e)){var t={};return Object.defineProperties(t,{_data:{enumerable:!1,writable:!0,value:null},_x:{enumerable:!1,writable:!0,value:null},_y:{enumerable:!1,writable:!0,value:null},_speed:{enumerable:!1,writable:!0,value:null},_angle:{enumerable:!1,writable:!0,value:null},x:{get:function(){return null===this._x&&(null===this._data&&(this._data=n._getPointerVelocityData(e)),this._x=n._calculatePointerVelocity(this._data.time,this._data.x)),this._x},set:function(){}},y:{get:function(){return null===this._y&&(null===this._data&&(this._data=n._getPointerVelocityData(e)),this._y=n._calculatePointerVelocity(this._data.time,this._data.y)),this._y},set:function(){}},speed:{get:function(){return null===this._speed&&(this._speed=Math.sqrt(this.x*this.x+this.y*this.y)),this._speed},set:function(){}},angle:{get:function(){return null===this._angle&&(this._angle=Math.atan2(this.y,this.x)),this._angle},set:function(){}}}),{velocity:t}}return void 0}},monitorDOMModificationInEventHandling:{value:!1},domModificationEventHandler:{value:i.specialize({handleEvent:{value:function(){throw"DOM Modified"}},captureDOMSubtreeModified:{value:function(){throw"DOMSubtreeModified"}},captureDOMAttrModified:{value:function(){throw"DOMAttrModified"}},captureDOMCharacterDataModified:{value:function(){throw"DOMCharacterDataModified"}}})},handleEvent:{enumerable:!1,value:function(e){this.monitorDOMModificationInEventHandling&&(document.body.addEventListener("DOMSubtreeModified",this.domModificationEventHandler,!0),document.body.addEventListener("DOMAttrModified",this.domModificationEventHandler,!0),document.body.addEventListener("DOMCharacterDataModified",this.domModificationEventHandler,!0));var t,n,i,r,s,o,p,f,m,g,v,_,b,y,w=e.type,C=e.bubbles;for("DOMContentLoaded"===w&&(t=e.target.defaultView,t&&this._windowsAwaitingFinalRegistration[t.uuid]&&(this._finalizeWindowRegistration(t),e.target.removeEventListener("DOMContentLoaded",this,!0))),y="boolean"!=typeof e.propagationStopped?a.fromEvent(e):e,m=Element.isElement(y.target)||y.target instanceof Document||y.target===window?this._eventPathForDomTarget(y.target):this._eventPathForTarget(y.target),_=y.target.identifier?this.methodNameForCapturePhaseOfEventType(w,y.target.identifier):null,b=y.target.identifier?this.methodNameForBubblePhaseOfEventType(w,y.target.identifier):null,g=this.methodNameForCapturePhaseOfEventType(w),v=this.methodNameForBubblePhaseOfEventType(w),this.delegate&&typeof this.delegate.willDistributeEvent===d&&this.delegate.willDistributeEvent(y),this._isStoringPointerEvents&&this._pointerStorage.storeEvent(y),y.eventPhase=c,n=m.length-1;!y.propagationStopped&&(i=m[n]);n--)if(y.currentTarget=i,r=this.registeredEventListenersForEventType_onTarget_(w,i))for(p=Object.keys(r),s=0;r&&!y.immediatePropagationStopped&&(o=r[p[s]]);s++)o.capture&&(f=o.listener,_&&typeof f[_]===d?f[_](y):typeof f[g]===d?f[g](y):typeof f.handleEvent===d?f.handleEvent(y):typeof f!==d||f.__isConstructor__||f.call(i,y));if(!y.propagationStopped&&(y.eventPhase=u,y.currentTarget=i=y.target,r=this.registeredEventListenersForEventType_onTarget_(w,i)))for(p=Object.keys(r),s=0;r&&!y.immediatePropagationStopped&&(o=r[p[s]]);s++)f=o.listener,o.capture&&(_&&typeof f[_]===d?f[_](y):typeof f[g]===d?f[g](y):typeof f.handleEvent===d?f.handleEvent(y):typeof f===d&&f.call(i,y)),o.bubble&&(b&&typeof f[b]===d?f[b](y):typeof f[v]===d?f[v](y):typeof f.handleEvent===d?f.handleEvent(y):typeof f===d&&f.call(i,y));for(y.eventPhase=h,n=0;C&&!y.propagationStopped&&(i=m[n]);n++)if(y.currentTarget=i,r=this.registeredEventListenersForEventType_onTarget_(w,i))for(p=Object.keys(r),s=0;r&&!y.immediatePropagationStopped&&(o=r[p[s]]);s++)o.bubble&&(f=o.listener,b&&typeof f[b]===d?f[b](y):typeof f[v]===d?f[v](y):typeof f.handleEvent===d?f.handleEvent(y):typeof f===d&&f.call(i,y));y.eventPhase=l,y.currentTarget=null,this._isStoringPointerEvents&&this._pointerStorage.removeEvent(e),this.monitorDOMModificationInEventHandling&&(document.body.removeEventListener("DOMSubtreeModified",this.domModificationEventHandler,!0),document.body.removeEventListener("DOMAttrModified",this.domModificationEventHandler,!0),document.body.removeEventListener("DOMCharacterDataModified",this.domModificationEventHandler,!0))}},_prepareComponentsForActivation:{value:function(e){var t,n,i=e,r=i&&i.defaultView?i.defaultView:window,a=r.document?r.document:document,s=!1,o=null;do switch(i&&(n=this.eventHandlerForElement(i),n&&(s||(s=!0,o=this._findActiveTarget(n)),n._preparedForActivationEvents||(n._prepareForActivationEvents(),n._preparedForActivationEvents=!0))),t=i,i){case r:i=null;break;case a:i=r;break;case a.documentElement:i=a;break;default:i=i.parentNode}while(i&&t!==i);this.activeTarget=o}},_findActiveTarget:{value:function(e){for(var t=null,n={};!t&&e&&!(e.uuid in n);)n[e.uuid]=e,e.acceptsActiveTarget?t=e:e=e.nextTarget;return t}},_eventPathForTarget:{enumerable:!1,value:function(e){if(!e)return[];var t=e,n=this.application,i=[],r={};r[e.uuid]=e;do t.uuid in r||(i.push(t),r[t.uuid]=t),t=t.nextTarget,(!t||t.uuid in r)&&(t=n),t&&t.uuid in r&&(t=null);while(t);return i}},_eventPathForDomTarget:{enumerable:!1,value:function(e){if(!e)return[];var t,n=e,i=n&&n.defaultView?n.defaultView:window,r=i.document?i.document:document,a=this.application,s=[];do switch(n!==e&&s.push(n),t=n,n){case a:n=n.parentApplication,n&&(a=n);break;case i:n=a;break;case r:n=i;break;case r.documentElement:n=r;break;default:n=n.parentNode,n||(n=a)}while(n&&t!==n);return s}},_elementEventHandlerByUUID:{enumerable:!1,value:{}},registerEventHandlerForElement:{enumerable:!1,value:function(e,t){var n=this.eventHandlerForElement(t);n&&this.unregisterEventHandlerForElement(t),this._elementEventHandlerByUUID[t.eventHandlerUUID=e.uuid]=e}},unregisterEventHandlerForElement:{enumerable:!1,value:function(e){delete this._elementEventHandlerByUUID[e.eventHandlerUUID],delete e.eventHandlerUUID}},eventHandlerForElement:{enumerable:!1,value:function(e){return this._elementEventHandlerByUUID[e.eventHandlerUUID]}},_activeTarget:{value:null},activeTarget:{get:function(){return this._activeTarget||this.application},set:function(e){e||(e=this.application),e===this._activeTarget||this.activeTarget&&!this.activeTarget.surrendersActiveTarget(e)||(e.willBecomeActiveTarget(this.activeTarget),this._activeTarget=e,e.didBecomeActiveTarget())}}})}}}),montageDefine("b15df60","core/serialization/deserializer/montage-reviver",{dependencies:["../../core","mousse/deserialization/reviver","./properties-deserializer","./self-deserializer","./unit-deserializer","../../module-reference","../alias","../../promise"],factory:function(e,t){var n=e("../../core").Montage,i=e("mousse/deserialization/reviver").Reviver,r=e("./properties-deserializer").PropertiesDeserializer,a=e("./self-deserializer").SelfDeserializer,s=e("./unit-deserializer").UnitDeserializer,o=e("../../module-reference").ModuleReference,l=e("../alias").Alias,c=e("../../promise").Promise,u=n.specialize({_require:{value:null},_objectRequires:{value:null},init:{value:function(e,t){if("function"!=typeof e)throw Error("Function 'require' missing.");if("string"!=typeof e.location)throw Error("Function 'require' location is missing");if("object"!=typeof t&&void 0!==t)throw Error("Parameter 'objectRequires' should be an object.");return this._require=e,this._objectRequires=t,this}},getExports:{value:function(e,t){var n;for(t=e.resolve(t),n=e.getModuleDescriptor(t);void 0!==n.redirect;)n=e.getModuleDescriptor(n.redirect);return void 0!==n.mappingRedirect?this.getExports(n.mappingRequire,n.mappingRedirect):n.exports}},getModule:{value:function(e,t){var n,i,r=this._objectRequires;return n=r&&t in r?r[t]:this._require,i=this.getExports(n,e),i||(i=n.async(e)),i}}}),h=t.MontageReviver=n.specialize.call(i,{moduleLoader:{value:null},init:{value:function(e,t){return this.moduleLoader=(new u).init(e,t),this}},getTypeOf:{value:function(e){if(null!==e&&"object"==typeof e&&1===Object.keys(e).length){if("#"in e)return"Element";if("%"in e)return"Module"}return i.prototype.getTypeOf.call(this,e)}},_checkLabel:{value:function(e,t){return t&&":"!==e[0]?Error('Aliases can only be defined in template properties (start with a colon (:)), "'+e+'".'):t||":"!==e[0]?void 0:Error('Only aliases are allowed as template properties (start with a colon (:), "'+e+'".')}},reviveRootObject:{value:function(e,t,n){var r,a="alias"in e;return r=this._checkLabel(n,a),r?c.reject(r):i.prototype.reviveRootObject.apply(this,arguments)}},reviveElement:{value:function(e,t,n){var i=e["#"],r=t.getElementById(i);return r?(n&&t.setObjectLabel(r,n),r):c.reject(Error("Element with id '"+i+"' was not found."))}},reviveModule:{value:function(e,t){var n=e["%"],i=t.getRequire();n=i.resolve(n);var r=i.getModuleDescriptor(n);return(new o).initWithIdAndRequire(r.id,r.require)}},reviveCustomObject:{value:function(e,t,n){return"alias"in e?this.reviveAlias(e,t,n):this.reviveMontageObject(e,t,n)}},reviveMontageObject:{value:function(e,t,n){var i,r,a,s=this,o=e.prototype||e.object;return o&&(r=h.parseObjectLocationId(o),i=this.moduleLoader.getModule(r.moduleId,n),a=r.objectName),c.isPromise(i)?i.then(function(i){return s.instantiateMontageObject(e,i,a,t,n)},function(t){throw t.stack&&console.error(t.stack),Error('Error deserializing "'+n+'" when loading module "'+r.moduleId+"' from '"+e.prototype+"'")}):this.instantiateMontageObject(e,i,a,t,n)}},instantiateMontageObject:{value:function(e,t,n,i,r){var a,s,o=this;return a=this.getMontageObject(e,t,n,i,r),i.setObjectLabel(a,r),a.isDeserializing=!0,s=this.reviveObjectLiteral(e,i),c.isPromise(s)?s.then(function(e){return o.deserializeMontageObject(e,a,i,r)}):this.deserializeMontageObject(s,a,i,r)}},deserializeMontageObject:{value:function(e,t,n,i){var r;return"function"==typeof t.deserializeSelf?this.deserializeCustomMontageObject(t,e,n,i):(n.setUnitsToDeserialize(t,e,h._unitNames),r=this.deserializeMontageObjectProperties(t,e.properties,n),c.isPromise(r)?r.then(function(){return t}):t)}},deserializeMontageObjectProperties:{value:function(e,t,n){var i;if("function"==typeof e.deserializeProperties){var a=(new r).initWithReviverAndObjects(this,n);i=e.deserializeProperties(a)}else for(var s in t)e[s]=t[s];return i}},deserializeCustomMontageObject:{value:function(e,t,n,i){var r,s=(new a).initWithObjectAndObjectDescriptorAndContextAndUnitNames(e,t,n,h._unitNames);return r=e.deserializeSelf(s),c.isPromise(r)?r.then(function(e){return n.setObjectLabel(e,i),e}):void 0!==r?(n.setObjectLabel(r,i),r):e}},getMontageObject:{value:function(e,t,n,i,r){var a;if(i.hasUserObject(r))return i.getUserObject(r);if("prototype"in e){if(!(n in t))throw Error('Error deserializing "'+r+'": object named "'+n+'"'+' was not found in "'+e.prototype+'".'+" Available objects are: "+Object.keys(t)+".");return a=Object.create(t[n].prototype),a.isDeserializing=!0,"function"==typeof a.didCreate?a.didCreate():"function"==typeof a.constructor&&a.constructor(),a}if("object"in e){if(!(n in t))throw Error('Error deserializing "'+r+'": object named "'+a+"' was not found given '"+e.object+"'");return t[n]}throw Error("Error deserializing "+JSON.stringify(e)+', might need "prototype" or "object" on label '+JSON.stringify(r))}},reviveAlias:{value:function(e,t,n){var i=new l;return i.value=e.alias,t.setObjectLabel(i,n),i}},didReviveObjects:{value:function(e,t){var n,i=this;return n=this._deserializeUnits(t),c.isPromise(n)?n.then(function(){i._invokeDeserializedFromSerialization(e,t)}):(this._invokeDeserializedFromSerialization(e,t),void 0)}},_invokeDeserializedFromSerialization:{value:function(e,t){var n;for(var i in e)n=e[i],null!=n&&delete n.isDeserializing,t.hasUserObject(i)||n&&"function"==typeof n.deserializedFromSerialization&&n.deserializedFromSerialization(i)}},_deserializeUnits:{value:function(e){var t,n,i=e.getUnitsToDeserialize(),r=h._unitRevivers;try{for(var a,o=0;a=i[o];o++){t=a.unitNames;for(var l,u=0;l=t[u];u++)l in a.objectDesc&&(n=(new s).initWithContext(e),r[l](n,a.object,a.objectDesc[l]))}}catch(d){return c.reject(d)}}}},{_unitRevivers:{value:Object.create(null)},_unitNames:{value:[]},_findObjectNameRegExp:{value:/([^\/]+?)(\.reel)?$/},_toCamelCaseRegExp:{value:/(?:^|-)([^-])/g},_replaceToCamelCase:{value:function(e,t){return t.toUpperCase()}},_locationDescCache:{value:Object.create(null)},parseObjectLocationId:{value:function(e){var t,n,i,r,a=this._locationDescCache;return e in a?t=a[e]:(n=e.indexOf("["),n>0?(i=e.substr(0,n),r=e.slice(n+1,-1)):(i=e,this._findObjectNameRegExp.test(e),r=RegExp.$1.replace(this._toCamelCaseRegExp,this._replaceToCamelCase)),t={moduleId:i,objectName:r},a[e]=t),t}},defineUnitReviver:{value:function(e,t){this._unitRevivers[e]=t,this._unitNames.push(e)}},getTypeOf:{value:function(e){return this.prototype.getTypeOf.call(this,e)}}});void 0!==t&&(t.MontageReviver=h)}}),montageDefine("b15df60","core/logger",{dependencies:["./core"],factory:function(e,t){function n(e){var t=function(e){return this._color=e,this};for(var n in d)t[n]=function(t){return function(){return e.color(d[t])}}(n);e.color=t}var i,r,a,s,o,l,c,u,h=e("./core").Montage;r=t.loggers={},o=function(){var e,t=o.caller.caller;return e=t.name,""===e&&(e="anonymous"),e},l=function(e){if(e.getHours){var t=e.getHours(),n=e.getMinutes(),i=e.getSeconds();return(1===t.length?"0"+t:t)+":"+(1===n.length?"0"+n:n)+":"+(1===i.length?"0"+i:i)+"."+e.getMilliseconds()}},s=function(){},a=function(){console.log(arguments)},i=t.Logger=h.specialize({constructor:{value:function i(){this.super(),n(this)}},init:{value:function(e,t,n){if(this.name=e,this._onStateChange=t,this._storeState=!n,this._storeState&&u){var i=u.getItem("_montage_logger_"+e);i&&(this.isDebug="true"===i)}return t&&this._onStateChange("true"===i),this.isError=!0,this}},name:{value:null},buffer:{value:[],distinct:!0},buffered:{value:!1},flush:{value:function(){var e,t,n=this.buffer;for(t=0;e=n[t];t++)this._formattedLog(e);this.buffer.length=0}},isDebug:{get:function(){return this.debug!==s},set:function(e){this.debug=e?this._consoleLogMontage:s}},isError:{get:function(){return this.error!==s},set:function(e){this.error=e?this._consoleLogMontage:s}},_consoleLogMontage:{value:function(){var e=arguments[0],t=e._montage_metadata;new Date,t?(Array.prototype.shift.call(arguments),Array.prototype.unshift.call(arguments,t.objectName+"."+o(e)+"()"),this.buffered?this.buffer.push(arguments):this._formattedLog(arguments)):this.buffered?this.buffer.push(arguments):this._formattedLog(arguments)}},_formattedLog:{value:function(e){var t=e[0];m.isDebug&&"string"==typeof t&&Array.prototype.splice.call(e,0,1,"%c"+t,this._logCss),console.log.apply(console,e)}},__logCss:{value:null},_logCss:{get:function(){return null===this.__logCss&&(this.__logCss="",this.__logCss+=this._color?"color:"+this._color+";":"color:black;"),this.__logCss}},debug:{value:s},error:{value:s},toTimeString:{value:l},_storeState:{value:null},_onStateChange:{value:null}});var d={base03:"#002b36",base02:"#073642",base01:"#586e75",base00:"#657b83",base0:"#839496",base1:"#93a1a1",base2:"#eee8d5",base3:"#fdf6e3",yellow:"#b58900",orange:"#cb4b16",red:"#dc322f",magenta:"#d33682",violet:"#6c71c4",blue:"#268bd2",cyan:"#2aa198",green:"#859900"};t.logger=function(e,t,n){var a;return null==(a=r[e])&&(a=(new i).init(e,t,n),h.defineProperty(r,e,{value:a})),a},c=h.specialize({constructor:{value:function c(){this.super()}},init:{value:function(){return document.nativeAddEventListener?(document.nativeAddEventListener("keyup",this,!1),document.nativeAddEventListener("keydown",this,!1)):(document.addEventListener("keyup",this,!1),document.addEventListener("keydown",this,!1)),this
}},inspectorElement:{value:null},m_dontRemove:{value:null},titleHeader:{value:null},shown:{value:!1},isCtrl:{value:!1},isAlt:{value:!1},keyup:{value:function(e){17==e.which&&(this.isCtrl=!1),18==e.which&&(this.isAlt=!1)}},keydown:{value:function(e){return 17==e.which&&(this.isCtrl=!0),18==e.which&&(this.isAlt=!0),76==e.which&&this.isCtrl===!0&&this.isAlt===!0?(this.shown?this.hideInspector():this.showInspector(),!1):void 0}},change:{value:function(e){var t=e.target.checked,n=e.target.value,i=r[n];i.isDebug=t,i._onStateChange&&i._onStateChange(t),i._storeState&&u&&u.setItem("_montage_logger_"+n,t)}},mouseup:{value:function(){this.hideInspector()}},showInspector:{value:function(){if(!this.inspectorElement){var e,t,n,i,a,s,o,l,c,h,d,p=0;for(this.m_dontRemove=document.getElementsByTagName("body")[0],this.inspectorElement=document.createElement("div"),this.inspectorElement.id="_montage_logger_inspector",t=document.createElement("div"),this.inspectorElement.appendChild(t),i=document.createElement("div"),t.appendChild(i),n=document.createElement("h1"),n.className="_montage_logger_inspector-title",n.textContent="Logger Inspector",this.titleHeader=n,i.appendChild(n),c=Object.keys(r),p=0;e=r[c[p]];p++)a=document.createElement("label"),s=document.createElement("input"),d=document.createElement("span"),a.className="_montage_logger_inspector-content",d.textContent=e.name,a.appendChild(s),a.appendChild(d),s.value=e.name,s.type="checkbox",s.checked=!!e.isDebug,l="_montage_logger_"+e.name,e._storeState&&u&&(o=u.getItem(l),null==o&&u.setItem(l,e.isDebug)),i.appendChild(a);h=document.createElement("style");var f="#_montage_logger_inspector {";f+="    border: 1px solid rgba(15,15,15,0.4);",f+="    position: fixed;",f+="    right: 25px;",f+="    top: 25px;",f+="    -webkit-border-radius: 5px;",f+="    color: #dddddd;",f+='    font: 10px "Lucida Grande","Lucida Sans", sans;',f+="    background:-webkit-gradient(linear, left top, left bottom, from(rgba(15,15,15,0.75)), to(rgba(15,15,15,0.95)) );",f+="    -webkit-box-shadow: 0 0 15px rgba(0,0,0,.3);",f+="    width: 250px;",f+="}",f+="#_montage_logger_inspector div {",f+="    -webkit-border-radius: 5px;",f+="    background: -webkit-gradient(radial, 100 -60, 0, 125 -50, 125, from(rgba(255,255,255,0.00)), to(rgba(0,0,0,.2)), color-stop(1, rgba(0,0,0,.2)));",f+="}",f+="#_montage_logger_inspector div div {",f+="    background: -webkit-gradient(linear, left top, left bottom, from(rgba(255,255,255,0.2)), to(rgba(0,0,0,.1)), color-stop(0.33, rgba(255,255,255,.01)), color-stop(0.33, rgba(50,50,50,1)) );",f+="    padding: 7px 10px;",f+="    -webkit-border-radius: 3px;",f+="    overflow-x: hidden;",f+="}",f+="._montage_logger_inspector-title {",f+="    color: rgba(255,255,255,0.9);",f+="    font-size: 13px;",f+="    margin: 0 0 11px 0;",f+="    padding: 0 0 0 5px;",f+="}",f+="._montage_logger_inspector-content {",f+="    padding: 0 0 0 20px;",f+="    margin: 0;",f+="    display: block;",f+="}",h.textContent=f,document.head.appendChild(h)}this.shown=!0,this.m_dontRemove.appendChild(this.inspectorElement),this.titleHeader.nativeAddEventListener("mouseup",this,!1),this.inspectorElement.nativeAddEventListener("change",this,!1)}},hideInspector:{value:function(){document.getElementById("_montage_logger_inspector")&&(this.shown=!1,this.m_dontRemove.removeChild(this.inspectorElement),this.titleHeader.nativeRemoveEventListener("mouseup",this,!1),this.inspectorElement.nativeRemoveEventListener("change",this,!1))}},handleEvent:{enumerable:!1,value:function(e){this[e.type]&&this[e.type](e)}}});var p=function(){(new c).init()};if("undefined"!=typeof window){try{u=window.localStorage}catch(f){console.log("Error accessing localStorage",f)}window.loggers=r,u&&p()}var m=t.logger("colors")}}),montageDefine("b15df60","core/serialization/deserializer/properties-deserializer",{dependencies:["../../core","../../promise"],factory:function(e,t){var n=e("../../core").Montage;e("../../promise").Promise;var i=n.specialize({_object:{value:null},_objectDescriptor:{value:null},_context:{value:null},initWithObjectAndObjectDescriptorAndContext:{value:function(e,t,n){return this._object=e,this._objectDescriptor=t,this._context=n,this}},get:{value:function(e){return this._objectDescriptor.properties?this._objectDescriptor.properties[e]:void 0}},deserializeProperties:{value:function(e){var t,i=this._object,r=this._objectDescriptor.properties;if(r){e||(e=n.getSerializablePropertyNames(i));for(var a=0,s=e.length;s>a;a++)t=e[a],i[t]=r[t]}}},getObjectByLabel:{value:function(e){this._context.getObject(e)}}});t.PropertiesDeserializer=i}}),montageDefine("b15df60","core/serialization/deserializer/self-deserializer",{dependencies:["../../core","../../promise"],factory:function(e,t){var n=e("../../core").Montage;e("../../promise").Promise;var i=n.specialize({_object:{value:null},_objectDescriptor:{value:null},_context:{value:null},_unitNames:{value:null},_objectUnitNames:{value:null},create:{value:function(){return new this}},initWithObjectAndObjectDescriptorAndContextAndUnitNames:{value:function(e,t,n,i){return this._object=e,this._objectDescriptor=t,this._context=n,this._unitNames=i,this}},getProperty:{value:function(e){return this._objectDescriptor.properties?this._objectDescriptor.properties[e]:void 0}},getType:{value:function(){return"prototype"in this._objectDescriptor?"prototype":"object"in this._objectDescriptor?"object":void 0}},getTypeValue:{value:function(){return this._objectDescriptor.prototype||this._objectDescriptor.object}},getObjectByLabel:{value:function(e){this._context.getObject(e)}},deserializeProperties:{value:function(e){var t,i=this._object,r=this._objectDescriptor.properties;if(r){e||(e=n.getSerializablePropertyNames(i));for(var a=0,s=e.length;s>a;a++)t=e[a],i[t]=r[t]}}},deserializeUnit:{value:function(e){var t=this._objectUnitNames;t?-1===t.indexOf(e)&&t.push(e):(t=this._objectUnitNames=[e],this._context.setUnitsToDeserialize(this._object,this._objectDescriptor,t))}},deserializeUnits:{value:function(){var e=this._objectUnitNames;if(e)for(var t,n=0;t=e[n];n++)-1===e.indexOf(t)&&e.push(t);else e=this._objectUnitNames=this._unitNames,this._context.setUnitsToDeserialize(this._object,this._objectDescriptor,e)}}});t.SelfDeserializer=i}}),montageDefine("b15df60","core/serialization/deserializer/unit-deserializer",{dependencies:["../../core","../../promise"],factory:function(e,t){var n=e("../../core").Montage;e("../../promise").Promise;var i=n.specialize({_context:{value:null},create:{value:function(){return new this}},initWithContext:{value:function(e){return this._context=e,this}},_templatePropertyRegExp:{value:/^([^:]+)(:.*)$/},isValidTemplatePropertyReference:{value:function(e){var t=this._templatePropertyRegExp.exec(e);if(t){var n=t[1];return this._context.hasObject(n)?!0:!1}return!1}},getObjectByLabel:{value:function(e){if(this._context.hasObject(e))return this._context.getObject(e);if(this.isValidTemplatePropertyReference(e))return null;throw Error("Object with label '"+e+"' was not found.")}}});t.UnitDeserializer=i}}),montageDefine("b15df60","core/module-reference",{dependencies:["./core"],factory:function(e,t){var n=e("./core").Montage;t.ModuleReference=n.specialize({constructor:{value:function(){return this.super()}},initWithIdAndRequire:{value:function(e,t){if(!e||!t)throw Error("Module ID and require required");return this.id=e,this.require=t,this}},id:{value:null},require:{value:null},_exports:{value:null},exports:{get:function(){return this._exports?this._exports:this._exports=this.require.async(this.id)}},resolve:{value:function(e){return e.identify(this.id,this.require)}},isModuleReference:{writable:!1,configurable:!1,value:!0}})}}),montageDefine("b15df60","core/serialization/alias",{dependencies:["../core"],factory:function(e,t){var n=e("../core").Montage;t.Alias=n.specialize({_value:{value:null},_aliasRegExp:{value:/@([_a-zA-Z$][0-9_a-zA-Z$]*):([_a-zA-Z$][0-9_a-zA-Z$]*)$/},value:{get:function(){return this._value},set:function(e){var t=this._aliasRegExp.exec(e);if(!t)throw Error("Invalid alias syntax: "+e);this._value=e,this._componentLabel=t[1],this._propertyName=t[2]}},_componentLabel:{value:null},componentLabel:{get:function(){return this._componentLabel}},_propertyName:{value:null},propertyName:{get:function(){return this._propertyName}},init:{value:function(e){return this.value=e,this}}})}}),montageDefine("b15df60","core/shim/object",{dependencies:[],factory:function(){Object.create||(Object._creator=function e(){this.__proto__=e.prototype},Object.create=function(e){return this._creator.prototype=e||Object.prototype,new this._creator},Object.getPrototypeOf=function(e){return e.__proto__}),Object.isSealed||Object.defineProperty(Object,"isSealed",{value:function(){return!1},writable:!0,configurable:!0}),Object.seal||Object.defineProperty(Object,"seal",{value:function(e){return e},writable:!0,configurable:!0})}}),montageDefine("b15df60","core/shim/array",{dependencies:[],factory:function(){Array.isArray||Object.defineProperty(Array,"isArray",{value:function(e){return"[object Array]"===Object.prototype.toString.call(e)},writable:!0,configurable:!0})}}),montageDefine("b15df60","core/shim/string",{dependencies:[],factory:function(){String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e){return this.length>=e.length&&this.slice(0,e.length)===e},writable:!0,configurable:!0}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(e){return this.length>=e.length&&this.slice(this.length-e.length,this.length)===e},writable:!0,configurable:!0})}}),montageDefine("b15df60","core/extras/object",{dependencies:["collections/weak-map","frb"],factory:function(e){e("collections/weak-map"),Object.defineProperty(Object,"getPropertyDescriptor",{value:function(e,t){var n,i=e;do n=Object.getOwnPropertyDescriptor(i,t);while(!n&&(i=i.__proto__||Object.getPrototypeOf(i)));return n},writable:!0,configurable:!0}),Object.defineProperty(Object,"getPrototypeAndDescriptorDefiningProperty",{value:function(e,t){var n,i=e;if(t){do n=Object.getOwnPropertyDescriptor(i,t);while(!n&&(i=i.__proto__||Object.getPrototypeOf(i)));return{prototype:i,propertyDescriptor:n}}},writable:!0,configurable:!0}),Object.defineProperty(Object.prototype,"clear",{value:function(){for(var e=Object.keys(this),t=e.length;t;)t--,delete this[e[t]];return this},writable:!0,configurable:!0}),Object.defineProperty(Object,"defineBinding",{value:function(t,n,i){var r=Error.stackTraceLimit;Error.stackTraceLimit=2,console.warn("Object.defineBinding deprecated.  See the comment below this warning for migration instructions.",Error("deprecated").stack),Error.stackTraceLimit=r;var a=e("frb");i.source=i.boundObject,i.oneway?i["<-"]=i.boundObjectPropertyPath:i["<->"]=i.boundObjectPropertyPath,i.boundValueMutator&&(i.convert=i.boundValueMutator),a.defineBinding(t,n,i)}}),Object.defineProperty(Object,"deleteBinding",{value:function(t,n){var i=e("frb");i.cancelBinding(t,n)}})}}),montageDefine("b15df60","core/extras/date",{dependencies:[],factory:function(){Object.defineProperty(Date.prototype,"clone",{value:function(){return new Date(this)},writable:!0,configurable:!0})}}),montageDefine("b15df60","core/extras/element",{dependencies:[],factory:function(){"undefined"==typeof Element||Element.isElement||Object.defineProperty(Element,"isElement",{value:function(e){return!(!e||1!==e.nodeType)},writable:!0,configurable:!0})}}),montageDefine("b15df60","core/extras/function",{dependencies:["./object"],factory:function(e){e("./object"),Object.defineProperty(Function,"identity",{value:function(e){return e},writable:!0,configurable:!0}),Object.defineProperty(Function,"noop",{value:function(){},writable:!0,configurable:!0}),Object.defineProperty(Function,"by",{value:function(e,t){t=t||Object.compare,e=e||Function.identity;var n=function(n,i){return t(e(n),e(i))};return n.compare=t,n.by=e,n},writable:!0,configurable:!0})}}),montageDefine("b15df60","core/extras/regexp",{dependencies:[],factory:function(){if(!RegExp.isRegExp){var e=Object.prototype.toString;Object.defineProperty(RegExp,"isRegExp",{value:function(t){return"[object RegExp]"===e.call(t)},writable:!0,configurable:!0})}}}),montageDefine("b15df60","core/extras/string",{dependencies:[],factory:function(){Object.defineProperty(String.prototype,"equals",{value:function(e){return this.valueOf()===Object.getValueOf(e)},writable:!0,configurable:!0}),Object.defineProperty(String.prototype,"contains",{value:function(e){return-1!==this.indexOf(e)},writable:!0,configurable:!0}),Object.defineProperty(String.prototype,"toCapitalized",{value:function(){return this.charAt(0).toUpperCase()+this.slice(1)},writable:!0,configurable:!0})}}),montageDefine("b15df60","core/deprecate",{dependencies:[],factory:function(e,t){var n=t.deprecationWarning=function n(e,t,n){if(n=n===!0?2:n){var i=Error.stackTraceLimit;Error.stackTraceLimit=n}if("undefined"!=typeof console&&"function"==typeof console.warn){var r=n?Error("").stack:"";t?console.warn(e+" is deprecated, use "+t+" instead.",r):console.warn(e,r)}n&&(Error.stackTraceLimit=i)};t.deprecateMethod=function(e,t,i,r){var a=function(){return n(i,r,3),t.apply(e?e:this,arguments)};return a.deprecatedFunction=t,a},t.callDeprecatedFunction=function(e,t,n,i){var r,a,s=Error.stackTraceLimit;return Error.stackTraceLimit=2,"undefined"!=typeof console&&"function"==typeof console.warn&&(r=Montage.getInfoForObject(e).objectName,i?console.warn(n+" is deprecated, use "+i+" instead.",r):console.warn(n,r)),Error.stackTraceLimit=s,a=ARRAY_PROTOTYPE.slice.call(arguments,4),t.apply(e?e:this,a)}}}),montageDefine("b15df60","core/uuid",{dependencies:[],factory:function(e,t){function n(){var e,t=i,n=r;return n[0]=t[15&(e=4294967296*Math.random())],n[1]=t[15&(e>>>=4)],n[2]=t[15&(e>>>=4)],n[3]=t[15&(e>>>=4)],n[4]=t[15&(e>>>=4)],n[5]=t[15&(e>>>=4)],n[6]=t[15&(e>>>=4)],n[7]=t[15&(e>>>=4)],n[9]=t[15&(e=4294967296*Math.random())],n[10]=t[15&(e>>>=4)],n[11]=t[15&(e>>>=4)],n[12]=t[15&(e>>>=4)],n[15]=t[15&(e>>>=4)],n[16]=t[15&(e>>>=4)],n[17]=t[15&(e>>>=4)],n[19]=t[8|3&(e=4294967296*Math.random())],n[20]=t[15&(e>>>=4)],n[21]=t[15&(e>>>=4)],n[22]=t[15&(e>>>=4)],n[24]=t[15&(e>>>=4)],n[25]=t[15&(e>>>=4)],n[26]=t[15&(e>>>=4)],n[27]=t[15&(e>>>=4)],n[28]=t[15&(e=4294967296*Math.random())],n[29]=t[15&(e>>>=4)],n[30]=t[15&(e>>>=4)],n[31]=t[15&(e>>>=4)],n[32]=t[15&(e>>>=4)],n[33]=t[15&(e>>>=4)],n[34]=t[15&(e>>>=4)],n[35]=t[15&(e>>>=4)],n.join("")}var i="0123456789ABCDEF".split(""),r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".split("");t.Uuid=Object.create(Object.prototype,{generate:{enumerable:!1,value:n}}),t.generate=n}}),montageDefine("b15df60","core/serialization/bindings",{dependencies:["frb","frb/parse","frb/stringify","frb/expand","frb/scope","../serialization"],factory:function(e){var t=e("frb"),n=(e("frb/parse"),e("frb/stringify")),i=e("frb/expand"),r=e("frb/scope"),a=e("../serialization").Serializer,s=e("../serialization").Deserializer;a.defineSerializationUnit("bindings",function(e,a){var s,o=t.getBindings(a),l={};for(var c in o){var u=o[c],h={};if(!("serializable"in u)||u.serializable){var d=u.sourcePath,p=u.sourceSyntax;if(u.source!==a){var f=e.getObjectLabel(u.source),m=new r({type:"component",label:f});m.components=e,p=i(p,m)}var m=new r;m.components=e,d=n(p,m),u.twoWay?h["<->"]=d:h["<-"]=d,u.converter?h.converter=u.converter:(h.convert=u.convert,h.revert=u.revert),u.trace&&(h.trace=!0),l[c]=h,s=!0}}return s?l:void 0}),s.defineDeserializationUnit("bindings",function(e,n,i){for(var r in i){var a=i[r];if("object"!=typeof a)throw Error("Binding descriptor must be an object, not "+typeof a);"boundObject"in a?(a.source=e.getObjectByLabel(a.boundObject),a.oneway?a["<-"]=a.boundPropertyPath:a["<->"]=a.boundPropertyPath,delete a.boundObject,delete a.boundObjectPropertyPath,delete a.oneway):a["<<->"]&&(console.warn("WARNING: <<-> in bindings is deprectated, use <-> only, please update now."),a["<->"]=a["<<->"],delete a["<<->"])}t.defineBindings(n,i,{components:e})})}}),montageDefine("b15df60","core/event/mutable-event",{dependencies:["../core"],factory:function(e,t){var n=e("../core").Montage;if("undefined"!=typeof window){var i={},r=function(e,t){var i="_"+t;n.defineProperty(e,i,{value:void 0}),n.defineProperty(e,t,{get:function(e,t){return function(){return this.hasOwnProperty(t)?this[t]:this._event?this._event[e]:void 0}}(t,i),set:function(e){return function(t){this[e]=t}}(i)})};t.MutableEvent=n.specialize({_initPrototypeWithEvent:{value:function(e){var t;for(t in e)this[t]||r(this,t);return r(this,"replayed"),this}},_initWithEvent:{value:function(e){return this._event=e,this}},preventDefault:{value:function(){this._event.preventDefault()}},getPreventDefault:{value:function(){return this._event.getPreventDefault?this._event.getPreventDefault():this._event.defaultPrevented}},stopImmediatePropagation:{value:function(){this._event.stopImmediatePropagation(),this.propagationStopped=!0,this.immediatePropagationStopped=!0}},propagationStopped:{value:!1},immediatePropagationStopped:{value:!1},mutable:{value:!0},target:{value:null},stopPropagation:{value:function(){this._event.stopPropagation(),this.propagationStopped=!0}},stop:{value:function(){this.preventDefault(),this.stopPropagation()}}},{fromEvent:{value:function(e){var n,r=e.type,a=i[r];return a||(a=function(){},a.prototype=(new t.MutableEvent)._initPrototypeWithEvent(e),i[r]=a),n=new a,n._initWithEvent(e),n}},fromType:{value:function(e,t,n,i){var r=document.createEvent("CustomEvent");return r.initCustomEvent(e,t,n,i),this.fromEvent(r)}}})}}}),montageDefine("b15df60","core/serialization",{dependencies:["./serialization/serializer/montage-serializer","./serialization/deserializer/montage-deserializer"],factory:function(e,t){var n=e("./serialization/serializer/montage-serializer").MontageSerializer,i=e("./serialization/serializer/montage-serializer").serialize,r=e("./serialization/deserializer/montage-deserializer").MontageDeserializer,a=e("./serialization/deserializer/montage-deserializer").deserialize;t.Serializer=n,t.serialize=i,t.Deserializer=r,t.deserialize=a}}),montageDefine("b15df60","core/serialization/serializer/montage-serializer",{dependencies:["../../core","mousse/serialization/malker","mousse/serialization/serializer","./montage-builder","./montage-labeler","./montage-visitor","../../logger"],factory:function(e,t){var n=e("../../core").Montage,i=e("mousse/serialization/malker").Malker,r=e("mousse/serialization/serializer").Serializer,a=e("./montage-builder").MontageBuilder,s=e("./montage-labeler").MontageLabeler,o=e("./montage-visitor").MontageVisitor;e("../../logger").logger("montage-serializer");var l=n.specialize.call(r,{_require:{value:null},_visitor:{value:null},_units:{value:Object.create(null)},_findObjectNameRegExp:{value:/([^\/]+?)(\.reel)?$/},_toCamelCaseRegExp:{value:/(?:^|-)([^-])/g},_replaceToCamelCase:{value:function(e,t){return t.toUpperCase()}},constructor:{value:function l(){}},initWithRequire:{value:function(e){return this._require=e,this._builder=new a,this._labeler=new s,this._visitor=(new o).initWithBuilderAndLabelerAndRequireAndUnits(this._builder,this._labeler,this._require,this._units),this._malker=new i(this._visitor),this}},getExternalObjects:{value:function(){return this._visitor.getExternalObjects()}},getExternalElements:{value:function(){return this._visitor.getExternalElements()}},defineSerializationUnit:{value:function(e,t){this.constructor.defineSerializationUnit.call(this,e,t)}}},{defineSerializationUnit:{value:function(e,t){this._units[e]=t}},getDefaultObjectNameForModuleId:{value:function(e){return this._findObjectNameRegExp.test(e),RegExp.$1.replace(this._toCamelCaseRegExp,this._replaceToCamelCase)}}});t.MontageSerializer=l,t.serialize=function(e,t){return(new l).initWithRequire(t).serializeObject(e)}}}),montageDefine("b15df60","core/serialization/deserializer/montage-deserializer",{dependencies:["../../core","mousse/deserialization/interpreter","mousse/deserialization/deserializer","./montage-interpreter","./montage-reviver","../../promise","../../jshint","../../logger"],factory:function(e,t){var n=e("../../core").Montage;e("mousse/deserialization/interpreter").Interpreter;var i=e("mousse/deserialization/deserializer").Deserializer,r=e("./montage-interpreter").MontageInterpreter,a=e("./montage-reviver").MontageReviver,s=e("../../promise").Promise,o=e("../../jshint").JSHINT;e("../../logger").logger("montage-deserializer");var l=n.specialize.call(i,{_interpreter:{value:null},_serializationString:{value:null},_serialization:{value:null},init:{value:function(e,t,n){if(!this.isSerializationStringValid(e))throw Error(this._formatSerializationSyntaxError(e));return i.call(this,e),this._origin,this._serialization=null,this._interpreter=(new r).init(t,n),this}},serialization:{get:function(){var e=this._serialization;return e||(e=JSON.parse(this._serializationString),this._serialization=e),e}},deserialize:{value:function(e,t){var n;try{n=JSON.parse(this._serializationString)}catch(i){return s.reject(i)}return this._interpreter.instantiate(n,e,t)}},preloadModules:{value:function(){var e=JSON.parse(this._serializationString);return this._interpreter.preloadModules(e)}},getExternalObjectLabels:{value:function(){var e=this.serialization,t=[];for(var n in e)0===Object.keys(e[n]).length&&t.push(n);return t}},isSerializationStringValid:{value:function(e){try{return JSON.parse(e),!0}catch(t){return!1}}},_formatSerializationSyntaxError:{value:function(e){var t,n,i,r,a,s="   ",l=this._origin;if(o(e))t="Syntax error in the serialization but not able to find it!\n"+e;else{n=o.errors[0],i=e.split("\n"),r=(s+i.length).length,a=n.line-1;for(var c=0,u=i.length;u>c;c++)i[c]=Array(r-(c+1+"").length+1).join(c===a?">":" ")+(c+1)+" "+i[c];t="Syntax error at line "+n.line+(l?" from "+l:"")+":\n"+n.evidence+"\n"+n.reason+"\n"+i.join("\n")}return t}}},{defineDeserializationUnit:{value:function(e,t){a.defineUnitReviver(e,t)}}});t.MontageDeserializer=l,t.deserialize=function(e,t){return(new l).init(e,t).deserializeObject()}}}),montageDefine("b15df60","core/serialization/serializer/montage-builder",{dependencies:["../../core","mousse/serialization/builder","./montage-ast"],factory:function(e,t){var n=e("../../core").Montage,i=e("mousse/serialization/builder").Builder,r=e("./montage-ast"),a=n.specialize.call(i,{constructor:{value:function a(){i.call(this)}},createElementReference:{value:function(e){return(new r.ElementReference).initWithRootAndId(this._root,e)}},createModuleReference:{value:function(e){return(new r.ModuleReference).initWithRootAndModuleId(this._root,e)}}});t.MontageBuilder=a}}),montageDefine("b15df60","core/serialization/serializer/montage-labeler",{dependencies:["../../core","mousse/serialization/labeler"],factory:function(e,t){var n=e("../../core").Montage,i=e("mousse/serialization/labeler").Labeler;t.MontageLabeler=n.specialize.call(i,{_labelRegexp:{value:/^[a-zA-Z_$][0-9a-zA-Z_$]*$/},constructor:{value:function(){i.call(this)}},getTemplatePropertyLabel:{value:function(e){var t=this.superForValue("getObjectLabel")(e);if(":"!==t[0])throw Error("Template property's labels need to start with a colon (:), (\""+t+'").');return t}},getObjectLabel:{value:function(e){var t=this.super(e);if(":"===t[0])throw Error('Labels starting with colon (:) can only be used for template properties, ("'+t+'").');return t}},getObjectName:{value:function(e){var t,r=e.identifier;return r&&this._labelRegexp.test(r)?t=e.identifier:"getInfoForObject"in e||"getInfoForObject"in e.constructor?(t=n.getInfoForObject(e).objectName,t=t.toLowerCase()):t=i.prototype.getObjectName.call(this,e),t}}})}}),montageDefine("b15df60","core/serialization/serializer/montage-visitor",{dependencies:["../../core","./montage-serializer","./properties-serializer","./self-serializer","./unit-serializer","../alias","mousse/serialization/visitor"],factory:function(e,t){var n=e("../../core").Montage,i=e("./montage-serializer"),r=e("./properties-serializer").PropertiesSerializer,a=e("./self-serializer").SelfSerializer,s=e("./unit-serializer").UnitSerializer,o=e("../alias").Alias,l=e("mousse/serialization/visitor").Visitor,c=n.specialize.call(l,{_MONTAGE_ID_ATTRIBUTE:{value:"data-montage-id"},_require:{value:null},_units:{value:null},_elements:{value:null},constructor:{value:function c(){}},initWithBuilderAndLabelerAndRequireAndUnits:{value:function(e,t,n,i){return l.call(this,e,t),this._require=n,this._units=i,this._elements=[],this}},getTypeOf:{value:function(e){return e.isModuleReference?"Module":e instanceof o?"Alias":"getInfoForObject"in e||"getInfoForObject"in e.constructor?"MontageObject":e.thisIsAReferenceCreatedByMontageSerializer?"MontageReference":"undefined"!=typeof Element&&Element.isElement(e)?"Element":void 0}},visitMontageReference:{value:function(e,t,n){this.builder.top.setProperty(n,t.reference)}},visitElement:{value:function(e,t,n){var i,r;if(r=t.getAttribute(this._MONTAGE_ID_ATTRIBUTE),!r)throw Error("Not possible to serialize a DOM element with no "+this._MONTAGE_ID_ATTRIBUTE+" assigned: "+t.outerHTML);i=this.builder.createElementReference(r),this.storeValue(i,t,n),this._elements.push(t)}},visitModule:{value:function(e,t,n){var i,r;try{r=t.resolve(this._require)}catch(a){throw Error("Not possible to serialize module reference "+t.id+" from package "+t.require.location+" inside package "+this._require.location)}i=this.builder.createModuleReference(r),this.storeValue(i,t,n)}},visitAlias:{value:function(e,t){var n=this.labeler.getTemplatePropertyLabel(t),i=this.builder.createCustomObject();i.setProperty("alias",t.value),this.builder.top.setProperty(n,i)}},visitMontageObject:{value:function(e,t,n){this.isObjectSerialized(t)?this.serializeReferenceToMontageObject(e,t,n):this.handleMontageObject(e,t,n)}},handleMontageObject:{value:function(e,t,n){var i,r=this.builder.createCustomObject();this.setObjectSerialization(t,r),i=this.serializeMontageObject(e,t,r),i?this.serializeSubstituteObject(e,t,n,r,i):(r.setLabel(this.labeler.getObjectLabel(t)),this.builder.top.setProperty(n,r))}},serializeReferenceToMontageObject:{value:function(e,t,n){var i=this.labeler.getObjectLabel(t),r=this.builder.createObjectReference(i);this.builder.top.setProperty(n,r)}},serializeSubstituteObject:{value:function(e,t,n,i,r){var a,s,o,l;a=this.labeler.getObjectLabel(t),this.labeler.isUserDefinedLabel(a)?(s=this.labeler.getObjectLabel(r),this.labeler.setObjectLabel(r,a),this.builder.relabelReferences(s,a),l=this.getObjectSerialization(r),l&&(l.setLabel(a),this.labeler.isUserDefinedLabel(s)&&this.builder.createObjectReference(a).setLabel(s)),e.visit(r,n)):(e.visit(r,n),o=this.labeler.getObjectLabel(r),this.labeler.setObjectLabel(t,o),this.builder.relabelReferences(a,o))}},serializeMontageObject:{value:function(e,t,n){var i,r,s=this.builder.createObjectLiteral();return this.setObjectType(t,n),n.setProperty("properties",s),this.builder.push(n),"function"==typeof t.serializeSelf?(i=(new a).initWithMalkerAndVisitorAndObject(e,this,t,n),r=t.serializeSelf(i)):(this.setObjectProperties(e,t),this.setObjectCustomUnits(e,t)),this.builder.pop(),0===s.getPropertyNames().length&&n.clearProperty("properties"),r}},setObjectType:{value:function(e,t){var i=n.getInfoForObject(e).isInstance,r=this.getObjectLocationId(e),a=this.builder.createString(r);i?t.setProperty("prototype",a):t.setProperty("object",a)}},getObjectModuleId:{value:function(e){var t=n.getInfoForObject(e);return this._require.identify(t.moduleId,t.require)}},getObjectLocationId:{value:function(e){var t,r=this.getObjectModuleId(e),a=n.getInfoForObject(e),s=a.objectName;return t=i.MontageSerializer.getDefaultObjectNameForModuleId(r),t===s?r:r+"["+s+"]"}},setObjectProperties:{value:function(e,t){var n,i;i=this.builder.top.getProperty("properties"),this.builder.push(i),"function"==typeof t.serializeProperties?(n=(new r).initWithMalkerAndVisitorAndObject(e,this,t),t.serializeProperties(n)):this.setSerializableObjectProperties(e,t),this.builder.pop()}},setSerializableObjectProperties:{value:function(e,t){for(var i,r,a=n.getSerializablePropertyNames(t),s=a.length,o=0;s>o;o++)r=a[o],i=n.getPropertyAttribute(t,r,"serializable"),this.setProperty(e,r,t[r],i)}},hackIsReferenceAllowedForValue:{value:function(e){return"object"==typeof e&&null!=e&&!("undefined"!=typeof Element&&Element.isElement(e))}},setProperty:{value:function(e,t,n,i){var r;if("reference"===i&&this.hackIsReferenceAllowedForValue(n)){r=this.labeler.getObjectLabel(n);var a=this.builder.createObjectReference(r);this.builder.top.setProperty(t,a)}else e.visit(n,t)}},setObjectCustomUnits:{value:function(e,t){for(var n in this._units)this.setObjectCustomUnit(e,t,n)}},setObjectCustomUnit:{value:function(e,t,n){var i,r,a=this._units[n];a&&(r=(new s).initWithMalkerAndVisitorAndObject(e,this,t),i=a(r,t),null!=i&&e.visit(i,n))}},getExternalObjects:{value:function(){for(var e,t={},n=this.builder.getExternalReferences(),i=0;e=n[i];i++)t[e]=this.labeler.getObjectByLabel(e);return t}},getExternalElements:{value:function(){return this._elements}}});t.MontageVisitor=c}}),montageDefine("b15df60","core/serialization/deserializer/montage-interpreter",{dependencies:["../../core","mousse/deserialization/interpreter","mousse/deserialization/context","./montage-reviver","../../promise"],factory:function(e,t){var n=e("../../core").Montage,i=e("mousse/deserialization/interpreter").Interpreter,r=e("mousse/deserialization/context").Context,a=e("./montage-reviver").MontageReviver,s=e("../../promise").Promise,o=n.specialize.call(i,{_require:{value:null},_reviver:{value:null},init:{value:function(e,t){if("function"!=typeof e)throw Error("Function 'require' missing.");return this._reviver=(new a).init(e,t),this._require=e,this}},instantiate:{value:function(e,t,n){var i;return i=(new l).init(e,this._reviver,t,n,this._require),i.getObjects()}},preloadModules:{value:function(e){var t,n,i,r,o=this._reviver,l=o.moduleLoader,c=[];for(var u in e)t=e[u],n=t.prototype||t.object,n&&(i=a.parseObjectLocationId(n),r=l.getModule(i.moduleId,u),s.isPromise(r)&&c.push(r));return c.length>0?s.all(c):void 0}}}),l=n.specialize.call(r,{_ELEMENT_ID_ATTRIBUTE:{value:"data-montage-id"},_unitsToDeserialize:{value:null},_element:{value:null},_require:{value:null},constructor:{value:function(){this._unitsToDeserialize=[]}},init:{value:function(e,t,n,i,a){return r.call(this,e,t,n),this._element=i,this._require=a,this}},hasObject:{value:function(e){return e in this._serialization}},getRequire:{value:function(){return this._require}},getElement:{value:function(){return this._element}},getElementById:{value:function(e){var t="*["+this._ELEMENT_ID_ATTRIBUTE+'="'+e+'"]';return this._element.querySelector(t)}},setUnitsToDeserialize:{value:function(e,t,n){this._unitsToDeserialize.push({object:e,objectDesc:t,unitNames:n})}},getUnitsToDeserialize:{value:function(){return this._unitsToDeserialize}}});t.MontageInterpreter=o,t.MontageContext=l}}),montageDefine("b15df60","core/jshint",{dependencies:[],factory:function(e,t){var n=function(e){var t,n=function(){return t||(t=e(n)),t.apply(this,arguments)};return n}(function(e){"use strict";function t(){}function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function i(e,t){var i;for(i in t)n(t,i)&&(e[i]=t[i])}function r(){dt.couch&&i(pt,St),dt.rhino&&i(pt,Bt),dt.prototypejs&&i(pt,jt),dt.node&&i(pt,At),dt.devel&&i(pt,Ot),dt.dojo&&i(pt,Tt),dt.browser&&i(pt,Et),dt.jquery&&i(pt,Dt),dt.mootools&&i(pt,kt),dt.wsh&&i(pt,Nt),dt.globalstrict&&dt.strict!==!1&&(dt.strict=!0)}function a(e,t,n){var i=Math.floor(100*(t/st.length));throw{name:"JSHintError",line:t,character:n,message:e+" ("+i+"% scanned)."}}function s(t,n,i,r,s,o){var l,c,u;return n=n||ut,"(end)"===n.id&&(n=wt),c=n.line||0,l=n.from||0,u={id:"(error)",raw:t,evidence:st[c-1]||"",line:c,character:l,a:i,b:r,c:s,d:o},u.reason=t.supplant(u),e.errors.push(u),dt.passfail&&a("Stopping. ",c,l),Lt+=1,Lt>=dt.maxerr&&a("Too many errors.",c,l),u}function o(e,t,n,i,r,a,o){return s(e,{line:t,from:n},i,r,a,o)
}function l(e,t,n,i,r,o){var l=s(e,t,n,i,r,o);a("Stopping, unable to continue.",l.line,l.character)}function c(e,t,n,i,r,a,s){return l(e,{line:t,from:n},i,r,a,s)}function u(e,t){"hasOwnProperty"===e&&s("'hasOwnProperty' is a really bad name."),n(Q,e)&&!Q["(global)"]&&(Q[e]===!0?dt.latedef&&s("'{a}' was used before it was defined.",ut,e):dt.shadow||s("'{a}' is already defined.",ut,e)),Q[e]=t,Q["(global)"]?(tt[e]=Q,n(nt,e)&&(dt.latedef&&s("'{a}' was used before it was defined.",ut,e),delete nt[e])):gt[e]=Q}function h(){var e,t,n,i,a,s=ut.value;switch(s){case"*/":l("Unbegun comment.");break;case"/*members":case"/*member":s="/*members",ct||(ct={}),t=ct;break;case"/*jshint":case"/*jslint":t=dt,n=Mt;break;case"/*global":t=pt;break;default:l("What?")}i=Gt.token();e:for(;;){for(;;){if("special"===i.type&&"*/"===i.value)break e;if("(endline)"!==i.id&&","!==i.id)break;i=Gt.token()}"(string)"!==i.type&&"(identifier)"!==i.type&&"/*members"!==s&&l("Bad option.",i),a=Gt.token(),":"===a.id?(a=Gt.token(),t===ct&&l("Expected '{a}' and instead saw '{b}'.",i,"*/",":"),"indent"!==i.value||"/*jshint"!==s&&"/*jslint"!==s?"maxerr"!==i.value||"/*jshint"!==s&&"/*jslint"!==s?"maxlen"!==i.value||"/*jshint"!==s&&"/*jslint"!==s?"true"===a.value?t[i.value]=!0:"false"===a.value?t[i.value]=!1:l("Bad option value.",a):(e=+a.value,("number"!=typeof e||!isFinite(e)||0>=e||Math.floor(e)!==e)&&l("Expected a small integer and instead saw '{a}'.",a,a.value),t.maxlen=e):(e=+a.value,("number"!=typeof e||!isFinite(e)||0>=e||Math.floor(e)!==e)&&l("Expected a small integer and instead saw '{a}'.",a,a.value),t.maxerr=e):(e=+a.value,("number"!=typeof e||!isFinite(e)||0>=e||Math.floor(e)!==e)&&l("Expected a small integer and instead saw '{a}'.",a,a.value),t.white=!0,t.indent=e),i=Gt.token()):(("/*jshint"===s||"/*jslint"===s)&&l("Missing option value.",i),t[i.value]=!1,i=a)}n&&r()}function d(e){for(var t,n=e||0,i=0;n>=i;)t=ot[i],t||(t=ot[i]=Gt.token()),i+=1;return t}function p(e,t){switch(wt.id){case"(number)":"."===ut.id&&s("A dot following a number can be confused with a decimal point.",wt);break;case"-":("-"===ut.id||"--"===ut.id)&&s("Confusing minusses.");break;case"+":("+"===ut.id||"++"===ut.id)&&s("Confusing plusses.")}for(("(string)"===wt.type||wt.identifier)&&($=wt.value),e&&ut.id!==e&&(t?"(end)"===ut.id?s("Unmatched '{a}'.",t,t.id):s("Expected '{a}' to match '{b}' from line {c} and instead saw '{d}'.",ut,e,t.id,t.line,ut.value):("(identifier)"!==ut.type||ut.value!==e)&&s("Expected '{a}' and instead saw '{b}'.",ut,e,ut.value)),mt=wt,wt=ut;;){if(ut=ot.shift()||Gt.token(),"(end)"===ut.id||"(error)"===ut.id)return;if("special"===ut.type)h();else if("(endline)"!==ut.id)break}}function f(e,t){var n,i=!1;if("(end)"===ut.id&&l("Unexpected early end of program.",wt),p(),t&&($="anonymous",Q["(verb)"]=wt.value),t===!0&&wt.fud)n=wt.fud();else{if(wt.nud)n=wt.nud();else{if("(number)"===ut.type&&"."===wt.id)return s("A leading decimal point can be confused with a dot: '.{a}'.",wt,ut.value),p(),wt;l("Expected an identifier and instead saw '{a}'.",wt,wt.id)}for(;ut.lbp>e;)i="Array"==wt.value,p(),i&&"("==wt.id&&")"==ut.id&&s("Use the array literal notation [].",wt),wt.led?n=wt.led(n):l("Expected an operator and instead saw '{a}'.",wt,wt.id)}return n}function m(e,t){e=e||wt,t=t||ut,dt.white&&e.character!==t.from&&e.line===t.line&&s("Unexpected space after '{a}'.",t,e.value)}function g(e,t){e=e||wt,t=t||ut,!dt.white||e.character===t.from&&e.line===t.line||s("Unexpected space before '{a}'.",t,t.value)}function v(e,t){e=e||wt,t=t||ut,dt.white&&!e.comment&&e.line===t.line&&m(e,t)}function _(e,t){dt.white&&(e=e||wt,t=t||ut,e.line===t.line&&e.character===t.from&&s("Missing space after '{a}'.",ut,e.value))}function b(e,t){e=e||wt,t=t||ut,dt.laxbreak||e.line===t.line?dt.white&&(e=e||wt,t=t||ut,e.character===t.from&&s("Missing space after '{a}'.",ut,e.value)):s("Bad line breaking before '{a}'.",t,t.id)}function y(e){var t;dt.white&&"(end)"!==ut.id&&(t=rt+(e||0),ut.from!==t&&s("Expected '{a}' to have an indentation at {b} instead at {c}.",ut,ut.value,t,ut.from))}function w(e){e=e||wt,e.line!==ut.line&&s("Line breaking error '{a}'.",e,e.value)}function C(){wt.line!==ut.line?dt.laxbreak||s("Bad line breaking before '{a}'.",wt,ut.id):wt.character!==ut.from&&dt.white&&s("Unexpected space after '{a}'.",ut,wt.value),p(","),_(wt,ut)}function L(e,t){var n=Rt[e];return n&&"object"==typeof n||(Rt[e]=n={id:e,lbp:t,value:e}),n}function x(e){return L(e,0)}function M(e,t){var n=x(e);return n.identifier=n.reserved=!0,n.fud=t,n}function E(e,t){var n=M(e,t);return n.block=!0,n}function S(e){var t=e.id.charAt(0);return(t>="a"&&"z">=t||t>="A"&&"Z">=t)&&(e.identifier=e.reserved=!0),e}function O(e,t){var n=L(e,150);return S(n),n.nud="function"==typeof t?t:function(){return this.right=f(150),this.arity="unary",("++"===this.id||"--"===this.id)&&(dt.plusplus?s("Unexpected use of '{a}'.",this,this.id):this.right.identifier&&!this.right.reserved||"."===this.right.id||"["===this.right.id||s("Bad operand.",this)),this},n}function T(e,t){var n=x(e);return n.type=e,n.nud=t,n}function z(e,t){var n=T(e,t);return n.identifier=n.reserved=!0,n}function P(e,t){return z(e,function(){return"function"==typeof t&&t(this),this})}function D(e,t,n,i){var r=L(e,n);return S(r),r.led=function(e){return i||(b(mt,wt),_(wt,ut)),"function"==typeof t?t(e,this):(this.left=e,this.right=f(n),this)},r}function k(e,t){var n=L(e,100);return n.led=function(e){b(mt,wt),_(wt,ut);var n=f(100);return e&&"NaN"===e.id||n&&"NaN"===n.id?s("Use the isNaN function to compare with NaN.",this):t&&t.apply(this,[e,n]),"!"===e.id&&s("Confusing use of '{a}'.",e,"!"),"!"===n.id&&s("Confusing use of '{a}'.",e,"!"),this.left=e,this.right=n,this},n}function A(e){return e&&("(number)"===e.type&&0===+e.value||"(string)"===e.type&&""===e.value||"null"===e.type&&!dt.eqnull||"true"===e.type||"false"===e.type||"undefined"===e.type)}function j(e){return L(e,20).exps=!0,D(e,function(e,t){if(t.left=e,pt[e.value]===!1&&gt[e.value]["(global)"]===!0?s("Read only.",e):e["function"]&&s("'{a}' is a function.",e,e.value),e){if("."===e.id||"["===e.id)return e.left&&"arguments"!==e.left.value||s("Bad assignment.",t),t.right=f(19),t;if(e.identifier&&!e.reserved)return"exception"===Q[e.value]&&s("Do not assign to the exception parameter.",e),t.right=f(19),t;e===Rt["function"]&&s("Expected an identifier in an assignment and instead saw a function invocation.",wt)}l("Bad assignment.",t)},20)}function B(e,t,n){var i=L(e,n);return S(i),i.led="function"==typeof t?t:function(e){return dt.bitwise&&s("Unexpected use of '{a}'.",this,this.id),this.left=e,this.right=f(n),this},i}function I(e){return L(e,20).exps=!0,D(e,function(e,t){return dt.bitwise&&s("Unexpected use of '{a}'.",t,t.id),_(mt,wt),_(wt,ut),e?"."===e.id||"["===e.id||e.identifier&&!e.reserved?(f(19),t):(e===Rt["function"]&&s("Expected an identifier in an assignment, and instead saw a function invocation.",wt),t):(l("Bad assignment.",t),void 0)},20)}function R(e){var t=L(e,150);return t.led=function(e){return dt.plusplus?s("Unexpected use of '{a}'.",this,this.id):e.identifier&&!e.reserved||"."===e.id||"["===e.id||s("Bad operand.",this),this.left=e,this},t}function N(e){return ut.identifier?(p(),wt.reserved&&!dt.es5&&(e&&"undefined"==wt.value||s("Expected an identifier and instead saw '{a}' (a reserved word).",wt,wt.id)),wt.value):void 0}function F(e){var t=N(e);return t?t:("function"===wt.id&&"("===ut.id?s("Missing name in function declaration."):l("Expected an identifier and instead saw '{a}'.",ut,ut.value),void 0)}function q(e){var t,n=0;if(";"===ut.id&&!ht)for(;;){if(t=d(n),t.reach)return;if("(endline)"!==t.id){if("function"===t.id){s("Inner functions should be listed at the top of the outer function.",t);break}s("Unreachable '{a}' after '{b}'.",t,t.value,e);break}n+=1}}function V(e){var t,n=rt,i=gt,r=ut;return";"===r.id?(s("Unnecessary semicolon.",r),p(";"),void 0):(r.identifier&&!r.reserved&&":"===d().id&&(p(),p(":"),gt=Object.create(i),u(r.value,"label"),ut.labelled||s("Label '{a}' on {b} statement.",ut,r.value,ut.value),Yt.test(r.value+":")&&s("Label '{a}' looks like a javascript url.",r,r.value),ut.label=r.value,r=ut),e||y(),t=f(0,!0),r.block||(dt.expr||t&&t.exps?dt.nonew&&"("===t.id&&"new"===t.left.id&&s("Do not use 'new' for side effects."):s("Expected an assignment or function call and instead saw an expression.",wt),";"!==ut.id?dt.asi||dt.lastsemic&&"}"==ut.id&&ut.line==wt.line||o("Missing semicolon.",wt.line,wt.from+wt.value.length):(m(wt,ut),p(";"),_(wt,ut))),rt=n,gt=i,t)}function W(){return"use strict"===ut.value?(bt&&s('Unnecessary "use strict".'),p(),p(";"),bt=!0,dt.newcap=!0,dt.undef=!0,!0):!1}function H(){for(var e=[];!ut.reach&&"(end)"!==ut.id;)";"===ut.id?(s("Unnecessary semicolon."),p(";")):e.push(V());return e}function U(e,t){var n,i,r=it,a=rt,o=bt,c=gt;if(it=e,gt=Object.create(gt),_(wt,ut),i=ut,"{"===ut.id){if(p("{"),"}"!==ut.id||wt.line!==ut.line){for(rt+=dt.indent;!e&&ut.from>rt;)rt+=dt.indent;e||W()||o||!dt.strict||!Q["(context)"]["(global)"]||s('Missing "use strict" statement.'),n=H(),bt=o,rt-=dt.indent,y()}p("}",i),rt=a}else e?((!t||dt.curly)&&s("Expected '{a}' and instead saw '{b}'.",ut,"{",ut.value),ht=!0,n=[V()],ht=!1):l("Expected '{a}' and instead saw '{b}'.",ut,"{",ut.value);return Q["(verb)"]=null,gt=c,it=r,!e||!dt.noempty||n&&0!==n.length||s("Empty block."),n}function Y(e){ct&&"boolean"!=typeof ct[e]&&s("Unexpected /*member '{a}'.",wt,e),"number"==typeof lt[e]?lt[e]+=1:lt[e]=1}function X(e){var t=e.value,n=e.line,i=nt[t];"function"==typeof i&&(i=!1),i?i[i.length-1]!==n&&i.push(n):(i=[n],nt[t]=i)}function G(){var e=N(!0);return e||("(string)"===ut.id?(e=ut.value,p()):"(number)"===ut.id&&(e=""+ut.value,p())),e}function K(){var e,t=ut,n=[];if(p("("),v(),")"===ut.id)return p(")"),v(mt,wt),void 0;for(;;){if(e=F(!0),n.push(e),u(e,"parameter"),","!==ut.id)return p(")",t),v(mt,wt),n;C()}}function Z(e,t){var n,i=dt,r=gt;return dt=Object.create(dt),gt=Object.create(gt),Q={"(name)":e||'"'+$+'"',"(line)":ut.line,"(context)":Q,"(breakage)":0,"(loopage)":0,"(scope)":gt,"(statement)":t},n=Q,wt.funct=Q,et.push(Q),e&&u(e,"function"),Q["(params)"]=K(),U(!1),gt=r,dt=i,Q["(last)"]=wt.line,Q=Q["(context)"],n}function J(){function e(){var e={},t=ut;if(p("{"),"}"!==ut.id)for(;;){if("(end)"===ut.id)l("Missing '}' to match '{' from line {a}.",ut,t.line);else{if("}"===ut.id){s("Unexpected comma.",wt);break}","===ut.id?l("Unexpected comma.",ut):"(string)"!==ut.id&&s("Expected a string and instead saw {a}.",ut,ut.value)}if(e[ut.value]===!0?s("Duplicate key '{a}'.",ut,ut.value):"__proto__"===ut.value?s("Stupid key '{a}'.",ut,ut.value):e[ut.value]=!0,p(),p(":"),J(),","!==ut.id)break;p(",")}p("}")}function t(){var e=ut;if(p("["),"]"!==ut.id)for(;;){if("(end)"===ut.id)l("Missing ']' to match '[' from line {a}.",ut,e.line);else{if("]"===ut.id){s("Unexpected comma.",wt);break}","===ut.id&&l("Unexpected comma.",ut)}if(J(),","!==ut.id)break;p(",")}p("]")}switch(ut.id){case"{":e();break;case"[":t();break;case"true":case"false":case"null":case"(number)":case"(string)":p();break;case"-":p("-"),wt.character!==ut.from&&s("Unexpected space after '-'.",wt),m(wt,ut),p("(number)");break;default:l("Expected a JSON value.",ut)}}var $,Q,et,tt,nt,it,rt,at,st,ot,lt,ct,ut,ht,dt,pt,ft,mt,gt,vt,_t,bt,yt,wt,Ct,Lt,xt={"<":!0,"<=":!0,"==":!0,"===":!0,"!==":!0,"!=":!0,">":!0,">=":!0,"+":!0,"-":!0,"*":!0,"/":!0,"%":!0},Mt={asi:!0,bitwise:!0,boss:!0,browser:!0,couch:!0,curly:!0,debug:!0,devel:!0,dojo:!0,eqeqeq:!0,eqnull:!0,es5:!0,evil:!0,expr:!0,forin:!0,globalstrict:!0,immed:!0,jquery:!0,latedef:!0,laxbreak:!0,loopfunc:!0,mootools:!0,newcap:!0,noarg:!0,node:!0,noempty:!0,nonew:!0,nomen:!0,onevar:!0,passfail:!0,plusplus:!0,prototypejs:!0,regexdash:!0,regexp:!0,rhino:!0,undef:!0,scripturl:!0,shadow:!0,strict:!0,sub:!0,supernew:!0,trailing:!0,white:!0,wsh:!0},Et={ArrayBuffer:!1,ArrayBufferView:!1,addEventListener:!1,applicationCache:!1,blur:!1,clearInterval:!1,clearTimeout:!1,close:!1,closed:!1,DataView:!1,defaultStatus:!1,document:!1,event:!1,FileReader:!1,Float32Array:!1,Float64Array:!1,focus:!1,frames:!1,getComputedStyle:!1,HTMLElement:!1,history:!1,Int16Array:!1,Int32Array:!1,Int8Array:!1,Image:!1,length:!1,localStorage:!1,location:!1,moveBy:!1,moveTo:!1,name:!1,navigator:!1,onbeforeunload:!0,onblur:!0,onerror:!0,onfocus:!0,onload:!0,onresize:!0,onunload:!0,open:!1,openDatabase:!1,opener:!1,Option:!1,parent:!1,print:!1,removeEventListener:!1,resizeBy:!1,resizeTo:!1,screen:!1,scroll:!1,scrollBy:!1,scrollTo:!1,setInterval:!1,setTimeout:!1,status:!1,top:!1,Uint16Array:!1,Uint32Array:!1,Uint8Array:!1,WebSocket:!1,window:!1,Worker:!1,XMLHttpRequest:!1,XPathEvaluator:!1,XPathException:!1,XPathExpression:!1,XPathNamespace:!1,XPathNSResolver:!1,XPathResult:!1},St={require:!1,respond:!1,getRow:!1,emit:!1,send:!1,start:!1,sum:!1,log:!1,exports:!1,module:!1},Ot={alert:!1,confirm:!1,console:!1,Debug:!1,opera:!1,prompt:!1},Tt={dojo:!1,dijit:!1,dojox:!1,define:!1,require:!1},zt={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"/":"\\/","\\":"\\\\"},Pt=["closure","exception","global","label","outer","unused","var"],Dt={$:!1,jQuery:!1},kt={$:!1,$$:!1,Assets:!1,Browser:!1,Chain:!1,Class:!1,Color:!1,Cookie:!1,Core:!1,Document:!1,DomReady:!1,DOMReady:!1,Drag:!1,Element:!1,Elements:!1,Event:!1,Events:!1,Fx:!1,Group:!1,Hash:!1,HtmlTable:!1,Iframe:!1,IframeShim:!1,InputValidator:!1,instanceOf:!1,Keyboard:!1,Locale:!1,Mask:!1,MooTools:!1,Native:!1,Options:!1,OverText:!1,Request:!1,Scroller:!1,Slick:!1,Slider:!1,Sortables:!1,Spinner:!1,Swiff:!1,Tips:!1,Type:!1,typeOf:!1,URI:!1,Window:!1},At={__filename:!1,__dirname:!1,exports:!1,Buffer:!1,GLOBAL:!1,global:!1,module:!1,process:!1,require:!1},jt={$:!1,$$:!1,$A:!1,$F:!1,$H:!1,$R:!1,$break:!1,$continue:!1,$w:!1,Abstract:!1,Ajax:!1,Class:!1,Enumerable:!1,Element:!1,Event:!1,Field:!1,Form:!1,Hash:!1,Insertion:!1,ObjectRange:!1,PeriodicalExecuter:!1,Position:!1,Prototype:!1,Selector:!1,Template:!1,Toggle:!1,Try:!1,Autocompleter:!1,Builder:!1,Control:!1,Draggable:!1,Draggables:!1,Droppables:!1,Effect:!1,Sortable:!1,SortableObserver:!1,Sound:!1,Scriptaculous:!1},Bt={defineClass:!1,deserialize:!1,gc:!1,help:!1,load:!1,loadClass:!1,print:!1,quit:!1,readFile:!1,readUrl:!1,runCommand:!1,seal:!1,serialize:!1,spawn:!1,sync:!1,toint32:!1,version:!1},It={Array:!1,Boolean:!1,Date:!1,decodeURI:!1,decodeURIComponent:!1,encodeURI:!1,encodeURIComponent:!1,Error:!1,eval:!1,EvalError:!1,Function:!1,hasOwnProperty:!1,isFinite:!1,isNaN:!1,JSON:!1,Math:!1,Number:!1,Object:!1,parseInt:!1,parseFloat:!1,RangeError:!1,ReferenceError:!1,RegExp:!1,String:!1,SyntaxError:!1,TypeError:!1,URIError:!1},Rt={},Nt={ActiveXObject:!0,Enumerator:!0,GetObject:!0,ScriptEngine:!0,ScriptEngineBuildVersion:!0,ScriptEngineMajorVersion:!0,ScriptEngineMinorVersion:!0,VBArray:!0,WSH:!0,WScript:!0},Ft=/[\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/,qt=/^\s*([(){}\[.,:;'"~\?\]#@]|==?=?|\/(\*(jshint|jslint|members?|global)?|=|\/)?|\*[\/=]?|\+(?:=|\++)?|-(?:=|-+)?|%=?|&[&=]?|\|[|=]?|>>?>?=?|<([\/=!]|\!(\[|--)?|<=?)?|\^=?|\!=?=?|[a-zA-Z_$][a-zA-Z0-9_$]*|[0-9]+([xX][0-9a-fA-F]+|\.[0-9]*)?([eE][+\-]?[0-9]+)?)/,Vt=/[\u0000-\u001f&<"\/\\\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/,Wt=/[\u0000-\u001f&<"\/\\\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,Ht=/\*\/|\/\*/,Ut=/^([a-zA-Z_$][a-zA-Z0-9_$]*)$/,Yt=/^(?:javascript|jscript|ecmascript|vbscript|mocha|livescript)\s*:/i,Xt=/^\s*\/\*\s*falls\sthrough\s*\*\/\s*$/;"function"!=typeof Array.isArray&&(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.apply(e)}),"function"!=typeof Object.create&&(Object.create=function(e){return t.prototype=e,new t}),"function"!=typeof Object.keys&&(Object.keys=function(e){var t,i=[];for(t in e)n(e,t)&&i.push(t);return i}),"function"!=typeof String.prototype.entityify&&(String.prototype.entityify=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}),"function"!=typeof String.prototype.isAlpha&&(String.prototype.isAlpha=function(){return this>="a"&&"z￿">=this||this>="A"&&"Z￿">=this}),"function"!=typeof String.prototype.isDigit&&(String.prototype.isDigit=function(){return this>="0"&&"9">=this}),"function"!=typeof String.prototype.supplant&&(String.prototype.supplant=function(e){return this.replace(/\{([^{}]*)\}/g,function(t,n){var i=e[n];return"string"==typeof i||"number"==typeof i?i:t})}),"function"!=typeof String.prototype.name&&(String.prototype.name=function(){return Ut.test(this)?this:Vt.test(this)?'"'+this.replace(Wt,function(e){var t=zt[e];return t?t:"\\u"+("0000"+e.charCodeAt().toString(16)).slice(-4)})+'"':'"'+this+'"'});var Gt=function Gt(){function e(){var e,t;return a>=st.length?!1:(i=1,s=st[a],a+=1,e=s.search(/ \t/),e>=0&&o("Mixed spaces and tabs.",a,e+1),s=s.replace(/\t/g,yt),e=s.search(Ft),e>=0&&o("Unsafe character.",a,e),dt.maxlen&&dt.maxlen<s.length&&o("Line too long.",a,s.length),t=s.search(/\s+$/),dt.trailing&&~t&&!~s.search(/^\s+$/)&&o("Trailing whitespace.",a,t),!0)}function t(e,t){var s,l;return l="(color)"===e||"(range)"===e?{type:e}:"(punctuator)"===e||"(identifier)"===e&&n(Rt,t)?Rt[t]||Rt["(error)"]:Rt[e],l=Object.create(l),("(string)"===e||"(range)"===e)&&!dt.scripturl&&Yt.test(t)&&o("Script URL.",a,r),"(identifier)"===e&&(l.identifier=!0,"__iterator__"===t||"__proto__"===t?c("Reserved name '{a}'.",a,r,t):!dt.nomen||"_"!==t.charAt(0)&&"_"!==t.charAt(t.length-1)||o("Unexpected {a} in '{b}'.",a,r,"dangling '_'",t)),l.value=t,l.line=a,l.character=i,l.from=r,s=l.id,"(endline)"!==s&&(ft=s&&("(,=:[!&|?{};".indexOf(s.charAt(s.length-1))>=0||"return"===s)),l}var i,r,a,s;return{init:function(t){st="string"==typeof t?t.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n"):t,st[0]&&"#!"==st[0].substr(0,2)&&(st[0]=""),a=0,e(),r=1},range:function(e,n){var l,u="";for(r=i,s.charAt(0)!==e&&c("Expected '{a}' and instead saw '{b}'.",a,i,e,s.charAt(0));;){switch(s=s.slice(1),i+=1,l=s.charAt(0)){case"":c("Missing '{a}'.",a,i,l);break;case n:return s=s.slice(1),i+=1,t("(range)",u);case"\\":o("Unexpected '{a}'.",a,i,l)}u+=l}},token:function(){function n(e){var t,n=e.exec(s);return n?(v=n[0].length,t=n[1],h=t.charAt(0),s=s.substr(v),r=i+v-t.length,i+=v,t):void 0}function l(n){function l(e){var t=parseInt(s.substr(h+1,e),16);h+=e,t>=32&&126>=t&&34!==t&&92!==t&&39!==t&&o("Unnecessary escapement.",a,i),i+=e,u=String.fromCharCode(t)}var u,h,d="";for(at&&'"'!==n&&o("Strings must use doublequote.",a,i),h=0;;){for(;h>=s.length;)h=0,e()||c("Unclosed string.",a,r);if(u=s.charAt(h),u===n)return i+=1,s=s.substr(h+1),t("(string)",d,n);if(" ">u){if("\n"===u||"\r"===u)break;o("Control character in string: {a}.",a,i+h,s.slice(0,h))}else if("\\"===u)switch(h+=1,i+=1,u=s.charAt(h)){case"\\":case'"':case"/":break;case"'":at&&o("Avoid \\'.",a,i);break;case"b":u="\b";break;case"f":u="\f";break;case"n":u="\n";break;case"r":u="\r";break;case"t":u="	";break;case"u":l(4);break;case"v":at&&o("Avoid \\v.",a,i),u="";break;case"x":at&&o("Avoid \\x-.",a,i),l(2);break;default:o("Bad escapement.",a,i)}d+=u,i+=1,h+=1}}for(var u,h,d,p,f,m,g,v,_,b,y;;){if(!s)return t(e()?"(endline)":"(end)","");if(y=n(qt)){if(h.isAlpha()||"_"===h||"$"===h)return t("(identifier)",y);if(h.isDigit())return isFinite(Number(y))||o("Bad number '{a}'.",a,i,y),s.substr(0,1).isAlpha()&&o("Missing space after '{a}'.",a,i,y),"0"===h&&(p=y.substr(1,1),p.isDigit()?"."!==wt.id&&o("Don't use extra leading zeros '{a}'.",a,i,y):!at||"x"!==p&&"X"!==p||o("Avoid 0x-. '{a}'.",a,i,y)),"."===y.substr(y.length-1)&&o("A trailing decimal point can be confused with a dot '{a}'.",a,i,y),t("(number)",y);switch(y){case'"':case"'":return l(y);case"//":vt&&o("Unexpected comment.",a,i),s="",wt.comment=!0;break;case"/*":for(vt&&o("Unexpected comment.",a,i);g=s.search(Ht),!(g>=0);)e()||c("Unclosed comment.",a,i);i+=g+2,"/"===s.substr(g,1)&&c("Nested comment.",a,i),s=s.substr(g+2),wt.comment=!0;break;case"/*members":case"/*member":case"/*jshint":case"/*jslint":case"/*global":case"*/":return{value:y,type:"special",line:a,character:i,from:r};case"":break;case"/":if("/="===wt.id&&c("A regular expression literal can be confused with '/='.",a,r),ft){for(f=0,d=0,v=0;;){switch(u=!0,h=s.charAt(v),v+=1,h){case"":return c("Unclosed regular expression.",a,r),void 0;case"/":for(f>0&&o("Unescaped '{a}'.",a,r+v,"/"),h=s.substr(0,v-1),b={g:!0,i:!0,m:!0};b[s.charAt(v)]===!0;)b[s.charAt(v)]=!1,v+=1;return i+=v,s=s.substr(v),b=s.charAt(0),("/"===b||"*"===b)&&c("Confusing regular expression.",a,r),t("(regexp)",h);case"\\":h=s.charAt(v)," ">h?o("Unexpected control character in regular expression.",a,r+v):"<"===h&&o("Unexpected escaped character '{a}' in regular expression.",a,r+v,h),v+=1;break;case"(":if(f+=1,u=!1,"?"===s.charAt(v))switch(v+=1,s.charAt(v)){case":":case"=":case"!":v+=1;break;default:o("Expected '{a}' and instead saw '{b}'.",a,r+v,":",s.charAt(v))}else d+=1;break;case"|":u=!1;break;case")":0===f?o("Unescaped '{a}'.",a,r+v,")"):f-=1;break;case" ":for(b=1;" "===s.charAt(v);)v+=1,b+=1;b>1&&o("Spaces are hard to count. Use {{a}}.",a,r+v,b);break;case"[":h=s.charAt(v),"^"===h&&(v+=1,dt.regexp?o("Insecure '{a}'.",a,r+v,h):"]"===s.charAt(v)&&c("Unescaped '{a}'.",a,r+v,"^")),b=!1,"]"===h&&(o("Empty class.",a,r+v-1),b=!0);e:do switch(h=s.charAt(v),v+=1,h){case"[":case"^":o("Unescaped '{a}'.",a,r+v,h),b=!0;break;case"-":b?b=!1:(o("Unescaped '{a}'.",a,r+v,"-"),b=!0);break;case"]":b||dt.regexdash||o("Unescaped '{a}'.",a,r+v-1,"-");break e;case"\\":h=s.charAt(v)," ">h?o("Unexpected control character in regular expression.",a,r+v):"<"===h&&o("Unexpected escaped character '{a}' in regular expression.",a,r+v,h),v+=1,b=!0;break;case"/":o("Unescaped '{a}'.",a,r+v-1,"/"),b=!0;break;case"<":b=!0;break;default:b=!0}while(h);break;case".":dt.regexp&&o("Insecure '{a}'.",a,r+v,h);break;case"]":case"?":case"{":case"}":case"+":case"*":o("Unescaped '{a}'.",a,r+v,h)}if(u)switch(s.charAt(v)){case"?":case"+":case"*":v+=1,"?"===s.charAt(v)&&(v+=1);break;case"{":for(v+=1,h=s.charAt(v),("0">h||h>"9")&&o("Expected a number and instead saw '{a}'.",a,r+v,h),v+=1,_=+h;h=s.charAt(v),!("0">h||h>"9");)v+=1,_=+h+10*_;if(m=_,","===h&&(v+=1,m=1/0,h=s.charAt(v),h>="0"&&"9">=h))for(v+=1,m=+h;h=s.charAt(v),!("0">h||h>"9");)v+=1,m=+h+10*m;"}"!==s.charAt(v)?o("Expected '{a}' and instead saw '{b}'.",a,r+v,"}",h):v+=1,"?"===s.charAt(v)&&(v+=1),_>m&&o("'{a}' should not be greater than '{b}'.",a,r+v,_,m)}}return h=s.substr(0,v-1),i+=v,s=s.substr(v),t("(regexp)",h)}return t("(punctuator)",y);case"#":return t("(punctuator)",y);default:return t("(punctuator)",y)}}else{for(y="",h="";s&&"!">s;)s=s.substr(1);s&&c("Unexpected '{a}'.",a,i,s.substr(0,1))}}}}}();T("(number)",function(){return this}),T("(string)",function(){return this}),Rt["(identifier)"]={type:"(identifier)",lbp:0,identifier:!0,nud:function(){var e,t=this.value,n=gt[t];if("function"==typeof n?n=void 0:"boolean"==typeof n&&(e=Q,Q=et[0],u(t,"var"),n=Q,Q=e),Q===n)switch(Q[t]){case"unused":Q[t]="var";break;case"unction":Q[t]="function",this["function"]=!0;break;case"function":this["function"]=!0;break;case"label":s("'{a}' is a statement label.",wt,t)}else if(Q["(global)"])"typeof"!=$&&"delete"!=$&&dt.undef&&"boolean"!=typeof pt[t]&&s("'{a}' is not defined.",wt,t),X(wt);else switch(Q[t]){case"closure":case"function":case"var":case"unused":s("'{a}' used out of scope.",wt,t);break;case"label":s("'{a}' is a statement label.",wt,t);break;case"outer":case"global":break;default:if(n===!0)Q[t]=!0;else if(null===n)s("'{a}' is not allowed.",wt,t),X(wt);else if("object"!=typeof n)"typeof"!=$&&"delete"!=$&&dt.undef?s("'{a}' is not defined.",wt,t):Q[t]=!0,X(wt);else switch(n[t]){case"function":case"unction":this["function"]=!0,n[t]="closure",Q[t]=n["(global)"]?"global":"outer";break;case"var":case"unused":n[t]="closure",Q[t]=n["(global)"]?"global":"outer";break;case"closure":case"parameter":Q[t]=n["(global)"]?"global":"outer";break;case"label":s("'{a}' is a statement label.",wt,t)}}return this},led:function(){l("Expected an operator and instead saw '{a}'.",ut,ut.value)}},T("(regexp)",function(){return this}),x("(endline)"),x("(begin)"),x("(end)").reach=!0,x("</").reach=!0,x("<!"),x("<!--"),x("-->"),x("(error)").reach=!0,x("}").reach=!0,x(")"),x("]"),x('"').reach=!0,x("'").reach=!0,x(";"),x(":").reach=!0,x(","),x("#"),x("@"),z("else"),z("case").reach=!0,z("catch"),z("default").reach=!0,z("finally"),P("arguments",function(e){bt&&Q["(global)"]&&s("Strict violation.",e)}),P("eval"),P("false"),P("Infinity"),P("NaN"),P("null"),P("this",function(e){bt&&(Q["(statement)"]&&Q["(name)"].charAt(0)>"Z"||Q["(global)"])&&s("Strict violation.",e)}),P("true"),P("undefined"),j("=","assign",20),j("+=","assignadd",20),j("-=","assignsub",20),j("*=","assignmult",20),j("/=","assigndiv",20).nud=function(){l("A regular expression literal can be confused with '/='.")},j("%=","assignmod",20),I("&=","assignbitand",20),I("|=","assignbitor",20),I("^=","assignbitxor",20),I("<<=","assignshiftleft",20),I(">>=","assignshiftright",20),I(">>>=","assignshiftrightunsigned",20),D("?",function(e,t){return t.left=e,t.right=f(10),p(":"),t["else"]=f(10),t},30),D("||","or",40),D("&&","and",50),B("|","bitor",70),B("^","bitxor",80),B("&","bitand",90),k("==",function(e,t){var n=dt.eqnull&&("null"==e.value||"null"==t.value);return!n&&dt.eqeqeq?s("Expected '{a}' and instead saw '{b}'.",this,"===","=="):A(e)?s("Use '{a}' to compare with '{b}'.",this,"===",e.value):A(t)&&s("Use '{a}' to compare with '{b}'.",this,"===",t.value),this}),k("==="),k("!=",function(e,t){return dt.eqeqeq?s("Expected '{a}' and instead saw '{b}'.",this,"!==","!="):A(e)?s("Use '{a}' to compare with '{b}'.",this,"!==",e.value):A(t)&&s("Use '{a}' to compare with '{b}'.",this,"!==",t.value),this}),k("!=="),k("<"),k(">"),k("<="),k(">="),B("<<","shiftleft",120),B(">>","shiftright",120),B(">>>","shiftrightunsigned",120),D("in","in",120),D("instanceof","instanceof",120),D("+",function(e,t){var n=f(130);return e&&n&&"(string)"===e.id&&"(string)"===n.id?(e.value+=n.value,e.character=n.character,!dt.scripturl&&Yt.test(e.value)&&s("JavaScript URL.",e),e):(t.left=e,t.right=n,t)},130),O("+","num"),O("+++",function(){return s("Confusing pluses."),this.right=f(150),this.arity="unary",this}),D("+++",function(e){return s("Confusing pluses."),this.left=e,this.right=f(130),this},130),D("-","sub",130),O("-","neg"),O("---",function(){return s("Confusing minuses."),this.right=f(150),this.arity="unary",this}),D("---",function(e){return s("Confusing minuses."),this.left=e,this.right=f(130),this},130),D("*","mult",140),D("/","div",140),D("%","mod",140),R("++","postinc"),O("++","preinc"),Rt["++"].exps=!0,R("--","postdec"),O("--","predec"),Rt["--"].exps=!0,O("delete",function(){var e=f(0);return(!e||"."!==e.id&&"["!==e.id)&&s("Variables should not be deleted."),this.first=e,this}).exps=!0,O("~",function(){return dt.bitwise&&s("Unexpected '{a}'.",this,"~"),f(150),this}),O("!",function(){return this.right=f(150),this.arity="unary",xt[this.right.id]===!0&&s("Confusing use of '{a}'.",this,"!"),this}),O("typeof","typeof"),O("new",function(){var e,t=f(155);if(t&&"function"!==t.id)if(t.identifier)switch(t["new"]=!0,t.value){case"Object":s("Use the object literal notation {}.",wt);break;case"Number":case"String":case"Boolean":case"Math":case"JSON":s("Do not use {a} as a constructor.",wt,t.value);break;case"Function":dt.evil||s("The Function constructor is eval.");break;case"Date":case"RegExp":break;default:"function"!==t.id&&(e=t.value.substr(0,1),dt.newcap&&("A">e||e>"Z")&&s("A constructor name should start with an uppercase letter.",wt))}else"."!==t.id&&"["!==t.id&&"("!==t.id&&s("Bad constructor.",wt);else dt.supernew||s("Weird construction. Delete 'new'.",this);return m(wt,ut),"("===ut.id||dt.supernew||s("Missing '()' invoking a constructor."),this.first=t,this}),Rt["new"].exps=!0,O("void").exps=!0,D(".",function(e,t){m(mt,wt),g();var n=F();return"string"==typeof n&&Y(n),t.left=e,t.right=n,dt.noarg&&e&&"arguments"===e.value&&("callee"===n||"caller"===n)?s("Avoid arguments.{a}.",e,n):dt.evil||!e||"document"!==e.value||"write"!==n&&"writeln"!==n||s("document.write can be a form of eval.",e),dt.evil||"eval"!==n&&"execScript"!==n||s("eval is evil."),t},160,!0),D("(",function(e,t){"}"!==mt.id&&")"!==mt.id&&g(mt,wt),v(),dt.immed&&!e.immed&&"function"===e.id&&s("Wrap an immediate function invocation in parentheses to assist the reader in understanding that the expression is the result of a function, and not the function itself.");var n=0,i=[];if(e&&"(identifier)"===e.type&&e.value.match(/^[A-Z]([A-Z0-9_$]*[a-z][A-Za-z0-9_$]*)?$/)&&"Number"!==e.value&&"String"!==e.value&&"Boolean"!==e.value&&"Date"!==e.value&&("Math"===e.value?s("Math is not a function.",e):dt.newcap&&s("Missing 'new' prefix when invoking a constructor.",e)),")"!==ut.id)for(;i[i.length]=f(10),n+=1,","===ut.id;)C();return p(")"),v(mt,wt),"object"==typeof e&&("parseInt"===e.value&&1===n&&s("Missing radix parameter.",e),dt.evil||("eval"===e.value||"Function"===e.value||"execScript"===e.value?s("eval is evil.",e):!i[0]||"(string)"!==i[0].id||"setTimeout"!==e.value&&"setInterval"!==e.value||s("Implied eval is evil. Pass a function instead of a string.",e)),e.identifier||"."===e.id||"["===e.id||"("===e.id||"&&"===e.id||"||"===e.id||"?"===e.id||s("Bad invocation.",e)),t.left=e,t},155,!0).exps=!0,O("(",function(){v(),"function"===ut.id&&(ut.immed=!0);var e=f(0);return p(")",this),v(mt,wt),dt.immed&&"function"===e.id&&("("===ut.id?s("Move the invocation into the parens that contain the function.",ut):s("Do not wrap function literals in parens unless they are to be immediately invoked.",this)),e}),D("[",function(e,t){g(mt,wt),v();var n,i=f(0);return i&&"(string)"===i.type&&(dt.evil||"eval"!==i.value&&"execScript"!==i.value||s("eval is evil.",t),Y(i.value),!dt.sub&&Ut.test(i.value)&&(n=Rt[i.value],n&&n.reserved||s("['{a}'] is better written in dot notation.",i,i.value))),p("]",t),v(mt,wt),t.left=e,t.right=i,t},160,!0),O("[",function(){var e=wt.line!==ut.line;for(this.first=[],e&&(rt+=dt.indent,ut.from===rt+dt.indent&&(rt+=dt.indent));"(end)"!==ut.id;){for(;","===ut.id;)s("Extra comma."),p(",");if("]"===ut.id)break;if(e&&wt.line!==ut.line&&y(),this.first.push(f(10)),","!==ut.id)break;if(C(),"]"===ut.id&&!dt.es5){s("Extra comma.",wt);break}}return e&&(rt-=dt.indent,y()),p("]",this),this},160),function(e){e.nud=function(){var e,t,n,i,r,a,o={};for(e=wt.line!==ut.line,e&&(rt+=dt.indent,ut.from===rt+dt.indent&&(rt+=dt.indent));"}"!==ut.id;){if(e&&y(),"get"===ut.value&&":"!==d().id)p("get"),dt.es5||l("get/set are ES5 features."),n=G(),n||l("Missing property name."),a=ut,m(wt,ut),t=Z(),!dt.loopfunc&&Q["(loopage)"]&&s("Don't make functions within a loop.",a),r=t["(params)"],r&&s("Unexpected parameter '{a}' in get {b} function.",a,r[0],n),m(wt,ut),p(","),y(),p("set"),i=G(),n!==i&&l("Expected {a} and instead saw {b}.",wt,n,i),a=ut,m(wt,ut),t=Z(),r=t["(params)"],r&&1===r.length&&"value"===r[0]||s("Expected (value) in set {a} function.",a,n);else{if(n=G(),"string"!=typeof n)break;p(":"),_(wt,ut),f(10)}if(o[n]===!0&&s("Duplicate member '{a}'.",ut,n),o[n]=!0,Y(n),","!==ut.id)break;C(),","===ut.id?s("Extra comma.",wt):"}"!==ut.id||dt.es5||s("Extra comma.",wt)}return e&&(rt-=dt.indent,y()),p("}",this),this},e.fud=function(){l("Expected to see a statement and instead saw a block.",wt)}}(x("{"));var Kt=M("var",function(e){var t,n,i;for(Q["(onevar)"]&&dt.onevar?s("Too many var statements."):Q["(global)"]||(Q["(onevar)"]=!0),this.first=[];_(wt,ut),t=F(),Q["(global)"]&&pt[t]===!1&&s("Redefinition of '{a}'.",wt,t),u(t,"unused"),!e&&(n=wt,this.first.push(wt),"="===ut.id&&(_(wt,ut),p("="),_(wt,ut),"undefined"===ut.id&&s("It is not necessary to initialize '{a}' to 'undefined'.",wt,t),"="===d(0).id&&ut.identifier&&l("Variable {a} was not declared correctly.",ut,ut.value),i=f(0),n.first=i),","===ut.id);)C();
return this});Kt.exps=!0,E("function",function(){it&&s("Function declarations should not be placed in blocks. Use a function expression or move the statement to the top of the outer function.",wt);var e=F();return m(wt,ut),u(e,"unction"),Z(e,!0),"("===ut.id&&ut.line===wt.line&&l("Function declarations are not invocable. Wrap the whole function invocation in parens."),this}),O("function",function(){var e=N();return e?m(wt,ut):_(wt,ut),Z(e),!dt.loopfunc&&Q["(loopage)"]&&s("Don't make functions within a loop."),this}),E("if",function(){var e=ut;return p("("),_(this,e),v(),f(20),"="===ut.id&&(dt.boss||s("Expected a conditional expression and instead saw an assignment."),p("="),f(20)),p(")",e),v(mt,wt),U(!0,!0),"else"===ut.id&&(_(wt,ut),p("else"),"if"===ut.id||"switch"===ut.id?V(!0):U(!0,!0)),this}),E("try",function(){var e,t,n;return U(!1),"catch"===ut.id&&(p("catch"),_(wt,ut),p("("),n=gt,gt=Object.create(n),t=ut.value,"(identifier)"!==ut.type?s("Expected an identifier and instead saw '{a}'.",ut,t):u(t,"exception"),p(),p(")"),U(!1),e=!0,gt=n),"finally"===ut.id?(p("finally"),U(!1),void 0):(e||l("Expected '{a}' and instead saw '{b}'.",ut,"catch",ut.value),this)}),E("while",function(){var e=ut;return Q["(breakage)"]+=1,Q["(loopage)"]+=1,p("("),_(this,e),v(),f(20),"="===ut.id&&(dt.boss||s("Expected a conditional expression and instead saw an assignment."),p("="),f(20)),p(")",e),v(mt,wt),U(!0,!0),Q["(breakage)"]-=1,Q["(loopage)"]-=1,this}).labelled=!0,z("with"),E("switch",function(){var e=ut,t=!1;for(Q["(breakage)"]+=1,p("("),_(this,e),v(),this.condition=f(20),p(")",e),v(mt,wt),_(wt,ut),e=ut,p("{"),_(wt,ut),rt+=dt.indent,this.cases=[];;)switch(ut.id){case"case":switch(Q["(verb)"]){case"break":case"case":case"continue":case"return":case"switch":case"throw":break;default:Xt.test(st[ut.line-2])||s("Expected a 'break' statement before 'case'.",wt)}y(-dt.indent),p("case"),this.cases.push(f(20)),t=!0,p(":"),Q["(verb)"]="case";break;case"default":switch(Q["(verb)"]){case"break":case"continue":case"return":case"throw":break;default:Xt.test(st[ut.line-2])||s("Expected a 'break' statement before 'default'.",wt)}y(-dt.indent),p("default"),t=!0,p(":");break;case"}":return rt-=dt.indent,y(),p("}",e),(1===this.cases.length||"true"===this.condition.id||"false"===this.condition.id)&&s("This 'switch' should be an 'if'.",this),Q["(breakage)"]-=1,Q["(verb)"]=void 0,void 0;case"(end)":return l("Missing '{a}'.",ut,"}"),void 0;default:if(t)switch(wt.id){case",":return l("Each value should have its own case label."),void 0;case":":H();break;default:l("Missing ':' on a case clause.",wt)}else l("Expected '{a}' and instead saw '{b}'.",ut,"case",ut.value)}}).labelled=!0,M("debugger",function(){return dt.debug||s("All 'debugger' statements should be removed."),this}).exps=!0,function(){var e=M("do",function(){Q["(breakage)"]+=1,Q["(loopage)"]+=1,this.first=U(!0),p("while");var e=ut;return _(wt,e),p("("),v(),f(20),"="===ut.id&&(dt.boss||s("Expected a conditional expression and instead saw an assignment."),p("="),f(20)),p(")",e),v(mt,wt),Q["(breakage)"]-=1,Q["(loopage)"]-=1,this});e.labelled=!0,e.exps=!0}(),E("for",function(){var e,t=ut;if(Q["(breakage)"]+=1,Q["(loopage)"]+=1,p("("),_(this,t),v(),"in"===d("var"===ut.id?1:0).id){if("var"===ut.id)p("var"),Kt.fud.call(Kt,!0);else{switch(Q[ut.value]){case"unused":Q[ut.value]="var";break;case"var":break;default:s("Bad for in variable '{a}'.",ut,ut.value)}p()}return p("in"),f(20),p(")",t),e=U(!0,!0),dt.forin&&(e.length>1||"object"!=typeof e[0]||"if"!==e[0].value)&&s("The body of a for in should be wrapped in an if statement to filter unwanted properties from the prototype.",this),Q["(breakage)"]-=1,Q["(loopage)"]-=1,this}if(";"!==ut.id)if("var"===ut.id)p("var"),Kt.fud.call(Kt);else for(;f(0,"for"),","===ut.id;)C();if(w(wt),p(";"),";"!==ut.id&&(f(20),"="===ut.id&&(dt.boss||s("Expected a conditional expression and instead saw an assignment."),p("="),f(20))),w(wt),p(";"),";"===ut.id&&l("Expected '{a}' and instead saw '{b}'.",ut,")",";"),")"!==ut.id)for(;f(0,"for"),","===ut.id;)C();return p(")",t),v(mt,wt),U(!0,!0),Q["(breakage)"]-=1,Q["(loopage)"]-=1,this}).labelled=!0,M("break",function(){var e=ut.value;return 0===Q["(breakage)"]&&s("Unexpected '{a}'.",ut,this.value),w(this),";"!==ut.id&&wt.line===ut.line&&("label"!==Q[e]?s("'{a}' is not a statement label.",ut,e):gt[e]!==Q&&s("'{a}' is out of scope.",ut,e),this.first=ut,p()),q("break"),this}).exps=!0,M("continue",function(){var e=ut.value;return 0===Q["(breakage)"]&&s("Unexpected '{a}'.",ut,this.value),w(this),";"!==ut.id?wt.line===ut.line&&("label"!==Q[e]?s("'{a}' is not a statement label.",ut,e):gt[e]!==Q&&s("'{a}' is out of scope.",ut,e),this.first=ut,p()):Q["(loopage)"]||s("Unexpected '{a}'.",ut,this.value),q("continue"),this}).exps=!0,M("return",function(){return w(this),"(regexp)"===ut.id&&s("Wrap the /regexp/ literal in parens to disambiguate the slash operator."),";"===ut.id||ut.reach||(_(wt,ut),this.first=f(20)),q("return"),this}).exps=!0,M("throw",function(){return w(this),_(wt,ut),this.first=f(20),q("throw"),this}).exps=!0,z("class"),z("const"),z("enum"),z("export"),z("extends"),z("import"),z("super"),z("let"),z("yield"),z("implements"),z("interface"),z("package"),z("private"),z("protected"),z("public"),z("static");var Zt=function(t,n,a){var o,l,c;if(e.errors=[],pt=Object.create(It),i(pt,a||{}),n){if(o=n.predef)if(Array.isArray(o))for(l=0;o.length>l;l+=1)pt[o[l]]=!0;else if("object"==typeof o)for(c=Object.keys(o),l=0;c.length>l;l+=1)pt[c[l]]=!!o[c];dt=n}else dt={};for(dt.indent=dt.indent||4,dt.maxerr=dt.maxerr||50,yt="",l=0;dt.indent>l;l+=1)yt+=" ";rt=1,tt=Object.create(pt),gt=tt,Q={"(global)":!0,"(name)":"(global)","(scope)":gt,"(breakage)":0,"(loopage)":0},et=[Q],Ct=[],vt=!1,_t=null,lt={},ct=null,nt={},it=!1,ot=[],at=!1,Lt=0,Gt.init(t),ft=!0,bt=!1,mt=wt=ut=Rt["(begin)"],r();try{switch(p(),ut.id){case"{":case"[":dt.laxbreak=!0,at=!0,J();break;default:"use strict"===ut.value&&(dt.globalstrict||s('Use the function form of "use strict".'),W()),H("lib")}p("(end)")}catch(u){u&&e.errors.push({reason:u.message,line:u.line||ut.line,character:u.character||ut.from},null)}return 0===e.errors.length};return e.data=function(){var t,i,r,a,s,o,l,c={functions:[]},u=[],h=[],d=[];e.errors.length&&(c.errors=e.errors),at&&(c.json=!0);for(o in nt)n(nt,o)&&u.push({name:o,line:nt[o]});for(u.length>0&&(c.implieds=u),Ct.length>0&&(c.urls=Ct),i=Object.keys(gt),i.length>0&&(c.globals=i),a=1;et.length>a;a+=1){for(r=et[a],t={},s=0;Pt.length>s;s+=1)t[Pt[s]]=[];for(o in r)n(r,o)&&"("!==o.charAt(0)&&(l=r[o],"unction"===l&&(l="unused"),Array.isArray(t[l])&&(t[l].push(o),"unused"===l&&d.push({name:o,line:r["(line)"],"function":r["(name)"]})));for(s=0;Pt.length>s;s+=1)0===t[Pt[s]].length&&delete t[Pt[s]];t.name=r["(name)"],t.param=r["(params)"],t.line=r["(line)"],t.last=r["(last)"],c.functions.push(t)}d.length>0&&(c.unused=d),h=[];for(o in lt)if("number"==typeof lt[o]){c.member=lt;break}return c},e.report=function(t){function n(e,t){var n,i,r;if(t){for(m.push("<div><i>"+e+"</i> "),t=t.sort(),i=0;t.length>i;i+=1)t[i]!==r&&(r=t[i],m.push((n?", ":"")+r),n=!0);m.push("</div>")}}var i,r,a,s,o,l,c,u,h,d=e.data(),p=[],f="",m=[];if(d.errors||d.implieds||d.unused){if(a=!0,m.push("<div id=errors><i>Error:</i>"),d.errors)for(o=0;d.errors.length>o;o+=1)i=d.errors[o],i&&(r=i.evidence||"",m.push("<p>Problem"+(isFinite(i.line)?" at line "+i.line+" character "+i.character:"")+": "+i.reason.entityify()+"</p><p class=evidence>"+(r&&(r.length>80?r.slice(0,77)+"...":r).entityify())+"</p>"));if(d.implieds){for(h=[],o=0;d.implieds.length>o;o+=1)h[o]="<code>"+d.implieds[o].name+"</code>&nbsp;<i>"+d.implieds[o].line+"</i>";m.push("<p><i>Implied global:</i> "+h.join(", ")+"</p>")}if(d.unused){for(h=[],o=0;d.unused.length>o;o+=1)h[o]="<code><u>"+d.unused[o].name+"</u></code>&nbsp;<i>"+d.unused[o].line+"</i> <code>"+d.unused[o]["function"]+"</code>";m.push("<p><i>Unused variable:</i> "+h.join(", ")+"</p>")}d.json&&m.push("<p>JSON: bad.</p>"),m.push("</div>")}if(!t){for(m.push("<br><div id=functions>"),d.urls&&n("URLs<br>",d.urls,"<br>"),d.json&&!a?m.push("<p>JSON: good.</p>"):d.globals?m.push("<div><i>Global</i> "+d.globals.sort().join(", ")+"</div>"):m.push("<div><i>No new global variables introduced.</i></div>"),o=0;d.functions.length>o;o+=1)s=d.functions[o],m.push("<br><div class=function><i>"+s.line+"-"+s.last+"</i> "+(s.name||"")+"("+(s.param?s.param.join(", "):"")+")</div>"),n("<big><b>Unused</b></big>",s.unused),n("Closure",s.closure),n("Variable",s["var"]),n("Exception",s.exception),n("Outer",s.outer),n("Global",s.global),n("Label",s.label);if(d.member){if(p=Object.keys(d.member),p.length){for(p=p.sort(),f="<br><pre id=members>/*members ",c=10,o=0;p.length>o;o+=1)l=p[o],u=l.name(),c+u.length>72&&(m.push(f+"<br>"),f="    ",c=1),c+=u.length+2,1===d.member[l]&&(u="<i>"+u+"</i>"),p.length-1>o&&(u+=", "),f+=u;m.push(f+"<br>*/</pre>")}m.push("</div>")}}return m.join("")},e.jshint=Zt,e.edition="2011-04-16",Zt});"object"==typeof t&&(t.JSHINT=n),"undefined"!=typeof bootstrap&&bootstrap("core/jshint",function(e,t){"use strict";t.JSHINT=n})}}),montageDefine("b15df60","core/serialization/serializer/montage-ast",{dependencies:["../../core","mousse/serialization/ast"],factory:function(e,t){var n=e("../../core").Montage,i=e("mousse/serialization/ast").Value,r=n.specialize.call(i,{constructor:{value:function r(){}},initWithRootAndId:{value:function(e,t){return i.call(this,e,t),this}},_getSerializationValue:{value:function(){return{"#":this.value}}}}),a=n.specialize.call(i,{constructor:{value:function a(){}},initWithRootAndModuleId:{value:function(e,t){return i.call(this,e,t),this}},_getSerializationValue:{value:function(){return{"%":this.value}}}});t.ElementReference=r,t.ModuleReference=a}}),montageDefine("b15df60","core/serialization/serializer/properties-serializer",{dependencies:["../../core"],factory:function(e,t){var n=e("../../core").Montage,i=n.specialize.call(Object,{_malker:{value:null},_visitor:{value:null},_object:{value:null},constructor:{value:function i(){}},initWithMalkerAndVisitorAndObject:{value:function(e,t,n){return this._malker=e,this._visitor=t,this._object=n,this}},addObject:{value:function(e){return"object"==typeof e?(this._malker.visit(e),e):void 0}},addObjectReference:{value:function(e){var t=this._visitor.builder,n=this._visitor.labeler,i=n.getObjectLabel(e),a=Object.create(r);return a.reference=t.createReference(i),a}},set:{value:function(e,t,n){this._visitor.setProperty(this._malker,e,t,n)}},setAll:{value:function(){this._visitor.setSerializableObjectProperties(this._malker,this._object)}}}),r={thisIsAReferenceCreatedByMontageSerializer:!0,reference:null};t.PropertiesSerializer=i}}),montageDefine("b15df60","core/serialization/serializer/self-serializer",{dependencies:["../../core"],factory:function(e,t){var n=e("../../core").Montage,i=n.specialize.call(Object,{_malker:{value:null},_visitor:{value:null},_object:{value:null},constructor:{value:function i(){}},initWithMalkerAndVisitorAndObject:{value:function(e,t,n){return this._malker=e,this._visitor=t,this._object=n,this}},getObjectLabel:{value:function(e){return this._visitor.labeler.getObjectLabel(e)}},addObject:{value:function(e){return"object"==typeof e?(this._malker.visit(e),e):void 0}},addObjectReference:{value:function(e){var t=this._visitor.builder,n=this._visitor.labeler,i=n.getObjectLabel(e);return{thisIsAReferenceCreatedByMontageSerializer:!0,reference:t.createObjectReference(i)}}},setProperty:{value:function(e,t,n){var i,r=this._visitor.builder;i=r.top.getProperty("properties"),r.push(i),this._visitor.setProperty(this._malker,e,t,n),r.pop()}},setAllProperties:{value:function(){var e,t=this._visitor.builder;e=t.top.getProperty("properties"),t.push(e),this._visitor.setSerializableObjectProperties(this._malker,this._object),t.pop()}},setUnit:{value:function(e){this._visitor.setObjectCustomUnit(this._malker,this._object,e)}},setAllUnits:{value:function(){this._visitor.setObjectCustomUnits(this._malker,this._object)}}});t.SelfSerializer=i}}),montageDefine("b15df60","core/serialization/serializer/unit-serializer",{dependencies:["../../core"],factory:function(e,t){function n(e,t,n){this._visitor=e,this._malker=t,this._object=n}var i=e("../../core").Montage,n=i.specialize.call(Object,{_malker:{value:null},_visitor:{value:null},_object:{value:null},constructor:{value:function n(){}},initWithMalkerAndVisitorAndObject:{value:function(e,t,n){return this._malker=e,this._visitor=t,this._object=n,this}},getObjectLabel:{value:function(e){return this.addObjectReference(e),this._visitor.labeler.getObjectLabel(e)}},addObject:{value:function(e){return"object"==typeof e?(this._malker.visit(e),e):void 0}},addObjectReference:{value:function(e){var t=this._visitor.builder,n=this._visitor.labeler,i=n.getObjectLabel(e);return{thisIsAReferenceCreatedByMontageSerializer:!0,reference:t.createObjectReference(i)}}}});t.UnitSerializer=n}}),montageDefine("b15df60","ui/component",{dependencies:["../core/core","../core/target","../core/template","../core/document-resources","../core/gate","../core/promise","../core/logger","../core/event/event-manager","collections/set","../core/serialization/alias","../core/application"],factory:function(e,t){function n(e){return e?e._montage_metadata.objectName+":"+Object.hash(e)+" id: "+e.identifier:"NIL"}var i=e("../core/core").Montage,r=e("../core/target").Target,a=e("../core/template").Template,s=e("../core/document-resources").DocumentResources,o=e("../core/gate").Gate,l=e("../core/promise").Promise,c=e("../core/logger").logger("component"),u=e("../core/logger").logger("Drawing performance").color.green(),h=e("../core/logger").logger("drawing list").color.blue(),d=e("../core/logger").logger("drawing needsDraw").color.violet(),p=e("../core/logger").logger("drawing").color.blue(),f=e("../core/event/event-manager").defaultEventManager,m=e("collections/set"),g=e("../core/serialization/alias").Alias,v="data-montage-le-component",_="data-montage-le-arg",b="data-montage-le-arg-begin",y="data-montage-le-arg-end",w=t.Component=r.specialize({DOM_ARG_ATTRIBUTE:{value:"data-arg"},constructor:{value:function w(){this.super(),this._isComponentExpanded=!1,this._isTemplateLoaded=!1,this._isTemplateInstantiated=!1,this._isComponentTreeLoaded=!1}},delegate:{value:null},templateObjects:{serializable:!1,value:null},_nextTarget:{value:null},nextTarget:{get:function(){return this._nextTarget||this.parentComponent},set:function(e){this._nextTarget=e}},_ownerDocumentPart:{value:null},_templateDocumentPart:{value:null},_domArguments:{value:null},_domArgumentNames:{value:null},_dispatchActionEvent:{value:function(){this.dispatchEvent(this.createActionEvent())},enumerable:!1},createActionEvent:{value:function(){var e=document.createEvent("CustomEvent");return e.initCustomEvent("action",!0,!0,null),e}},canDrawGate:{get:function(){return this._canDrawGate||(this._canDrawGate=(new o).initWithDelegate(this),this._canDrawGate.setField("componentTreeLoaded",!1)),this._canDrawGate},enumerable:!1},_blockDrawGate:{value:null},blockDrawGate:{enumerable:!1,get:function(){return this._blockDrawGate||(this._blockDrawGate=(new o).initWithDelegate(this),this._blockDrawGate.setField("element",!1),this._blockDrawGate.setField("drawRequested",!1)),this._blockDrawGate}},_firstDraw:{enumerable:!1,value:!0},_completedFirstDraw:{enumerable:!1,value:!1},originalElement:{value:null},_element:{enumerable:!1,value:null},element:{get:function(){return this._element},set:function(e){if(null==e)return console.warn("Tried to set element of ",this," to ",e),void 0;if(window._montage_le_flag&&e.setAttribute(v,i.getInfoForObject(this).moduleId),this.isDeserializing)this.eventManager.registerEventHandlerForElement(this,e),this._isTemplateInstantiated?this._templateElement||(this._templateElement=e):(this._element=e,!this.blockDrawGate.value&&this._element&&this.blockDrawGate.setField("element",!0));else{if(!this._firstDraw)return console.error("Cannot change element of ",this," after it has been set"),void 0;this.eventManager.registerEventHandlerForElement(this,e),this._element=e,!this.blockDrawGate.value&&this._element&&this.blockDrawGate.setField("element",!0)}this._initializeClassListFromElement(e)}},getElementId:{value:function(){var e=this._element;return e?e.getAttribute("data-montage-id"):void 0}},_initDomArguments:{value:function(){var e,t,n,i={},r=this.element;e=r.querySelectorAll("*["+this.DOM_ARG_ATTRIBUTE+"]");e:for(var a,s=0;a=e[s];s++){for(n=a;(n=n.parentNode)!==r;)if(n.component)continue e;this._findAndDetachComponents(a),a.parentNode.removeChild(a),t=a.getAttribute(this.DOM_ARG_ATTRIBUTE),a.removeAttribute(this.DOM_ARG_ATTRIBUTE),i[t]=a}this._domArguments=i}},getDomArgumentNames:{value:function(){return this._domArgumentNames||(this._domArgumentNames=Object.keys(this._domArguments)),this._domArgumentNames}},extractDomArgument:{value:function(e){var t;return t=this._domArguments[e],this._domArguments[e]=null,t}},_getTemplateDomArgument:{value:function(e){var t,n,i,r,a,s,o=this._ownerDocumentPart.template;i=o.getElementById(this.getElementId()),t=i.querySelectorAll("*["+this.DOM_ARG_ATTRIBUTE+"='"+e+"']");e:for(var l,c=0;l=t[c];c++){for(n=l;(n=n.parentNode)!==i;)if(r=o.getElementId(n),r&&(a=o.getSerialization(),s=a.getSerializationLabelsWithElements(r),s.length>0))continue e;return l}}},getTemplateArgumentElement:{value:function(e){var t,n,i,r=this._ownerDocumentPart.template;if(window._montage_le_flag)var a=this.ownerComponent._montage_metadata.moduleId,s=this._montage_metadata.label;return"*"===e?(t=r.getElementById(this.getElementId()),n=r.document.createRange(),n.selectNodeContents(t),i=n.cloneContents(),window._montage_le_flag&&t.children.length>0&&this._leTagStarArgument(a,s,i)):(i=this._getTemplateDomArgument(e).cloneNode(!0),i.removeAttribute(this.DOM_ARG_ATTRIBUTE),window._montage_le_flag&&this._leTagNamedArgument(a,s,i,e)),i}},getTemplateArgumentSerialization:{value:function(e){var t=this._ownerDocumentPart.template;return t._createSerializationWithElementIds(e)}},resolveTemplateArgumentTemplateProperty:{value:function(e){var t,n,r,a,s=e.indexOf(":"),o=e.slice(0,s),l=e.slice(s),c=this._templateDocumentPart;return i.getInfoForObject(this).label===o?(c&&(r=c.objects[l]),r instanceof g&&(n=c.objects[r.componentLabel],t=r.value.slice(1),a=n.resolveTemplateArgumentTemplateProperty(t),a||(a=t)),a):void 0}},setElementWithParentComponent:{value:function(e,t){this._alternateParentComponent=t,this.element!==e&&(this.element=e)}},application:{enumerable:!1,get:function(){return e("../core/application").application}},eventManager:{enumerable:!1,get:function(){return f}},rootComponent:{enumerable:!1,get:function(){return L}},elementControllerFromEvent:{enumerable:!1,value:function(e,t){return t}},_alternateParentComponent:{value:null},__parentComponent:{value:null},_parentComponent:{set:function(e){this.__parentComponent=e,this.dispatchOwnPropertyChange("parentComponent",e)},get:function(){return this.__parentComponent}},parentComponent:{enumerable:!1,get:function(){return this._parentComponent}},findParentComponent:{value:function(){var e,t=this.element,n=this.eventManager;if(t){for(;null!=(e=t.parentNode)&&null==n.eventHandlerForElement(e);)t=e;return e?n.eventHandlerForElement(e):this._alternateParentComponent}}},querySelectorComponent:{value:function(e){if("string"!=typeof e)throw"querySelectorComponent: Selector needs to be a string.";var t=e.match(/^\s*(?:@([^>\s]+))?(?:\s*(>)?\s*@([^>\s]+)(.*))?$/);if(!t)throw'querySelectorComponent: Syntax error "'+e+'"';var n,r,a,s=this.childComponents,o=t[1],l=(t[2]||" ",t[3]),c=t[4];if(o)for(c=l?"@"+l+c:"",r=0,a;a=s[r];r++){if(o===i.getInfoForObject(a).label)return c?a.querySelectorComponent(c):a;if(n=a.querySelectorComponent(e))return n}else for(r=0,a;a=s[r];r++)if(l===i.getInfoForObject(a).label)return c?a.querySelectorComponent(c):a;return null}},querySelectorAllComponent:{value:function(e,t){if("string"!=typeof e)throw"querySelectorComponent: Selector needs to be a string.";var n=e.match(/^\s*(?:@([^>\s]+))?(?:\s*(>)?\s*@([^>\s]+)(.*))?$/);if(!n)throw'querySelectorComponent: Syntax error "'+e+'"';var r,a,s=this.childComponents,o=n[1],l=(n[2]||" ",n[3]),c=n[4],u=[];if(o)for(c=l?"@"+l+c:"",r=0,a;a=s[r];r++)o!==i.getInfoForObject(a).label||t&&t!==a.ownerComponent?u=u.concat(a.querySelectorAllComponent(e,t)):c?u=u.concat(a.querySelectorAllComponent(c)):u.push(a);else for(r=0,a;a=s[r];r++)l!==i.getInfoForObject(a).label||t&&t!==a.ownerComponent||(c?u=u.concat(a.querySelectorAllComponent(c,t)):u.push(a));return u}},template:{enumerable:!1,value:null},hasTemplate:{enumerable:!1,value:!0},_templateModuleId:{serializable:!1,value:null},_template:{value:null},_treeLevel:{value:0},_addChildComponent:{value:function(e){return this.addChildComponent(e)}},addChildComponent:{value:function(e){-1===this.childComponents.indexOf(e)&&(this.childComponents.push(e),e._prepareForEnterDocument(),e._parentComponent=this,e.needsDraw&&!this.rootComponent.isComponentWaitingNeedsDraw(e)&&e._addToParentsDrawList())}},attachToParentComponent:{value:function(){this.detachFromParentComponent(),this._parentComponent=null;var e,t,n=this.findParentComponent();if(n){e=n.childComponents;for(var i=0;t=e[i];i++){var r=t.findParentComponent();r===this&&(n.removeChildComponent(t),r.addChildComponent(t))}n.addChildComponent(this)}}},detachFromParentComponent:{value:function(){var e=this.parentComponent;e&&e.removeChildComponent(this)}},removeChildComponent:{value:function(e){var t=this.childComponents,n=t.indexOf(e);n>-1&&(e._exitDocument(),t.splice(n,1),e._parentComponent=null,e._alternateParentComponent=null,e._addedToDrawList&&(e._addedToDrawList=!1,n=this._drawList.indexOf(e),this._drawList.splice(n,1)),this.rootComponent.removeFromCannotDrawList(e))}},childComponents:{enumerable:!1,distinct:!0,value:[]},_needsEnterDocument:{value:!1},_inDocument:{value:!1},__exitDocument:{value:function(){this._inDocument&&"function"==typeof this.exitDocument&&(this.exitDocument(),this._inDocument=!1)}},_exitDocument:{value:function(){var e;this._needsEnterDocument?this._needsEnterDocument=!1:(e=function(t){for(var n,i=t.childComponents,r=0;n=i[r];r++)n._isComponentExpanded&&e(n);t._inDocument&&t.__exitDocument()},e(this))}},exitDocument:{value:function(){this.isActiveTarget&&(f.activeTarget=this.nextTarget)}},_prepareForEnterDocument:{value:function(){this._firstDraw?this._needsEnterDocument=!0:(this.needsDraw=!0,this.traverseComponentTree(function(e){return e._needsEnterDocument?!1:(e._needsEnterDocument=!0,e.needsDraw=!0,void 0)}))}},ownerComponent:{enumerable:!1,value:null},components:{enumerable:!1,value:{}},_isComponentExpanded:{enumerable:!1,value:null},_isTemplateLoaded:{enumerable:!1,value:null},_isTemplateInstantiated:{enumerable:!1,value:null},cleanupDeletedComponentTree:{value:function(e){e&&this.cancelBindings(),this.needsDraw=!1,this.traverseComponentTree(function(t){e&&t.cancelBindings(),t.needsDraw=!1})}},_newDomContent:{enumerable:!1,value:null},domContent:{serializable:!1,get:function(){return this._element?Array.prototype.slice.call(this._element.childNodes,0):null},set:function(e){var t,n,i,r=[];for(this._newDomContent=e,this.needsDraw=!0,null===this._newDomContent&&(this._shouldClearDomContentOnNextDraw=!0),"function"==typeof this.contentWillChange&&this.contentWillChange(e),t=this.childComponents,n=0,i;i=t[n];n++)i.detachFromParentComponent();if(e instanceof Element)this._findAndDetachComponents(e,r);else if(e&&e[0])for(n=0;e.length>n;n++)this._findAndDetachComponents(e[n],r);for(n=0,i;i=r[n];n++)this.addChildComponent(i)}},_shouldClearDomContentOnNextDraw:{value:!1},_findAndDetachComponents:{value:function(e,t){var n,i=e.component;if(t||(t=[]),i)i.detachFromParentComponent(),t.push(i);else{n=e.children||e.childNodes;for(var r,a=0;r=n[a];a++)this._findAndDetachComponents(r,t)}return t}},clonesChildComponents:{writable:!1,value:!1},_innerTemplate:{value:null},innerTemplate:{serializable:!1,get:function(){var e,t,n,i,r,a,s,o=this._innerTemplate;if(!o&&(e=this._ownerDocumentPart)){t=e.template,n=this.getElementId(),o=t.createTemplateFromElementContents(n),i=o.getSerialization(),r=i.getExternalObjectLabels(),a=e.objects,s=Object.create(null);for(var l,c=0;l=r[c];c++)s[l]=a[l];o.setInstances(s),this._innerTemplate=o}return o},set:function(e){this._innerTemplate=e}},canDraw:{value:function(){return this._canDraw}},_canDraw:{get:function(){return!this._canDrawGate||this._canDrawGate.value},set:function(e){L.componentCanDraw(this,e)},enumerable:!1},_prepareCanDraw:{enumerable:!1,value:function(){this._isComponentTreeLoaded||this.loadComponentTree().done()}},_blocksOwnerComponentDraw:{value:!1},_updateOwnerCanDrawGate:{value:function(){this._blocksOwnerComponentDraw&&this.ownerComponent&&this.ownerComponent.canDrawGate.setField(this.uuid,this.canDrawGate.value)}},_isComponentTreeLoaded:{value:null},shouldLoadComponentTree:{value:!0},_loadComponentTreeDeferred:{value:null},loadComponentTree:{value:function(){var e=this,t=this.canDrawGate,n=this._loadComponentTreeDeferred;return n||(n=l.defer(),this._loadComponentTreeDeferred=n,t.setField("componentTreeLoaded",!1),(this.needsDraw||this.hasTemplate)&&(this._canDraw=!1),this.expandComponent().then(function(){if(e.hasTemplate||e.shouldLoadComponentTree){for(var t,n=[],i=e.childComponents,r=0;t=i[r];r++)n.push(t.loadComponentTree());return l.all(n)}}).then(function(){e._isComponentTreeLoaded=!0,e._needsEnterDocument&&(e.needsDraw=!0),t.setField("componentTreeLoaded",!0),n.resolve()},n.reject).done()),n.promise}},traverseComponentTree:{value:function(e,t){function n(){var n,r,a=i.childComponents;if(e&&e(i)===!1)return t&&t(),void 0;if(0===(r=a.length))return t&&t(),void 0;for(var s=function(){0===--r&&t&&t()},o=0;n=a[o];o++)n.traverseComponentTree(e,s)}var i=this;this._isComponentExpanded?n():t&&t()}},_expandComponentDeferred:{value:null},expandComponent:{value:function(){var e=this,t=this._expandComponentDeferred;return t||(t=l.defer(),this._expandComponentDeferred=t,this.hasTemplate?this._instantiateTemplate().then(function(){e._isComponentExpanded=!0,e._addTemplateStyles(),e.needsDraw=!0,t.resolve()},t.reject):(this._isComponentExpanded=!0,t.resolve())),t.promise}},_templateObjectDescriptor:{value:{enumerable:!0,configurable:!0}},_setupTemplateObjects:{value:function(e){this.templateObjects=Object.create(null),this._addTemplateObjects(e)}},_addTemplateObjects:{value:function(e){var t=this._templateObjectDescriptor,n=this.templateObjects;for(var i in e){var r=e[i];"object"==typeof r&&null!=r&&(w.prototype.isPrototypeOf(r)&&r!==this&&r.parentComponent!==this?(t.get=this._makeTemplateObjectGetter(this,i,r),Object.defineProperty(n,i,t)):n[i]=r)}}},_makeTemplateObjectGetter:{value:function(e,t,n){var i,r,a,s="@"+t;return function(){if(i)return e.querySelectorAllComponent(s,e);if(r=e.querySelectorAllComponent(s,e),1===r.length)for(a=r[0];a=a.parentComponent;){if(a===e)return Object.defineProperty(this,t,{value:r[0]}),r[0];if(a.clonesChildComponents)break}else if(0===r.length)return n;return i=!0,r}}},_instantiateTemplate:{value:function(){var e=this;return this._loadTemplate().then(function(t){if(!e._element)return console.error("Cannot instantiate template without an element.",e),l.reject(Error("Cannot instantiate template without an element.",e));var n=e.templateObjects,i=e._element.ownerDocument;return n||(n=Object.create(null)),n.owner=e,e._isTemplateInstantiated=!0,t.instantiateWithInstances(n,i).then(function(t){t.parentDocumentPart=e._ownerDocumentPart,e._templateDocumentPart=t,t.fragment=null}).fail(function(e){var n=e.stack||e;throw console.error("Error in",t.getBaseUrl()+":",n),e})})}},_templateDidLoad:{value:function(e){this._setupTemplateObjects(e.objects)}},_loadTemplatePromise:{value:null},_loadTemplate:{value:function(){var e,t=this,n=this._loadTemplatePromise;return n||(e=i.getInfoForObject(this),n=this._loadTemplatePromise=a.getTemplateWithModuleId(this.templateModuleId,e.require).then(function(e){return t._template=e,t._isTemplateLoaded=!0,e})),n}},templateModuleId:{get:function(){return this._templateModuleId||this._getDefaultTemplateModuleId()}},_getDefaultTemplateModuleId:{value:function(){var e,t,n,r;return r=i.getInfoForObject(this),n=r.moduleId,t=n.lastIndexOf("/"),e=n+"/"+n.slice(-1===t?0:t+1,-5)+".html"}},deserializedFromSerialization:{value:function(){this.attachToParentComponent()}},_deserializedFromTemplate:{value:function(e,t,n){i.getInfoForObject(this).label=t,this._ownerDocumentPart=n,this.hasOwnProperty("identifier")||(this.identifier=t),this.ownerComponent||(this.ownerComponent=w.prototype.isPrototypeOf(e)?e:this.rootComponent,this._updateOwnerCanDrawGate()),this._needsDrawInDeserialization&&(this.needsDraw=!0)}},blueprintModuleId:{serializable:!1,enumerable:!1,get:function(){var e=i.getInfoForObject(this),t=e&&!e.isInstance?this:Object.getPrototypeOf(this);if(!Object.getOwnPropertyDescriptor(t,"_blueprintModuleId")||!t._blueprintModuleId){e=i.getInfoForObject(t);var n=e.moduleId,r=n.lastIndexOf("/"),a=n.lastIndexOf(".");r=-1===r?0:r+1,a=-1===a?n.length:a,a=r>a?n.length:a;var s;s=n.length>a&&".reel"===n.slice(a,n.length)?n+"/"+n.slice(r,a)+".meta":n.slice(0,a)+".meta",i.defineProperty(t,"_blueprintModuleId",{value:s})}return t._blueprintModuleId}},blueprint:e("../core/core")._blueprintDescriptor,gateDidBecomeTrue:{value:function(e){e===this._canDrawGate?(this._canDraw=!0,this._updateOwnerCanDrawGate()):e===this._blockDrawGate&&(L.componentBlockDraw(this),this._prepareCanDraw())},enumerable:!1},gateDidBecomeFalse:{value:function(e){e===this._canDrawGate&&this._updateOwnerCanDrawGate()},enumerable:!1},_canDrawGate:{enumerable:!1,value:null},_preparedForActivationEvents:{enumerable:!1,value:!1},_arrayObjectPool:{value:{pool:null,size:200,ix:0}},_getArray:{value:function(){if(null==this._arrayObjectPool.pool){this._arrayObjectPool.pool=[];for(var e=0;this._arrayObjectPool.size>e;e++)this._arrayObjectPool.pool[e]=[]}return this._arrayObjectPool.ix<this._arrayObjectPool.size?this._arrayObjectPool.pool[this._arrayObjectPool.ix++]:[]}},_disposeArray:{value:function(e){this._arrayObjectPool.ix>0&&(e.length=0,this._arrayObjectPool.pool[--this._arrayObjectPool.ix]=e)}},_drawIfNeeded:{enumerable:!1,value:function(e){var t,r,a,s,o=this._firstDraw;if(this._treeLevel=e,o&&(this.originalElement=this.element),this.needsDraw&&L.addToDrawCycle(this),o&&this.prepareForDraw&&i.callDeprecatedFunction(this,this.prepareForDraw,"prepareForDraw","enterDocument(firstTime)"),this._needsEnterDocument&&(this._needsEnterDocument=!1,this._inDocument=!0,"function"==typeof this.enterDocument&&this.enterDocument(o),this._enterDocument(o)),o&&(this.originalElement=null),null!==this._drawList&&this._drawList.length>0){for(r=this._drawList,this._drawList=this._getArray(),s=r.length,a=0;s>a;a++)t=r[a],t._addedToDrawList=!1,t.canDraw()?t._drawIfNeeded(e+1):p.isDebug&&p.debug(n(t)+" can't draw.");this._disposeArray(r)}}},_updateComponentDom:{value:function(){var e,t,n;if(this._firstDraw){for(this._prepareForDraw(),t=this.composerList.length,n=0;t>n;n++)e=this.composerList[n],e.lazyLoad||e._load();this._firstDraw=!1}(null!==this._newDomContent||this._shouldClearDomContentOnNextDraw)&&(p.isDebug&&c.debug("Component content changed: component ",this._montage_metadata.objectName,this.identifier," newDomContent",this._newDomContent),this._performDomContentChanges())}},_replaceElementWithTemplate:{enumerable:!1,value:function(){var e,t,n,i,r,a=this.element,s=this._templateElement,o=this.element.attributes;for(n=0;i=o[n];n++)e=i.nodeName,window._montage_le_flag&&e===v?t=i.nodeValue:"id"===e||"data-montage-id"===e?t=i.nodeValue:(r=s.getAttribute(e)||"",t=r?r+("style"===e?"; ":" ")+i.nodeValue:i.nodeValue),s.setAttribute(e,t);this._initializeClassListFromElement(s),a.parentNode?a.parentNode.replaceChild(s,a):this._canDrawOutsideDocument||console.warn("Warning: Trying to replace element ",a," which has no parentNode"),this.eventManager.unregisterEventHandlerForElement(a),this.eventManager.registerEventHandlerForElement(this,s),this._element=s,this._templateElement=null,this._newDomContent&&(this._newDomContent=null,this._shouldClearDomContentOnNextDraw=!1)
}},_addTemplateStyles:{value:function(){var e,t,n,i=this._templateDocumentPart;if(i){e=i.template.getResources(),n=this.element.ownerDocument,t=e.createStylesForDocument(n);for(var r,a=0;r=t[a];a++)this.rootComponent.addStylesheet(r)}}},_prepareForDraw:{value:function(){c.isDebug&&c.debug(this,"_templateElement: "+this._templateElement);var e;window._montage_le_flag&&(e=this.element.children.length>0),this._initDomArguments(),e&&this._leTagArguments(),this._templateElement&&(this._bindTemplateParametersToArguments(),this._replaceElementWithTemplate())},enumerable:!1},_leTagArguments:{value:function(){var e=this.ownerComponent._montage_metadata.moduleId,t=this._montage_metadata.label,n=this.getDomArgumentNames();if(0===n.length)this._leTagStarArgument(e,t,this.element);else for(var i,r=0;i=n[r];r++)this._leTagNamedArgument(e,t,this._domArguments[i],i)}},_getNodeFirstElement:{value:function(e){var t=e.firstElementChild;if(!t){t=e.firstChild;do if(t.nodeType===Node.ELEMENT_NODE)break;while(t=t.nextSibling)}return t}},_getNodeLastElement:{value:function(e){var t=e.lastElementChild;if(!t){t=e.lastChild;do if(t.nodeType===Node.ELEMENT_NODE)break;while(t=t.previousSibling)}return t}},_leTagStarArgument:{value:function(e,t,n){var i=this._getNodeFirstElement(n),r=this._getNodeLastElement(n);i.setAttribute(b,(i.getAttribute(b)||"")+" "+e+","+t),r.setAttribute(y,(r.getAttribute(y)||"")+" "+e+","+t)}},_leTagNamedArgument:{value:function(e,t,n,i){n.setAttribute(_,e+","+t+","+i)}},_bindTemplateParametersToArguments:{value:function(){var e,t,n,i,r,a,s,o,l=this._templateDocumentPart.parameters;if(t=this._domArguments,this._template.hasParameters()||1!==t.length){if(i=this._validateTemplateArguments(t,l))throw i;for(var c in l){e=l[c],n=t[c],"*"===c?(s=this._element.ownerDocument.createRange(),s.selectNodeContents(this._element),r=s.extractContents()):r=n,a=this._findAndDetachComponents(r),e.parentNode.replaceChild(r,e);for(var u=0;o=a[u];u++)o.attachToParentComponent()}}}},_validateTemplateArguments:{value:function(e,t){var n,i,r=Object.keys(t);if(0!==r.length)if(null==e){if(r.length>0)return Error("No arguments provided for "+this.templateModuleId+". Arguments needed: "+r+".")}else if("*"in t){if(n=Object.keys(e),n.length>0)return Error('Arguments "'+n+'" were given to component but no named parameters '+"are defined in "+this.templateModuleId)}else{for(i in t)if(!(i in e))return Error('"'+i+'" argument not '+"given in "+this.templateModuleId);for(i in e)if("*"!==i&&!(i in t))return Error('"'+i+'" parameter does '+"not exist in "+this.templateModuleId)}}},prepareForActivationEvents:{enumerable:!1,value:null},_prepareForActivationEvents:{value:function(){var e,t=this.composerList.length;for(t=0;this.composerList.length>t;t++)e=this.composerList[t],e.lazyLoad&&e._load();"function"==typeof this.prepareForActivationEvents&&this.prepareForActivationEvents()}},_performDomContentChanges:{value:function(){var e,t,n=this._newDomContent,i=this._element.childNodes[0];if(n||this._shouldClearDomContentOnNextDraw){t=this._element,e=this._element.childNodes.length;for(var r=0;e>r;r++)t.removeChild(t.firstChild);if(Element.isElement(n))t.appendChild(n);else if(null!=n)for(var a,r=0;a=n[r];r++)t.appendChild(a);this._newDomContent=null,"function"==typeof this.contentDidChange&&this.contentDidChange(this._element.childNodes[0],i),this._shouldClearDomContentOnNextDraw=!1}}},prepareForDraw:{enumerable:!1,value:null},draw:{enumerable:!1,value:function(){}},willDraw:{enumerable:!1,value:null},didDraw:{enumerable:!1,value:function(){}},_addedToDrawList:{value:!1},_addToParentsDrawList:{enumerable:!1,value:function(){if(!this._addedToDrawList){var e=this.parentComponent;e?(e._addToDrawList(this),h.isDebug&&h.debug(n(this)+" added to "+n(e)+"'s drawList")):h.isDebug&&h.debug(this,"parentComponent is null")}}},_needsDraw:{value:!1},_needsDrawInDeserialization:{value:!1},needsDraw:{enumerable:!1,get:function(){return!!this._needsDraw},set:function(e){return this.isDeserializing?(this._needsDrawInDeserialization=!0,void 0):(this._needsDraw!==e&&(d.isDebug&&d.debug("needsDraw toggled "+e+" for "+this._montage_metadata.objectName),this._needsDraw=!!e,e&&(this.canDrawGate.value?this._addToParentsDrawList():this.blockDrawGate.setField("drawRequested",!0))),void 0)}},_drawList:{value:null},__addToDrawList:{enumerable:!1,value:function(e){null===this._drawList?(this._drawList=[e],e._addedToDrawList=!0):-1===this._drawList.indexOf(e)&&(this._drawList.push(e),e._addedToDrawList=!0)}},_addToDrawList:{enumerable:!1,value:function(e){this.__addToDrawList(e),this._addToParentsDrawList()}},_templateElement:{enumerable:!1,value:null},surrenderPointer:{value:function(){return!0}},composerList:{value:[],distinct:!0,serializable:!1},addComposer:{value:function(e){this.addComposerForElement(e,e.element)}},addComposerForElement:{value:function(e,t){e.component=this,e.element=t,this.composerList.push(e),this._firstDraw||(e.lazyLoad?this._preparedForActivationEvents&&e._load():e._load())}},scheduleComposer:{value:function(e){this.rootComponent.addToComposerList(e)}},removeComposer:{value:function(e){var t,n;for(n=this.composerList.length,t=0;n>t;t++)if(this.composerList[t].uuid===e.uuid){this.composerList[t].unload(),this.composerList.splice(t,1);break}}},clearAllComposers:{value:function(){var e,t,n=this.composerList;for(t=n.length,e=0;t>e;e++)n[e].unload();n.splice(0,t)}},localizer:{value:null},_waitForLocalizerMessages:{value:!1},waitForLocalizerMessages:{enumerable:!1,get:function(){return this._waitForLocalizerMessages},set:function(e){if(this._waitForLocalizerMessages!==e)if(e!==!0||this.localizer.messages)this._waitForLocalizerMessages=!1,this.canDrawGate.setField("messages",!0);else{if(!this.localizer)throw"Cannot wait for messages on localizer if it is not set";this._waitForLocalizerMessages=!0;var t=this;c.debug(this,"waiting for messages from localizer"),this.canDrawGate.setField("messages",!1),this.localizer.messagesPromise.then(function(){c.isDebug&&c.debug(t,"got messages from localizer"),t.canDrawGate.setField("messages",!0)})}}},_elementAttributeValues:{value:null},_elementAttributeDescriptors:{value:null},_getElementAttributeDescriptor:{value:function(e){for(var t,n=this;n&&n._elementAttributeDescriptors&&!(t=n._elementAttributeDescriptors[e]);)n=Object.getPrototypeOf(n);return t}},defineAttribute:{value:function(e,t){t=t||{};var n="_"+e,r={configurable:void 0===t.configurable?!0:t.configurable,enumerable:void 0===t.enumerable?!0:t.enumerable,set:function(e,t){return function(n){var i=this._getElementAttributeDescriptor(e,this);i&&"boolean"===i.dataType&&(n=n||""===n?!0:!1),void 0!==n&&this[t]!==n&&(this[t]=n,null===this._elementAttributeValues&&(this._elementAttributeValues={}),this._elementAttributeValues[e]=n,this.needsDraw=!0)}}(e,n),get:function(e,t){return function(){return this[t]}}(e,n)};i.defineProperty(this.prototype,n,{value:null}),i.defineProperty(this.prototype,e,r)}},addAttributes:{value:function(e){var t,n,i;this.prototype._elementAttributeDescriptors=e;for(n in e)e.hasOwnProperty(n)&&(i=e[n],null===i||"string"==typeof i?(t={value:i,dataType:"string"},e[n]=t):t=i,void 0===this[n]&&this.defineAttribute(n,t))}},_enterDocument:{value:function(e){var t;if(e){t=this.originalElement;var n,i,r,a,s,o,l;if(n=t.attributes)for(r=n.length,i=0;r>i;i++)a=n[i].name,s=n[i].value,l=this._getElementAttributeDescriptor(a,this),(l||void 0!==this[a])&&(null===this._elementAttributeValues&&(this._elementAttributeValues={}),void 0===this._elementAttributeValues[a]&&(this._elementAttributeValues[a]=s,(void 0===this[a]||null==this[a])&&(this[a]=s)));if(l=this._getElementAttributeDescriptor("textContent",this)){var c=t.textContent;null===this._elementAttributeValues&&(this._elementAttributeValues={}),void 0===this._elementAttributeValues.textContent&&(this._elementAttributeValues.textContent=c,null==this.textContent&&(this.textContent=c))}if(this._elementAttributeDescriptors)for(o in this._elementAttributeDescriptors){l=this._elementAttributeDescriptors[o];var u="_"+o;null===this[u]&&null!==l&&"value"in l&&(this[u]=this._elementAttributeDescriptors[o].value)}}}},_draw:{value:function(){var e,t=this.element;for(var n in this._elementAttributeValues)if(this._elementAttributeValues.hasOwnProperty(n)){var i=this[n];e=this._getElementAttributeDescriptor(n,this),e&&("boolean"===e.dataType?i===!0?(t[n]=!0,t.setAttribute(n,n.toLowerCase())):(t[n]=!1,t.removeAttribute(n)):void 0!==i&&("textContent"===n?t.textContent=i:t.setAttribute(n,i))),delete this._elementAttributeValues[n]}this._drawClassListIntoComponent()}},_classList:{value:null},_classListDirty:{value:!1},classList:{get:function(){return null===this._classList&&(this._classList=new m,this._subscribeToToClassListChanges(),this._initializeClassListFromElement(this.element)),this._classList}},_initializeClassListFromElement:{value:function(e){var t;if(e&&e.className&&(t=e.className.trim())&&0!==t.length){var n=this.classList;this._unsubscribeToClassListChanges&&this._unsubscribeToClassListChanges(),n.addEach(t.split(/\s+/)),this._subscribeToToClassListChanges()}}},_unsubscribeToClassListChanges:{value:null},_subscribeToToClassListChanges:{value:function(){this._unsubscribeToClassListChanges=this._classList.addRangeChangeListener(this,"classList")}},handleClassListRangeChange:{value:function(){this._classListDirty=!0,this.needsDraw=!0}},_drawClassListIntoComponent:{value:function(){if(this._classListDirty){for(var e,t=this.element.classList,n=this._classList,i=0,r=t.length;r>i;i++)e=t.item(i),n.has(e)||(t.remove(e),i--,r--);this._classList.forEach(function(e){t.add(e)}),this._classListDirty=!1}}},dispose:{value:function(){this.cancelBindings(),this.detachFromParentComponent(),f.unregisterEventHandlerForElement(this,this._element),this._element=null,this.childComponents.forEach(function(e){e.dispose()})}}}),C=w.specialize({constructor:{value:function C(){this.super(),this._drawTree=this._drawTree.bind(this),this._readyToDrawListIndex={}}},init:{value:function(){return this}},needsDraw:{enumerable:!0,get:function(){return!1},set:function(e){if(this._needsDraw!==e&&(this._needsDraw=!!e,e))for(var t,n=this.childComponents,i=0;t=n[i];i++)d.isDebug&&d.debug(this,"needsDraw = true for: "+t._montage_metadata.exportedSymbol),t.needsDraw=!0}},canDrawGate:{get:function(){return this._canDrawGate||(this._canDrawGate=(new o).initWithDelegate(this))}},_clearNeedsDrawTimeOut:{value:null},_needsDrawList:{value:[]},_cannotDrawList:{value:null},componentBlockDraw:{value:function(e){this._cannotDrawList=this._cannotDrawList?this._cannotDrawList:{},this._cannotDrawList[e.uuid]=e,this._clearNeedsDrawTimeOut&&(window.clearTimeout(this._clearNeedsDrawTimeOut),this._clearNeedsDrawTimeOut=null)}},isComponentWaitingNeedsDraw:{value:function(e){return e.uuid in this._cannotDrawList||this._needsDrawList.indexOf(e)>=0}},componentCanDraw:{value:function(e,t){if(t){if(!this._cannotDrawList)return;if(delete this._cannotDrawList[e.uuid],this._needsDrawList.push(e),0===Object.keys(this._cannotDrawList).length&&this._needsDrawList.length>0&&!this._clearNeedsDrawTimeOut){var n=this;this._clearNeedsDrawTimeOut=window.setTimeout(function(){n._clearNeedsDrawList()},0)}}else this._clearNeedsDrawTimeOut&&(window.clearTimeout(this._clearNeedsDrawTimeOut),this._clearNeedsDrawTimeOut=null)}},_clearNeedsDrawList:{value:function(){var e,t,n,i=this._needsDrawList;for(n=i.length,t=0;n>t;t++)e=i[t],(e.needsDraw||e._drawList&&e._drawList.length>0)&&e._addToParentsDrawList();this._clearNeedsDrawTimeOut=null,i.splice(0,n)}},removeFromCannotDrawList:{value:function(e){if(this._cannotDrawList&&(delete this._cannotDrawList[e.uuid],0===Object.keys(this._cannotDrawList).length&&this._needsDrawList.length>0&&!this._clearNeedsDrawTimeOut)){var t=this;this._clearNeedsDrawTimeOut=window.setTimeout(function(){t._clearNeedsDrawList()},0)}}},_cancelDrawIfScheduled:{value:function(){var e=this.requestedAnimationFrame,t=this.cancelAnimationFrame;null!==e&&(this._frameTime||(c.isDebug&&c.debug(this,"clearing draw"),t?t.call(window,e):window.clearTimeout(e),this.requestedAnimationFrame=null))}},_addToDrawList:{value:function(e){this.__addToDrawList(e),h.isDebug&&h.debug(this,this.canDrawGate.value,this.requestedAnimationFrame),this.drawTree()},enumerable:!1},addToComposerList:{value:function(e){this.composerList.push(e),p.isDebug&&p.debug(this,e,"Added to composer list"),this._scheduleComposerRequest=!0,this.drawTree()}},composerListSwap:{value:[],distinct:!0},_scheduleComposerRequest:{value:!1},requestedAnimationFrame:{value:null,enumerable:!1},requestAnimationFrame:{value:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,enumerable:!1},cancelAnimationFrame:{value:window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame,enumerable:!1},_frameTime:{value:null},_oldSource:{value:null},_diff:{value:function(e,t){for(var n={},i={},r=0;t.length>r;r++)null==n[t[r]]&&(n[t[r]]={rows:[],o:null}),n[t[r]].rows.push(r);for(r=0;e.length>r;r++)null==i[e[r]]&&(i[e[r]]={rows:[],n:null}),i[e[r]].rows.push(r);for(r in n)1===n[r].rows.length&&void 0!==i[r]&&1===i[r].rows.length&&(t[n[r].rows[0]]={text:t[n[r].rows[0]],row:i[r].rows[0]},e[i[r].rows[0]]={text:e[i[r].rows[0]],row:n[r].rows[0]});for(r=0;t.length-1>r;r++)null!=t[r].text&&null==t[r+1].text&&t[r].row+1<e.length&&null==e[t[r].row+1].text&&t[r+1]==e[t[r].row+1]&&(t[r+1]={text:t[r+1],row:t[r].row+1},e[t[r].row+1]={text:e[t[r].row+1],row:r+1});for(r=t.length-1;r>0;r--)null!=t[r].text&&null==t[r-1].text&&t[r].row>0&&null==e[t[r].row-1].text&&t[r-1]==e[t[r].row-1]&&(t[r-1]={text:t[r-1],row:t[r].row-1},e[t[r].row-1]={text:e[t[r].row-1],row:r-1});return{o:e,n:t}}},_previousDrawDate:{enumerable:!1,value:0},_documentResources:{value:null},_needsStylesheetsDraw:{value:!1},_stylesheets:{value:[]},addStylesheet:{value:function(e){this._stylesheets.push(e),this._needsStylesheetsDraw=!0}},drawStylesheets:{value:function(){for(var e,t=this._documentResources,n=this._stylesheets;e=n.shift();)t.addStyle(e);this._needsStylesheetsDraw=!1}},drawTree:{value:function(){if(null===this.requestedAnimationFrame){var e=this.requestAnimationFrame;if(e)this.requestedAnimationFrame=e.call(window,this._drawTree);else{var t=Date.now(),n=17-t+this._previousDrawDate;0>n&&(n=0),this.requestedAnimationFrame=setTimeout(this._drawTree,n),this._previousDrawDate=t+n}this._scheduleComposerRequest=!1}},enumerable:!1},_drawTree:{value:function(e){var t;if(this._needsStylesheetsDraw&&this.drawStylesheets(),!this._documentResources.areStylesLoaded)return u.isDebug&&console.log("Draw Cycle Waiting Stylesheets: ",this._documentResources._expectedStyles.length),this.requestedAnimationFrame=null,this.drawTree(),void 0;if(u.isDebug&&(t=window.performance?window.performance.now():Date.now()),this._frameTime=e?e:Date.now(),this._clearNeedsDrawTimeOut&&this._clearNeedsDrawList(),p.isDebug){var n=document.body.innerHTML;if(this._oldSource&&n!==this._oldSource){for(var i=["DOM modified outside of the draw loop"],r=this._diff(this._oldSource.split("\n"),n.split("\n")),a=0;r.n.length>a;a++)if(null==r.n[a].text)i.push("+ "+r.n[a]);else for(var s=r.n[a].row+1;r.o.length>s&&null==r.o[s].text;s++)i.push("- "+r.o[s]);console.warn(i.join("\n"))}console.group((e?p.toTimeString(new Date(e))+" ":"")+"Draw Fired")}if(this.drawIfNeeded(),u.isDebug){if(window.performance)var o=window.performance.now();else var o=Date.now();console.log("Draw Cycle Time: ",o-t,", Components: ",this._lastDrawComponentsCount)}p.isDebug&&(console.groupEnd(),this._oldSource=document.body.innerHTML),this._frameTime=null,this._scheduleComposerRequest&&this.drawTree()}},_readyToDrawList:{enumerable:!1,value:[]},_readyToDrawListIndex:{enumerable:!1,value:null},addToDrawCycle:{value:function(e){var t=this._readyToDrawListIndex;return t.hasOwnProperty(e.uuid)?(p.isDebug&&this!==L&&p.debug(n(this)+" added to the draw cycle twice, this should not happen."),void 0):(this._readyToDrawList.push(e),this._readyToDrawListIndex[e.uuid]=!0,e._updateComponentDom(),void 0)}},_lastDrawComponentsCount:{value:null},_sortByLevel:{value:function(e,t){return e._treeLevel-t._treeLevel}},drawIfNeeded:{value:function(){var e,t,i,r,a,s,o=this._readyToDrawList,l=0,c=this.composerList;if(o.length=0,s=c.length,this._readyToDrawListIndex.clear(),s>0){for(this.composerList=this.composerListSwap,t=0;s>t;t++)a=c[t],a.needsFrame=!1,a.frame(this._frameTime);c.splice(0,s),this.composerListSwap=c}for(this._drawIfNeeded(0),i=o.length,p.isDebug&&console.groupCollapsed("willDraw - "+o.length+(o.length>1?" components.":" component."));i>l;){for(t=l;i>t;t++)e=o[t],"function"==typeof e.willDraw&&e.willDraw(this._frameTime),p.isDebug&&p.debug("Level "+e._treeLevel+" "+n(e));this._drawIfNeeded(0),l=i,i=o.length}for(p.isDebug&&(console.groupEnd(),console.group("draw - "+o.length+(o.length>1?" components.":" component."))),o.sort(this._sortByLevel),t=0;i>t;t++)e=o[t],e.needsDraw=!1;for(this.requestedAnimationFrame=null,t=i-1;t>=0;t--)e=o[t],e._draw(this._frameTime),e.draw(this._frameTime),p.isDebug&&p.debug("Level "+e._treeLevel+" "+n(e));for(p.isDebug&&(console.groupEnd(),console.groupCollapsed("didDraw - "+o.length+(o.length>1?" components.":" component."))),t=0;i>t;t++)e=o[t],e.didDraw(this._frameTime),"channelListItem"===e.identifier&&console.log("component %s completedFirstDraw %s",Object.hash(e),e._completedFirstDraw),e._completedFirstDraw||(r=document.createEvent("CustomEvent"),r.initCustomEvent("firstDraw",!0,!1,null),e.dispatchEvent(r),e._completedFirstDraw=!0),p.isDebug&&p.debug("Level "+e._treeLevel+" "+n(e));return p.isDebug&&console.groupEnd(),u.isDebug&&(this._lastDrawComponentsCount=o.length),!!o.length}},element:{get:function(){return this._element},set:function(e){f.registerEventHandlerForElement(this,e),this._element=e,this._documentResources=s.getInstanceForDocument(e)}}}),L=(new C).init();t.__root__=L}}),montageDefine("b15df60","ui/slot.reel/slot",{dependencies:["../../core/core","../component"],factory:function(e,t){var n=(e("../../core/core").Montage,e("../component").Component);t.Slot=n.specialize({hasTemplate:{enumerable:!1,value:!1},constructor:{value:function(){this.super(),this.content=null}},delegate:{value:null},_content:{value:null},enterDocument:{value:function(e){e&&this.element.classList.add("montage-Slot")}},content:{get:function(){return this._content},set:function(e){var t,i;e&&void 0!==e.needsDraw?(i=this._content,i&&void 0!==i.needsDraw&&i.detachFromParentComponent(),e.element?t=e.element:(t=document.createElement("div"),t.id="appendDiv",this.delegate&&"function"==typeof this.delegate.slotElementForComponent&&(t=this.delegate.slotElementForComponent(this,e,t)),e.element=t),Object.getPropertyDescriptor(n,"domContent").set.call(this,t),this.addChildComponent(e),e.needsDraw=!0):Object.getPropertyDescriptor(n,"domContent").set.call(this,e),this._content=e,this.needsDraw=!0}},contentDidChange:{value:function(e,t){this.delegate&&"function"==typeof this.delegate.slotDidSwitchContent&&this.delegate.slotDidSwitchContent(this,e,e?e.component:null,t,t?t.component:null)}}})}}),montageDefine("b15df60","core/target",{dependencies:["./core","./event/event-manager","./event/mutable-event"],factory:function(e,t){var n=e("./core").Montage,i=e("./event/event-manager").defaultEventManager,r=e("./event/mutable-event").MutableEvent;t.Target=n.specialize({constructor:{value:function(){this.super()}},acceptsActiveTarget:{serializable:!1,value:!1},isActiveTarget:{get:function(){return this===i.activeTarget}},willBecomeActiveTarget:{value:Function.noop},didBecomeActiveTarget:{value:Function.noop},surrendersActiveTarget:{value:function(){return!0}},nextTarget:{serializable:!1,value:null},dispatchEvent:{value:function(e){var t=e;return e instanceof r||(t=r.fromEvent(t)),t.target=this,i.handleEvent(t),!e.defaultPrevented}},dispatchEventNamed:{value:function(e,t,n,a){var s=r.fromType(e,t,n,a);return s.target=this,i.handleEvent(s),!s.defaultPrevented}},addEventListener:{value:function(e,t,n){t&&i.registerEventListener(this,e,t,n)}},removeEventListener:{value:function(e,t,n){t&&i.unregisterEventListener(this,e,t,n)}}})}}),montageDefine("b15df60","core/template",{dependencies:["./core","./serialization","./document-part","./document-resources","./serialization/serialization","./serialization/serializer/montage-labeler","./promise","./mini-url","./logger","./event/event-manager","./application"],factory:function(e,t){function n(e,t,n){var i,r,a=new d,o=e.documentElement.outerHTML,l=new s,c=e.documentElement;return i=a.createHtmlDocumentWithHtml(o,e.location.href),a.initWithDocument(i,t).then(function(){return a.setBaseUrl(e.location.href),r=a._createTemplateObjects(n),l.initWithTemplateAndFragment(a),a._instantiateObjects(r,c).then(function(e){return l.objects=e,a._invokeDelegates(l),l})})}var i,r=e("./core").Montage,a=e("./serialization").Deserializer,s=e("./document-part").DocumentPart,o=e("./document-resources").DocumentResources,l=e("./serialization/serialization").Serialization,c=e("./serialization/serializer/montage-labeler").MontageLabeler,u=e("./promise").Promise,h=e("./mini-url");e("./logger").logger("template"),e("./event/event-manager").defaultEventManager;var d=r.specialize({_SERIALIZATON_SCRIPT_TYPE:{value:"text/montage-serialization"},_ELEMENT_ID_ATTRIBUTE:{value:"data-montage-id"},PARAM_ATTRIBUTE:{value:"data-param"},_require:{value:null},_resources:{value:null},_baseUrl:{value:null},_instances:{value:null},_metadata:{value:null},_objectsString:{value:null},objectsString:{get:function(){return this._objectsString},set:function(e){this._objectsString=e,this._serialization&&this._serialization.initWithString(e),this.__deserializer=null}},__deserializer:{value:null},_deserializer:{get:function(){var e,t,n=this.__deserializer;if(!n){if(e=this._metadata){t=Object.create(null);for(var i in e)t[i]=e[i].require}n=(new a).init(this.objectsString,this._require,t),this.__deserializer=n}return n}},getDeserializer:{value:function(){return this._deserializer}},_serialization:{value:null},getSerialization:{value:function(){var e=this._serialization;return e||(e=this._serialization=new l,e.initWithString(this.objectsString)),e}},_isDirty:{value:!1},isDirty:{get:function(){return this._isDirty},set:function(e){this._isDirty!==e&&(this._isDirty=e,this.clearTemplateFromElementContentsCache())}},refresher:{value:null},_document:{value:null},document:{get:function(){return this._isDirty&&this.refresh(),this._document},set:function(e){this._document=e}},constructor:{value:function d(){this.super()}},initWithRequire:{value:function(e){return this._require=e,this.document=this.createHtmlDocumentWithHtml(""),this.objectsString="",this}},initWithDocument:{value:function(e,t){var n=this;return this._require=t,this.setDocument(e),this.getObjectsString(e).then(function(e){return n.objectsString=e,n})}},initWithHtml:{value:function(e,t){var n=this;return this._require=t,this.document=this.createHtmlDocumentWithHtml(e),this.getObjectsString(this.document).then(function(e){return n.objectsString=e,n})}},initWithObjectsAndDocumentFragment:{value:function(e,t,n){return this._require=n,this.document=this.createHtmlDocumentWithHtml(""),this.document.body.appendChild(this.document.importNode(t,!0)),this.setObjects(e),this}},initWithModuleId:{value:function(e,t){var n=this;return this._require=t,this.createHtmlDocumentWithModuleId(e,t).then(function(i){var r=t(e).directory;return n.document=i,n.setBaseUrl(r),n.getObjectsString(i).then(function(e){return n.objectsString=e,n})})}},clone:{value:function(){var e=new d;return e._require=this._require,e._baseUrl=this._baseUrl,e.setDocument(this.document),e.objectsString=this.objectsString,e._instances=Object.clone(this._instances,1),e}},instantiate:{value:function(e){return this.instantiateWithInstances(null,e)}},instantiateWithInstances:{value:function(e,t){var n,i,r,a=this,o=new s;return e=e||this._instances,n=this._createMarkupDocumentFragment(t),r=this._getParameters(n),o.initWithTemplateAndFragment(this,n),o.startActingAsTopComponent(),o.parameters=r,i=this._createTemplateObjects(e),this._instantiateObjects(i,n).then(function(n){var i;return o.objects=n,a._invokeDelegates(o,e),o.stopActingAsTopComponent(),i=a.getResources(),!i.resourcesLoaded()&&i.hasResources()&&i.loadResources(t).done(),o})}},_objectsInstantiationOptimized:{value:!1},_optimizeObjectsInstantiationPromise:{value:null},_optimizeObjectsInstantiation:{value:function(){var e,t=this;return this._objectsInstantiationOptimized?void 0:(this._optimizeObjectsInstantiationPromise||(e=this._deserializer.preloadModules(),e?this._optimizeObjectsInstantiationPromise=e.then(function(){t._objectsInstantiationOptimized=!0}):this._objectsInstantiationOptimized=!0),this._optimizeObjectsInstantiationPromise)}},setBaseUrl:{value:function(e){this._baseUrl=e}},getBaseUrl:{value:function(){return this._baseUrl}},getResources:{value:function(){var e=this._resources;return e||(e=this._resources=new p,e.initWithTemplate(this)),e}},_createTemplateObjects:{value:function(t){var n=Object.create(t||null);return void 0===i&&(i=e("./application").application),n.application=i,n.template=this,n}},_instantiateObjects:{value:function(e,t){var n,i=this._deserializer;return n=this._optimizeObjectsInstantiation(),n?n.then(function(){return i.deserialize(e,t)}):i.deserialize(e,t)}},_createMarkupDocumentFragment:{value:function(e){for(var t=e.createDocumentFragment(),n=this.document.body.childNodes,i=0,r=n.length;r>i;i++)t.appendChild(e.importNode(n[i],!0));return t}},getParameterName:{value:function(e){return e.getAttribute(this.PARAM_ATTRIBUTE)}},getParameters:{value:function(){return this._getParameters(this.document.body)}},_getParameters:{value:function(e){for(var t,n=e.querySelectorAll("*["+this.PARAM_ATTRIBUTE+"]"),i=n.length,r={},a=0;i>a;a++){t=n[a];var s=this.getParameterName(t);if(s in r)throw Error('The parameter "'+s+'" is'+" declared more than once in "+this.getBaseUrl()+".");r[s]=t}if("*"in r&&i>1)throw Error('The star "*" template parameter was declared when other parameters were also present in '+this.getBaseUrl()+": "+Object.keys(r)+".");return r}},hasParameters:{value:function(){return!!this.document.querySelector("*["+this.PARAM_ATTRIBUTE+"]")}},_invokeDelegates:{value:function(e,t){var n,i,r,a=e.objects,s=a.owner||t&&t.owner;for(var o in a)t&&o in t||(n=a[o],i=this._getObjectOwner(o,s),r=this._getObjectLabel(o),n&&("function"==typeof n._deserializedFromTemplate&&n._deserializedFromTemplate(i,r,e),"function"==typeof n.deserializedFromTemplate&&n.deserializedFromTemplate(i,r,e)));if(s){var l=this.getSerialization();l.isExternalObject("owner")||("function"==typeof s._templateDidLoad&&s._templateDidLoad(e),"function"==typeof s.templateDidLoad&&s.templateDidLoad(e))}}},setInstances:{value:function(e){this._instances=e}},getInstances:{value:function(){return this._instances}},setObjects:{value:function(e){this.objectsString=JSON.stringify(e,null,4)}},setObjectMetadata:{value:function(e,t,n,i){var r=this._metadata;r||(this._metadata=r=Object.create(null)),r[e]={require:t,label:n,owner:i},this.__deserializer=null}},getObjectMetadata:{value:function(e){var t=this._metadata;return t&&e in t?t[e]:{require:this._require,label:e}}},_getObjectOwner:{value:function(e,t){var n,i=this._metadata;return n=i&&e in i?i[e].owner:t}},_getObjectLabel:{value:function(e){var t,n=this._metadata;return t=n&&e in n?n[e].label:e}},setDocument:{value:function(e){var t=e.documentElement.innerHTML;this.document=this.createHtmlDocumentWithHtml(t,e.baseURI),this.clearTemplateFromElementContentsCache()}},getObjectsString:{value:function(e){var t;return t=this.getInlineObjectsString(e),null===t?this.getExternalObjectsString(e):u.resolve(t)}},getInlineObjectsString:{value:function(e){var t="script[type='"+this._SERIALIZATON_SCRIPT_TYPE+"']",n=e.querySelector(t);return n?n.textContent:null}},getExternalObjectsString:{value:function(e){var t,n,i,r=e.querySelector('link[rel="serialization"]');return r?(t=new XMLHttpRequest,n=r.getAttribute("href"),i=u.defer(),t.open("GET",n),t.addEventListener("load",function(){200==t.status?i.resolve(t.responseText):i.reject(Error("Unable to retrive '"+n+"', code status: "+t.status))},!1),t.addEventListener("error",function(e){i.reject(Error("Unable to retrive '"+n+"' with error: "+e.error+"."))},!1),t.send(),i.promise):u.resolve(null)}},createHtmlDocumentWithHtml:{value:function(e,t){var n=document.implementation.createHTMLDocument("");return n.documentElement.innerHTML=e,this.normalizeRelativeUrls(n,t),n}},createHtmlDocumentWithModuleId:{value:function(e,t){var n=this;return"function"!=typeof t?u.reject(Error("Missing 'require' function to load module '"+e+"'.")):t.async(e).then(function(e){return n.createHtmlDocumentWithHtml(e.content,e.directory)})}},_removeObjects:{value:function(e){var t="script[type='"+this._SERIALIZATON_SCRIPT_TYPE+"'], link[rel='serialization']";Array.prototype.forEach.call(e.querySelectorAll(t),function(e){e.parentNode.removeChild(e)})}},_addObjects:{value:function(e,t){if(t){var n=e.createElement("script");n.setAttribute("type",this._SERIALIZATON_SCRIPT_TYPE),n.textContent=JSON.stringify(JSON.parse(t),null,4),e.head.appendChild(n)}}},_templateFromElementContentsCache:{value:null},clearTemplateFromElementContentsCache:{value:function(){this._templateFromElementContentsCache=null}},createTemplateFromElementContents:{value:function(e){var t,n,i,r=this._templateFromElementContentsCache;return r||(r=Object.create(null),this._templateFromElementContentsCache=r),e in r?Object.create(r[e]):(t=this.getElementById(e),i=this.document.createRange(),i.selectNodeContents(t),n=this.createTemplateFromRange(i),r[e]=n,Object.create(n))}},createTemplateFromElement:{value:function(e){var t,n;return t=this.getElementById(e),n=this.document.createRange(),n.selectNode(t),this.createTemplateFromRange(n)}},createTemplateFromRange:{value:function(e){var t,n,i,r,a,s=new l;return t=e.cloneContents(),n=this._getChildrenElementIds(t),s.initWithString(this.objectsString),i=s.getSerializationLabelsWithElements(n),a=s.extractSerialization(i,["owner"]),r=new d,r.initWithObjectsAndDocumentFragment(null,t,this._require),r.objectsString=a.getSerializationString(),r._resources=this.getResources(),r}},_createSerializationWithElementIds:{value:function(e){var t,n,i=new l;return i.initWithString(this.objectsString),t=i.getSerializationLabelsWithElements(e),n=i.extractSerialization(t,["owner"])}},expandParameters:{value:function(e){var t,n,i,r,a,s,o,l=[],c={},u=this.getSerialization(),h={};t=this.getParameters();for(var d in t)if(r=t[d],a=e.getTemplateArgumentElement(d),l.push.apply(l,this._getElementIds(a)),n=this.replaceNode(a,r))for(var p in n)c[p]=n[p];return h.elementIds=l,h.elementIdsCollisions=c,s=e.getTemplateArgumentSerialization(l),s.renameElementReferences(c),o=function(t){return t.indexOf(":")>0?e.resolveTemplateArgumentTemplateProperty(t):void 0},i=u.mergeSerialization(s,{willMergeObjectWithLabel:o}),this.objectsString=u.getSerializationString(),h.labels=s.getSerializationLabels(),h.labelsCollisions=i,h}},_resolveElementIdCollisions:{value:function(e,t){var n,i,r,a,s;t=t||new c,r=this.getElementIds();for(var o,l=0;o=r[l];l++)t.addLabel(o);i=this._getElements(e);for(var o in i)this.getElementById(o)&&(a=i[o],s=t.generateLabel(t.getLabelBaseName(o)),this.setElementId(a,s),n||(n=Object.create(null)),n[o]=s);return n}},replaceNode:{value:function(e,t,n){var i;return i=this._resolveElementIdCollisions(e,n),this.normalizeRelativeUrls(e,this.getBaseUrl()),t.parentNode.replaceChild(e,t),i}},insertNodeBefore:{value:function(e,t,n){var i;return i=this._resolveElementIdCollisions(e,n),this.normalizeRelativeUrls(e,this.getBaseUrl()),t.parentNode.insertBefore(e,t),i}},appendNode:{value:function(e,t,n){var i;return i=this._resolveElementIdCollisions(e,n),this.normalizeRelativeUrls(e,this.getBaseUrl()),t.appendChild(e),i
}},getElementId:{value:function(e){return e.getAttribute?e.getAttribute(this._ELEMENT_ID_ATTRIBUTE):void 0}},setElementId:{value:function(e,t){e.setAttribute(this._ELEMENT_ID_ATTRIBUTE,t)}},getElementIds:{value:function(){return this._getElementIds(this.document.body)}},_getElements:{value:function(e){var t,n,i="*["+this._ELEMENT_ID_ATTRIBUTE+"]",r={};t=e.querySelectorAll(i);for(var a,s=0;a=t[s];s++)n=this.getElementId(a),r[n]=a;return n=this.getElementId(e),n&&(r[n]=e),r}},_getChildrenElementIds:{value:function(e){var t,n="*["+this._ELEMENT_ID_ATTRIBUTE+"]",i=[];t=e.querySelectorAll(n);for(var r,a=0;r=t[a];a++)i.push(this.getElementId(r));return i}},_getElementIds:{value:function(e){var t,n=this._getChildrenElementIds(e);return t=this.getElementId(e),t&&n.push(t),n}},getElementById:{value:function(e){var t="*["+this._ELEMENT_ID_ATTRIBUTE+"='"+e+"']";return this.document.querySelector(t)}},html:{get:function(){var e=this.document;return this._removeObjects(e),this._addObjects(e,this.objectsString),this._getDoctypeString(e.doctype)+"\n"+e.documentElement.outerHTML}},_getDoctypeString:{value:function(e){return"<!DOCTYPE "+e.name+(e.publicId?' PUBLIC "'+e.publicId+'"':"")+(!e.publicId&&e.systemId?" SYSTEM":"")+(e.systemId?' "'+e.systemId+'"':"")+">"}},normalizeRelativeUrls:{value:function(e,t){if("string"==typeof t&&""!==t&&"about:blank"!==t)for(var n="http://www.w3.org/1999/xlink",i=/^[\w\-]+:|^\//,r=-1!==d._NORMALIZED_TAG_NAMES.indexOf(e.tagName)?[e]:e.querySelectorAll(d._NORMALIZED_TAG_NAMES_SELECTOR),a=0,s=r.length;s>a;a++){var o,l=r[a];"image"===l.tagName?(o=l.getAttributeNS(n,"href"),i.test(o)||l.setAttributeNS(n,"href",h.resolve(t,o))):l.hasAttribute("src")?(o=l.getAttribute("src"),""===o||i.test(o)||l.setAttribute("src",h.resolve(t,o))):l.hasAttribute("href")&&(o=l.getAttribute("href"),""===o||i.test(o)||l.setAttribute("href",h.resolve(t,o)))}}},replaceContentsWithTemplate:{value:function(e){this._require=e._require,this._baseUrl=e._baseUrl,this._document=e._document,this.objectsString=e.objectsString,this._instances=e._instances,this._templateFromElementContentsCache=e._templateFromElementContentsCache,this._metadata=e._metadata}},refresh:{value:function(){this.isDirty&&(this.refresher&&"function"==typeof this.refresher.refreshTemplate?(this.refresher.refreshTemplate(this),this.isDirty=!1):console.warn("Not able to refresh without a refresher.refreshTemplate."))}}},{_templateCache:{value:{moduleId:Object.create(null)}},_getTemplateCacheKey:{value:function(e,t){return e=t.resolve(e),t.location+"#"+e}},getTemplateWithModuleId:{value:function(e,t){var n,i;return n=this._getTemplateCacheKey(e,t),i=this._templateCache.moduleId[n],i||(i=(new d).initWithModuleId(e,t),this._templateCache.moduleId[n]=i),i}},_NORMALIZED_TAG_NAMES:{value:["IMG","image","IFRAME","link"]},__NORMALIZED_TAG_NAMES_SELECTOR:{value:null},_NORMALIZED_TAG_NAMES_SELECTOR:{get:function(){return this.__NORMALIZED_TAG_NAMES_SELECTOR||(this.__NORMALIZED_TAG_NAMES_SELECTOR=this._NORMALIZED_TAG_NAMES.join(",")),this.__NORMALIZED_TAG_NAMES_SELECTOR}}}),p=r.specialize({_resources:{value:null},_resourcesLoaded:{value:!1},template:{value:null},rootUrl:{value:""},constructor:{value:function p(){this._resources=Object.create(null)}},initWithTemplate:{value:function(e){this.template=e}},hasResources:{value:function(){return this.getStyles().length>0||this.getScripts().length>0}},resourcesLoaded:{value:function(){return this._resourcesLoaded}},loadResources:{value:function(e){return this._resourcesLoaded=!0,u.all([this.loadScripts(e),this.loadStyles(e)])}},getScripts:{value:function(){var e,t,n,i=this._resources.scripts;if(!i){t=this.template,i=this._resources.scripts=[],n=t.document.querySelectorAll("script");for(var r=0,a=n.length;a>r;r++)e=n[r],e.type!==this.template._SERIALIZATON_SCRIPT_TYPE&&i.push(e)}return i}},loadScripts:{value:function(e){var t,n=[];t=this.getScripts();for(var i=0,r=t.length;r>i;i++)n.push(this.loadScript(t[i],e));return u.all(n)}},loadScript:{value:function(e,t){var n,i;return n=o.getInstanceForDocument(t),i=this._cloneScriptElement(e,t),n.addScript(i)}},_cloneScriptElement:{value:function(e,t){for(var n,i=t.createElement("script"),r=e.attributes,a=0,s=r.length;s>a;a++)n=r[a],i.setAttribute(n.name,n.value);return i}},getStyles:{value:function(){var e,t,n,i=this._resources.styles;return i||(n='link[rel="stylesheet"], style',e=this.template,t=e.document.querySelectorAll(n),i=Array.prototype.slice.call(t,0),this._resources.styles=i),i}},loadStyles:{value:function(e){var t,n=[];t=this.getStyles();for(var i=0,r=t.length;r>i;i++)n.push(this.loadStyle(t[i],e));return u.all(n)}},loadStyle:{value:function(e,t){var n,i;return n=e.getAttribute("href"),n?(i=o.getInstanceForDocument(t),i.preloadResource(n)):u.resolve()}},createStylesForDocument:{value:function(e){for(var t,n,i=this.getStyles(),r=[],a=0;n=i[a];a++)t=e.importNode(n,!0),r.push(t);return r}}}),f=r.specialize({getTemplateArgumentElement:{value:function(){}},getTemplateArgumentSerialization:{value:function(){}},resolveTemplateArgumentTemplateProperty:{value:function(){}}});t.Template=d,t.TemplateArgumentProvider=f,t.TemplateResources=p,t.instantiateDocument=n}}),montageDefine("b15df60","core/document-resources",{dependencies:["./core","./promise","./mini-url"],factory:function(e,t){var n=e("./core").Montage,i=e("./promise").Promise,r=e("./mini-url"),a=n.specialize({_SCRIPT_TIMEOUT:{value:5e3},_document:{value:null},_resources:{value:null},_preloaded:{value:null},_expectedStyles:{value:null},constructor:{value:function a(){this.super(),this._expectedStyles=[]}},initWithDocument:{value:function(e){return this.clear(),this._document=e,this._populateWithDocument(e),this}},_populateWithDocument:{value:function(e){var t=e.querySelectorAll("script"),n=Array.prototype.forEach;n.call(t,function(e){e.src&&this._addResource(this.normalizeUrl(e.src))},this);var i=e.querySelectorAll("link");n.call(i,function(e){"stylesheet"===e.rel&&this._addResource(this.normalizeUrl(e.href))},this)}},clear:{value:function(){this._resources=Object.create(null),this._preloaded=Object.create(null)}},_addResource:{value:function(e){this._resources[e]=!0}},hasResource:{value:function(e){return e in this._resources}},isResourcePreloaded:{value:function(e){return this._preloaded[e]===!0}},isResourcePreloading:{value:function(e){return i.isPromise(this._preloaded[e])}},setResourcePreloadedPromise:{value:function(e,t){this._preloaded[e]=t}},setResourcePreloaded:{value:function(e){this._preloaded[e]=!0}},getResourcePreloadedPromise:{value:function(e){return this._preloaded[e]}},addScript:{value:function(e){var t=this.normalizeUrl(e.src);return t?this.isResourcePreloaded(t)?i.resolve():this.isResourcePreloading(t)?this.getResourcePreloadedPromise(t):this._importScript(e):this._importScript(e)}},_importScript:{value:function(e){var t,n,r=this,a=this._document,s=a.head,o=i.defer(),l=e.src;return l?(r._addResource(l),t=function(){r.setResourcePreloaded(l),e.removeEventListener("load",t),e.removeEventListener("error",t),clearTimeout(n),o.resolve()},e.addEventListener("load",t,!1),e.addEventListener("error",t,!1),n=setTimeout(function(){r.setResourcePreloaded(l),o.resolve()},this._SCRIPT_TIMEOUT),this.setResourcePreloadedPromise(l,o.promise)):o.resolve(),s.appendChild(a.createComment("Inserted from FIXME")),s.appendChild(e),o.promise}},addStyle:{value:function(e){var t,n=e.getAttribute("href");if(n){if(n=this.normalizeUrl(n),this.hasResource(n))return;this._addResource(n),this._expectedStyles.push(n)}t=this._document.head,t.insertBefore(e,t.firstChild)}},normalizeUrl:{value:function(e,t){return t||(t=this._document.location.href),r.resolve(t,e)}},domain:{value:window.location.protocol+"//"+window.location.host},isCrossDomain:{value:function(e){return 0!==e.indexOf(this.domain+"/")||0===e.indexOf("file://")}},preloadResource:{value:function(e,t){var n;return e=this.normalizeUrl(e),!t&&this.isCrossDomain(e)&&(n=!0),n||this.isResourcePreloaded(e)?i.resolve():this.isResourcePreloading(e)?this.getResourcePreloadedPromise(e):this._preloadResource(e)}},_preloadResource:{value:function(e){var t,n,r=this,a=new XMLHttpRequest,s=i.defer();return a.open("GET",e),t=function(){r.setResourcePreloaded(e),a.removeEventListener("load",t),a.removeEventListener("error",t),clearTimeout(n),s.resolve()},a.addEventListener("load",t,!1),a.addEventListener("error",t,!1),a.send(),n=setTimeout(function(){r.setResourcePreloaded(e),s.resolve()},this._SCRIPT_TIMEOUT),this.setResourcePreloadedPromise(e,s.promise),s.promise}},areStylesLoaded:{get:function(){var e,t;if(this._expectedStyles.length>0){e=this._document.styleSheets;for(var n,i=0;n=e[i];i++)t=this._expectedStyles.indexOf(n.href),t>=0&&this._expectedStyles.splice(t,1)}return 0===this._expectedStyles.length}}},{getInstanceForDocument:{value:function(e){var t=e.__montage_resources__;return t||(t=e.__montage_resources__=(new a).initWithDocument(e)),t}}});t.DocumentResources=a}}),montageDefine("b15df60","core/gate",{dependencies:["./core","./logger"],factory:function(e,t){var n=e("./core").Montage,i=e("./logger").logger("gate");t.Gate=n.specialize({constructor:{value:function(){this.super()}},init:{enumerable:!1,value:function(){return this.reset(),this}},initWithDelegate:{enumerable:!1,value:function(e){return this.reset(),this.delegate=e,this}},initWithDescriptor:{enumerable:!1,value:function(e){var t;this.reset();for(t in e)this.setField(t,e[t].value);return this}},count:{value:0},table:{value:null},getField:{enumerable:!1,value:function(e){var t=this.table;return!t||t[e]}},setField:{enumerable:!1,value:function(e,t){var n,r=this.table,a=this.count;r=r?r:this.table={},n=r[e],void 0!==n||t?void 0!==n&&n!==t?t?this.count--:this.count++:t&&i.isDebug&&i.debug(this,e+" was not set before."):this.count++,r[e]=!!t,0===this.count&&a>0?this.callDelegateMethod(!0):0===a&&this.count>0&&this.callDelegateMethod(!1)}},removeField:{enumerable:!1,value:function(e){var t=this.table,n=t[e];void 0===n||n||this.count--,delete t[e]}},delegate:{enumerable:!1,value:null},callDelegateMethod:{value:function(e){var t;this.delegate&&"function"==typeof(t=this.delegate["gateDidBecome"+(e?"True":"False")])&&t.call(this.delegate,this)},enumerable:!1},value:{enumerable:!1,get:function(){return 0===this.count}},reset:{enumerable:!1,value:function(){this.table={},this.count=0}},toString:{value:function(){var e,t,n=this._fields,i="";for(e=0;t=n[e];e++)i+=t+"["+(this._value&n[t])+"], ";return i}}})}}),montageDefine("b15df60","core/application",{dependencies:["./core","./target","../window-loader/montage-window","./dom","./template"],factory:function(e,t){var n,i=(e("./core").Montage,e("./target").Target),r=e("../window-loader/montage-window").MontageWindow;e("./dom"),t.Application=i.specialize({eventManager:{value:null},parentApplication:{value:null},mainApplication:{get:function(){for(var e=this;e.parentApplication;)e=e.parentApplication;return e}},_windowsSortOrder:{value:"reverse-z-order"},windowsSortOrder:{get:function(){return null==this.parentApplication?this._windowsSortOrder:this.mainApplication.windowsSortOrder},set:function(e){null==this.parentApplication?-1!==["z-order","reverse-z-order","z-order","reverse-open-order"].indexOf(e)&&(this._windowsSortOrder=e):this.mainApplication.windowsSortOrder=e}},windows:{get:function(){var e;if(null==this.parentApplication){if(!this._windows){var e=new r;e.application=this,e.window=window,this.window=e,this._windows=[this.window],this._multipleWindow=!0}return this._windows}return this.mainApplication.windows}},_window:{value:null},window:{get:function(){if(!this._window&&this==this.mainApplication){var e=new r;e.application=this,e.window=window,this._window=e}return this._window},set:function(e){this._window||(this._window=e)}},attachedWindows:{value:[]},eventManagerForWindow:{value:function(e){return e.defaultEventMananger}},focusWindow:{get:function(){var e=this.windows,t=this.windowsSortOrder;if("z-order"==t)return e[0];if("reverse-z-order"==t)return e[e.length-1];for(var n in e)if(e[n].focused)return e[n]}},delegate:{value:null},nextTarget:{get:function(){return this.delegate}},openWindow:{value:function(e,t,n){var i,a,s=this,o=new r,l={location:!1,menubar:!1,resizable:!0,scrollbars:!0,status:!1,titlebar:!0,toolbar:!1},c={module:e,name:t,parent:window,callback:function(e,t){var n;i=e.document.application,o.window=e,o.application=i,o.component=t,i.window=o,s.attachedWindows.push(o),n=s.mainApplication.windowsSortOrder,"z-order"==n||"reverse-open-order"==n?s.windows.unshift(o):s.windows.push(o),a=document.createEvent("CustomEvent"),a.initCustomEvent("load",!0,!0,null),o.dispatchEvent(a)}};if(this!==this.mainApplication||this._multipleWindow||this.window,"object"==typeof n){var u,h,d="",p="";for(u in n)n.hasOwnProperty(u)&&(l[u]=n[u])}var f=["name"];for(u in l)-1==f.indexOf(u)&&(h=l[u],"boolean"==typeof h?h=h?"yes":"no":(h+="",h.match(/[ ,"]/)&&(h='"'+h.replace(/"/g,'\\"')+'"')),p+=d+u+"="+h,d=",");return window.require.loadPackage({name:"montage"}).then(function(e){var t=window.open(e.location+"window-loader/index.html","_blank",p);t.loadInfo=c}).done(),o}},attachWindow:{value:function(e){var t,n=e.application.parentApplication;return n!==this&&(n&&n.detachWindow(e),e.parentApplication=this,this.attachedWindows.push(e),t=this.mainApplication.windowsSortOrder,"z-order"==t||"reverse-open-order"==t?this.windows.unshift(e):this.windows.push(e),e.focus()),e}},detachWindow:{value:function(e){var t,n,i=this.windows;return void 0===e&&(e=this.window),n=e.application.parentApplication,n==this?(t=this.attachedWindows.indexOf(e),-1!==t&&this.attachedWindows.splice(t,1),t=i.indexOf(e),-1!==t&&i.splice(t,1),e.application.parentApplication=null):n&&n.detachWindow(e),e}},constructor:{value:function(){window.loadInfo&&!this.parentApplication&&(this.parentApplication=window.loadInfo.parent.document.application)}},_load:{value:function(n,i){var r,a=this;t.application=a,e.async("ui/component").then(function(t){return r=t.__root__,r.element=document,e("./template").instantiateDocument(window.document,n).then(function(){a.callDelegateMethod("willFinishLoading",a),r.needsDraw=!0,i&&i(a)})}).done()}},_alertPopup:{value:null,enumerable:!1},_confirmPopup:{value:null,enumerable:!1},_notifyPopup:{value:null,enumerable:!1},_zIndex:{value:null},_isSystemPopup:{value:function(e){return"alert"===e||"confirm"===e||"notify"===e}},_createPopupSlot:{value:function(e){var t=document.createElement("div");document.body.appendChild(t),t.style.zIndex=e,t.style.position="absolute";var i=new n;return i.element=t,i.attachToParentComponent(),i}},getPopupSlot:{value:function(t,i,r){var a=this;e.async("ui/slot.reel/slot").then(function(e){n=n||e.Slot,t=t||"custom";var s,o,l=a._isSystemPopup(t);if(a.popupSlots=a.popupSlots||{},l)switch(t){case"alert":s=9004;break;case"confirm":s=9003;break;case"notify":s=9002}else a._zIndex=a._zIndex?a._zIndex+1:7e3,s=a._zIndex;o=a.popupSlots[t],o||(o=a.popupSlots[t]=a._createPopupSlot(s)),l||(o.element.style.zIndex=s),o.content=i,r.call(this,o)}).done()}},returnPopupSlot:{value:function(e){var t=this;if(t.popupSlots&&t.popupSlots[e]){var n=t.popupSlots[e];n.content=null}}},_getActivePopupSlots:{value:function(){var e=[];if(this.popupSlots){var t=Object.keys(this.popupSlots);if(t&&t.length>0){var n,i=0,r=t.length;for(i=0;r>i;i++)n=this.popupSlots[t[i]],n&&null!==n.content&&e.push(n)}}return e}}})}}),montageDefine("b15df60","core/document-part",{dependencies:["./core","./logger","./promise","./event/event-manager"],factory:function(e,t){var n=e("./core").Montage,i=(e("./logger").logger("document-part"),e("./promise").Promise),r=e("./event/event-manager").defaultEventManager,a=n.specialize({parentDocumentPart:{value:null},template:{value:null},fragment:{value:null},objects:{value:null},childComponents:{value:null},parameters:{value:null},constructor:{value:function a(){this.super()}},initWithTemplateAndFragment:{value:function(e,t){this.template=e,this.fragment=t,this.objects=null,this.childComponents=[],this.parameters=null}},startActingAsTopComponent:{value:function(){this.fragment&&r.registerEventHandlerForElement(this,this.fragment)}},stopActingAsTopComponent:{value:function(){this.fragment&&r.unregisterEventHandlerForElement(this.fragment)}},addChildComponent:{value:function(e){-1==this.childComponents.indexOf(e)&&this.childComponents.push(e)}},removeChildComponent:{value:function(e){var t=this.childComponents,n=t.indexOf(e);n>-1&&(t.splice(n,1),e._parentComponent=null,e._alternateParentComponent=null)}},_addToDrawList:{value:function(){}},_componentTreeLoadedDeferred:{value:null},loadComponentTree:{value:function(){var e,t=this._componentTreeLoadedDeferred;return t||(t=i.defer(),this._componentTreeLoadedDeferred=t,e=[],this.childComponents.forEach(function(t){e.push(t.loadComponentTree())}),i.all(e).then(function(){t.resolve()},t.reject).done()),t.promise}}});t.DocumentPart=a}}),montageDefine("b15df60","core/serialization/serialization",{dependencies:["../core","./serializer/montage-labeler","./deserializer/montage-reviver","frb/parse","frb/stringify"],factory:function(e,t){var n=e("../core").Montage,i=e("./serializer/montage-labeler").MontageLabeler,r=e("./deserializer/montage-reviver").MontageReviver,a=e("frb/parse"),s=e("frb/stringify"),o=n.specialize({_serializationString:{value:null},_serializationObject:{value:null},_serializationLabels:{value:null},initWithString:{value:function(e){return this._serializationString=e,this._serializationObject=null,this._serializationLabels=null,this}},initWithObject:{value:function(e){return this._serializationString=null,this._serializationObject=e,this._serializationLabels=null,this}},clone:{value:function(){var e=new o;return e.initWithString(this.getSerializationString()),e}},getSerializationObject:{value:function(){return this._serializationObject||(this._serializationObject=JSON.parse(this._serializationString)),this._serializationObject}},getSerializationString:{value:function(){return this._serializationString||(this._serializationString=JSON.stringify(this._serializationObject)),this._serializationString}},getSerializationLabels:{value:function(){return this._serializationLabels||(this._serializationLabels=Object.keys(this.getSerializationObject())),this._serializationLabels}},getExternalObjectLabels:{value:function(){var e=this.getSerializationObject(),t=[];for(var n in e)0===Object.keys(e[n]).length&&t.push(n);return t}},hasSerializationLabel:{value:function(e){return e in this.getSerializationObject()}},isExternalObject:{value:function(e){var t=this.getSerializationObject();return t&&e in t?0===Object.keys(t[e]).length:!1}},isAlias:{value:function(e){var t=this.getSerializationObject();return t&&e in t?"alias"in t[e]:!1}},getElementId:{value:function(e){var t=this.getSerializationObject(),i=n.getPath.call(t,e+".properties.element");return i?i["#"]:void 0}},getSerializationLabelsWithElements:{value:function(e){var t=new c,n=[];return t.initWithSerialization(this),t.visitSerialization(function(t){"Element"===t.type&&e.indexOf(t.data)>=0&&(t=t.parent,t&&"properties"===t.name&&(t=t.parent,t&&"montageObject"===t.type&&n.push(t.label)))}),n}},renameElementReferences:{value:function(e){var t=new c;t.initWithSerialization(this),t.visitSerialization(function(t){"Element"===t.type&&t.data in e&&(t.data=e[t.data])})}},renameSerializationLabels:{value:function(e){var t=new c;t.initWithSerialization(this),t.visitSerialization(function(t){if(t.label){var n=t.label;n in e&&(t.label=e[n])}if("reference"===t.type){var i=t.data;i in e&&(t.data=e[i])}})}},mergeSerialization:{value:function(e,t){return l.mergeSerializations(this,e,t)}},extractSerialization:{value:function(e,t){var n=new u;return n.initWithSerialization(this),n.extractSerialization(e,t)}}}),l=n.specialize(null,{mergeSerializations:{value:function(e,t,n){var i,r,a,s,o,l,c={};a=e.getSerializationLabels(),s=t.getSerializationLabels(),o=this._createCollisionTable(a,s,c,n&&n.labeler),n&&n.willMergeObjectWithLabel&&(l=this._willMergeObjectWithLabel(n,e,t,c),o=o||l),o&&(t=t.clone(),t.renameSerializationLabels(c),s=t.getSerializationLabels()),i=e.getSerializationObject(),r=t.getSerializationObject();for(var u,h=0;u=s[h];h++)-1===a.indexOf(u)&&(i[u]=r[u]);return e.initWithObject(i),c}},_willMergeObjectWithLabel:{value:function(e,t,n,i){var r,a,s,o,l,c=!1,u=n.getSerializationLabels();i&&(s=[],Object.keys(i).forEach(function(e){s.push(i[e])}));for(var h,d=0;h=u[d];d++)if(a=i&&i[h],r=e.willMergeObjectWithLabel(h,a),"string"==typeof r){if(o=this._isLabelValidInSerialization(r,t),o||(l=!this._isLabelValidInSerialization(r,n)&&-1===s.indexOf(r)),!o&&!l)throw Error("willMergeObjectWithLabel either needs to return a label that exists in the destination serialization to indicate it's the same object or return a completely new label to rename the object being merged. \""+r+'"  destination: '+t.getSerializationString()+"\n source: "+n.getSerializationString()+"\n collision table: "+JSON.stringify(i,null,4));c=!0,i[h]=r}return c}},_isLabelValidInSerialization:{value:function(e,t){var n,i;return t.hasSerializationLabel(e)?!0:(i=e.indexOf(":"),i>0&&(n=e.slice(0,i),t.hasSerializationLabel(n))?!0:!1)}},_createCollisionTable:{value:function(e,t,n,r){for(var a,s,o,l,r=r||new i,c=!1,u=Object.create(null),h=0;e.length>h;h++)o=e[h],l=o.indexOf(":"),l>0&&(a=o.slice(0,l),r.addLabel(a),u[a]=1),r.addLabel(o),u[o]=1;for(var h=0;o=t[h];h++)l=o.indexOf(":"),l>0?(a=o.slice(0,l),s=n[a],s?(n[o]=s+":"+o.slice(l+1),c=!0):a in u?(s=r.generateLabel(r.getLabelBaseName(a)),t.indexOf(a)>=0&&(n[a]=s),n[o]=s+o.slice(l),c=!0):r.addLabel(a)):o in u&&!(o in n)?(n[o]=r.generateLabel(r.getLabelBaseName(o)),c=!0):r.addLabel(o);return c}}}),c=n.specialize({initWithSerialization:{value:function(e){this._serialization=e}},visitSerialization:{value:function(e){var t=this._serialization.getSerializationObject();this._walkRootObjects(e,t),this._serialization.initWithObject(t)}},visitSerializationObject:{value:function(e,t){var n=this._serialization.getSerializationObject();if(!(e in n))throw Error('Object "'+e+'" does not exist in '+this._serialization.getSerializationString());this._walkRootObject(t,n,e),this._serialization.initWithObject(n)}},changeLabel:{value:function(e,t){var n,i=this._serialization.getSerializationObject();n=i[e],delete i[e],i[t]=n}},_walkRootObjects:{value:function(e,t){for(var n in t)this._walkRootObject(e,t,n)}},_walkRootObject:{value:function(e,t,n){var i=t[n];"value"in i?this._walkObject(e,i,"value",n):this._walkCustomObject(e,t,n)}},_walkObject:{value:function(e,t,n,i,a){var s,o=t[n],l=r.getTypeOf(o);if(s={type:l},i?s.label=i:s.name=n,a&&(s.parent=a),"number"===l||"string"===l||"null"===l)s.data=o,e(s),t[n]=s.data;else if("regexp"===l)s.data=o["/"],e(s),o["/"]=s.data;else if("reference"===l)s.data=o["@"],e(s),o["@"]=s.data;else if("Element"===l)s.data=o["#"],e(s),o["#"]=s.data;else if("array"===l){s.data=o,e(s),t[n]=o=s.data;for(var c=0,u=o.length;u>c;c++)this._walkObject(e,o,""+c,null,s)}else if("object"===l){s.data=o,e(s),t[n]=o=s.data;for(var n in o)this._walkObject(e,o,n,null,s)}s.label!=i&&this.changeLabel(i,s.label)}},_walkCustomObject:{value:function(e,t,n){var i,r=t[n];i={type:"montageObject",label:n,data:r},e(i),t[n]=r=i.data,i.label!=n&&this.changeLabel(n,i.label),r.properties&&this._walkObject(e,r,"properties",null,i),r.listeners&&this._walkObject(e,r,"listeners",null,i),r.bindings&&this._walkBindings(e,r,null,i),r.localizations&&this._walkLocalizations(e,r,null,i)}},_walkBindings:{value:function(e,t,n){var i,r=t.bindings;i={type:"bindings",data:r,parent:n},e(i),t.bindings=r=i.data;for(var a in r)this._walkBinding(e,r,a,i)}},_walkBinding:{value:function(e,t,n,i){var r,a=t[n];r={type:"binding",name:n,data:a,parent:i},e(r),t[n]=a=r.data,this._walkBindingData(e,a,r)}},_walkBindingData:{value:function(e,t,n){var i,r,o=!1;i=t["<-"]||t["<->"],r=a(i),this._walksBindingReferences(r,function(t){var n={type:"reference",data:t.label};e(n),t.label!==n.data&&(t.label=n.data,o=!0)}),o&&("<-"in t?t["<-"]=s(r):t["<->"]=s(r)),t.converter&&this._walkObject(e,t,"converter",null,n)}},_walkLocalizations:{value:function(e,t,n){var i,r=t.localizations;i={type:"localizations",data:r,parent:n},e(i),t.localizations=r=i.data;for(var a in r)this._walkLocalization(e,r,a,i)}},_walkLocalization:{value:function(e,t,n,i){var r,a,s=t[n];if(r={type:"localization",name:n,data:s,parent:i},e(r),t[n]=s=r.data,"object"==typeof s.key&&this._walkBindingData(e,s.key,r),"object"==typeof s.default&&this._walkBindingData(e,s.default,r),"object"==typeof s.data){a=s.data;for(var n in a)this._walkBindingData(e,a[n],r)}}},_walksBindingReferences:{value:function(e,t){var n=e.args;if("component"===e.type&&t(e),n)for(var i=0,r=n.length;r>i;i++)this._walksBindingReferences(n[i],t)}}}),u=n.specialize({_serialization:{value:null},initWithSerialization:{value:function(e){this._serialization=e}},extractSerialization:{value:function(e,t){var n,i=new c,r={},a=[];n=this._serialization.getSerializationObject(),i.initWithSerialization(this._serialization);for(var s,l=0;s=e[l];l++)r[s]=n[s],i.visitSerializationObject(s,function(t){var n;"reference"===t.type&&(n=t.data,-1===a.indexOf(n)&&-1===e.indexOf(n)&&a.push(n))});if(t)for(var s,l=0;s=t[l];l++)s in n&&!(s in r)&&(r[s]={});for(var s,l=0;s=a[l];l++)r[s]={};return(new o).initWithObject(r)}}});t.Serialization=o,t.SerializationMerger=l,t.SerializationInspector=c,t.SerializationExtractor=u}}),montageDefine("b15df60","window-loader/montage-window",{dependencies:["../core/core"],factory:function(e,t){var n=e("../core/core").Montage;t.MontageWindow=n.specialize({_application:{value:null},application:{get:function(){return this._application},set:function(e){null===this._application&&(this._application=e,this.focused&&this._setFocusedWindow(this))}},_window:{value:null},window:{get:function(){return this._window},set:function(e){if(null===this._window){var t=e.document.body;this._window=e,e.addEventListener("beforeunload",this,!0),e.addEventListener("focus",this,!0),e.addEventListener("mousedown",this,!0),null===t.getAttribute("tabIndex")&&(t.setAttribute("tabIndex",-1),t.focus())}}},document:{get:function(){return this._window.document}},_component:{value:null},component:{get:function(){return this._component},set:function(e){null===this._component&&(this._component=e)}},title:{get:function(){return this.document.title},set:function(e){this.document.title=e}},focused:{value:!1},focus:{value:function(){this._window&&this._window.focus()}},_setFocusedWindow:{value:function(e){var t,n,i,r=this.application;if(r._multipleWindow){t=r.windows;for(i in t)n=t[i],n.window===e?n.focused!==!0&&(n.focused=!0,"z-order"==r.windowsSortOrder?(t.splice(i,1),t.unshift(n)):"reverse-z-order"==r.windowsSortOrder&&(t.splice(i,1),t.push(n))):n.focused=!1}else this.focused=!0}},closed:{get:function(){return this._window?this._window.closed:!1}},close:{value:function(){this._window&&this._window.close()}},resizeTo:{value:function(e,t){this._window&&this._window.resizeTo(e,t)}},moveTo:{value:function(e,t){this._window&&this._window.moveTo(e,t)}},captureFocus:{value:function(e){var t=this.application;if(!this.application)return this.focused=!0,void 0;if(t.parentApplication)t.mainApplication.window.captureFocus(e);else{var n=(e.target.ownerDocument?e.target.ownerDocument.defaultView:null)||e.target.defaultView||e.target;this._setFocusedWindow(n)}}},captureMousedown:{value:function(e){this.captureFocus(e)}},captureBeforeunload:{value:function(){var e,t=this.application,n=t.windows,i=t.attachedWindows;t.attachedWindows=[];for(var e in i)i[e].close();t.parentApplication&&(i=t.parentApplication.attachedWindows,e=i.indexOf(this),-1!==e&&i.splice(e,1),e=n.indexOf(this),-1!==e&&n.splice(e,1),this.window.removeEventListener("beforeunload",this,!0),this.close())}}})}}),montageDefine("b15df60","core/dom",{dependencies:["./geometry/point"],factory:function(e,t){var n=e("./geometry/point").Point,i=Node.prototype,r=Element.prototype;Object.defineProperty(r,"set",{value:function(e,t,n){var i,r,a,s,o,l=e.indexOf(".",n);n=n||0,r=e.substring(n,-1===l?e.length:l),-1===l?this.setAttribute(r,t):(a=e.lastIndexOf("."),"style"===r?(s=e.substring(l+1,e.length),this.style[s]=t):"classList"===r?(o=e.substring(l+1,e.length),t?this.classList.add(o):this.classList.remove(o)):(i=this.get(e.substring(0,a)))&&(i[e.substring(a+1,e.length)]=t))},enumerable:!1}),i.get=function(e){return this.getAttribute(e)||this[e]},Object.getPrototypeOf(document).addRule=function(e,t){var n,i;if(null==(n=document.styleSheets[0])){var r=document.createElement("style");r.type="text/css",document.head.appendChild(r),n=document.styleSheets[0]}else i=document.getRule(e,n);i||n.insertRule(e+" "+t,n.cssRules.length)},Object.getPrototypeOf(document).getRule=function(e,t){var n;if(t.cssRules)for(var i=0;n=t.cssRules[i];i++){if(n.name&&n.name===e)return n;if(n.selectorText===e)return n}},"undefined"!=typeof Element&&function(){var e="classList";if(!Element.prototype.hasOwnProperty(e)){var t=/^\s+|\s+$/g,n=function(e,t){e.setAttribute("class",t.join(" "))},i=function(e,t){if(""===t)throw"SYNTAX_ERR";if(/\s/.test(t))throw"INVALID_CHARACTER_ERR";return e.indexOf(t)},r=function(){var e=this,r=e.getAttribute("class")||"";return r=r.replace(t,"").split(/\s+/),{length:r.length,item:function(e){return r[e]||null},contains:function(e){return-1!==i(r,e)},add:function(t){-1===i(r,t)&&(r.push(t),this.length=r.length,n(e,r))},remove:function(t){var a=i(r,t);-1!==a&&(r.splice(a,1),this.length=r.length,n(e,r))},toggle:function(e){-1===i(r,e)?this.add(e):this.remove(e)},toString:function(){return e.getAttribute("class")||""}}};Object.defineProperty?Object.defineProperty(Element.prototype,e,{get:r,enumerable:!0}):Object.prototype.__defineGetter__&&Element.prototype.__defineGetter__(e,r)}}(),i.parentOf=function(e){for(;(e=e.parentNode)&&e!==this;);return e?!0:!1};var a=function(e){var t,n,i,r,a=e.ownerDocument;if(e&&a){if(n=a.documentElement,i=a.body,r=a.defaultView,e!==i){if(t=e.getBoundingClientRect(),n.parentOf(e)){var s=n.clientTop||i.clientTop||0,o=n.clientLeft||i.clientLeft||0,l=r.pageYOffset||n.scrollTop||i.scrollTop,c=r.pageXOffset||n.scrollLeft||i.scrollLeft,u=t.top+l-s,h=t.left+c-o;return{top:u,left:h}}return{top:t.top,left:t.left}}return{top:i.offsetTop,left:i.offsetLeft}}return null},s=null;try{s=new WebKitPoint(0,0)}catch(o){}var l=function(){t.convertPointFromNodeToPage=function(e,t){return t?(s.x=t.x,s.y=t.y):(s.x=0,s.y=0),t=webkitConvertPointFromNodeToPage(e,s),t?(new n).init(t.x,t.y):null},t.convertPointFromPageToNode=function(e,t){return t?(s.x=t.x,s.y=t.y):(s.x=0,s.y=0),t=webkitConvertPointFromPageToNode(e,s),t?(new n).init(t.x,t.y):null}},c=function(){t.convertPointFromNodeToPage=function(e,t){if(!e||void 0!==e.x)return null;var i;return(i=a(e))?(new n).init((t?t.x:0)+i.left,(t?t.y:0)+i.top):(new n).init(t?t.x:0,t?t.y:0)},t.convertPointFromPageToNode=function(e,t){if(!e||void 0!==e.x)return null;var i;return(i=a(e))?(new n).init((t?t.x:0)-i.left,(t?t.y:0)-i.top):(new n).init(t?t.x:0,t?t.y:0)}};s?l():c()}}),montageDefine("b15df60","core/range-controller",{dependencies:["./core","collections/generic-collection"],factory:function(e,t){var n=e("./core").Montage,i=e("collections/generic-collection"),r=function(e,t){var n=e.clone();n.makeObservable(),n.rangeController=t,n.contentEquals=e&&e.contentEquals||Object.is,Object.defineProperty(n,"clone",{value:function(){return n.slice()}});var i=n.splice;return Object.defineProperty(n,"splice",{configurable:!1,value:function(e,t){var n=this.rangeController.content;this.contentEquals=n&&n.contentEquals||Object.is,e=e>=0?e:this.length+e;var r=this.length,a=Math.min(t,r-e),s=[].slice.call(arguments,2);s.contentEquals=this.contentEquals;var o,l=s.filter(function(t,i){if(n&&!n.has(t))return!1;if(s.findLast(t)>i)return!1;var r=this.find(t);return 0>r||r>=e&&e+a>r},this),c=Math.max(l.length,0),u=c-a,h=Math.max(r+u,e+c);if(!this.rangeController.multiSelect&&h>1){var d=c?l[c-1]:this.one();
o=[0,r,d]}else o=this.rangeController.avoidsEmptySelection&&0===h?n.has(this[0])?[1,this.length-1]:[0,this.length,n.one()]:[e,t].concat(l);return i.apply(this,o)}}),n};t.RangeController=n.specialize({constructor:{value:function(e){this.content=null,this._selection=new r([],this),this.sortPath=null,this.filterPath=null,this.visibleIndexes=null,this.reversed=!1,this.start=null,this.length=null,this.selectAddedContent=!1,this.deselectInvisibleContent=!1,this.clearSelectionOnOrderChange=!1,this.avoidsEmptySelection=!1,this.multiSelect=!1,this.organizedContent=[],this.organizedContent.addRangeChangeListener(this,"organizedContent"),this.defineBinding("_orderedContent",{"<-":"content.($filterPath.defined() ? filter{path($filterPath)} : ()).($sortPath.defined() ? sorted{path($sortPath)} : ()).($reversed ?? 0 ? reversed() : ())"}),this.defineBinding("organizedContent.rangeContent()",{"<-":"_orderedContent.($visibleIndexes.defined() ?$visibleIndexes.filter{<$_orderedContent.length}.map{$_orderedContent[()]} : ()).($start.defined() && $length.defined() ?view($start, $length) : ())"}),this.addRangeAtPathChangeListener("content",this,"handleContentRangeChange"),this.addPathChangeListener("sortPath",this,"handleOrderChange"),this.addPathChangeListener("reversed",this,"handleOrderChange"),this.addOwnPropertyChangeListener("multiSelect",this),this.iterations=[],e&&this.initWithContent(e)}},initWithContent:{value:function(e){return this.content=e,this}},sortPath:{value:null},reversed:{value:null},filterPath:{value:null},visibleIndexes:{value:null},start:{value:null},length:{value:null},selectAddedContent:{value:!1},deselectInvisibleContent:{value:!1},clearSelectionOnOrderChange:{value:!1},avoidsEmptySelection:{value:!1},multiSelect:{value:!1},_orderedContent:{value:null},organizedContent:{value:null},iterations:{value:null},_selection:{value:null},selection:{get:function(){return this._selection},set:function(e){var t=[0,this._selection.length];e&&e.toArray&&(t=t.concat(e.toArray())),this._selection.splice.apply(this._selection,t)}},select:{value:function(e){!this.multiSelect&&this.selection.length>=1&&this.selection.clear(),this.selection.add(e)}},deselect:{value:function(e){(!this.avoidsEmptySelection||this.selection.length>1)&&this.selection["delete"](e)}},clearSelection:{value:function(){(!this.avoidsEmptySelection||this.selection.length>1)&&this.selection.clear()}},add:{value:function(e){var t;return this.content||(this.content=[]),t=this.content.add(e),t&&this.handleAdd(e),t}},push:{value:function(){for(var e=this.content.push.apply(this.content,arguments),t=0;arguments.length>t;t++)this.handleAdd(arguments[t]);return e}},pop:{value:function(){return this.content.pop()}},shift:{value:function(){return this.content.shift()}},unshift:{value:function(){for(var e=this.content.unshift.apply(this.content,arguments),t=0;arguments.length>t;t++)this.handleAdd(arguments[t]);return e}},splice:{value:function(){for(var e=this.content.splice.apply(this.content,arguments),t=2;arguments.length>t;t++)this.handleAdd(arguments[t]);return e}},swap:{value:function(e,t,n){var i=this.content.swap.apply(this.content,arguments);if(n)for(var e=2;n.length>e;e++)this.handleAdd(n[e]);return i}},"delete":{value:function(e){return this.content["delete"](e)}},has:{value:function(e){return this.content?this.content.has(e):!1}},addEach:{value:i.prototype.addEach},deleteEach:{value:i.prototype.deleteEach},clear:{value:function(){this.content.clear()}},addContent:{value:function(){var e=new this.contentConstructor;return this.add(e),e}},_contentConstructor:{value:null},contentConstructor:{get:function(){return this._contentConstructor?this._contentConstructor:this.content&&this.content.contentConstructor?this.content.contentConstructor:Object},set:function(e){this._contentConstructor=e}},handleContentRangeChange:{value:function(e,t){if(this.selection.length>0){var n=this.content&&this.content.contentEquals||Object.is;t.deleteEach(e,n),this.selection&&this.selection.deleteEach(t)}}},handleSelectionRangeChange:{value:function(e,t){if(this.selection)if(this.content){for(var n=[],i=0;e.length>i;i++)this.content.has(e[i])||n.push(e[i]);if(this._selection.deleteEach(n),!this.multiSelect&&this._selection.length>1){var r=this._selection.pop();this._selection.clear(),this._selection.add(r)}this.avoidsEmptySelection&&0==this._selection.length&&this._selection.add(t[0])}else this._selection.clear()}},handleOrganizedContentRangeChange:{value:function(e,t){if(this.deselectInvisibleContent&&this.selection){var n=t.clone(1);n.deleteEach(e),this.selection.deleteEach(t)}}},handleOrderChange:{value:function(){this.clearSelectionOnOrderChange&&this.selection&&this.selection.clear()}},handleAdd:{value:function(e){this.selectAddedContent&&this.selection&&(!this.multiSelect&&this.selection.length>=1&&this.selection.clear(),this.selection.add(e))}},handleMultiSelectChange:{value:function(){if(this.selection){var e=this.selection.length;if(!this.multiSelect&&e>1){var t=this._selection.pop();this._selection.clear(),this._selection.add(t)}}}}},{blueprintModuleId:e("./core")._blueprintModuleIdDescriptor,blueprint:e("./core")._blueprintDescriptor})}}),montageDefine("b15df60","ui/flow.reel/flow",{dependencies:["../../core/core","../component","frb/observers","./flow-bezier-spline","../../core/range-controller","../../core/deprecate"],factory:function(e,t){var n=(e("../../core/core").Montage,e("../component").Component),i=e("frb/observers").observeProperty,r=e("./flow-bezier-spline").FlowBezierSpline,a=e("../../core/range-controller").RangeController,s=e("../../core/deprecate").deprecationWarning;t.Flow=n.specialize({constructor:{value:function(){this.super(),this._visibleIndexes=[],this._slideOffsets={},this.defineBinding("_numberOfIterations",{"<-":"_frustumController.content.length"}),this.addOwnPropertyChangeListener("_numberOfIterations",this),window.addEventListener("resize",this,!1)}},slotContent:{serializable:!0,value:null},__flowTranslateComposer:{value:null},_flowTranslateComposer:{get:function(){return this.__flowTranslateComposer},set:function(e){this.__flowTranslateComposer&&(this.__flowTranslateComposer.removeEventListener("translateStart",this,!1),this.__flowTranslateComposer.removeEventListener("translateEnd",this,!1)),this.__flowTranslateComposer=e,this.__flowTranslateComposer.addEventListener("translateStart",this,!1),this.__flowTranslateComposer.addEventListener("translateEnd",this,!1)}},handleTranslateStart:{value:function(){this.callDelegateMethod("didTranslateStart",this)}},handleTranslateEnd:{value:function(){this.callDelegateMethod("didTranslateEnd",this)}},_scrollingMode:{value:"linear"},_transform:{value:null},_transformCss:{value:null},_perspective:{value:null},scrollingMode:{serializable:!0,get:function(){return this._scrollingMode},set:function(e){switch(e){case"linear":case"drag":this._scrollingMode=e}}},_linearScrollingVector:{value:[-300,0]},linearScrollingVector:{seriazable:!0,get:function(){return this._linearScrollingVector},set:function(e){this._linearScrollingVector=e}},_repetition:{value:null},momentumDuration:{serializable:!0,value:650},_splinePaths:{value:null},splinePaths:{enumerable:!1,get:function(){return this._splinePaths||(this._splinePaths=[]),this._splinePaths},set:function(e){this._splinePaths=e}},_appendPath:{value:function(e){var t,n,i=new r,a=e.knots,s=e.knots.length,o=[],l=[],c=[],u=[];i.parameters={};for(t in e.units)i.parameters[t]={data:[],units:e.units[t]};for(t=0;s>t;t++){o[t]=a[t].knotPosition,c[t]=a[t].previousHandlerPosition,l[t]=a[t].nextHandlerPosition,u[t]=a[t].previousDensity;for(n in e.units)i.parameters[n].data.push(a[t][n])}i.knots=o,i.previousHandlers=c,i.nextHandlers=l,i.densities=u,i._computeDensitySummation(),this.splinePaths.push(i),e.hasOwnProperty("headOffset")||(e.headOffset=0),e.hasOwnProperty("tailOffset")||(e.tailOffset=0),this._paths.push(e),this._updateLength()}},_paths:{value:null},paths:{get:function(){var e,t,n,i,r,a,s,o=this.splinePaths.length,l=[];for(r=0;o>r;r++){for(t=this.splinePaths[r].knots.length,e={knots:[],units:{}},a=0;t>a;a++)i={knotPosition:this.splinePaths[r].knots[a]},this.splinePaths[r].nextHandlers&&this.splinePaths[r].nextHandlers[a]&&(i.nextHandlerPosition=this.splinePaths[r].nextHandlers[a]),this.splinePaths[r].previousHandlers&&this.splinePaths[r].previousHandlers[a]&&(i.previousHandlerPosition=this.splinePaths[r].previousHandlers[a]),this.splinePaths[r].densities&&this.splinePaths[r].densities[a]&&(i.previousDensity=this.splinePaths[r].densities[a],i.nextDensity=this.splinePaths[r].densities[a]),e.knots.push(i);for(a in this.splinePaths[r].parameters)for(e.units[a]=this.splinePaths[r].parameters[a].units,n=this.splinePaths[r].parameters[a].data.length,s=0;n>s;s++)e.knots[s][a]=this.splinePaths[r].parameters[a].data[s];e.headOffset=this._paths[r].hasOwnProperty("headOffset")?this._paths[r].headOffset:0,e.tailOffset=this._paths[r].hasOwnProperty("tailOffset")?this._paths[r].tailOffset:0,l.push(e)}return l},set:function(e){var t,n=e.length;for(this._splinePaths=[],this._paths=[],t=0;n>t;t++)this._appendPath(e[t]);this.needsDraw=!0,this._needsComputeVisibleRange=!0}},_cameraElement:{value:null},_cameraPosition:{value:[0,0,800]},cameraPosition:{get:function(){return this._cameraPosition},set:function(e){this._cameraPosition=e,this._isCameraUpdated=!0,this.needsDraw=!0,this._needsComputeVisibleRange=!0}},_cameraTargetPoint:{value:[0,0,0]},cameraTargetPoint:{get:function(){return this._cameraTargetPoint},set:function(e){this._cameraTargetPoint=e,this._isCameraUpdated=!0,this.needsDraw=!0,this._needsComputeVisibleRange=!0}},_cameraFov:{value:50},cameraFov:{get:function(){return this._cameraFov},set:function(e){this._cameraFov=e,this._isCameraUpdated=!0,this.needsDraw=!0,this._needsComputeVisibleRange=!0}},_cameraRoll:{value:0},cameraRoll:{get:function(){return this._cameraRoll},set:function(e){this._cameraRoll=e,this._isCameraUpdated=!0,this.needsDraw=!0,this._needsComputeVisibleRange=!0}},_stride:{value:0},stride:{get:function(){return this._stride},set:function(e){this._stride=e}},_scrollingTransitionDurationMiliseconds:{value:500},_scrollingTransitionDuration:{value:"500ms"},scrollingTransitionDuration:{get:function(){return this._scrollingTransitionDuration},set:function(e){var t,n,i=e+"";i.length,(n=/^(\d+)ms$/.exec(i))?t=+n[1]:(n=/^(\d+)s$/.exec(i))?t=1e3*+n[1]:(t=+i,i+="ms"),isNaN(t)||this._scrollingTransitionDurationMiliseconds===t||(this._scrollingTransitionDurationMiliseconds=t,this._scrollingTransitionDuration=i)}},hasSelectedIndexScrolling:{value:!1},selectedIndexScrollingOffset:{value:0},_handleSelectedIndexesChange:{value:function(e){this.hasSelectedIndexScrolling&&e[0]&&this.startScrollingIndexToOffset(Math.floor(this.contentController.content.indexOf(e[0].object)/this._paths.length),this.selectedIndexScrollingOffset)}},_timingFunctions:{value:{ease:[.25,.1,.25,1],linear:[0,0,1,1],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1]}},_scrollingTransitionTimingFunctionBezier:{value:[.25,.1,.25,1]},_scrollingTransitionTimingFunction:{value:"ease"},scrollingTransitionTimingFunction:{get:function(){return this._scrollingTransitionTimingFunction},set:function(e){var t,n,i=e+"";if(this._timingFunctions.hasOwnProperty(i))this._scrollingTransitionTimingFunction=i,this._scrollingTransitionTimingFunctionBezier=this._timingFunctions[i];else if("cubic-bezier("===i.substr(0,13)&&")"===i.substr(i.length-1,1)&&(t=i.substr(13,i.length-14).split(","),4===t.length)){for(n=0;4>n;n++)if(t[n]-=0,isNaN(t[n]))return;0>t[0]?t[0]=0:t[0]>1&&(t[0]=1),0>t[2]?t[2]=0:t[2]>1&&(t[2]=1),this._scrollingTransitionTimingFunction="cubic-bezier("+t+")",this._scrollingTransitionTimingFunctionBezier=t}}},_computeCssCubicBezierValue:{value:function(e,t){var n,i,r,a=.5,s=.25;for(r=0;20>r;r++)n=a*a,i=1-a,3*(i*i*a*t[0]+i*n*t[2])+n*a>e?a-=s:a+=s,s*=.5;return n=a*a,i=1-a,3*(i*i*a*t[1]+i*n*t[3])+n*a}},_isTransitioningScroll:{value:!1},stopScrolling:{value:function(){this._isTransitioningScroll=!1}},startScrollingIndexToOffset:{value:function(e,t){this._scrollingOrigin=this.scroll,this._scrollingDestination=e-t,this._scrollingDestination>this._length?this._scrollingDestination=this._length:0>this._scrollingDestination&&(this._scrollingDestination=0),this._isScrolling=!0,this._scrollingStartTime=Date.now(),this._isTransitioningScroll=!0,this.needsDraw=!0,this.callDelegateMethod("didTranslateStart",this)}},_isCameraUpdated:{value:!0},_width:{value:null},_height:{value:null},_boundingBoxSize:{value:[200,200,0]},boundingBoxSize:{serializable:!0,get:function(){return this._boundingBoxSize},set:function(e){this._boundingBoxSize=e,this.elementsBoundingSphereRadius=.5*Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),this._needsComputeVisibleRange=!0}},_elementsBoundingSphereRadius:{value:283},elementsBoundingSphereRadius:{get:function(){return this._elementsBoundingSphereRadius},set:function(e){this._elementsBoundingSphereRadius!==e&&(this._elementsBoundingSphereRadius=e,this.needsDraw=!0,this._needsComputeVisibleRange=!0)}},_halfPI:{value:.5*Math.PI},_doublePI:{value:2*Math.PI},_computeFrustumNormals:{value:function(){var e,t,n,i,r,a,s,o,l,c=.5*this.cameraFov*this._doublePI/360,u=Math.sin(c),h=Math.cos(c),d=u*this._width/this._height,p=this.cameraTargetPoint[0]-this.cameraPosition[0],f=this.cameraTargetPoint[1]-this.cameraPosition[1],m=this.cameraTargetPoint[2]-this.cameraPosition[2],g=this._halfPI-Math.atan2(m,p),v=p*Math.sin(g)+m*Math.cos(g),_=this._halfPI-Math.atan2(v,f),b=[[h,0,d],[-h,0,d],[0,h,u],[0,-h,u]],y=[];for(l=0;4>l;l++)o=b[l],e=o[0],t=o[1]*Math.cos(-_)-o[2]*Math.sin(-_),n=o[1]*Math.sin(-_)+o[2]*Math.cos(-_),i=e*Math.cos(-g)-n*Math.sin(-g),r=t,a=e*Math.sin(-g)+n*Math.cos(-g),s=1/Math.sqrt(i*i+r*r+a*a),y.push([i*s,r*s,a*s]);return y}},_segmentsIntersection:{value:function(e,t){for(var n,i,r=0,a=0,s=[];e.length>r&&t.length>a;)e[r][0]>=t[a][1]?a++:e[r][1]<=t[a][0]?r++:(n=e[r][0]>=t[a][0]?e[r][0]:t[a][0],i=e[r][1]<=t[a][1]?e[r][1]:t[a][1],s.push([n,i]),e[r][1]<t[a][1]?r++:e[r][1]>t[a][1]?a++:(r++,a++));return s}},_computeVisibleRange:{value:function(e){var t,n,i,r,a=e._knots.length-1,s=this._cameraPosition[0],o=this._cameraPosition[1],l=this._cameraPosition[2],c=this._computeFrustumNormals(),u=[],h=[],d=[],p=this._elementsBoundingSphereRadius,f=e._knots,m=e._nextHandlers,g=e._previousHandlers,v=[],_=[];for(i=0;a>i;i++)if(t=c[0],u=e.directedPlaneBezierIntersection(s-t[0]*p,o-t[1]*p,l-t[2]*p,c[0],f[i],m[i],g[i+1],f[i+1],v),u.length&&(t=c[1],h=e.directedPlaneBezierIntersection(s-t[0]*p,o-t[1]*p,l-t[2]*p,c[1],f[i],m[i],g[i+1],f[i+1],v),h.length&&(n=this._segmentsIntersection(u,h),n.length&&(t=c[2],u=e.directedPlaneBezierIntersection(s-t[0]*p,o-t[1]*p,l-t[2]*p,c[2],f[i],m[i],g[i+1],f[i+1],v),n=this._segmentsIntersection(u,n),n.length))))for(t=c[3],u=e.directedPlaneBezierIntersection(s-t[0]*p,o-t[1]*p,l-t[2]*p,c[3],f[i],m[i],g[i+1],f[i+1],v),n=this._segmentsIntersection(u,n),r=0;n.length>r;r++)d.push([i,n[r][0],n[r][1]]);var b,y,w,C,L,x,M,E=e._densities;for(i=0;d.length>i;i++)b=E[d[i][0]],y=E[d[i][0]+1],w=d[i][0]?e._densitySummation[d[i][0]-1]:0,C=d[i][1],L=d[i][2],x=.5*(y-b)*C*C+C*b+w,M=.5*(y-b)*L*L+L*b+w,_.push([x,M]);return _}},_determineCssPrefixedProperties:{value:function(){"webkitTransform"in this.element.style?(this._transform="webkitTransform",this._transformCss="-webkit-transform",this._perspective="webkitPerspective"):"MozTransform"in this.element.style?(this._transform="MozTransform",this._transformCss="-moz-transform",this._perspective="MozPerspective"):"msTransform"in this.element.style?(this._transform="msTransform",this._transformCss="-ms-transform",this._perspective="msPerspective"):(this._transform="transform",this._perspective="perspective")}},_isListeningToResize:{value:!0},isListeningToResize:{get:function(){return this._isListeningToResize},set:function(e){var t=!!e;this._isListeningToResize!==t&&(this._isListeningToResize=t,this._isListeningToResize?window.addEventListener("resize",this,!1):window.removeEventListener("resize",this,!1))}},handleResize:{value:function(){this._isCameraUpdated=!0,this.needsDraw=!0}},enterDocument:{value:function(e){e&&(this._determineCssPrefixedProperties(),this._repetition.addRangeAtPathChangeListener("selectedIterations",this,"_handleSelectedIndexesChange"))}},_updateVisibleIndexes:{value:function(e,t){var n,i,r=this._visibleIndexes,a=r&&!isNaN(r.length)?r.length:0,s=[];for(i=0;a>i;i++)"number"==typeof t[r[i]]?e[t[r[i]]]=null:s.push(i);for(i=n=0;s.length>n&&e.length>i;i++)null!==e[i]&&(r.set(s[n],e[i]),n++);for(n=a;e.length>i;i++)null!==e[i]&&(r.set(n,e[i]),n++)}},_needsComputeVisibleRange:{value:!0},_previousVisibleRanges:{value:null},willDraw:{value:function(e){var t,n,i,r,a,s,o,l,c,u,h,d=[],p={},f=this._paths,m=f.length,g=this.splinePaths;this._isTransitioningScroll&&(u=(Date.now()-this._scrollingStartTime)/this._scrollingTransitionDurationMiliseconds,h=this._computeCssCubicBezierValue(u,this._scrollingTransitionTimingFunctionBezier),1>u?this.scroll=this._scrollingOrigin+(this._scrollingDestination-this._scrollingOrigin)*h:(this.scroll=this._scrollingDestination,this._isTransitioningScroll=!1,this._needsToCallDidTranslateEndDelegate=!0));var v,_,b,y,w,u=e,c=6,C=this.lastDrawTime?.018*(u-this.lastDrawTime)*this._elasticScrollingSpeed:0,L=1-C/c,x=this._minSlideOffsetIndex,M=this._maxSlideOffsetIndex;if(this.lastDrawTime=u,this._hasElasticScrolling)for(r=0;c>r;r++){for(i=this._draggedSlideIndex-1;i>=x;i--)v=this._getSlideOffset(i),_=this._getSlideOffset(i+1),b=(v-_)*L+_,b>0&&(b=0),this._updateSlideOffset(i,b);for(i=this._draggedSlideIndex+1;M>=i;i++)v=this._getSlideOffset(i),_=this._getSlideOffset(i-1),b=(v-_)*L+_,0>b&&(b=0),this._updateSlideOffset(i,b)}if(this._width=this._element.clientWidth,this._height=this._element.clientHeight,g.length){for(o=this._numberOfIterations%m,l=(this._numberOfIterations-o)/m,this._needsComputeVisibleRange&&(this._previousVisibleRanges=[]),a=0;m>a;a++)for(c=l+(o>a?1:0),this._needsComputeVisibleRange?(t=this._computeVisibleRange(g[a]),this._previousVisibleRanges[a]=t,g[a]._computeDensitySummation()):t=this._previousVisibleRanges[a],s=this._scroll-f[a].headOffset,i=0;t.length>i;i++){for(w=c/2,r=w;w>=1;)n=(0|r)*m+a,y=(0|r)+this._getSlideOffset(n)-s,w/=2,y>=t[i][0]?r-=w:r+=w;r=0|r-1,0>r&&(r=0);do n=r*m+a,y=r+this._getSlideOffset(n)-s,y>=t[i][0]&&t[i][1]>=y&&void 0===p[n]&&(p[n]=d.length,d.push(n)),r++;while(t[i][1]>=y&&c>r)}this._needsComputeVisibleRange=!1}this._updateVisibleIndexes(d,p)}},draw:{value:function(){var e,t,n,i,r,a,s,o,l,c,u=this._repetition._drawnIterations.length,h=(this._paths.length,this._visibleIndexes);if(this._isTransitioningScroll&&(this.needsDraw=!0),this._isCameraUpdated){var d,p,f=.5*Math.tan((90-.5*this.cameraFov)*this._doublePI/360)*this._height,m=this.cameraTargetPoint[0]-this.cameraPosition[0],g=this.cameraTargetPoint[1]-this.cameraPosition[1],v=this.cameraTargetPoint[2]-this.cameraPosition[2],_=Math.atan2(-m,-v);d=m*-Math.sin(-_)+v*Math.cos(-_),p=Math.atan2(-g,-d),this._element.style[this._perspective]=f+"px",this._cameraElement.style[this._transform]="translate3d(0,0,"+f+"px)rotateX("+p+"rad)rotateY("+-_+"rad)"+"translate3d("+-this.cameraPosition[0]+"px,"+-this.cameraPosition[1]+"px,"+-this.cameraPosition[2]+"px)",this._isCameraUpdated=!1}if(this.splinePaths.length)for(e=0;u>e;e++)c=this.offset(h[e]),a=c.pathIndex,t=c.slideTime,o=this._splinePaths[a]._convertSplineTimeToBezierIndexTime(t),i=this._repetition._drawnIterations[e],r=i.cachedFirstElement||i.firstElement,null!==o?(r.children[0]&&(r.classList.contains("selected")?r.children[0].classList.add("selected"):r.children[0].classList.remove("selected"),r.classList.contains("active")?r.children[0].classList.add("active"):r.children[0].classList.remove("active")),s=this._splinePaths[a].getPositionAtIndexTime(o),l=this._splinePaths[a].getRotationAtIndexTime(o),n=this._transformCss+":translate3d("+1e-5*(1e5*s[0]>>0)+"px,"+1e-5*(1e5*s[1]>>0)+"px,"+1e-5*(1e5*s[2]>>0)+"px)"+(l[2]?"rotateZ("+1e-5*(1e5*l[2]>>0)+"rad)":"")+(l[1]?"rotateY("+1e-5*(1e5*l[1]>>0)+"rad)":"")+(l[0]?"rotateX("+1e-5*(1e5*l[0]>>0)+"rad)":"")+";"+this._splinePaths[a].getStyleAtIndexTime(o),r.setAttribute("style",n)):r.setAttribute("style",this._transformCss+":scale3d(0,0,0);opacity:0");else for(e=0;u>e;e++)i=this._repetition._drawnIterations[e],r=i.cachedFirstElement||i.firstElement,r.setAttribute("style",this._transformCss+":scale3d(0,0,0);opacity:0");this._slideOffsetsLength&&(this.needsDraw=!0),this._needsToCallDidTranslateEndDelegate&&(this._needsToCallDidTranslateEndDelegate=!1,this.callDelegateMethod("didTranslateEnd",this))}},_updateLength:{value:function(){if(this._paths){var e,t,n,i,r,a,s=this._paths.length,o=0;if(s>0){for(r=this._numberOfIterations%s,i=(this._numberOfIterations-r)/s,a=0;s>a;a++)e=this._paths[a],t=i+(r>a?1:0),n=t-e.tailOffset+e.headOffset-1,n>o&&(o=n);this.length=o}this.needsDraw=!0}}},_numberOfIterations:{value:0},handle_numberOfIterationsChange:{value:function(){this._updateLength()}},content:{get:function(){return this.getPath("contentController.content")},set:function(e){this.contentController=(new a).initWithContent(e)}},contentController:{value:null},isSelectionEnabled:{value:null},selectedIndexes:{serializable:!1,value:null},activeIndexes:{serializable:!1,value:null},observeProperty:{value:function(e,t,n){return"currentIteration"!==e&&"objectAtCurrentIteration"!==e&&"contentAtCurrentIteration"!==e?i(this,e,t,n):(s(e,":iteration.object"),this._repetition?this._repetition.observeProperty(e,t,n):void 0)}},templateDidLoad:{value:function(){var e=this;this._repetition.willDraw=function(){e.needsDraw=!0}}},_length:{value:0},length:{get:function(){return this._length},set:function(e){this._length=0>e?0:e}},_scroll:{value:0},_elasticScrollingRange:{value:20},_hasElasticScrolling:{value:!1},hasElasticScrolling:{get:function(){return this._hasElasticScrolling},set:function(e){this._hasElasticScrolling=e?!0:!1}},_slideOffsets:{value:null},_slideOffsetsLength:{value:0},_maxSlideOffsetIndex:{value:-1},_minSlideOffsetIndex:{value:2e9},_updateSlideOffset:{value:function(e,t){var n=1e-4;e>=0&&(-n>t||t>n?(void 0===this._slideOffsets[e]&&(this._slideOffsetsLength++,this._minSlideOffsetIndex>e&&(this._minSlideOffsetIndex=e),e>this._maxSlideOffsetIndex&&(this._maxSlideOffsetIndex=e)),this._slideOffsets[e]=t):this._removeSlideOffset(e))}},_incrementSlideOffset:{value:function(e,t){this._updateSlideOffset(e,this._getSlideOffset(e)+t)}},_removeSlideOffset:{value:function(e){if(void 0!==this._slideOffsets[e]){var t,n,i;if(delete this._slideOffsets[e],this._slideOffsetsLength--,e===this._minSlideOffsetIndex)for(t=Object.keys(this._slideOffsets),this._minSlideOffsetIndex=2e9,n=0;t.length>n;n++)i=0|t[n],this._minSlideOffsetIndex>i&&(this._minSlideOffsetIndex=i);if(e===this._maxSlideOffsetIndex)for(void 0===t&&(t=Object.keys(this._slideOffsets)),this._maxSlideOffsetIndex=-1,n=0;t.length>n;n++)i=0|t[n],i>this._maxSlideOffsetIndex&&(this._maxSlideOffsetIndex=i)}}},_getSlideOffset:{value:function(e){return this._minSlideOffsetIndex>e?e=this._minSlideOffsetIndex>this._draggedSlideIndex?this._draggedSlideIndex:this._minSlideOffsetIndex:e>this._maxSlideOffsetIndex&&(e=this._maxSlideOffsetIndex<this._draggedSlideIndex?this._draggedSlideIndex:this._maxSlideOffsetIndex),void 0!==this._slideOffsets[e]?this._slideOffsets[e]:0}},scroll:{get:function(){return this._scroll},set:function(e){if(0>e&&(e=0),e>this.length&&(e=this.length),this._hasElasticScrolling&&null!==this._draggedSlideIndex){var t,n,i=this._draggedSlideIndex-this._elasticScrollingRange,r=this._draggedSlideIndex+this._elasticScrollingRange;for(i>this._minSlideOffsetIndex&&(i=this._minSlideOffsetIndex),this._maxSlideOffsetIndex>r&&(r=this._maxSlideOffsetIndex),n=e-this._scroll,0>i&&(i=0),t=i;r>=t;t++)t!==this._draggedSlideIndex?this._incrementSlideOffset(t,n):this._removeSlideOffset(t);this._scroll=e}else this._scroll=e;this.needsDraw=!0}},previousStride:{value:function(){var e=Math.round(this.scroll/this.stride),t=(e-1)*this.stride;this.startScrollingIndexToOffset(0,-t)}},nextStride:{value:function(){var e=Math.round(this.scroll/this.stride),t=(e+1)*this.stride;this.startScrollingIndexToOffset(0,-t)}},_isInputEnabled:{value:!0},isInputEnabled:{get:function(){return this._isInputEnabled},set:function(e){this._isInputEnabled=e?!0:!1}},_draggedSlideIndex:{value:0},draggedSlideIndex:{get:function(){return this._draggedSlideIndex},set:function(e){if(e!==this._draggedSlideIndex){if(null!==e){var t,n=this._getSlideOffset(e),i=this._minSlideOffsetIndex,r=this._maxSlideOffsetIndex;for(this._incrementSlideOffset(this._draggedSlideIndex,-n),t=i;r>=t;t++)t!==this._draggedSlideIndex&&this._incrementSlideOffset(t,-n);this._removeSlideOffset(e),this._scroll-=n,this._flowTranslateComposer._scroll=this._scroll}this._draggedSlideIndex=e,this.needsDraw=!0}}},_elasticScrollingSpeed:{value:1},elasticScrollingSpeed:{get:function(){return this._elasticScrollingSpeed},set:function(e){this._elasticScrollingSpeed=parseFloat(e)}},lastDrawTime:{value:null},offset:{enumerable:!1,value:function(e){var t=this._paths.length,n=e%t,i=Math.floor(e/t)-this._scroll+this._paths[n].headOffset;return{pathIndex:n,slideTime:i+this._getSlideOffset(e)}}},serializeSelf:{value:function(e){e.setAllProperties();for(var t,n=this.originalContent,i=0;t=n[i];i++)t.component&&e.addObject(t.component)}}})}}),montageDefine("b15df60","ui/text.reel/text",{dependencies:["../component"],factory:function(e,t){var n=e("../component").Component;t.Text=n.specialize({constructor:{value:function(){this.super()}},hasTemplate:{value:!1},_value:{value:null},value:{get:function(){return this._value},set:function(e){this._value!==e&&(this._value=e,this.needsDraw=!0)}},converter:{value:null},defaultValue:{value:""},_valueNode:{value:null},_RANGE:{value:document.createRange()},enterDocument:{value:function(e){if(e){var t=this._RANGE;t.selectNodeContents(this.element),t.deleteContents(),this._valueNode=document.createTextNode(""),t.insertNode(this._valueNode),this.element.classList.add("montage-Text")}}},draw:{value:function(){var e=this._value,t=e||0===e?e:this.defaultValue;this.converter&&(t=this.converter.convert(t)),this._valueNode.data=t}}})}}),montageDefine("b15df60","core/geometry/point",{dependencies:["../core"],factory:function(e,t){var n=e("../core").Montage;t.Point=n.specialize({init:{enumerable:!1,value:function(e,t){return this.x=null===e?0:e,this.y=null===t?0:t,this}},x:{enumerable:!0,value:0},y:{enumerable:!0,value:0}},{interpolate:{enumerable:!1,value:function(e,n,i,r){var a,s;return a=n.x+(i.x-n.x)*e,s=n.y+(i.y-n.y)*e,r>0&&(a=Math.round(a*r)/r,s=Math.round(s*r)/r),(new t.Point).init(a,s)}}})}}),montageDefine("b15df60","ui/flow.reel/flow-bezier-spline",{dependencies:["../../core/core"],factory:function(e,t){var n=e("../../core/core").Montage,i=t.FlowBezierSpline=n.specialize({constructor:{value:function i(){this._knots=[],this._densities=[]}},knots:{get:function(){return this._knots},set:function(e){this._knots=e}},previousHandlers:{get:function(){return this._previousHandlers||(this._previousHandlers=[]),this._previousHandlers},set:function(e){this._previousHandlers=e}},nextHandlers:{get:function(){return this._nextHandlers||(this._nextHandlers=[]),this._nextHandlers},set:function(e){this._nextHandlers=e}},densities:{get:function(){return this._densities},set:function(e){this._densities=e,this._densitiesLength=this._densities.length,this._maxTime=null}},_parameters:{value:{}},parameters:{get:function(){return this._parameters||(this._parameters={}),this._parameters},set:function(e){this._parameters=e,this._parametersLength=this._parameters.length}},_maxTime:{enumerable:!1,value:null},computeMaxTime:{value:function(){return this._computeDensitySummation(),this._maxTime=this._densitySummation.length?this._densitySummation[this._densitySummation.length-1]:0,this._maxTime}},_densitySummation:{enumerable:!1,value:null},_computeDensitySummation:{enumerable:!1,value:function(){var e,t=this.densities,n=t.length-1,i=0;for(this._densitySummation=[],e=0;n>e;e++)i+=(t[e]+t[e+1])/2,this._densitySummation[e]=i;this._maxTime=null}},_convertSplineTimeToBezierIndexTime:{enumerable:!1,value:function(e){if(0>e)return null;if(null===this._maxTime&&this.computeMaxTime(),e>=this._maxTime)return null;for(var t,n,i,r,a,s=this._densitySummation,o=s.length,l=o-1,c=o>>1;c;)l-c>=0&&s[l-c]>e?l-=c:c>>=1;return t=e-(l?s[l-1]:0),i=this._densities[l],r=this._densities[l+1],a=i-r,n=-1e-10>a||a>1e-10?(i-Math.sqrt(i*i+2*(r-i)*t))/a:t/i,[l,n]}},getPositionAtIndexTime:{value:function(e){var t=e[0],n=e[1],i=this._knots[t],r=this._nextHandlers[t],a=this._previousHandlers[t+1],s=this._knots[t+1],o=1-n,l=o*o*o,c=3*o*o*n,u=3*o*n*n,h=n*n*n;return[i[0]*l+r[0]*c+a[0]*u+s[0]*h,i[1]*l+r[1]*c+a[1]*u+s[1]*h,i[2]*l+r[2]*c+a[2]*u+s[2]*h]}},getRotationAtIndexTime:{value:function(e){var t,n,i,r=e[0],a=e[1],s=1-a,o=this._parameters;return t=void 0!==o.rotateX?o.rotateX.data[r]*s+o.rotateX.data[r+1]*a:0,n=void 0!==o.rotateY?o.rotateY.data[r]*s+o.rotateY.data[r+1]*a:0,i=void 0!==o.rotateZ?o.rotateZ.data[r]*s+o.rotateZ.data[r+1]*a:0,[t,n,i]}},getStyleAtIndexTime:{value:function(e){var t,n,i,r,a,s,o=e[0],l=e[1],c=this._parameters,u=1-l,h="";for(i=Object.keys(c),r=i.length,t=0;r>t;t++)n=i[t],a=c[n],s=a.data,"rotateX"!==n&&"rotateY"!==n&&"rotateZ"!==n&&void 0!==s[o]&&void 0!==s[o+1]&&(h+=n+":"+1e-5*(1e5*(s[o]*u+s[o+1]*l)>>0)+a.units+";");return h}},transformVectorArray:{value:function(e,t){var n,i,r=e.length,a=[];for(i=0;r>i;i++)n=e[i],n&&(a[i]=[n[0]*t[0]+n[1]*t[4]+n[2]*t[8]+t[12],n[0]*t[1]+n[1]*t[5]+n[2]*t[9]+t[13],n[0]*t[2]+n[1]*t[6]+n[2]*t[10]+t[14]]);return a}},transform:{value:function(e){var t=new i;return t._densities=this._densities,t._densitySummation=this._densitySummation,t._knots=this.transformVectorArray(this.knots,e),t._previousHandlers=this.transformVectorArray(this.previousHandlers,e),t._nextHandlers=this.transformVectorArray(this.nextHandlers,e),t}},deCasteljau:{value:function(e,t,n,i,r){var a=1-r,s=a*e[0]+r*t[0],o=a*t[0]+r*n[0],l=a*n[0]+r*i[0],c=a*s+r*o,u=a*o+r*l,h=a*c+r*u,d=a*e[1]+r*t[1],p=a*t[1]+r*n[1],f=a*n[1]+r*i[1],m=a*d+r*p,g=a*p+r*f,v=a*m+r*g,_=a*e[2]+r*t[2],b=a*t[2]+r*n[2],y=a*n[2]+r*i[2],w=a*_+r*b,C=a*b+r*y,L=a*w+r*C;return[[e,[s,d,_],[c,m,w],[h,v,L]],[[h,v,L],[u,g,C],[l,f,y],i]]}},cubic:{enumerable:!1,value:function(e,t,n,i,r){return((e*r+t)*r+n)*r+i}},cubeRoot:{enumerable:!1,value:function(e){return e>0?Math.pow(e,1/3):-Math.pow(-e,1/3)}},cubicRealRoots:{enumerable:!1,value:function(e,t,n,i){var r=1e-100,a=Math;if(-r>e||e>r){var s=1/e,o=t*s,l=n*s,c=(3*l-o*o)*(1/9),u=(4.5*o*l-13.5*i*s-o*o*o)*(1/27),h=c*c*c+u*u;if(h>r){var d=a.sqrt(h);return[this.cubeRoot(u+d)+this.cubeRoot(u-d)+o*(-1/3)]}if(h>-r){if(-r>u||u>r){var p=this.cubeRoot(u),f=2*p+o*(-1/3),m=o*(-1/3)-p;return m>f?[f,m]:[m,f]}return[o*(-1/3)]}var g=a.acos(u/a.sqrt(-c*c*c))*(1/3),v=a.sqrt(-c),_=1.7320508075688772*v*a.sin(g),b=o*(-1/3);return v*=a.cos(g),[b-v-_,b-v+_,b+2*v]}if(-r>t||t>r){var y=n*n-4*t*i;return y>=0?(y=a.sqrt(y),[(-n-y)/(2*t),(y-n)/(2*t)]):[]}return-r>n||n>r?[-i/n]:[]}},_halfPI:{enumerable:!1,value:.5*Math.PI},reflectionMatrix:{enumerable:!1,value:function(e,t,n,i){var r=Math,a=this._halfPI-r.atan2(t,e),s=r.sin(a),o=r.cos(a),l=this._halfPI-r.atan2(n,e*s+t*o),c=r.sin(l);return i[0]=c*s,i[1]=o*c,i[2]=r.cos(l),i}},reflectedY:{enumerable:!1,value:function(e,t,n,i){return e*i[0]+t*i[1]+n*i[2]}},directedPlaneBezierIntersection:{enumerable:!1,value:function(e,t,n,i,r,a,s,o,l){for(var c,u,h=this.reflectionMatrix(i[0],i[1],i[2],l),d=this.reflectedY(r[0]-e,r[1]-t,r[2]-n,h),p=this.reflectedY(a[0]-e,a[1]-t,a[2]-n,h),f=this.reflectedY(s[0]-e,s[1]-t,s[2]-n,h),m=this.reflectedY(o[0]-e,o[1]-t,o[2]-n,h),g=3*(p-f)+m-d,v=3*(d+f)-6*p,_=3*(p-d),b=this.cubicRealRoots(g,v,_,d),y=0,w=0,C=[];b.length>w&&0>=b[w];)w++;for(;b.length>w&&1>b[w];)c=y,y=b[w],u=.5*(c+y),this.cubic(g,v,_,d,u)>=0&&C.push([c,y]),w++;return u=.5*(y+1),this.cubic(g,v,_,d,u)>=0&&C.push([y,1]),C
}}})}}),montageDefine("b15df60","ui/flow.reel/flow.html",{text:'<!DOCTYPE html><html><head>\n    <meta charset=utf-8>\n    <link rel=stylesheet href=flow.css>\n    <script type=text/montage-serialization>{"repetition":{"prototype":"ui/repetition.reel","properties":{"element":{"#":"montage-flow-repetition"},"contentController":{"@":"frustumController"}},"bindings":{"isSelectionEnabled":{"<-":"@owner.isSelectionEnabled"}}},"frustumController":{"prototype":"core/range-controller","bindings":{"content":{"<-":"@owner.contentController.organizedContent ?? @owner.content"},"selection.0":{"<->":"@owner.contentController.selection.0"},"visibleIndexes":{"<-":"@owner._visibleIndexes"}}},"flowTranslateComposer":{"prototype":"ui/flow.reel/flow-translate-composer","properties":{"flow":{"@":"owner"},"invertAxis":true,"allowFloats":true,"minScroll":0},"bindings":{"maxScroll":{"<-":"@owner.length"},"_momentumDuration":{"<-":"@owner.momentumDuration"},"translateStride":{"<-":"@owner.stride"},"scrollingMode":{"<-":"@owner.scrollingMode"},"linearScrollingVector":{"<-":"@owner.linearScrollingVector"},"isLimitedToSingleStride":{"<-":"@owner.isLimitedToSingleStride"},"delegate":{"<-":"@owner"}}},"slot":{"prototype":"ui/slot.reel","properties":{"element":{"#":"montage-flow-slot"}},"bindings":{"content":{"<->":"@owner.slotContent"}}},"owner":{"properties":{"element":{"#":"montage-flow"},"_repetition":{"@":"repetition"},"_flowTranslateComposer":{"@":"flowTranslateComposer"},"_cameraElement":{"#":"montage-flow-camera"},"_frustumController":{"@":"frustumController"}},"bindings":{"scroll":{"<->":"@flowTranslateComposer.scroll"},"selection":{"<->":"@frustumController.selection"},"selectedIndexes":{"<-":"@repetition.selectedIndexes"},"activeIndexes":{"<-":"@repetition.activeIndexes"},"draggedSlideIndex":{"<-":"@flowTranslateComposer._closerIndex"}}},":iteration":{"alias":"@repetition:iteration"}}</script>\n</head>\n<body>\n    <div data-montage-id=montage-flow class=montage-Flow>\n        <div data-montage-id=montage-flow-camera class=montage-Flow-camera>\n            <div data-montage-id=montage-flow-repetition class=montage-Flow-Repetition>\n                <div data-montage-id=wrapper>\n                    <div data-param=*></div>\n                </div>\n            </div>\n            <div data-montage-id=montage-flow-slot class=montage-Flow-Slot></div>\n        </div>\n    </div>\n\n\n</body></html>'}),montageDefine("b15df60","ui/base/abstract-button",{dependencies:["../../core/core","./abstract-control","../../composer/press-composer"],factory:function(e,t){var n=(e("../../core/core").Montage,e("./abstract-control").AbstractControl),i=e("../../composer/press-composer").PressComposer,r=t.AbstractButton=n.specialize({constructor:{value:function r(){if(this.constructor===r)throw Error("AbstractControl cannot be instantiated.");this.super(),this._pressComposer=new i,this.addComposer(this._pressComposer),this._pressComposer.defineBinding("longPressThreshold ",{"<-":"holdThreshold",source:this}),this.defineBinding("classList.has('montage--disabled')",{"<-":"!enabled"}),this.defineBinding("classList.has('montage--active')",{"<-":"active"})}},enabled:{value:!0},_preventFocus:{value:!1},preventFocus:{get:function(){return this._preventFocus},set:function(e){this._preventFocus=!!e,this.needsDraw=!0}},acceptsActiveTarget:{value:function(){return!this._preventFocus}},willBecomeActiveTarget:{value:function(){}},_labelNode:{value:void 0,enumerable:!1},_label:{value:void 0,enumerable:!1},label:{get:function(){return this._label},set:function(e){if(void 0!==e&&this.converter)try{e=this.converter.convert(e),this.error&&(this.error=null)}catch(t){this.error=t}this._label=""+e,this.needsDraw=!0}},holdThreshold:{value:1e3},_pressComposer:{value:null},_active:{value:!1},active:{get:function(){return this._active},set:function(e){this._active=e,this.needsDraw=!0}},prepareForActivationEvents:{value:function(){this._pressComposer.addEventListener("pressStart",this,!1),this._pressComposer.addEventListener("press",this,!1),this._pressComposer.addEventListener("pressCancel",this,!1)}},addEventListener:{value:function(e,t,i){n.addEventListener.call(this,e,t,i),"longAction"===e&&this._pressComposer.addEventListener("longPress",this,!1)}},handlePressStart:{value:function(e){this.active=!0,e.touch&&document.addEventListener("touchmove",this,!1),this._preventFocus||this._element.focus()}},handlePress:{value:function(){this.active=!1,this.dispatchActionEvent(),document.removeEventListener("touchmove",this,!1)}},handleKeyup:{value:function(e){32===e.keyCode&&(this.active=!1,this.dispatchActionEvent())}},handleLongPress:{value:function(){this._pressComposer.cancelPress();var e=document.createEvent("CustomEvent");e.initCustomEvent("longAction",!0,!0,null),this.dispatchEvent(e)}},handlePressCancel:{value:function(){this.active=!1,document.removeEventListener("touchmove",this,!1)}},handleTouchmove:{value:function(e){e.preventDefault()}},isInputElement:{value:!1},enterDocument:{value:function(e){e&&(this.isInputElement="INPUT"===this.originalElement.tagName,this.isInputElement?void 0===this._label&&(this.label=this.originalElement.value):(this.originalElement.firstChild||this.originalElement.appendChild(document.createTextNode("")),this._labelNode=this.originalElement.firstChild,void 0===this._label&&(this.label=this._labelNode.data)),this.element.setAttribute("role","button"),this.element.addEventListener("keyup",this,!1))}},_drawLabel:{enumerable:!1,value:function(e){this.isInputElement?this._element.value=e:this._labelNode&&(this._labelNode.data=e)}},draw:{value:function(){this._elementNeedsTabIndex()&&(this._preventFocus?this.element.removeAttribute("tabindex"):this.element.setAttribute("tabindex","-1")),this.isInputElement&&(this.element.disabled=!this.enabled),this._drawLabel(this.label)}},_elementNeedsTabIndexRegex:{value:/INPUT|TEXTAREA|A|SELECT|BUTTON|LABEL/},_elementNeedsTabIndex:{value:function(){return null===this.element.tagName.match(this._elementNeedsTabIndexRegex)}}})}}),montageDefine("b15df60","ui/flow.reel/flow-translate-composer",{dependencies:["../../core/core","../../composer/translate-composer","../../core/event/event-manager","../../core/geometry/point","../../core/dom"],factory:function(e,t){var n=(e("../../core/core").Montage,e("../../composer/translate-composer").TranslateComposer),i=(e("../../core/event/event-manager").defaultEventManager,e("../../core/geometry/point").Point),r=e("../../core/dom").convertPointFromPageToNode;t.FlowTranslateComposer=n.specialize({constructor:{value:function(){this.super(),this.handleMousewheel=this.handleWheel}},stealChildrenPointer:{value:!0},_scrollingMode:{value:"linear"},scrollingMode:{get:function(){return this._scrollingMode},set:function(e){switch(e){case"linear":case"drag":this._scrollingMode=e}}},_linearScrollingVector:{value:[-300,0]},linearScrollingVector:{get:function(){return this._linearScrollingVector},set:function(e){this._linearScrollingVector=e}},_startPageX:{value:null},_startPageY:{value:null},_pageX:{value:null},_pageY:{value:null},_pointerStartX:{value:null},_pointerStartY:{value:null},_contentOffsetX:{value:null},_contentOffsetY:{value:null},_start:{value:function(e,t){n._start.apply(this,arguments);var a=window.getComputedStyle(this._element,null),s=this.convertCssPixelsPropertyStringToNumber(a.getPropertyValue("border-left-width")),o=this.convertCssPixelsPropertyStringToNumber(a.getPropertyValue("border-top-width")),l=this.convertCssPixelsPropertyStringToNumber(a.getPropertyValue("padding-left")),c=this.convertCssPixelsPropertyStringToNumber(a.getPropertyValue("padding-top")),u=r(this._element,(new i).init(e,t));this._pointerStartX=this._pointerX=u.x-s-l,this._pointerStartY=this._pointerY=u.y-o-c,this._contentOffsetX=this._startPageX-this._pointerStartX,this._contentOffsetY=this._startPageY-this._pointerStartY,this._computePointedElement(),this._startPageX=this._pageX=e,this._startPageY=this._pageY=t,this._startScroll=this._scroll,this._previousScrollDelta=0,this._scrollEnd=null}},_analyzeMovement:{value:function(e){var t,n,i,r=e.velocity;r&&(t=r.speed,t>=this.startTranslateSpeed?this._stealPointer():(n=this.startPageX-e.pageX,i=this.startPageY-e.pageY,n*n+i*i>this.startTranslateRadius*this.startTranslateRadius&&this._stealPointer()))}},_dispatchTranslateStart:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translateStart",!0,!0,null),e.scroll=this._scroll,e.translateX=0,e.translateY=0,e.pointer=this._observedPointer,this.dispatchEvent(e)}},_dispatchTranslateEnd:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translateEnd",!0,!0,null),e.scroll=this._scroll,e.translateX=0,e.translateY=0,e.pointer=this._observedPointer,this.dispatchEvent(e)}},_dispatchTranslateCancel:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translateCancel",!0,!0,null),e.scroll=this._scroll,e.translateX=0,e.translateY=0,e.pointer=this._observedPointer,this.dispatchEvent(e)}},_dispatchTranslate:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translate",!0,!0,null),e.scroll=this._scroll,e.translateX=0,e.translateY=0,e.pointer=this._observedPointer,this.dispatchEvent(e)}},_move:{value:function(e,t){this._isFirstMove&&(this._dispatchTranslateStart(),this._isFirstMove=!1),this._pageX=e,this._pageY=t,"drag"===this._scrollingMode?(this._pointerX=e-this._contentOffsetX,this._pointerY=t-this._contentOffsetY,this._updateDragScroll()):this._updateLinearScroll(),null!==this._closerIndex,this._shouldDispatchTranslate&&this._dispatchTranslate()}},_end:{value:function(e){this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&(this.startTime=Date.now(),this.endX=this.startX=this._pageX,this.endY=this.startY=this._pageY,this._hasMomentum&&(e.velocity.speed>40||this.translateStrideX||this.translateStrideY)?(this.momentumX="vertical"!=this._axis?e.velocity.x*this._pointerSpeedMultiplier*(this._invertXAxis?1:-1):0,this.momentumY="horizontal"!=this._axis?e.velocity.y*this._pointerSpeedMultiplier*(this._invertYAxis?1:-1):0,this.endX=this.startX+this.momentumX*this.__momentumDuration/2e3,this.endY=this.startY+this.momentumY*this.__momentumDuration/2e3,this.startStrideXTime=null,this.startStrideYTime=null,this.animateMomentum=!0):this.animateMomentum=!1,this.animateMomentum?this._animationInterval():this._isFirstMove||this._dispatchTranslateEnd()),this._releaseInterest()}},_translateEndTimeout:{value:null},_mousewheelStrideTimeout:{value:null},_previousDeltaY:{value:0},handleWheel:{value:function(e){var t=this;if(this.eventManager.isPointerClaimedByComponent(this._WHEEL_POINTER,this.component)){var n=this._pageY,i=e.wheelDeltaY||-e.deltaY||0;this.translateStrideX?(window.clearTimeout(this._mousewheelStrideTimeout),(null===this._mousewheelStrideTimeout||Math.abs(i)>Math.abs(this._previousDeltaY*(null===this._mousewheelStrideTimeout?2:4)))&&(i>1?this.callDelegateMethod("previousStride",this):-1>i&&this.callDelegateMethod("nextStride",this)),this._mousewheelStrideTimeout=window.setTimeout(function(){t._mousewheelStrideTimeout=null,t._previousDeltaY=0},70),t._previousDeltaY=i,this._shouldPreventDefault(e)&&e.preventDefault()):(null===this._translateEndTimeout&&this._dispatchTranslateStart(),this._pageY=this._pageY+20*i/100,this._updateScroll(),this._dispatchTranslate(),window.clearTimeout(this._translateEndTimeout),this._translateEndTimeout=window.setTimeout(function(){t._dispatchTranslateEnd(),t._translateEndTimeout=null},400),n!==this._pageY&&this._shouldPreventDefault(e)&&e.preventDefault()),this.eventManager.forfeitPointer(this._WHEEL_POINTER,this.component)}}},_scroll:{value:0},scroll:{get:function(){return this._scroll},set:function(e){null!==this.minScroll&&this.minScroll>e&&(e=this.minScroll),null!==this.maxScroll&&e>this.maxScroll&&(e=this.maxScroll),this._scroll=e}},minScroll:{value:null},maxScroll:{value:null},_flow:{value:null},flow:{get:function(){return this._flow},set:function(e){this._flow=e,this.component=e}},_updateScroll:{value:function(){"linear"===this._scrollingMode?this._updateLinearScroll():this._updateDragScroll()}},_updateLinearScroll:{value:function(){var e=500/this._flow._height,t=(this._pageX-this._startPageX)*this._linearScrollingVector[0]*e,n=(this._pageY-this._startPageY)*this._linearScrollingVector[1]*e,i=this._linearScrollingVector[0]*this._linearScrollingVector[0]+this._linearScrollingVector[1]*this._linearScrollingVector[1],r=(t+n)/i;this.scroll+=r-this._previousScrollDelta,this._previousScrollDelta=r}},_updateDragScroll:{value:function(){var e=(this._pointerX-this._pointerStartX)*this._lineVectorX,t=(this._pointerY-this._pointerStartY)*this._lineVectorY,n=this._lineVectorX*this._lineVectorX+this._lineVectorY*this._lineVectorY,i=(e+t)/n;this.scroll+=i-this._previousScrollDelta,this._previousScrollDelta=i;var r,a,s,o,l,c,u,h,d,p,f,m,g,v,_,b,y,w,C,L,x=this._flow,M=x._cameraPosition,E=x._splinePaths,S=E.length,O=this._closerIndex%S,T=this.flow._splinePaths[O],z=Math.floor(this._closerIndex/S)-this._scroll+this._flow._paths[O].headOffset,P=null,D=null,k=0,A=.5*this._element.clientWidth,j=.5*this._element.clientHeight,e=A-this._pointerX,t=j-this._pointerY,B=x.cameraTargetPoint[0]-M[0],I=x.cameraTargetPoint[1]-M[1],R=x.cameraTargetPoint[2]-M[2],N=-Math.atan2(B,R),F=this._pointerIntersectionPosition;f=R*Math.cos(N)-B*Math.sin(N),m=-Math.atan2(I,f),b=Math.sin(N),y=Math.cos(N),w=Math.sin(m),C=Math.cos(m),v=j/Math.tan(.008726646259972*x.cameraFov),L=0,u=1e100;do p=T._convertSplineTimeToBezierIndexTime(z+L),null!==p&&(r=T.getPositionAtIndexTime(p),rotation=E[O].getRotationAtIndexTime(p),g=this._rotateXYZ(F,rotation),a=(M[2]-r[2]-g[2])*b-(r[0]-M[0]+g[0])*y,s=r[1]-M[1]+g[1],o=(r[2]-M[2]+g[2])*y-(r[0]-M[0]+g[0])*b,l=o*w+s*C,c=o*C-s*w,_=v/c,a=e+a*_,s=t+l*_,d=a*a+s*s,u>d&&(u=d,P=L)),L-=.025;while(L>-6);P+.025>0&&(P=-.025),L=P+.025,u=1e100;do p=T._convertSplineTimeToBezierIndexTime(z+L),null!==p&&(r=T.getPositionAtIndexTime(p),rotation=E[O].getRotationAtIndexTime(p),g=this._rotateXYZ(F,rotation),a=(M[2]-r[2]-g[2])*b-(r[0]-M[0]+g[0])*y,s=r[1]-M[1]+g[1],o=(r[2]-M[2]+g[2])*y-(r[0]-M[0]+g[0])*b,l=o*w+s*C,c=o*C-s*w,_=v/c,a=e+a*_,s=t+l*_,d=a*a+s*s,u>d&&(u=d,P=L)),L-=2e-4;while(L>P-.05);L=0,h=1e100;do p=T._convertSplineTimeToBezierIndexTime(z+L),null!==p&&(r=T.getPositionAtIndexTime(p),rotation=E[O].getRotationAtIndexTime(p),g=this._rotateXYZ(F,rotation),a=(M[2]-r[2]-g[2])*b-(r[0]-M[0]+g[0])*y,s=r[1]-M[1]+g[1],o=(r[2]-M[2]+g[2])*y-(r[0]-M[0]+g[0])*b,l=o*w+s*C,c=o*C-s*w,_=v/c,a=e+a*_,s=t+l*_,d=a*a+s*s,h>d&&(h=d,D=L)),L+=.025;while(6>L);0>D-.025&&(D=.025),L=D-.025,h=1e100;do p=T._convertSplineTimeToBezierIndexTime(z+L),null!==p&&(r=T.getPositionAtIndexTime(p),rotation=E[O].getRotationAtIndexTime(p),g=this._rotateXYZ(F,rotation),a=(M[2]-r[2]-g[2])*b-(r[0]-M[0]+g[0])*y,s=r[1]-M[1]+g[1],o=(r[2]-M[2]+g[2])*y-(r[0]-M[0]+g[0])*b,l=o*w+s*C,c=o*C-s*w,_=v/c,a=e+a*_,s=t+l*_,d=a*a+s*s,h>d&&(h=d,D=L)),L+=2e-4;while(D+.05>L);P?k=D?D*D>P*P?P:D:P:D&&(k=D),k>0?.05>=k&&(this.scroll=this._scroll-k):k>=-.05&&(this.scroll=this._scroll-k)}},frame:{value:function(){this.isAnimating&&this._animationInterval()}},convertCssPixelsPropertyStringToNumber:{value:function(e){return"string"==typeof e?"px"===e.substr(-2)?1*e.substr(0,e.length-2):0:0}},_rayPointDistance:{value:function(e,t){var n,i,r,a,s;return n=e[0]*t[0]+e[1]*t[1]+e[2]*t[2],n>=0?(i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n/=i,r=e[0]*n-t[0],a=e[1]*n-t[1],s=e[2]*n-t[2],Math.sqrt(r*r+a*a+s*s)):!1}},_rayRectangleIntersection:{value:function(e,t,n,i){var r,a,s,o,l,c=e[1]*i[2]-e[2]*i[1],u=e[2]*i[0]-e[0]*i[2],h=e[0]*i[1]-e[1]*i[0],d=n[0]*c+n[1]*u+n[2]*h,p=1e-10,f=!1;return-p>d?(r=-t[0]*c-t[1]*u-t[2]*h,0>r&&r>d&&(s=n[1]*t[2]-n[2]*t[1],o=n[2]*t[0]-n[0]*t[2],l=n[0]*t[1]-n[1]*t[0],a=e[0]*s+e[1]*o+e[2]*l,0>a&&a>d&&(f=(i[0]*s+i[1]*o+i[2]*l)/d,0>f&&(f=!1)))):d>p&&(r=-t[0]*c-t[1]*u-t[2]*h,r>0&&d>r&&(s=n[1]*t[2]-n[2]*t[1],o=n[2]*t[0]-n[0]*t[2],l=n[0]*t[1]-n[1]*t[0],a=e[0]*s+e[1]*o+e[2]*l,a>0&&d>a&&(f=(i[0]*s+i[1]*o+i[2]*l)/d,0>f&&(f=!1)))),f}},_rayRectangleIntersectionPosition:{enumerable:!1,value:function(e,t,n,i){var r,a,s,o,l,c=e[1]*i[2]-e[2]*i[1],u=e[2]*i[0]-e[0]*i[2],h=e[0]*i[1]-e[1]*i[0],d=n[0]*c+n[1]*u+n[2]*h,p=this._flow._boundingBoxSize;return r=-t[0]*c-t[1]*u-t[2]*h,s=n[1]*t[2]-n[2]*t[1],o=n[2]*t[0]-n[0]*t[2],l=n[0]*t[1]-n[1]*t[0],a=e[0]*s+e[1]*o+e[2]*l,[r*p[0]/d-.5*p[0],a*p[1]/d-.5*p[1],0]}},_rotateXYZ:{enumerable:!1,value:function(e,t){var n,i,r,a,s=Math.cos(t[0]),o=Math.sin(t[0]),l=Math.cos(t[1]),c=Math.sin(t[1]),u=Math.cos(t[2]),h=Math.sin(t[2]);return i=s*e[1]-o*e[2],r=o*e[1]+s*e[2],a=l*e[0]+c*r,r=-c*e[0]+l*r,n=u*a-h*i,i=h*a+u*i,[n,i,r]}},_pointerIntersectionPosition:{enumerable:!1,value:null},_closerIndex:{enumerable:!1,value:null},_computePointedElement:{value:function(){var e=this._flow._splinePaths,t=e.length;if(t){var n,i,r,a,s,o,l,c,u,h=this._flow,d=h.cameraTargetPoint[0]-h.cameraPosition[0],p=h.cameraTargetPoint[2]-h.cameraPosition[2],f=Math.atan2(d,p),m=p*Math.cos(-f)-d*Math.sin(-f),g=Math.atan2(h.cameraTargetPoint[1]-h.cameraPosition[1],m),v=.5*this._element.clientWidth-this._pointerX,_=this._pointerY-.5*this._element.clientHeight,b=.5*this._element.offsetHeight/Math.tan(h.cameraFov*h._doublePI*(1/720)),y=[],w=h._visibleIndexes,C=w.length,L=null,x=1e100;for(i=b*Math.cos(g)-_*Math.sin(g),_=b*Math.sin(g)+_*Math.cos(g),n=i*Math.cos(f)-v*Math.sin(f),v=i*Math.sin(f)+v*Math.cos(f),l=[v,_,n],u=0;e.length>u;u++)y[u]=e[u].transform([1,0,0,0,0,1,0,0,0,0,1,0,-h.cameraPosition[0],-h.cameraPosition[1],-h.cameraPosition[2],1]);for(u=0;C>u;u++)c=this._flow.offset(w[u]),r=c.pathIndex,a=c.slideTime,o=y[r]._convertSplineTimeToBezierIndexTime(a),null!==o&&(pos=y[r].getPositionAtIndexTime(o),s=this._rayPointDistance(l,pos),s!==!1&&x>s&&(x=s,L=w[u]));this._closerIndex=L}}},test:{enumerable:!1,value:function(){var e,t,n,i,r,a,s,o,l,c,u=this._flow,h=this._bezierValue,d=u.cameraTargetPoint[0]-u.cameraPosition[0],p=u.cameraTargetPoint[1]-u.cameraPosition[1],f=u.cameraTargetPoint[2]-u.cameraPosition[2],m=Math.atan2(d,f),g=this._pointerX,v=this._pointerY;if(e=f*Math.cos(-m)-d*Math.sin(-m),t=Math.atan2(p,e),i=.5*this._element.clientWidth-g,r=v-.5*this._element.clientHeight,c=a=.5*this._element.offsetHeight/Math.tan(u.cameraFov*u._doublePI*(1/720)),l=a*Math.cos(t)-r*Math.sin(t),o=a*Math.sin(t)+r*Math.cos(t),s=i,a=l*Math.cos(m)-s*Math.sin(m),i=l*Math.sin(m)+s*Math.cos(m),r=o,this.t=n=this._raycastBezierTubes(u._cameraPosition[0],u._cameraPosition[1],u._cameraPosition[2],this._computeRotationValuesToXAxis(i,r,a)),null!==n[0]){var i,r,a,s,o,l,_,b,y,w,C,L=[u._splinePaths[n[0]]._knots[n[1]][0]-u._cameraPosition[0],u._splinePaths[n[0]]._knots[n[1]][1]-u._cameraPosition[1],u._splinePaths[n[0]]._knots[n[1]][2]-u._cameraPosition[2],u._splinePaths[n[0]]._nextHandlers[n[1]][0]-u._cameraPosition[0],u._splinePaths[n[0]]._nextHandlers[n[1]][1]-u._cameraPosition[1],u._splinePaths[n[0]]._nextHandlers[n[1]][2]-u._cameraPosition[2],u._splinePaths[n[0]]._previousHandlers[n[1]+1][0]-u._cameraPosition[0],u._splinePaths[n[0]]._previousHandlers[n[1]+1][1]-u._cameraPosition[1],u._splinePaths[n[0]]._previousHandlers[n[1]+1][2]-u._cameraPosition[2],u._splinePaths[n[0]]._knots[n[1]+1][0]-u._cameraPosition[0],u._splinePaths[n[0]]._knots[n[1]+1][1]-u._cameraPosition[1],u._splinePaths[n[0]]._knots[n[1]+1][2]-u._cameraPosition[2]],x=[];for(C=0;12>C;C+=3)x[0]=L[C+2]*Math.sin(-m)+L[C]*Math.cos(-m),x[1]=L[C+1],x[2]=L[C+2]*Math.cos(-m)-L[C]*Math.sin(-m),L[C]=x[0],L[C+1]=x[2]*Math.sin(-t)+x[1]*Math.cos(-t),L[C+2]=x[2]*Math.cos(-t)-x[1]*Math.sin(-t);a=h(L[2],L[5],L[8],L[11],n[2]),l=h(L[2],L[5],L[8],L[11],n[2]+1e-8),i=h(L[0],L[3],L[6],L[9],n[2])/a,s=h(L[0],L[3],L[6],L[9],n[2]+1e-8)/l,_=(s-i)*c/1e-8,r=h(L[1],L[4],L[7],L[10],n[2])/a,o=h(L[1],L[4],L[7],L[10],n[2]+1e-8)/l,dy=(o-r)*c/1e-8,b=Math.sqrt(_*_+dy*dy),y=Math.atan2(dy,_),w=u._splinePaths[n[0]]._densities[n[1]]*(1-n[2])+u._splinePaths[n[0]]._densities[n[1]+1]*n[2],this._lineVectorX=Math.cos(-y)*b/w,this._lineVectorY=Math.sin(-y)*b/w}}},_lineVectorX:{enumerable:!1,value:80*Math.cos(Math.PI-.6)},_lineVectorY:{enumerable:!1,value:80*Math.sin(Math.PI-.6)},_startX:{enumerable:!1,value:0},_startY:{enumerable:!1,value:0},_currentX:{enumerable:!1,value:0},_currentY:{enumerable:!1,value:0},_previousScrollDelta:{enumerable:!1,value:0},_startScroll:{enumerable:!1,value:0},_bezierValue:{enumerable:!1,value:function(e,t,n,i,r){var a=1-r;return e*a*a*a+3*t*a*a*r+3*n*a*r*r+i*r*r*r}},_computeRotationValuesToXAxis:{enumerable:!1,value:function(e,t,n){var i,r,a,s,o;return 1e-100>e*e&&(e=1e-50),i=e*e+t*t,r=Math.sqrt(i),a=1/r,o=e*a,s=-t*a,a=1/Math.sqrt(i+n*n),[s,o,-n*a,r*a]}},_infinite:{enumerable:!1,value:1e100},_sphereIntersection:{enumerable:!1,value:function(e,t){var n,i,r,a=e[0]*t[1]-e[1]*t[0],s=e[0]*t[0]+e[1]*t[1],o=a*t[2]+e[2]*t[3],l=e[3]*e[3];return l>=s*s+o*o?(n=a*t[3]-e[2]*t[2],i=Math.sqrt(l-s*s-o*o),r=n-i,0>r?0>n+i?this._infinite:0:r):this._infinite}},_bezierTubeBoundingSphere:{enumerable:!1,value:function(e,t){var n,i,r,a,s,o=e[0],l=e[1],c=e[2],u=e[0],h=e[1],d=e[2];return s=e[3],o>s?o=s:s>u&&(u=s),s=e[4],l>s?l=s:s>h&&(h=s),s=e[5],c>s?c=s:s>d&&(d=s),s=e[6],o>s?o=s:s>u&&(u=s),s=e[7],l>s?l=s:s>h&&(h=s),s=e[8],c>s?c=s:s>d&&(d=s),s=e[9],o>s?o=s:s>u&&(u=s),s=e[10],l>s?l=s:s>h&&(h=s),s=e[11],c>s?c=s:s>d&&(d=s),n=.5*(u-o),i=.5*(h-l),r=.5*(d-c),a=Math.sqrt(n*n+i*i+r*r)+t,[o+n,l+i,c+r,a]}},_raycastBezierTubes:{enumerable:!1,value:function(e,t,n,i){var r,a,s,o,l,c,u,h,d,p,f,m,g,v,_,b,y,w,C,L,x,M,E,S,O,T,z,P,D=[],k=this._infinite,A=null,j=0,B=null,I=0,R=this._flow._splinePaths;for(P=0;R.length>P;P++)for(z=0;R[P]._knots.length-1>z;z++)D[I]=[R[P]._knots[z][0]-e,R[P]._knots[z][1]-t,R[P]._knots[z][2]-n,R[P]._nextHandlers[z][0]-e,R[P]._nextHandlers[z][1]-t,R[P]._nextHandlers[z][2]-n,R[P]._previousHandlers[z+1][0]-e,R[P]._previousHandlers[z+1][1]-t,R[P]._previousHandlers[z+1][2]-n,R[P]._knots[z+1][0]-e,R[P]._knots[z+1][1]-t,R[P]._knots[z+1][2]-n,0,1048576,z,P],I++;for(z=I-1;z>=0;)u=D[z],h=.5*(u[0]+u[3]),d=.5*(u[3]+u[6]),p=.5*(u[6]+u[9]),v=.5*(u[1]+u[4]),_=.5*(u[4]+u[7]),b=.5*(u[7]+u[10]),L=.5*(u[2]+u[5]),x=.5*(u[5]+u[8]),M=.5*(u[8]+u[11]),f=.5*(h+d),m=.5*(d+p),g=.5*(f+m),y=.5*(v+_),w=.5*(_+b),C=.5*(y+w),E=.5*(L+x),S=.5*(x+M),O=.5*(E+S),T=u[13]>>1,s=[u[0],u[1],u[2],h,v,L,f,y,E,g,C,O,u[12],T,u[14],u[15]],r=this._bezierTubeBoundingSphere(s,this._flow._elementsBoundingSphereRadius),o=[g,C,O,m,w,S,p,b,M,u[9],u[10],u[11],u[12]+T,T,u[14],u[15]],a=this._bezierTubeBoundingSphere(o,this._flow._elementsBoundingSphereRadius),l=this._sphereIntersection(r,i),c=this._sphereIntersection(a,i),k>l?k>c?c>l?T?(D[z++]=o,D[z]=s):(k=l-1e-5,j=u[12],A=u[14],B=u[15],z--):T?(D[z++]=s,D[z]=o):(k=c-1e-5,j=u[12],A=u[14],B=u[15],z--):T?D[z]=s:(k=l-1e-5,j=u[12],A=u[14],B=u[15],z--):k>c?T?D[z]=o:(k=c-1e-5,j=u[12],A=u[14],B=u[15],z--):z--;return[B,A,j*(1/1048576)]}},_translateStride:{enumerable:!1,value:null},translateStride:{serializable:!0,get:function(){return this._translateStride},set:function(e){this._translateStride=e,this.translateStrideX=e}},startStrideTime:{enumerable:!1,value:null},_scrollEnd:{enumerable:!1,value:null},_scrollStart:{enumerable:!1,value:null},_hasMomentum:{enumerable:!1,value:!0},isLimitedToSingleStride:{value:!1},_animationInterval:{enumerable:!1,value:function(){var e,t,n,i,r,a,s=Date.now(),o=!1;r=this.minScroll,a=this.maxScroll,this.minScroll=null,this.maxScroll=null,null===this._scrollEnd&&(this._scrollStart=this.scroll,this._pageX=this.endX,this._pageY=this.endY,this._updateScroll(),this._scrollEnd=this.scroll,this.isLimitedToSingleStride&&this.translateStrideX&&(this._scrollEnd>Math.floor(this._scrollStart)+this.translateStrideX&&(this._scrollEnd=Math.floor(this._scrollStart)+this.translateStrideX),this._scrollEnd<Math.ceil(this._scrollStart)-this.translateStrideX&&(this._scrollEnd=Math.ceil(this._scrollStart)-this.translateStrideX)),this._pageX=this.startX,this._pageY=this.startY,this._updateScroll()),this.animateMomentum?(e=s-this.startTime,this.__momentumDuration>e?(this._pageX=this.startX+(this.momentumX+this.momentumX*(this.__momentumDuration-e)/this.__momentumDuration)*e/1e3/2,this._pageY=this.startY+(this.momentumY+this.momentumY*(this.__momentumDuration-e)/this.__momentumDuration)*e/1e3/2,this._updateScroll(),this.translateStrideX&&null===this.startStrideXTime&&(this.__momentumDuration-e<this.translateStrideDuration||Math.abs(this.scroll-this._scrollEnd)<.75*this.translateStrideX)&&(this.startStrideXTime=s,this._strideStartScroll=this._scroll)):this.animateMomentum=!1):null===this.startStrideXTime&&(this.startStrideXTime=this.startTime,this._strideStartScroll=this._scrollStart),i=this.scroll,this.startStrideXTime&&s-this.startStrideXTime>0&&(n=Math.round(this._scrollEnd/this.translateStrideX),s-this.startStrideXTime<this.translateStrideDuration?(e=this._bezierTValue((s-this.startStrideXTime)/this.translateStrideDuration,.275,0,.275,1),t=(s-this.startStrideXTime)/this.translateStrideDuration,i=i*(1-t)+(n*this.translateStrideX*e+this._strideStartScroll*(1-e))*t,o=!0):(i=n*this.translateStrideX,this.animateMomentum=!1)),this.minScroll=r,this.maxScroll=a,r>i&&(i=r,this.animateMomentum=!1,o=!1),i>a&&(i=a,this.animateMomentum=!1,o=!1),this.scroll=i,this.isAnimating=this.animateMomentum||o,this.isAnimating?this.needsFrame=!0:(this._dispatchTranslateEnd(),this._scrollEnd=null)}}})}}),montageDefine("b15df60","ui/repetition.reel/repetition",{dependencies:["../../core/core","../component","../../core/template","../../core/range-controller","../../core/promise","../../core/browser","collections/map","collections/set","../../core/deprecate","../../core/logger","frb/observers"],factory:function(e,t){var n=e("../../core/core").Montage,i=e("../component").Component;e("../../core/template").Template;var r=e("../../core/range-controller").RangeController,a=e("../../core/promise").Promise,s=e("../../core/browser").browser,o=e("collections/map"),l=e("collections/set"),c=e("../../core/deprecate").deprecationWarning,u=e("../../core/logger").logger("repetition").color.magenta(),h=e("frb/observers"),d=h.observeProperty,p=h.observeKey,f=t.Iteration=n.specialize({repetition:{value:null},controller:{value:null},object:{value:null},selected:{value:null},_fragment:{value:null},_childComponents:{value:null},index:{value:null},_drawnIndex:{value:null},active:{value:null},_noTransition:{value:null},_templateDocumentPart:{value:null},isDirty:{value:!1},constructor:{value:function f(){this.super(),u.isDebug&&u.debug("Iteration:%s create iteration %O",Object.hash(this),this),this.repetition=null,this.controller=null,this.object=null,this.defineBinding("selected",{"<->":"object.defined() ? repetition.contentController.selection.has(object) : selected"}),this._fragment=null,this._childComponents=null,this.index=null,this._drawnIndex=null,this.active=!1,this.defineBinding("active",{"<->":"repetition.activeIterations.has(())"}),this._noTransition=!1,this.addOwnPropertyChangeListener("active",this),this.addOwnPropertyChangeListener("selected",this),this.addOwnPropertyChangeListener("_noTransition",this),this.addPathChangeListener("index.defined() && _childComponents.defined()",this,"handleComponentModelChange"),this.cachedFirstElement=null}},initWithRepetition:{value:function(e){return this.repetition=e,this}},recycle:{value:function(){this.index=null,this.object=null,this._noTransition=!0}},injectIntoDocument:{value:function(e){null!==this._drawnIndex?(u.isDebug&&u.debug("Iteration:%s retracting from index %s and injecting at %s",Object.hash(this),this._drawnIndex,e),this.retractFromDocument()):u.isDebug&&u.debug("Iteration:%s injecting at index %s",Object.hash(this),e);var t=this,n=this.repetition,i=n.element,r=n._boundaries,a=i.ownerDocument.createTextNode(""),s=r[e];if(r.splice(e,0,a),i.insertBefore(a,s),i.insertBefore(this._fragment,s),n._drawnIterations.splice(e,0,this),n._updateDrawnIndexes(e),n._addDirtyClassListIteration(this),!this._elementsWillBeAddedToMap){var o=this._childComponents.length,l=function(e){e.target.removeEventListener("firstDraw",l,!1),o--,o||t.forEachElement(function(e){n._iterationForElement.set(e,t)})};if(this._childComponents.length>0)for(var c=0;this._childComponents.length>c;c++){var h=this._childComponents[c];h.addEventListener("firstDraw",l,!1),h.needsDraw=!0,h._completedFirstDraw===!0&&console.error("Repetiton:%s child component %O has already drawn.",Object.hash(this),h)}else this.forEachElement(function(e){n._iterationForElement.set(e,t)});this._elementsWillBeAddedToMap=!0}}},_elementsWillBeAddedToMap:{value:!1},retractFromDocument:{value:function(){u.isDebug&&u.debug("Iteration:%s retractFromDocument drawnIndex: %s",Object.hash(this),this._drawnIndex);var e=this._drawnIndex,t=this.repetition,n=t.element,i=t._boundaries[e],r=t._boundaries[e+1];t._boundaries.splice(e,1);for(var a=this._fragment,s=i.nextSibling;s!=r;){var o=s.nextSibling;n.removeChild(s),a.appendChild(s),s=o}n.removeChild(i),this._drawnIndex=null,t._drawnIterations.splice(e,1),t._updateDrawnIndexes(e)}},handleComponentModelChange:{value:function(e){e?this._childComponents.forEach(this.repetition.addChildComponent,this.repetition):this._childComponents&&this._childComponents.forEach(this.repetition.removeChildComponent,this.repetition)}},handlePropertyChange:{value:function(){this.repetition&&(this.repetition._addDirtyClassListIteration(this),this.repetition.needsDraw=!0)}},forEachElement:{value:function(e,t){var n=this.repetition,i=this._drawnIndex;if(null!=i)for(var r=n._boundaries[i];r!==n._boundaries[i+1];r=r.nextSibling)1===r.nodeType&&e.call(t,r)}},firstElement:{get:function(){var e=this.repetition,t=this._drawnIndex;if(null!=t)for(var n=e._boundaries[t];n!==e._boundaries[t+1];n=n.nextSibling)if(1===n.nodeType)return this.cachedFirstElement=n,n}},isComponentTreeLoaded:{value:function(){return null!==this._fragment}},cachedFirstElement:{value:null}});t.Repetition=i.specialize({initWithContent:{value:function(e){return this.object=e,this}},initWithContentController:{value:function(e){return this.contentController=e,this}},content:{get:function(){return this.getPath("contentController.content")},set:function(e){this.contentController=(new r).initWithContent(e)}},contentController:{value:null},isSelectionEnabled:{value:null},selection:{value:null},selectedIterations:{value:null},selectedIndexes:{value:null},activeIterations:{value:null},iterations:{value:null},currentIteration:{value:null},objectAtCurrentIteration:{value:null},hasTemplate:{value:!1},_iterationTemplate:{value:null},clonesChildComponents:{value:!0},constructor:{value:function(){this.super(),this.contentController=null,this.organizedContent=[],this.defineBinding("organizedContent.rangeContent()",{"<-":"contentController.organizedContent"}),this.isSelectionEnabled=!1,this.defineBinding("selection",{"<->":"contentController.selection"}),this.defineBinding("selectedIterations",{"<-":"iterations.filter{selected}"}),this.defineBinding("selectedIndexes",{"<-":"selectedIterations.map{index}"}),this._iterationTemplate=null,this.addPathChangeListener(this._setupRequirements,this,"_handleSetupRequirementsChange"),this.addPathChangeListener("innerTemplate",this,"_handleInnerTemplateChange"),this.iterations=[],this._drawnIterations=[],this._freeIterations=[],this._contentForIteration=o(),this._iterationForElement=o(),this.currentIteration=null,this._templateId=null,this._iterationCreationPromise=a.resolve(),this._boundaries=[],this._dirtyClassListIterations=l(),this._requestedIterations=0,this._createdIterations=0,this._canDrawInitialContent=!1,this._initialContentDrawn=!1,this.addOwnPropertyChangeListener("isSelectionEnabled",this),this._selectionPointer=null,this.activeIterations=[]}},_setupRequirements:{value:"[!_iterationTemplate.defined(),!_newDomContent.defined(),!_shouldClearDomContentOnNextDraw,_isComponentExpanded,_ownerDocumentPart.defined()].every{}"},_handleSetupRequirementsChange:{value:function(e){e&&this._setupIterationTemplate()
}},_handleInnerTemplateChange:{value:function(e){this._iterationTemplate&&this._teardownIterationTemplate(),e&&this.getPath(this._setupRequirements)&&this._setupIterationTemplate()}},cleanupDeletedComponentTree:{value:function(e){var t=this._innerTemplate;this._innerTemplate=null,t&&this._teardownIterationTemplate(),e&&this.cancelBindings()}},expandComponent:{value:function(){return this._isComponentExpanded=!0,a.resolve()}},_buildIterationTemplate:{value:function(){var e,t,i,r;return e=this.innerTemplate.clone(),t=e.getSerialization(),i=t.getSerializationObject(),r=n.getInfoForObject(this).label,this._iterationLabel=r+":iteration",i[this._iterationLabel]={},e.setObjects(i),this.innerTemplate.hasParameters()&&this._expandIterationTemplateParameters(e),window._montage_le_flag&&(e.refresher=this,this._leTagIterationTemplate(e)),e}},_rebuildIterationTemplate:{value:function(){var e,t=this._iterationTemplate,n=this.iterations;this._purgeFreeIterations();for(var i,r=0;i=n[r];r++)i.isDirty=!0;this._innerTemplate=null,e=this._buildIterationTemplate(),t.replaceContentsWithTemplate(e)}},refreshTemplate:{value:function(){this._rebuildIterationTemplate()}},_setupIterationTemplate:{value:function(){var e=this;this._iterationTemplate=this._buildIterationTemplate();for(var t,n=e.childComponents,i=n.length-1;t=n[i--];)t.detachFromParentComponent(),t.needsDraw=!1,t.cleanupDeletedComponentTree(!0);e.handleOrganizedContentRangeChange(e.organizedContent,[],0),e.organizedContent.addRangeChangeListener(e,"organizedContent"),e._canDrawInitialContent=!0,e.needsDraw=!0}},_leTagIterationTemplate:{value:function(e){var t=e.document.body;if(t.children.length>0){var n=this.ownerComponent._montage_metadata.moduleId,i=this._montage_metadata.label;this._leTagStarArgument(n,i,t)}}},_teardownIterationTemplate:{value:function(){this.organizedContent.removeRangeChangeListener(this,"organizedContent"),this.handleOrganizedContentRangeChange([],this.organizedContent,0),this._purgeFreeIterations(),this._iterationTemplate=null,this._contentForIteration.clear(),this._iterationForElement.clear(),this.currentIteration=null,this._templateId=null,this._requestedIterations=0,this._createdIterations=0,this._canDrawInitialContent=!1,this._selectionPointer=null,this.activeIterations.clear(),this._dirtyClassListIterations.clear()}},_purgeFreeIterations:{value:function(){for(var e=0;this._freeIterations.length>e;e++)for(var t=this._freeIterations[e],n=0;t._childComponents.length>n;n++){var i=t._childComponents[n];this.removeChildComponent(i),i.cleanupDeletedComponentTree(!0)}this._freeIterations.clear()}},_expandIterationTemplateParameters:{value:function(e){for(var t,n,i,r,a,s,o,l,c,u=this;e.hasParameters();){u=u.ownerComponent,t=u._ownerDocumentPart.template,r=u._ownerDocumentPart.objects,s=e.expandParameters(u),i=e.getSerialization().getExternalObjectLabels(),a=e.getInstances(),l=s.labels,n=s.labelsCollisions;for(var h,d=0;h=l[d];d++)o=n&&h in n?n[h]:h,i.indexOf(o)>=0?a[o]=r[h]:(c=t.getObjectMetadata(h),c.owner||(c.owner=r.owner),e.setObjectMetadata(o,c.require,c.label,c.owner))}}},_iterationLabel:{value:null},_iterationCreationPromise:{value:null},_createIteration:{value:function(){var e=this,t=(new this.Iteration).initWithRepetition(this);return this._iterationCreationPromise=this._iterationCreationPromise.then(function(){var n,i,r=e.element.ownerDocument;return e.currentIteration=t,n=e._iterationTemplate.getInstances(),n=Object.create(n),n[e._iterationLabel]=t,i=e._iterationTemplate.instantiateWithInstances(n,r).then(function(n){n.parentDocumentPart=e._ownerDocumentPart,t._templateDocumentPart=n,n.loadComponentTree().then(function(){u.isDebug&&u.debug("Iteration:%s component tree loaded.",Object.hash(t)),t._fragment=n.fragment,t._childComponents=n.childComponents,e.constructIteration(t)}).done(),e.currentIteration=null}),i.done(),i.then(null,function(){})}),this._requestedIterations++,t}},constructIteration:{value:function(){this._createdIterations++,this._createdIterations>=this._requestedIterations&&(this.needsDraw=!0,this._canDraw=!0)}},observeProperty:{value:function(e,t,n){return"contentAtCurrentIteration"===e||"objectAtCurrentIteration"===e?("contentAtCurrentIteration"===e?c("contentAtCurrentIteration",":iteration.object"):"objectAtCurrentIteration"===e&&c("objectAtCurrentIteration",":iteration.object"),p(this._contentForIteration,this.currentIteration,t,n)):"currentIteration"===e?(c("currentIteration",":iteration"),t(this.currentIteration)):d(this,e,t,n)}},makePropertyObservable:{value:function(e){return"currentIteration"!==e?n.makePropertyObservable.call(this,e):void 0}},_controllerIterations:{value:null},_drawnIterations:{value:null},_freeIterations:{value:null},_contentForIteration:{value:null},handleOrganizedContentRangeChange:{value:function(e,t,n){u.isDebug&&u.debug("Repetition:%s content changed +%s@%s %O -%s %O ",Object.hash(this),e?e.length:0,n,e,t?t.length:0,t);var i=this.iterations,r=this._contentForIteration;this._iterationTemplate.isDirty&&this._iterationTemplate.refresh();var a=Math.min(e.length,t.length),s=t.length-a,o=e.length-a;if(u.isDebug&&u.debug("Repetition:%s +%s -%s iterations",Object.hash(this),o,s),a>0)for(var l=0;a>l;l++,n++)i[n].object=e[l],r.set(i[n],e[l]);if(s>0){var c=i.splice(n,s);c.forEach(function(e){e.recycle()});for(var h,l=0;h=c[l];l++)h.isDirty||this._freeIterations.push(h)}if(o>0){if(u.isDebug)var d=[];for(;o>this._freeIterations.length;)this._freeIterations.push(this._createIteration()),u.isDebug&&d.push(this._freeIterations[this._freeIterations.length-1]);for(var p=Array(o),l=a,f=0;e.length>l;l++,f++){var m=this._freeIterations.pop();u.isDebug&&(d.has(m)||u.debug("Repetition:%s reusing %s",Object.hash(this),Object.hash(m)));var g=e[l];m.object=g,r.set(m,g),p[f]=m}i.swap(n,0,p)}(s>0||o>0)&&this._updateIndexes(n),this.needsDraw=!0}},_updateIndexes:{value:function(e){for(var t=this.iterations;t.length>e;e++)t[e].index=e}},_addDirtyClassListIteration:{value:function(e){e.forEachElement(function(t){var n;t&&(n=t.component)?(n.classList[e.active?"add":"remove"]("active"),n.classList[e.selected?"add":"remove"]("selected"),n.classList.remove("no-transition")):this._dirtyClassListIterations.add(e)},this)}},canDraw:{value:function(){var e=this.canDrawGate.value;return e=e&&this._requestedIterations<=this._createdIterations,e=e&&(this._initialContentDrawn||this._canDrawInitialContent)}},_boundaries:{value:null},_dirtyClassListIterations:{value:null},_requestedIterations:{value:null},_createdIterations:{value:null},_canDrawInitialContent:{value:null},_initialContentDrawn:{value:null},draw:{value:function(){this._initialContentDrawn||(this._drawInitialContent(),this._initialContentDrawn=!0);for(var e=this._drawnIterations.length-1;e>=0;e--)null===this._drawnIterations[e].index&&this._drawnIterations[e].retractFromDocument();for(var e=0;this.iterations.length>e;e++){var t=this.iterations[e];t._drawnIndex!==t.index&&t.isComponentTreeLoaded()&&t.injectIntoDocument(e)}var n=this._dirtyClassListIterations.toArray();this._dirtyClassListIterations.clear(),n.forEach(function(e){e.isComponentTreeLoaded()&&e.forEachElement(function(t){t.component||(t.classList[e.active?"add":"remove"]("active"),t.classList[e.selected?"add":"remove"]("selected"),t.classList.remove("no-transition"))},this)},this)}},_drawInitialContent:{value:function(){for(var e=this.element,t=e.childNodes.length,n=0;t>n;n++)e.removeChild(e.firstChild);var i=e.ownerDocument.createTextNode("");e.appendChild(i),this._boundaries.push(i)}},_updateDrawnIndexes:{value:function(e){for(var t=this._drawnIterations;t.length>e;e++)t[e]._drawnIndex=e}},_selectionPointer:{value:null},handleIsSelectionEnabledChange:{value:function(e){e?this._enableSelectionTracking():this._disableSelectionTracking()}},_enableSelectionTracking:{value:function(){s.android&&s.android.androidBrowser?window.Touch?this.element.addEventListener("touchstart",this,!0):this.element.addEventListener("mousedown",this,!0):(this.element.addEventListener("touchstart",this,!0),this.element.addEventListener("mousedown",this,!0))}},_disableSelectionTracking:{value:function(){s.android&&s.android.androidBrowser?window.Touch?this.element.removeEventListener("touchstart",this,!0):this.element.removeEventListener("mousedown",this,!0):(this.element.removeEventListener("touchstart",this,!0),this.element.removeEventListener("mousedown",this,!0))}},_observeSelectionPointer:{value:function(e){this._selectionPointer=e,this.eventManager.claimPointer(e,this);var t=this.element.ownerDocument;t.addEventListener("touchend",this,!1),t.addEventListener("touchcancel",this,!1),t.addEventListener("mouseup",this,!1)}},_ignoreSelectionPointer:{value:function(){this.eventManager.isPointerClaimedByComponent(this._selectionPointer,this)&&this.eventManager.forfeitPointer(this._selectionPointer,this),this._selectionPointer=null,this.activeIterations.clear();var e=this.element.ownerDocument;e.removeEventListener("touchend",this,!1),e.removeEventListener("touchcancel",this,!1),e.removeEventListener("mouseup",this,!1)}},captureMousedown:{value:function(e){if(null==this._selectionPointer){this._observeSelectionPointer("mouse");var t=this._findIterationContainingElement(e.target);t?t.active=!0:this._ignoreSelectionPointer()}}},captureTouchstart:{value:function(e){if(null==this._selectionPointer){this._observeSelectionPointer(e.changedTouches[0].identifier);var t=this._findIterationContainingElement(e.target);t?t.active=!0:this._ignoreSelectionPointer()}}},handleTouchend:{value:function(e){for(var t=0;e.changedTouches.length>t&&!this._endSelectionOnTarget(e.changedTouches[t].identifier,e.target);t++);}},handleTouchcancel:{value:function(){this._ignoreSelectionPointer()}},handleMouseup:{value:function(e){this._endSelectionOnTarget("mouse",e.target)}},_endSelectionOnTarget:{value:function(e,t){if(e===this._selectionPointer){if(this.eventManager.isPointerClaimedByComponent(this._selectionPointer,this)){var n=this._findIterationContainingElement(t);n&&(n.active=!1,n.selected||(n.selected=!0))}return this._ignoreSelectionPointer(),!0}}},_findIterationContainingElement:{value:function(e){for(var t;e;){if(e===this.element)return this._iterationForElement.get(t);t=e,e=e.parentNode}}},Iteration:{value:f,serializable:!1}})}}),montageDefine("b15df60","composer/translate-composer",{dependencies:["./composer","../core/event/event-manager"],factory:function(e,t){var n=e("./composer").Composer,i=e("../core/event/event-manager").defaultEventManager,r=t.TranslateComposer=n.specialize({constructor:{value:function r(){this.super()}},_NATIVE_ELEMENTS:{value:["A","IFRAME","EMBED","OBJECT","VIDEO","AUDIO","CANVAS","LABEL","INPUT","BUTTON","SELECT","TEXTAREA","KEYGEN","DETAILS","COMMAND"]},_WHEEL_POINTER:{value:"wheel",writable:!1},_externalUpdate:{value:!0},isAnimating:{value:!1},isMoving:{value:!1},stealChildrenPointer:{value:!1},stealChildrenPointerThreshold:{value:130},frame:{value:function(){this.isAnimating&&this._animationInterval(),this._externalUpdate=!1}},_pointerSpeedMultiplier:{value:1},pointerSpeedMultiplier:{get:function(){return this._pointerSpeedMultiplier},set:function(e){this._pointerSpeedMultiplier=e}},pointerStartEventPosition:{value:null},_shouldDispatchTranslate:{value:!1},_isSelfUpdate:{value:!1},_allowFloats:{value:!1},allowFloats:{get:function(){return this._allowFloats},set:function(e){this._allowFloats!==e&&(this._allowFloats=e,this.translateX=this._translateX,this.translateY=this._translateY)}},_translateX:{value:0},translateX:{get:function(){return this._translateX},set:function(e){if("vertical"===this._axis)this._translateX=this._minTranslateX||0;else{var t=isNaN(e)?0:this._allowFloats?parseFloat(e):e>>0;null!==this._minTranslateX&&this._minTranslateX>t&&(t=this._minTranslateX),null!==this._maxTranslateX&&t>this._maxTranslateX&&(t=this._maxTranslateX),this._isSelfUpdate||(this.isAnimating=!1),this._translateX=t}}},_translateY:{value:0},translateY:{get:function(){return this._translateY},set:function(e){if("horizontal"===this._axis)this._translateY=this._minTranslateY||0;else{var t=isNaN(e)?0:this._allowFloats?parseFloat(e):e>>0;null!==this._minTranslateY&&this._minTranslateY>t&&(t=this._minTranslateY),null!==this._maxTranslateY&&t>this._maxTranslateY&&(t=this._maxTranslateY),this._isSelfUpdate||(this.isAnimating=!1),this._translateY=t}}},_minTranslateX:{value:null},minTranslateX:{get:function(){return this._minTranslateX},set:function(e){null!==e&&(e=parseFloat(e)),this._minTranslateX!==e&&(null!==e&&e>this._translateX&&(this.translateX=e),this._minTranslateX=e)}},_maxTranslateX:{value:null},maxTranslateX:{get:function(){return this._maxTranslateX},set:function(e){null!==e&&(e=parseFloat(e)),this._maxTranslateX!==e&&(null!==e&&this._translateX>e&&(this.translateX=e),this._maxTranslateX=e)}},_minTranslateY:{value:null},minTranslateY:{get:function(){return this._minTranslateY},set:function(e){null!==e&&(e=parseFloat(e)),this._minTranslateY!==e&&(null!==e&&e>this._translateY&&(this.translateY=e),this._minTranslateY=e)}},_maxTranslateY:{value:null},maxTranslateY:{get:function(){return this._maxTranslateY},set:function(e){null!==e&&(e=parseFloat(e)),this._maxTranslateY!==e&&(null!==e&&this._translateY>e&&(this.translateY=e),this._maxTranslateY=e)}},_axis:{value:"both"},axis:{get:function(){return this._axis},set:function(e){switch(e){case"vertical":case"horizontal":this._axis=e,this.translateX=this._translateX,this.translateY=this._translateY;break;default:this._axis="both"}}},invertAxis:{depends:["invertXAxis","invertYAxis"],get:function(){return this._invertXAxis===this._invertYAxis?this._invertXAxis:null},set:function(e){this.invertXAxis=e,this.invertYAxis=e}},_invertXAxis:{value:!1},invertXAxis:{get:function(){return this._invertXAxis},set:function(e){this._invertXAxis=!!e}},_invertYAxis:{value:!1},invertYAxis:{get:function(){return this._invertYAxis},set:function(e){this._invertYAxis=!!e}},startTranslateSpeed:{value:500},startTranslateRadius:{value:8},_hasMomentum:{value:!0},hasMomentum:{get:function(){return this._hasMomentum},set:function(e){this._hasMomentum=e?!0:!1}},__momentumDuration:{value:650},_momentumDuration:{get:function(){return this.__momentumDuration},set:function(e){this.__momentumDuration=isNaN(e)?1:e>>0,1>this.__momentumDuration&&(this.__momentumDuration=1)}},_pointerX:{value:null},_pointerY:{value:null},_touchIdentifier:{value:null},_isFirstMove:{value:!1},_start:{value:function(e,t,n,i){this.pointerStartEventPosition={pageX:e,pageY:t,target:n,timeStamp:i},this._pointerX=e,this._pointerY=t,window.Touch?(this._element.addEventListener("touchend",this,!0),this._element.addEventListener("touchcancel",this,!0),this._element.addEventListener("touchmove",this,!0),this._element.addEventListener("touchmove",this,!1)):(document.addEventListener("mouseup",this,!0),this._element.addEventListener("mousemove",this,!0)),this.isAnimating&&(this.isAnimating=!1,this._dispatchTranslateEnd()),this._isFirstMove=!0}},_observedPointer:{value:null},_shouldPreventDefault:{value:function(e){return!!e.target.tagName&&-1===r._NATIVE_ELEMENTS.indexOf(e.target.tagName)&&!e.target.isContentEditable}},handleMousedown:{value:function(e){this._observedPointer="mouse",0!==e.button||this.eventManager.componentClaimingPointer(this._observedPointer)||(this._start(e.clientX,e.clientY,e.target,e.timeStamp),this.eventManager.claimPointer(this._observedPointer,this))}},captureMousemove:{value:function(e){this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&(e.preventDefault(),this._isFirstMove?this._firstMove():this._move(e.clientX,e.clientY))}},captureMouseup:{value:function(e){this._end(e)}},_releaseInterest:{value:function(){window.Touch?(this._element.removeEventListener("touchend",this,!0),this._element.removeEventListener("touchcancel",this,!0),this._isFirstMove&&this._element.removeEventListener("touchmove",this,!0),this._element.removeEventListener("touchmove",this,!1)):(document.removeEventListener("mouseup",this,!0),this._isFirstMove?this._element.removeEventListener("mousemove",this,!0):document.removeEventListener("mousemove",this,!0)),this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&this.eventManager.forfeitPointer(this._observedPointer,this),this._observedPointer=null}},captureTouchstart:{value:function(e){this._shouldPreventDefault(e)&&e.preventDefault(),null!==this._observedPointer&&this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)||e.targetTouches&&1===e.targetTouches.length&&(this._observedPointer=e.targetTouches[0].identifier,this._start(e.targetTouches[0].clientX,e.targetTouches[0].clientY,e.targetTouches[0].target,e.timeStamp))}},captureTouchmove:{value:function(e){var t;this.stealChildrenPointer&&this._isAxisMovement(e.targetTouches[0])&&(t=e.timeStamp-this.pointerStartEventPosition.timeStamp,this.stealChildrenPointerThreshold>t&&this.eventManager.claimPointer(this._observedPointer,this))}},handleTouchmove:{value:function(e){for(var t=0,n=e.changedTouches.length;n>t&&e.changedTouches[t].identifier!==this._observedPointer;)t++;n>t&&(this._isFirstMove&&(this.eventManager.componentClaimingPointer(this._observedPointer)||this.eventManager.claimPointer(this._observedPointer,this)),this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)?(e.preventDefault(),this._isFirstMove?this._firstMove():this._move(e.changedTouches[t].clientX,e.changedTouches[t].clientY)):this._releaseInterest())}},captureTouchend:{value:function(e){for(var t=0,n=e.changedTouches.length;n>t&&e.changedTouches[t].identifier!==this._observedPointer;)t++;n>t&&this._end(e.changedTouches[t])}},captureTouchcancel:{value:function(e){for(var t=0,n=e.changedTouches.length;n>t&&e.changedTouches[t].identifier!==this._observedPointer;)t++;n>t&&this._cancel(e.changedTouches[t])}},_isAxisMovement:{value:function(e){var t,n,i,r,a,s,o,l=e.velocity,c=.7853981633974483,u=2.356194490192345,h=-2.356194490192345,d=-.7853981633974483;if("both"===this.axis)return!0;if(!l||0===l.speed||isNaN(l.speed)?(s=this.pointerStartEventPosition.pageX-e.clientX,o=this.pointerStartEventPosition.pageY-e.clientY,a=Math.atan2(o,s)):a=l.angle,"horizontal"===this.axis){if(i=c>=a&&a>=d,r=a>=u||h>=a,i||r)return!0}else if("vertical"===this.axis&&(t=d>=a&&a>=h,n=a>=c&&u>=a,t||n))return!0;return!1}},_translateEndTimeout:{value:null},captureWheel:{value:function(){this.eventManager.componentClaimingPointer(this._WHEEL_POINTER)||this.eventManager.claimPointer(this._WHEEL_POINTER,this.component)}},handleWheel:{value:function(e){var t=this;if(this.eventManager.isPointerClaimedByComponent(this._WHEEL_POINTER,this.component)){var n=this._translateY,i=e.wheelDeltaY||-e.deltaY||0;this._dispatchTranslateStart(),this.translateY=this._translateY-20*i/120,this._dispatchTranslate(),window.clearTimeout(this._translateEndTimeout),this._translateEndTimeout=window.setTimeout(function(){t._dispatchTranslateEnd()},400),n!==this._translateY&&this._shouldPreventDefault(e)&&e.preventDefault(),this.eventManager.forfeitPointer(this._WHEEL_POINTER,this.component)}}},_firstMove:{value:function(){this._isFirstMove&&(this._dispatchTranslateStart(this._translateX,this._translateY),this._isFirstMove=!1,this.isMoving=!0,window.Touch?this._element.removeEventListener("touchmove",this,!0):(document.addEventListener("mousemove",this,!0),this._element.removeEventListener("mousemove",this,!0)))}},_move:{value:function(e,t){var n;this._isSelfUpdate=!0,"vertical"!==this._axis&&(n=this._invertXAxis?this._pointerX-e:e-this._pointerX,this.translateX+=n*this._pointerSpeedMultiplier),"horizontal"!==this._axis&&(n=this._invertYAxis?this._pointerY-t:t-this._pointerY,this.translateY+=n*this._pointerSpeedMultiplier),this._isSelfUpdate=!1,this._pointerX=e,this._pointerY=t,this._shouldDispatchTranslate&&this._dispatchTranslate()}},_bezierTValue:{value:function(e,t,n,i,r){var a,s,o,l,c=1-3*i+3*t,u=3*i-6*t,h=3*t,d=.5;for(s=0;10>s;s++)l=d*d,a=3*c*l+2*u*d+h,o=1-d,d-=(3*(o*o*d*t+o*l*i)+l*d-e)/a;return l=d*d,o=1-d,3*(o*o*d*n+o*l*r)+l*d}},_dispatchTranslateStart:{value:function(e,t){var n=document.createEvent("CustomEvent");n.initCustomEvent("translateStart",!0,!0,null),n.translateX=e,n.translateY=t,n.scroll=0,n.pointer=this._observedPointer,this.dispatchEvent(n)}},_dispatchTranslateEnd:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translateEnd",!0,!0,null),e.translateX=this._translateX,e.translateY=this._translateY,e.scroll=0,this.dispatchEvent(e)}},_dispatchTranslateCancel:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translateCancel",!0,!0,null),e.translateX=this._translateX,e.translateY=this._translateY,e.scroll=0,this.dispatchEvent(e)}},_dispatchTranslate:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translate",!0,!0,null),e.translateX=this._translateX,e.translateY=this._translateY,e.scroll=0,e.pointer=this._observedPointer,this.dispatchEvent(e)}},animateBouncingX:{value:!1,enumerable:!1},startTimeBounceX:{value:!1,enumerable:!1},animateBouncingY:{value:!1,enumerable:!1},startTimeBounceY:{value:!1,enumerable:!1},animateMomentum:{value:!1,enumerable:!1},startTime:{value:null,enumerable:!1},startX:{value:null,enumerable:!1},posX:{value:null,enumerable:!1},endX:{value:null,enumerable:!1},startY:{value:null,enumerable:!1},posY:{value:null,enumerable:!1},endY:{value:null,enumerable:!1},translateStrideX:{value:null},translateStrideY:{value:null},translateStrideDuration:{value:330},_animationInterval:{value:function(){var e,t,n,i,r=Date.now(),a=!1;this.animateMomentum&&(e=r-this.startTime,this.__momentumDuration>e?(this.posX=this.startX-(this.momentumX+this.momentumX*(this.__momentumDuration-e)/this.__momentumDuration)*e/1e3/2,this.posY=this.startY-(this.momentumY+this.momentumY*(this.__momentumDuration-e)/this.__momentumDuration)*e/1e3/2,this.translateStrideX&&null===this.startStrideXTime&&(this.__momentumDuration-e<this.translateStrideDuration||Math.abs(this.posX-this.endX)<.75*this.translateStrideX)&&(this.startStrideXTime=r),this.translateStrideY&&null===this.startStrideYTime&&(this.__momentumDuration-e<this.translateStrideDuration||Math.abs(this.posY-this.endY)<.75*this.translateStrideY)&&(this.startStrideYTime=r)):this.animateMomentum=!1),t=Math.round(this.endX/this.translateStrideX),this.startStrideXTime&&r-this.startStrideXTime>0&&(r-this.startStrideXTime<this.translateStrideDuration?(e=this._bezierTValue((r-this.startStrideXTime)/this.translateStrideDuration,.275,0,.275,1),this.posX=this.posX*(1-e)+t*this.translateStrideX*e,a=!0):this.posX=t*this.translateStrideX),t=Math.round(this.endY/this.translateStrideY),this.startStrideYTime&&r-this.startStrideYTime>0&&(r-this.startStrideYTime<this.translateStrideDuration?(e=this._bezierTValue((r-this.startStrideYTime)/this.translateStrideDuration,.275,0,.275,1),this.posY=this.posY*(1-e)+t*this.translateStrideY*e,a=!0):this.posY=t*this.translateStrideY),n=this.posX,i=this.posY,this._isSelfUpdate=!0,this.translateX=n,this.translateY=i,this._shouldDispatchTranslate&&this._dispatchTranslate(),this._isSelfUpdate=!1,this.isAnimating=this.animateMomentum||a,this.isAnimating?this.needsFrame=!0:this._dispatchTranslateEnd()}},_end:{value:function(e){this.startTime=Date.now(),this.endX=this.posX=this.startX=this._translateX,this.endY=this.posY=this.startY=this._translateY,this._hasMomentum&&(e.velocity.speed>40||this.translateStrideX||this.translateStrideY)?(this.momentumX="vertical"!==this._axis?e.velocity.x*this._pointerSpeedMultiplier*(this._invertXAxis?1:-1):0,this.momentumY="horizontal"!==this._axis?e.velocity.y*this._pointerSpeedMultiplier*(this._invertYAxis?1:-1):0,this.endX=this.startX-this.momentumX*this.__momentumDuration/2e3,this.endY=this.startY-this.momentumY*this.__momentumDuration/2e3,this.startStrideXTime=null,this.startStrideYTime=null,this.animateMomentum=!0):this.animateMomentum=!1,this.animateMomentum?this._animationInterval():this._isFirstMove||(this.isMoving=!1,this._dispatchTranslateEnd()),this._releaseInterest()}},_cancel:{value:function(){this.startTime=Date.now(),this.endX=this.posX=this.startX=this._translateX,this.endY=this.posY=this.startY=this._translateY,this.animateMomentum=!1,this._isFirstMove||(this.isMoving=!1,this._dispatchTranslateCancel()),this._releaseInterest()}},surrenderPointer:{value:function(e,t){return!this.isMoving&&t.stealChildrenPointer&&t.stealChildrenPointerThreshold<=this.stealChildrenPointerThreshold}},eventManager:{get:function(){return i}},load:{value:function(){if(window.Touch)this._element.addEventListener("touchstart",this,!0),this._element.addEventListener("touchstart",this,!1);else{this._element.addEventListener("mousedown",this,!1);var e;e=void 0!==window.onwheel?"wheel":"mousewheel",this._element.addEventListener(e,this,!1),this._element.addEventListener(e,this,!0)}this.eventManager.isStoringPointerEvents=!0}},addEventListener:{value:function(e,t,i){n.addEventListener.call(this,e,t,i),"translate"===e&&(this._shouldDispatchTranslate=!0)}}});r.prototype.handleMousewheel=r.prototype.handleWheel,r.prototype.captureMousewheel=r.prototype.captureWheel}}),montageDefine("b15df60","ui/base/abstract-control",{dependencies:["../../core/core","../component","collections/dict"],factory:function(e,t){var n=(e("../../core/core").Montage,e("../component").Component),i=e("collections/dict");t.AbstractControl=n.specialize({dispatchActionEvent:{value:function(){return this.dispatchEvent(this.createActionEvent())}},_detail:{value:null},detail:{get:function(){return null==this._detail&&(this._detail=new i),this._detail}},createActionEvent:{value:function(){var e,t=document.createEvent("CustomEvent");return e=this._detail,t.initCustomEvent("action",!0,!0,e),t}}})}}),montageDefine("b15df60","composer/press-composer",{dependencies:["../core/core","./composer","../core/event/mutable-event"],factory:function(e,t){var n=e("../core/core").Montage,i=e("./composer").Composer,r=e("../core/event/mutable-event").MutableEvent,a=t.PressComposer=i.specialize({load:{value:function(){window.Touch?this._element.addEventListener("touchstart",this,!0):this._element.addEventListener("mousedown",this,!0)}},unload:{value:function(){window.Touch?this._element.removeEventListener("touchstart",this,!0):this._element.removeEventListener("mousedown",this,!0)}},delegate:{value:null},cancelPress:{value:function(){return this._state===a.PRESSED?(this._dispatchPressCancel(),this._endInteraction(),!0):!1}},addEventListener:{value:function(e,t,n){i.addEventListener.call(this,e,t,n),"longPress"===e&&(this._shouldDispatchLongPress=!0)}},UNPRESSED:{value:0},PRESSED:{value:1},CANCELLED:{value:2},_state:{enumerable:!1,value:0},state:{get:function(){return this._state}},_shouldDispatchLongPress:{enumerable:!1,value:!1},_longPressThreshold:{enumerable:!1,value:1e3},longPressThreshold:{get:function(){return this._longPressThreshold},set:function(e){this._longPressThreshold!==e&&(this._longPressThreshold=e)}},_longPressTimeout:{enumberable:!1,value:null},_observedPointer:{enumerable:!1,value:null},_startInteraction:{enumerable:!1,value:function(e){if("enabled"in this.component&&!this.component.enabled||null!==this._observedPointer)return!1;var t;"touchstart"===e.type?(t=e.changedTouches.length,1===t&&(this._observedPointer=e.changedTouches[0].identifier),document.addEventListener("touchend",this,!1),document.addEventListener("touchcancel",this,!1)):"mousedown"===e.type&&(this._observedPointer="mouse",document.addEventListener("mouseup",this,!1),document.addEventListener("click",this,!1)),this._element.addEventListener("dragstart",this,!1),this.component.eventManager.claimPointer(this._observedPointer,this),this._dispatchPressStart(e)}},_interpretInteraction:{value:function(e){var t,n,i;if(null===this._observedPointer)return this._endInteraction(e),void 0;for(t=!this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this),n=e.target;n!==this._element&&n&&n.parentNode;)n=n.parentNode;if(i=n===this._element,t&&"click"===e.type)return e.preventDefault(),this._endInteraction(e),void 0;if("mouseup"===e.type){if(!t&&i)return this._dispatchPress(e),this._endInteraction(e),void 0;if(!t&&!i)return this._dispatchPressCancel(e),this._endInteraction(e),void 0;this._endInteraction(e)}}},_endInteraction:{value:function(){document.removeEventListener("touchend",this),document.removeEventListener("touchcancel",this),document.removeEventListener("click",this),document.removeEventListener("mouseup",this),this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&this.component.eventManager.forfeitPointer(this._observedPointer,this),this._observedPointer=null,this._state=a.UNPRESSED}},_changedTouchisObserved:{value:function(e){if(null===this._observedPointer)return!1;for(var t=0,n=e.length;n>t;t++)if(e[t].identifier===this._observedPointer)return t;return!1}},surrenderPointer:{value:function(e,t){var n=this.callDelegateMethod("surrenderPointer",e,t);return void 0!==n&&n===!1?!1:(this._dispatchPressCancel(),!0)}},captureTouchstart:{value:function(e){this._startInteraction(e)}},handleTouchend:{value:function(e){return null===this._observedPointer?(this._endInteraction(e),void 0):(this._changedTouchisObserved(e.changedTouches)!==!1&&(this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)?this._dispatchPress(e):e.preventDefault(),this._endInteraction(e)),void 0)}},handleTouchcancel:{value:function(e){(null===this._observedPointer||this._changedTouchisObserved(e.changedTouches)!==!1)&&(this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&this._dispatchPressCancel(e),this._endInteraction(e))}},captureMousedown:{value:function(e){this._startInteraction(e)}},handleClick:{value:function(e){this._interpretInteraction(e)}},handleMouseup:{value:function(e){this._interpretInteraction(e)}},handleDragstart:{value:function(e){this._dispatchPressCancel(e),this._endInteraction()}},_createPressEvent:{enumerable:!1,value:function(e,t){var n,i;return t||(t=document.createEvent("CustomEvent"),t.initCustomEvent(e,!0,!0,null)),n=new s,n.event=t,n.type=e,n.pointer=this._observedPointer,n.targetElement=t.target,t.changedTouches&&(i=this._changedTouchisObserved(t.changedTouches))!==!1&&(n.touch=t.changedTouches[i]),n}},_dispatchPressStart:{enumerable:!1,value:function(e){if(this._state=a.PRESSED,this.dispatchEvent(this._createPressEvent("pressStart",e)),this._shouldDispatchLongPress){var t=this;this._longPressTimeout=setTimeout(function(){t._dispatchLongPress()},this._longPressThreshold)}}},_dispatchPress:{enumerable:!1,value:function(e){this._shouldDispatchLongPress&&(clearTimeout(this._longPressTimeout),this._longPressTimeout=null),this.dispatchEvent(this._createPressEvent("press",e)),this._state=a.UNPRESSED}},_dispatchLongPress:{enumerable:!1,value:function(e){this._shouldDispatchLongPress&&(this.dispatchEvent(this._createPressEvent("longPress",e)),this._longPressTimeout=null)}},_dispatchPressCancel:{enumerable:!1,value:function(e){this._shouldDispatchLongPress&&(clearTimeout(this._longPressTimeout),this._longPressTimeout=null),this._state=a.CANCELLED,this.dispatchEvent(this._createPressEvent("pressCancel",e))}}}),s=function(){var e,t,i,a,s,o;for(e=r.specialize({type:{value:"press"},_event:{enumerable:!1,value:null},event:{get:function(){return this._event},set:function(e){this._event=e}},_touch:{enumerable:!1,value:null},touch:{get:function(){return this._touch},set:function(e){this._touch=e}}}),t=["altKey","ctrlKey","metaKey","shiftKey","cancelBubble","currentTarget","defaultPrevented","eventPhase","timeStamp","preventDefault","stopImmediatePropagation","stopPropagation"],i=["clientX","clientY","pageX","pageY","screenX","screenY","target"],a=function(e){return{get:function(){return this._event[e]}}},s=function(e){return{get:function(){return this._touch?this._touch[e]:this._event[e]}}},o=t.length-1;o>=0;o--)n.defineProperty(e,t[o],a(t[o]));for(o=i.length-1;o>=0;o--)n.defineProperty(e,i[o],s(i[o]));
return e}()}}),montageDefine("b15df60","composer/composer",{dependencies:["../core/core","../core/target"],factory:function(e,t){var n=(e("../core/core").Montage,e("../core/target").Target);t.Composer=n.specialize({_component:{value:null},component:{get:function(){return this._component},set:function(e){this._component=e}},_element:{value:null},element:{get:function(){return this._element},set:function(e){this._element=e}},lazyLoad:{value:!1},_needsFrame:{value:!1},needsFrame:{set:function(e){this._needsFrame!==e&&(this._needsFrame=e,this._component&&e&&this._component.scheduleComposer(this))},get:function(){return this._needsFrame}},frame:{value:function(){}},_resolveDefaults:{value:function(){null==this.element&&null!=this.component&&(this.element=this.component.element)}},_load:{value:function(){this.element||this._resolveDefaults(),this.load()}},load:{value:function(){}},unload:{value:function(){}},deserializedFromTemplate:{value:function(){this.component&&this.component.addComposer(this)}}})}}),montageDefine("b15df60","core/browser",{dependencies:["montage"],factory:function(e,t){var n=e("montage").Montage,i=RegExp(/AppleWebKit\/([\d.]+)/),r=n.specialize({constructor:{value:function r(e){this.super(),this._userAgent=e,this._analyze(e)}},_analyze:{value:function(e){if(e.indexOf("Android")>-1&&e.indexOf("Mozilla/5.0")>-1&&e.indexOf("AppleWebKit")>-1){this.android={};var t=i.exec(e),n=null===t?null:parseFloat(i.exec(e)[1]);this.android.androidBrowser=null!==n&&537>n}}},_userAgent:{value:null}}),a=null;n.defineProperties(t,{browser:{get:function(){return null===a&&(a=new r(navigator.userAgent)),a}},Browser:{value:r}})}}),montageDefine("d1a4ba1","deserialization/reviver",{dependencies:["q"],factory:function(e,t){(function(t){function n(){}function i(e){var t=n.prototype.getCustomObjectTypeOf;return function(n){return e(n)||t(n)}}var r=function(){return this}(),a=e("q");Object.defineProperties(n.prototype,{_createAssignValueFunction:{value:function(e,t){return function(n){e[t]=n}}},getTypeOf:{value:function(e){var t=typeof e;return null===e?"null":Array.isArray(e)?"array":"object"===t&&1===Object.keys(e).length?"@"in e?"reference":"/"in e?"regexp":"object":t}},getCustomObjectTypeOf:{writable:!0,value:function(){}},reviveRootObject:{value:function(e,t,n){var i;return e.debugger,"value"in e?t.hasUserObject(n)?(i=t.getUserObject(n),t.setObjectLabel(i,n),i):this.reviveValue(e.value,t,n):0===Object.keys(e).length?t.hasUserObject(n)?(i=t.getUserObject(n),t.setObjectLabel(i,n),i):this.reviveExternalObject(e,t,n):this.reviveCustomObject(e,t,n)}},reviveValue:{value:function(e,t,n){var i=this.getTypeOf(e);return"string"===i||"number"===i||"boolean"===i||"null"===i||"undefined"===i?this.reviveNativeValue(e,t,n):"regexp"===i?this.reviveRegExp(e,t,n):"reference"===i?this.reviveObjectReference(e,t,n):"array"===i?this.reviveArray(e,t,n):"object"===i?this.reviveObjectLiteral(e,t,n):this._callReviveMethod("revive"+i,e,t,n)}},reviveNativeValue:{value:function(e,t,n){return n&&t.setObjectLabel(e,n),e}},reviveObjectLiteral:{value:function(e,t,n){var i,r=[];n&&t.setObjectLabel(e,n);for(var s in e)i=this.reviveValue(e[s],t),a.isPromise(i)?r.push(i.then(this._createAssignValueFunction(e,s))):e[s]=i;return 0===r.length?e:a.all(r).then(function(){return e})}},reviveRegExp:{value:function(e,t,n){var e=e["/"],i=RegExp(e.source,e.flags);return n&&t.setObjectLabel(i,n),i}},reviveObjectReference:{value:function(e,t){var e=e["@"],n=t.getObject(e);return n}},reviveArray:{value:function(e,t,n){var i,r=[];n&&t.setObjectLabel(e,n);for(var s=0,o=e.length;o>s;s++)i=this.reviveValue(e[s],t),a.isPromise(i)?r.push(i.then(this._createAssignValueFunction(e,s))):e[s]=i;return 0===r.length?e:a.all(r).then(function(){return e})}},reviveCustomObject:{value:function(e,t,n){var i=this.getCustomObjectTypeOf(e),o=s["revive"+i];return i?o.call(r,e,t,n):a.reject(Error("Object's type is unknown: "+JSON.stringify(e)))}},reviveExternalObject:{value:function(e,t,n){return a.reject(Error("External object '"+n+"' not found in user objects."))}},_callReviveMethod:{value:function(e,t,n,i){return this[e](t,n,i)}}});var s=Object.create(null);n.addCustomObjectReviver=function(e){for(var t in e)if("getTypeOf"!==t&&"function"==typeof e[t]&&/^revive/.test(t)){if(void 0!==s[t])return Error("Reviver '"+t+"' is already registered.");s[t]=e[t].bind(e)}this.prototype.getCustomObjectTypeOf=i(e.getTypeOf)},n.resetCustomObjectRevivers=function(){s=Object.create(null),this.prototype.getCustomObjectTypeOf=function(){}},t.Reviver=n})(t),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)})}}),montageDefine("d1a4ba1","serialization/malker",{dependencies:[],factory:function(e,t){(function(e){function t(e){this._visitHandler=e,this._enteredObjects={}}Object.defineProperties(t.prototype,{_visitHandler:{value:null,writable:!0},_enteredObjects:{value:null,writable:!0},_isObjectEntered:{value:function(e){return Object.hash(e)in this._enteredObjects}},_markObjectAsEntered:{value:function(e){this._enteredObjects[Object.hash(e)]=!0}},visit:{value:function(e,t){this._visitValue(e,t)},enumerable:!0},_getTypeOf:{value:function(e){return Array.isArray(e)?"array":RegExp.isRegExp(e)?"regexp":null===e?"null":"object"==typeof e||"function"==typeof e?this._getObjectType(e):typeof e}},_getObjectType:{value:function(e){var t,n=this._visitHandler;return"function"==typeof n.getTypeOf&&(t=n.getTypeOf(e)),void 0===t?typeof e:t}},_visitValue:{value:function(e,t){var n=this._getTypeOf(e);"object"===n?this._visitObject(e,t):"array"===n?this._visitArray(e,t):"regexp"===n?this._visitRegExp(e,t):"number"===n?this._visitNumber(e,t):"string"===n?this._visitString(e,t):"boolean"===n?this._visitBoolean(e,t):"null"===n?this._visitNull(t):"undefined"===n?this._visitUndefined(t):this._visitCustomType(n,e,t)}},_visitCustomType:{value:function(e,t,n){this._callVisitorMethod("visit"+e,t,n)}},_enterCustomObject:{value:function(e,t,n){this._callVisitorMethod("enter"+e,t,n),this._callVisitorMethod("exit"+e,t,n)}},_visitObject:{value:function(e,t){var n;this._isObjectEntered(e)?this._callVisitorMethod("visitObject",e,t):(n=this._callVisitorMethod("willEnterObject",e,t),n!==!1&&(this._markObjectAsEntered(e),this._enterObject(e,t)))}},_enterObject:{value:function(e,t){var n,i=Object.keys(e);this._callVisitorMethod("enterObject",e,t);for(var r=0,a=i.length;a>r;r++)n=i[r],this._visitValue(e[n],n);this._callVisitorMethod("exitObject",e,t)}},_visitArray:{value:function(e,t){var n;this._isObjectEntered(e)?this._callVisitorMethod("visitArray",e,t):(n=this._callVisitorMethod("willEnterArray",e,t),n!==!1&&(this._markObjectAsEntered(e),this._enterArray(e,t)))}},_enterArray:{value:function(e,t){this._callVisitorMethod("enterArray",e,t);for(var n=0,i=e.length;i>n;n++)this._visitValue(e[n],""+n);this._callVisitorMethod("exitArray",e,t)}},_visitRegExp:{value:function(e,t){this._callVisitorMethod("visitRegExp",e,t)}},_visitString:{value:function(e,t){this._callVisitorMethod("visitString",e,t)}},_visitNumber:{value:function(e,t){this._callVisitorMethod("visitNumber",e,t)}},_visitBoolean:{value:function(e,t){this._callVisitorMethod("visitBoolean",e,t)}},_visitNull:{value:function(e){this._callVisitorMethod("visitNull",e)}},_visitUndefined:{value:function(e){this._callVisitorMethod("visitUndefined",e)}},_callVisitorMethod:{value:function(e){var t,n=this._visitHandler;return"function"==typeof n[e]?(t=Array.prototype.slice.call(arguments,1),t.unshift(this),n[e].apply(n,t)):void 0}}}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),RegExp.isRegExp||(RegExp.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}),e.Malker=t,e.visit=function(e,n){var i=new t(n);i.visit(e)}})(t)}}),montageDefine("d1a4ba1","serialization/serializer",{dependencies:["./malker","./builder","./labeler","./visitor"],factory:function(e,t){(function(t){function n(){var e;this._builder=new r,this._labeler=new a,e=new s(this._builder,this._labeler),this._malker=new i(e)}var i=e("./malker").Malker,r=e("./builder").Builder,a=e("./labeler").Labeler,s=e("./visitor").Visitor;Object.defineProperties(n.prototype,{_labeler:{value:null,writable:!0},_builder:{value:null,writable:!0},_serializationIndentation:{value:2,writable:!0},_malker:{value:null,writable:!0},setSerializationIndentation:{value:function(e){this._serializationIndentation=e}},serialize:{value:function(e){var t;this._labeler.initWithObjects(e);for(var n in e)this._malker.visit(e[n]);return t=this._formatSerialization(this._builder.getSerialization(this._serializationIndentation))}},serializeObject:{value:function(e){return this.serialize({root:e})}},_formatSerializationBindingsRegExp:{value:/\{\s*("(?:<->?)")\s*:\s*("[^"]+"\s*(?:,\s*"converter"\s*:\s*\{\s*"@"\s*:\s*"[^"]+"\s*\}\s*|,\s*"deferred"\s*:\s*(true|false)\s*)*)\}/gi},_formatSerializationBindingsReplacer:{value:function(e,t,n){return"{"+t+": "+n.replace(/\n\s*/g,"").replace(/,\s*/g,", ")+"}"}},_formatSerializationBindings:{value:function(e){return e.replace(this._formatSerializationBindingsRegExp,this._formatSerializationBindingsReplacer)}},_formatSerializationReferencesRegExp:{value:/\{\s*("[#@]")\s*:\s*("[^"]+")\s*\}/gi},_formatSerializationReferences:{value:function(e){return e.replace(this._formatSerializationReferencesRegExp,"{$1: $2}")}},_formatSerialization:{value:function(e){return this._formatSerializationBindings(this._formatSerializationReferences(e))}}}),t.Serializer=n,t.serialize=function(e){return(new n).serializeObject(e)}})(t)}}),montageDefine("d1a4ba1","deserialization/interpreter",{dependencies:["./reviver","./context"],factory:function(e,t){(function(t){function n(){}var i=e("./reviver").Reviver,r=e("./context").Context;Object.defineProperties(n.prototype,{instantiate:{value:function(e,t){var n=new i,a=new r(e,n,t);return a.getObjects()}}}),t.Interpreter=n})(t)}}),montageDefine("d1a4ba1","deserialization/deserializer",{dependencies:["q","./interpreter"],factory:function(e,t){(function(t){function n(e){this._serializationString=e}function i(e){return new n(e).deserializeObject()}var r=e("q"),a=e("./interpreter").Interpreter;Object.defineProperties(n.prototype,{_interpreter:{value:new a},_serializationString:{value:null,writable:!0},deserialize:{value:function(e){var t;try{t=JSON.parse(this._serializationString)}catch(n){return r.reject(n)}return this._interpreter.instantiate(t,e)}},deserializeObject:{value:function(e){return this.deserialize(e).then(function(e){return e.root})}}}),t.Deserializer=n,t.deserialize=i})(t)}}),montageDefine("d1a4ba1","serialization/builder",{dependencies:["./ast"],factory:function(e,t){(function(t){function n(){this.init()}var i=e("./ast");Object.defineProperties(n.prototype,{_root:{value:null,writable:!0},_stack:{value:null,writable:!0},_references:{value:null,writable:!0},_placeholderProperty:{value:Object.create(null)},init:{value:function(){return this._references=Object.create(null),this._root=new i.Root,this._stack=[this._root],this}},cleanup:{value:function(){this._references=null,this._root=null,this._stack=null}},getExternalReferences:{value:function(){var e=this._references,t=this._root,n=[];for(var i in e)t.hasProperty(i)&&t.getProperty(i)!==this._placeholderProperty||n.push(i);return n}},relabelReferences:{value:function(e,t){var n=this._references[e];if(n){n=n.slice(0);for(var i=0,r=n.length;r>i;i++)n[i].value=t}}},_registerReference:{value:function(e){var t=this._references,n=e.value;t[n]?t[n].push(e):t[n]=[e]}},_unregisterReference:{value:function(e){var t,n=e.label,i=this._references[n];1===i.length?delete this._references[n]:(t=i.indexOf(e),-1===t?console.log("BUG: reference '"+n+"' not found in registry."):i.splice(t,1))}},_createPlaceholdersForReferences:{value:function(){var e=this._references,t=this._root;for(var n in e)t.hasProperty(n)||t.setProperty(n,this._placeholderProperty)}},getSerialization:{value:function(e){return this._createPlaceholdersForReferences(),this._root.serialize(e)}},root:{get:function(){return this._root}},top:{get:function(){return this._stack[0]}},push:{value:function(e){return this._stack.unshift(e)}},pop:{value:function(){return this._stack.shift()}},createObjectLiteral:{value:function(){return new i.ObjectLiteral(this._root,Object.create(null))}},createArray:{value:function(){return new i.ObjectLiteral(this._root,[])}},createObjectReference:{value:function(e){var t=new i.ObjectReference(this._root,e);return this._registerReference(t),t}},createRegExp:{value:function(e){return new i.RegExpObject(this._root,e)}},createString:{value:function(e){return new i.Value(this._root,e)}},createNumber:{value:function(e){return new i.Value(this._root,e)}},createBoolean:{value:function(e){return new i.Value(this._root,e)}},createNull:{value:function(){return new i.Value(this._root,null)}},createCustomObject:{value:function(){return new i.CustomObject(this._root)}}}),t.Builder=n})(t)}}),montageDefine("d1a4ba1","serialization/labeler",{dependencies:[],factory:function(e,t){(function(e){function t(){this._labels=Object.create(null),this._objectsLabels=Object.create(null),this._objects=Object.create(null),this._baseNamesIndex=Object.create(null),this._userDefinedLabels=Object.create(null)}Object.defineProperties(t.prototype,{_labels:{value:null,writable:!0},_objectsLabels:{value:null,writable:!0},_objects:{value:null,writable:!0},_INITIAL_LABEL_NUMBER:{value:2},_baseNamesIndex:{value:null,writable:!0},_userDefinedLabels:{value:null,writable:!0},initWithObjects:{value:function(e){for(var t in e)this.setObjectLabel(e[t],t),this._userDefinedLabels[t]=!0}},cleanup:{value:function(){this._labels=null,this._objectsLabels=null,this._objects=null,this._baseNamesIndex=null,this._userDefinedLabels=null}},generateLabel:{value:function(e){var t,n=this._baseNamesIndex[e];do n?(t=e+n,this._baseNamesIndex[e]=n+=1):(t=e,this._baseNamesIndex[e]=n=this._INITIAL_LABEL_NUMBER);while(t in this._labels);return t}},getLabelBaseName:{value:function(e){return e.replace(/\d*$/,"")}},addLabel:{value:function(e){this._labels[e]=!0}},addLabels:{value:function(e){for(var t=0,n=e.length;n>t;t++)this.addLabel(e[t])}},isLabelDefined:{value:function(e){return e in this._labels}},isUserDefinedLabel:{value:function(e){return e in this._userDefinedLabels}},getObjectName:{value:function(e){return Array.isArray(e)?"array":RegExp.isRegExp(e)?"regexp":typeof e}},generateObjectLabel:{value:function(e){var t=this.getObjectName(e);return this.generateLabel(t)}},getObjectLabel:{value:function(e){var t,n=Object.hash(e);return n in this._objectsLabels?t=this._objectsLabels[n]:(t=this.generateObjectLabel(e),this.setObjectLabel(e,t)),t}},setObjectLabel:{value:function(e,t){if(void 0!==e){var n=Object.hash(e);this.addLabel(t),this._objectsLabels[n]=t,this._objects[t]=e}}},getObjectByLabel:{value:function(e){return this._objects[e]}}}),e.Labeler=t})(t)}}),montageDefine("d1a4ba1","serialization/visitor",{dependencies:["collections/shim-object"],factory:function(e,t){(function(t){function n(e,t){this.builder=e,this.labeler=t,this._objectsSerialization=Object.create(null)}function i(e){var t=n.prototype.getCustomObjectTypeOf;return function(n){return e(n)||t(n)}}e("collections/shim-object"),Object.defineProperties(n.prototype,{builder:{value:null,writable:!0},labeler:{value:null,writable:!0},getTypeOf:{value:function(e){return this.isCustomObject(e)?"CustomObject":void 0}},getCustomObjectTypeOf:{value:function(){},writable:!0},isCustomObject:{value:function(e){var t=this.getCustomObjectTypeOf(e);return"string"==typeof t}},_objectsSerialization:{value:null,writable:!0},setObjectSerialization:{value:function(e,t){this._objectsSerialization[Object.hash(e)]=t}},getObjectSerialization:{value:function(e){return this._objectsSerialization[Object.hash(e)]}},isObjectSerialized:{value:function(e){return Object.hash(e)in this._objectsSerialization}},enterObject:{value:function(e,t){var n=this.builder.createObjectLiteral();this.setObjectSerialization(t,n),this.builder.push(n)}},exitObject:{value:function(e,t,n){this.storeValue(this.builder.pop(),t,n)}},visitObject:{value:function(e,t,n){var i=this.labeler.getObjectLabel(t),r=this.builder.createObjectReference(i);this.getObjectSerialization(t).setLabel(i),this.builder.top.setProperty(n,r)}},enterArray:{value:function(e,t){var n=this.builder.createArray();this.setObjectSerialization(t,n),this.builder.push(n)}},exitArray:{value:function(e,t,n){this.storeValue(this.builder.pop(),t,n)}},visitArray:{value:function(e,t,n){var i=this.labeler.getObjectLabel(t),r=this.builder.createObjectReference(i);this.getObjectSerialization(t).setLabel(i),this.builder.top.setProperty(n,r)}},visitRegExp:{value:function(e,t,n){this.storeValue(this.builder.createRegExp(t),t,n)}},visitString:{value:function(e,t,n){this.storeValue(this.builder.createString(t),t,n)}},visitNumber:{value:function(e,t,n){this.storeValue(this.builder.createNumber(t),t,n)}},visitBoolean:{value:function(e,t,n){this.storeValue(this.builder.createBoolean(t),t,n)}},visitNull:{value:function(e,t){this.storeValue(this.builder.createNull(),null,t)}},visitCustomObject:{value:function(e,t,n){var i=this.getCustomObjectTypeOf(t),a=r["visit"+i];if(i)return a.call(global,e,this,t,n);throw Error("Object's type is unknown: "+t)}},storeValue:{value:function(e,t,n){void 0===n?e.setLabel(this.labeler.getObjectLabel(t)):this.builder.top.setProperty(n,e)}}});var r=Object.create(null);n.addCustomObjectVisitor=function(e){for(var t in e)if("getTypeOf"!==t&&"function"==typeof e[t]&&/^visit/.test(t)){if(void 0!==r[t])return Error("Visitor '"+t+"' is already registered.");r[t]=e[t].bind(e)}this.prototype.getCustomObjectTypeOf=i(e.getTypeOf)},n.resetCustomObjectVisitors=function(){r=Object.create(null),this.prototype.getCustomObjectTypeOf=function(){}},t.Visitor=n})(t)}}),montageDefine("d1a4ba1","deserialization/context",{dependencies:["q"],factory:function(e,t){var n=e("q");(function(e){function t(e,t,n){if(this._reviver=t,this._serialization=e,this._objects=Object.create(null),n){this._userObjects=Object.create(null);for(var i in n)this._userObjects[i]=n[i]}}Object.defineProperties(t.prototype,{_objects:{value:null,writable:!0},_userObjects:{value:null,writable:!0},_serialization:{value:null,writable:!0},_reviver:{value:null,writable:!0},setObjectLabel:{value:function(e,t){this._objects[t]=e}},getObject:{value:function(e){var t,i=this._serialization,r=this._reviver,a=this._objects;return e in a?a[e]:e in i?(t=r.reviveRootObject(i[e],this,e),e in a||(a[e]=t),t):n.reject(Error("Object with label '"+e+"' was not found."))}},getObjects:{value:function(){var e,t=this,i=(this._reviver,this._serialization),r=[];for(var a in i)e=this.getObject(a),n.isPromise(e)&&r.push(e);return 0===r.length?n.resolve(this._invokeDidReviveObjects()):n.all(r).then(function(){return t._invokeDidReviveObjects()})}},hasUserObject:{value:function(e){var t=this._userObjects;return t?e in t:!1}},getUserObject:{value:function(e){var t=this._userObjects;return t?t[e]:void 0}},_invokeDidReviveObjects:{value:function(){var e,t=this,i=this._reviver;return"function"==typeof i.didReviveObjects&&(e=i.didReviveObjects(this._objects,this),n.isPromise(e))?e.then(function(){return t._objects}):this._objects}}}),e.Context=t})(t)}}),montageDefine("d1a4ba1","serialization/ast",{dependencies:[],factory:function(e,t){(function(e){function t(){this.object=Object.create(null)}function n(e,t){this.root=e,this.value=t}function i(e,t){n.call(this,e,t)}function r(e,t){n.call(this,e,t)}function a(e,t){n.call(this,e,t)}function s(e){n.call(this,e,Object.create(null))}function o(e,t){n.call(this,e,t)}Object.defineProperties(t.prototype,{object:{value:null,writable:!0},setProperty:{value:function(e,t){null!=e&&(this.object[e]=t)}},getProperty:{value:function(e){return this.object[e]}},clearProperty:{value:function(e){delete this.object[e]}},hasProperty:{value:function(e){return e in this.object}},serialize:{value:function(e){return JSON.stringify(this,null,e)}},toJSON:{value:function(){var e,t=Object.create(null);for(var n in this.object)e=this.object[n],t[n]=e.toJSON?e.toJSON(n,1):e;return t}}}),Object.defineProperties(n.prototype,{root:{value:null,writable:!0},label:{value:null,writable:!0},value:{value:null,writable:!0},setLabel:{value:function(e){this.label&&this.root.clearProperty(this.label),this.label=e,this.root.setProperty(e,this)}},getLabel:{value:function(){return this.label}},clearLabel:{value:function(){this.root.clearProperty(this.label),this.label=null}},_getSerializationValue:{value:function(){return this.value}},toJSON:{value:function(e,t){var n=this._getSerializationValue();return 1===t?{value:n}:n}}}),i.prototype=Object.create(n.prototype,{constructor:{value:i},toJSON:{value:function(e,t){var n,i=this._getSerializationValue();return 1===t?{value:i}:this.label?(n=new o(this.root,this.label),n.toJSON()):i}}}),r.prototype=Object.create(i.prototype,{constructor:{value:r},setProperty:{value:function(e,t){null!=e&&(this.value[e]=t)}},getProperty:{value:function(e){return this.value[e]}},clearProperty:{value:function(e){delete this.value[e]}},getPropertyNames:{value:function(){return Object.keys(this.value)}}}),a.prototype=Object.create(i.prototype,{constructor:{value:a},_getSerializationValue:{value:function(){var e=this.value;return{"/":{source:e.source,flags:(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")}}}}}),s.prototype=Object.create(n.prototype,{constructor:{value:s},setProperty:{value:function(e,t){null!=e&&(this.value[e]=t)}},getProperty:{value:function(e){return this.value[e]}},clearProperty:{value:function(e){delete this.value[e]}},toJSON:{value:function(e,t){var n,i=this._getSerializationValue();return 1===t?i:(n=new o(this.root,this.label),n.toJSON())}}}),o.prototype=Object.create(n.prototype,{constructor:{value:o},_getSerializationValue:{value:function(){return{"@":this.value}}}}),e.Root=t,e.Value=n,e.ReferenceableValue=i,e.ObjectLiteral=r,e.RegExpObject=a,e.CustomObject=s,e.ObjectReference=o})(t)}}),montageDefine("2a4cabc","shim",{dependencies:["./shim-array","./shim-object","./shim-function","./shim-regexp"],factory:function(e){e("./shim-array"),e("./shim-object"),e("./shim-function"),e("./shim-regexp")}}),montageDefine("2a4cabc","listen/property-changes",{dependencies:["../shim","weak-map"],factory:function(e,t,n){function i(){throw Error("This is an abstract interface. Mix it. Don't construct it")}e("../shim");var r=e("weak-map"),a=Object.prototype.hasOwnProperty,s=new r,o=new r;n.exports=i,i.debug=!0,i.prototype.getOwnPropertyChangeDescriptor=function(e){s.has(this)||s.set(this,{});var t=s.get(this);return a.call(t,e)||(t[e]={willChangeListeners:[],changeListeners:[]}),t[e]},i.prototype.hasOwnPropertyChangeDescriptor=function(e){if(!s.has(this))return!1;if(!e)return!0;var t=s.get(this);return a.call(t,e)?!0:!1},i.prototype.addOwnPropertyChangeListener=function(e,t,n){this.makeObservable&&!this.isObservable&&this.makeObservable();var r,a=i.getOwnPropertyChangeDescriptor(this,e);r=n?a.willChangeListeners:a.changeListeners,i.makePropertyObservable(this,e),r.push(t);var s=this;return function(){i.removeOwnPropertyChangeListener(s,e,r,n),s=null}},i.prototype.addBeforeOwnPropertyChangeListener=function(e,t){return i.addOwnPropertyChangeListener(this,e,t,!0)},i.prototype.removeOwnPropertyChangeListener=function(e,t,n){var r,a=i.getOwnPropertyChangeDescriptor(this,e);r=n?a.willChangeListeners:a.changeListeners;var s=r.lastIndexOf(t);if(-1===s)throw Error("Can't remove property change listener: does not exist: property name"+JSON.stringify(e));r.splice(s,1)},i.prototype.removeBeforeOwnPropertyChangeListener=function(e,t){return i.removeOwnPropertyChangeListener(this,e,t,!0)},i.prototype.dispatchOwnPropertyChange=function(e,t,n){var r=i.getOwnPropertyChangeDescriptor(this,e);if(!r.isActive){r.isActive=!0;var a;a=n?r.willChangeListeners:r.changeListeners;var s=(n?"Will":"")+"Change",o="handleProperty"+s,l=e+"";l=l&&l[0].toUpperCase()+l.slice(1);var c="handle"+l+s;try{a.slice().forEach(function(n){if(!(0>a.indexOf(n))){var i=n;if(n=n[c]||n[o]||n,!n.call)throw Error("No event listener for "+c+" or "+o+" or call on "+n);n.call(i,t,e,this)}},this)}finally{r.isActive=!1}}},i.prototype.dispatchBeforeOwnPropertyChange=function(e,t){return i.dispatchOwnPropertyChange(this,e,t,!0)},i.prototype.makePropertyObservable=function(e){if(!Array.isArray(this)){if(!Object.isExtensible(this,e))throw Error("Can't make property "+JSON.stringify(e)+" observable on "+this+" because object is not extensible");var t;"object"==typeof this.__state__?t=this.__state__:(t={},Object.isExtensible(this,"__state__")&&Object.defineProperty(this,"__state__",{value:t,writable:!0,enumerable:!1})),t[e]=this[e],o.has(this)||(n={},o.set(this,n));var n=o.get(this);if(!a.call(n,e)){var r,s=this;Object.getOwnPropertyDescriptor(s,e);do{if(r=Object.getOwnPropertyDescriptor(s,e))break;s=Object.getPrototypeOf(s)}while(s);if(r=r||{value:void 0,enumerable:!0,writable:!0,configurable:!0},!r.configurable)throw Error("Can't observe non-configurable properties");if(n[e]=r,r.writable||r.set){var l;l="value"in r?{get:function(){return r.value},set:function(n){return n===r.value?n:(i.dispatchBeforeOwnPropertyChange(this,e,r.value),r.value=n,t[e]=n,i.dispatchOwnPropertyChange(this,e,n),n)},enumerable:r.enumerable,configurable:!0}:{get:function(){return r.get?r.get.apply(this,arguments):void 0},set:function(n){var a;return r.get&&(a=r.get.apply(this,arguments)),r.set&&r.set.apply(this,arguments),r.get&&(n=r.get.apply(this,arguments),t[e]=n),n===a?n:(i.dispatchBeforeOwnPropertyChange(this,e,a),i.dispatchOwnPropertyChange(this,e,n),n)},enumerable:r.enumerable,configurable:!0},Object.defineProperty(this,e,l)}}}},i.prototype.makePropertyUnobservable=function(e){if(!Array.isArray(this)){if(!o.has(this))throw Error("Can't uninstall observer on property");var t=o.get(this);if(!t[e])throw Error("Can't uninstall observer on property");var n=t[e];delete t[e];var i;"object"==typeof this.__state__?i=this.__state__:(i={},Object.isExtensible(this,"__state__")&&Object.defineProperty(this,"__state__",{value:i,writable:!0,enumerable:!1})),delete i[e],Object.defineProperty(this,e,n)}},i.getOwnPropertyChangeDescriptor=function(e,t){return e.getOwnPropertyChangeDescriptor?e.getOwnPropertyChangeDescriptor(t):i.prototype.getOwnPropertyChangeDescriptor.call(e,t)},i.hasOwnPropertyChangeDescriptor=function(e,t){return e.hasOwnPropertyChangeDescriptor?e.hasOwnPropertyChangeDescriptor(t):i.prototype.hasOwnPropertyChangeDescriptor.call(e,t)},i.addOwnPropertyChangeListener=function(e,t,n,r){return Object.isObject(e)?e.addOwnPropertyChangeListener?e.addOwnPropertyChangeListener(t,n,r):i.prototype.addOwnPropertyChangeListener.call(e,t,n,r):void 0},i.removeOwnPropertyChangeListener=function(e,t,n,r){return Object.isObject(e)?e.removeOwnPropertyChangeListener?e.removeOwnPropertyChangeListener(t,n,r):i.prototype.removeOwnPropertyChangeListener.call(e,t,n,r):void 0},i.dispatchOwnPropertyChange=function(e,t,n,r){return Object.isObject(e)?e.dispatchOwnPropertyChange?e.dispatchOwnPropertyChange(t,n,r):i.prototype.dispatchOwnPropertyChange.call(e,t,n,r):void 0},i.addBeforeOwnPropertyChangeListener=function(e,t,n){return i.addOwnPropertyChangeListener(e,t,n,!0)},i.removeBeforeOwnPropertyChangeListener=function(e,t,n){return i.removeOwnPropertyChangeListener(e,t,n,!0)},i.dispatchBeforeOwnPropertyChange=function(e,t,n){return i.dispatchOwnPropertyChange(e,t,n,!0)},i.makePropertyObservable=function(e,t){return e.makePropertyObservable?e.makePropertyObservable(t):i.prototype.makePropertyObservable.call(e,t)},i.makePropertyUnobservable=function(e,t){return e.makePropertyUnobservable?e.makePropertyUnobservable(t):i.prototype.makePropertyUnobservable.call(e,t)}}}),montageDefine("2a4cabc","map",{dependencies:["./shim","./set","./generic-collection","./generic-map","./listen/property-changes","map"],factory:function(e,t,n){"use strict";function i(e,t,n,a){return this instanceof i?(t=t||Object.equals,n=n||Object.hash,a=a||Function.noop,this.contentEquals=t,this.contentHash=n,this.getDefault=a,this.store=new r(void 0,function(e,n){return t(e.key,n.key)},function(e){return n(e.key)}),this.length=0,this.addEach(e),void 0):new i(e,t,n,a)}e("./shim");var r=e("./set"),a=e("./generic-collection"),s=e("./generic-map"),o=e("./listen/property-changes");n.exports=i,i.Map=i,Object.addEach(i.prototype,a.prototype),Object.addEach(i.prototype,s.prototype),Object.addEach(i.prototype,o.prototype),i.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentHash,this.getDefault)},i.prototype.log=function(e,t,n,i){t=t||this.logNode,this.store.log(e,function(e,n,i){t(e.value.value,n,i)},n,i)},i.prototype.logNode=function(e,t){t(" key: "+e.key),t(" value: "+e.value)}}}),montageDefine("2a4cabc","shim-array",{dependencies:["./shim-function","./generic-collection","./generic-order","weak-map"],factory:function(e,t,n){"use strict";function i(e,t){Object.defineProperty(Array.prototype,e,{value:t,writable:!0,configurable:!0,enumerable:!1})}function r(e,t,n){this.array=e,this.start=null==t?0:t,this.end=n}e("./shim-function");var a=e("./generic-collection"),s=e("./generic-order"),o=e("weak-map");n.exports=Array;var l=Array.prototype.splice,c=Array.prototype.slice;Array.empty=[],Object.freeze&&Object.freeze(Array.empty),Array.from=function(e){var t=[];return t.addEach(e),t},Array.unzip=function(e){for(var t=[],n=1/0,i=0;e.length>i;i++){var r=e[i];e[i]=r.toArray(),n>r.length&&(n=r.length)}for(var i=0;e.length>i;i++)for(var r=e[i],a=0;r.length>a;a++)n>a&&a in r&&(t[a]=t[a]||[],t[a][i]=r[a]);return t},i("addEach",a.prototype.addEach),i("deleteEach",a.prototype.deleteEach),i("toArray",a.prototype.toArray),i("toObject",a.prototype.toObject),i("all",a.prototype.all),i("any",a.prototype.any),i("min",a.prototype.min),i("max",a.prototype.max),i("sum",a.prototype.sum),i("average",a.prototype.average),i("only",a.prototype.only),i("flatten",a.prototype.flatten),i("zip",a.prototype.zip),i("enumerate",a.prototype.enumerate),i("group",a.prototype.group),i("sorted",a.prototype.sorted),i("reversed",a.prototype.reversed),i("constructClone",function(e){var t=new this.constructor;return t.addEach(e),t}),i("has",function(e,t){return-1!==this.find(e,t)}),i("get",function(e,t){if(+e!==e)throw Error("Indicies must be numbers");return!e in this?t:this[e]}),i("set",function(e,t){return this.splice(e,1,t),!0}),i("add",function(e){return this.push(e),!0}),i("delete",function(e,t){var n=this.find(e,t);return-1!==n?(this.splice(n,1),!0):!1}),i("find",function(e,t){t=t||this.contentEquals||Object.equals;for(var n=0;this.length>n;n++)if(n in this&&t(this[n],e))return n;return-1}),i("findLast",function(e,t){t=t||this.contentEquals||Object.equals;var n=this.length;do if(n--,n in this&&t(this[n],e))return n;while(n>0);return-1}),i("swap",function(e,t,n){var i,r,a,s,o;if(void 0!==n){if(i=[e,t],Array.isArray(n)||(n=c.call(n)),a=0,r=n.length,1e3>r){for(a;r>a;a++)i[a+2]=n[a];return l.apply(this,i)}for(o=l.apply(this,i),a;r>a;){for(i=[e+a,0],s=2;1002>s&&r>a;s++,a++)i[s]=n[a];l.apply(this,i)}return o}return void 0!==t?l.call(this,e,t):void 0!==e?l.call(this,e):[]}),i("peek",function(){return this[0]}),i("poke",function(e){this.length>0&&(this[0]=e)}),i("peekBack",function(){return this.length>0?this[this.length-1]:void 0}),i("pokeBack",function(e){this.length>0&&(this[this.length-1]=e)}),i("one",function(){for(var e in this)if(Object.owns(this,e))return this[e]}),i("clear",function(){return this.length=0,this}),i("compare",function(e,t){t=t||Object.compare;var n,i,r,a,o;if(this===e)return 0;if(!e||!Array.isArray(e))return s.prototype.compare.call(this,e,t);for(i=Math.min(this.length,e.length),n=0;i>n;n++)if(n in this){if(!(n in e))return-1;if(r=this[n],a=e[n],o=t(r,a))return o}else if(n in e)return 1;return this.length-e.length}),i("equals",function(e,t){t=t||Object.equals;var n,i,r=0,a=this.length;
if(this===e)return!0;if(!e||!Array.isArray(e))return s.prototype.equals.call(this,e);if(a!==e.length)return!1;for(;a>r;++r)if(r in this){if(!(r in e))return!1;if(n=this[r],i=e[r],!t(n,i))return!1}else if(r in e)return!1;return!0}),i("clone",function(e,t){if(null==e)e=1/0;else if(0===e)return this;if(t=t||new o,t.has(this))return t.get(this);var n=Array(this.length);t.set(this,n);for(var i in this)n[i]=Object.clone(this[i],e-1,t);return n}),i("iterate",function(e,t){return new r(this,e,t)}),i("Iterator",r),r.prototype.next=function(){if(this.start===(null==this.end?this.array.length:this.end))throw StopIteration;return this.array[this.start++]}}}),montageDefine("2a4cabc","shim-object",{dependencies:["weak-map"],factory:function(e,t,n){"use strict";var i=e("weak-map");n.exports=Object,Object.empty=Object.freeze(Object.create(null)),Object.isObject=function(e){return Object(e)===e},Object.getValueOf=function(e){return e&&"function"==typeof e.valueOf&&(e=e.valueOf()),e};var r=new i;Object.hash=function(e){return e&&"function"==typeof e.hash?""+e.hash():Object(e)===e?(r.has(e)||r.set(e,Math.random().toString(36).slice(2)),r.get(e)):""+e};var a=Object.prototype.hasOwnProperty;Object.owns=function(e,t){return a.call(e,t)},Object.has=function(e,t){if("object"!=typeof e)throw Error("Object.has can't accept non-object: "+typeof e);if(e&&"function"==typeof e.has)return e.has(t);if("string"==typeof t)return t in e&&e[t]!==Object.prototype[t];throw Error("Key must be a string for Object.has on plain objects")},Object.get=function(e,t,n){if("object"!=typeof e)throw Error("Object.get can't accept non-object: "+typeof e);return e&&"function"==typeof e.get?e.get(t,n):Object.has(e,t)?e[t]:n},Object.set=function(e,t,n){e&&"function"==typeof e.set?e.set(t,n):e[t]=n},Object.addEach=function(e,t){return t&&("function"!=typeof t.forEach||t.hasOwnProperty("forEach")?Object.keys(t).forEach(function(n){e[n]=t[n]}):"function"==typeof t.keys?t.forEach(function(t,n){e[n]=t}):t.forEach(function(t){e[t[0]]=t[1]})),e},Object.forEach=function(e,t,n){Object.keys(e).forEach(function(i){t.call(n,e[i],i,e)})},Object.map=function(e,t,n){return Object.keys(e).map(function(i){return t.call(n,e[i],i,e)})},Object.values=function(e){return Object.map(e,Function.identity)},Object.concat=function(){for(var e={},t=0;arguments.length>t;t++)Object.addEach(e,arguments[t]);return e},Object.from=Object.concat,Object.is=function(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t},Object.equals=function(e,t,n,r){if(n=n||Object.equals,e=Object.getValueOf(e),t=Object.getValueOf(t),e===t)return!0;if(Object.isObject(e)){if(r=r||new i,r.has(e))return!0;r.set(e,!0)}if(Object.isObject(e)&&"function"==typeof e.equals)return e.equals(t,n,r);if(Object.isObject(t)&&"function"==typeof t.equals)return t.equals(e,n,r);if(Object.isObject(e)&&Object.isObject(t)&&Object.getPrototypeOf(e)===Object.prototype&&Object.getPrototypeOf(t)===Object.prototype){for(var a in e)if(!n(e[a],t[a],n,r))return!1;for(var a in t)if(!(a in e&&n(t[a],e[a],n,r)))return!1;return!0}return e!==e&&t!==t?!0:e&&t?!1:e===t},Object.compare=function(e,t){if(e=Object.getValueOf(e),t=Object.getValueOf(t),e===t)return 0;var n=typeof e,i=typeof t;return"number"===n&&"number"===i?e-t:"string"===n&&"string"===i?t>e?-1/0:1/0:e&&"function"==typeof e.compare?e.compare(t):t&&"function"==typeof t.compare?-t.compare(e):0},Object.clone=function(e,t,n){if(e=Object.getValueOf(e),n=n||new i,void 0===t)t=1/0;else if(0===t)return e;if(Object.isObject(e)){if(!n.has(e))if(e&&"function"==typeof e.clone)n.set(e,e.clone(t,n));else{var r=Object.getPrototypeOf(e);if(null!==r&&r!==Object.prototype)throw Error("Can't clone "+e);var a=Object.create(r);n.set(e,a);for(var s in e)a[s]=Object.clone(e[s],t-1,n)}return n.get(e)}return e},Object.clear=function(e){if(e&&"function"==typeof e.clear)e.clear();else for(var t=Object.keys(e),n=t.length;n;)n--,delete e[t[n]];return e}}}),montageDefine("2a4cabc","shim-function",{dependencies:[],factory:function(e,t,n){n.exports=Function,Function.noop=function(){},Function.identity=function(e){return e},Function.by=function(e,t){t=t||Object.compare,e=e||Function.identity;var n=function(n,i){return t(e(n),e(i))};return n.compare=t,n.by=e,n},Function.get=function(e){return function(t){return Object.get(t,e)}}}}),montageDefine("2a4cabc","shim-regexp",{dependencies:[],factory:function(){if(!RegExp.escape){var e=/[-[\]{}()*+?.\\^$|,#\s]/g;RegExp.escape=function(t){return t.replace(e,"\\$&")}}}}),montageDefine("2a4cabc","set",{dependencies:["./shim","./list","./fast-set","./generic-collection","./generic-set","./listen/property-changes","./listen/range-changes","set"],factory:function(e,t,n){"use strict";function i(e,t,n,r){return this instanceof i?(t=t||Object.equals,n=n||Object.hash,r=r||Function.noop,this.contentEquals=t,this.contentHash=n,this.getDefault=r,this.order=new this.Order(void 0,t),this.store=new this.Store(void 0,function(e,n){return t(e.value,n.value)},function(e){return n(e.value)}),this.length=0,this.addEach(e),void 0):new i(e,t,n,r)}e("./shim");var r=e("./list"),a=e("./fast-set"),s=e("./generic-collection"),o=e("./generic-set"),l=e("./listen/property-changes"),c=e("./listen/range-changes");n.exports=i,i.Set=i,Object.addEach(i.prototype,s.prototype),Object.addEach(i.prototype,o.prototype),Object.addEach(i.prototype,l.prototype),Object.addEach(i.prototype,c.prototype),i.prototype.Order=r,i.prototype.Store=a,i.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentHash,this.getDefault)},i.prototype.has=function(e){var t=new this.order.Node(e);return this.store.has(t)},i.prototype.get=function(e,t){if(t)throw Error("Set#get does not support second argument: equals");var n=new this.order.Node(e);return n=this.store.get(n),n?n.value:this.getDefault(e)},i.prototype.add=function(e){var t=new this.order.Node(e);if(!this.store.has(t)){var n=this.length;return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([e],[],n),this.order.add(e),t=this.order.head.prev,this.store.add(t),this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([e],[],n),!0}return!1},i.prototype["delete"]=function(e,t){if(t)throw Error("Set#delete does not support second argument: equals");var n=new this.order.Node(e);if(this.store.has(n)){var n=this.store.get(n);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],[e],n.index),this.store["delete"](n),this.order.splice(n,1),this.length--,this.dispatchesRangeChanges&&this.dispatchRangeChange([],[e],n.index),!0}return!1},i.prototype.pop=function(){if(this.length){var e=this.order.head.prev.value;return this["delete"](e),e}},i.prototype.shift=function(){if(this.length){var e=this.order.head.next.value;return this["delete"](e),e}},i.prototype.one=function(){return this.length>0?this.store.one().value:void 0},i.prototype.clear=function(){var e;this.dispatchesRangeChanges&&(e=this.toArray(),this.dispatchBeforeRangeChange([],e,0)),this.store.clear(),this.order.clear(),this.length=0,this.dispatchesRangeChanges&&this.dispatchRangeChange([],e,0)},i.prototype.reduce=function(e,t){var n=arguments[2],i=this.order,r=0;return i.reduce(function(t,i){return e.call(n,t,i,r++,this)},t,this)},i.prototype.reduceRight=function(e,t){var n=arguments[2],i=this.order,r=this.length-1;return i.reduceRight(function(t,i){return e.call(n,t,i,r--,this)},t,this)},i.prototype.iterate=function(){return this.order.iterate()},i.prototype.log=function(){var e=this.store;return e.log.apply(e,arguments)},i.prototype.makeObservable=function(){this.order.makeObservable()}}}),montageDefine("2a4cabc","generic-collection",{dependencies:["./shim-array"],factory:function(e,t,n){"use strict";function i(){throw Error("Can't construct. GenericCollection is a mixin.")}n.exports=i,i.prototype.addEach=function(e){if(e&&Object(e)===e)if("function"==typeof e.forEach)e.forEach(this.add,this);else if("number"==typeof e.length)for(var t=0;e.length>t;t++)this.add(e[t],t);else Object.keys(e).forEach(function(t){this.add(e[t],t)},this);return this},i.prototype.deleteEach=function(e,t){return e.forEach(function(e){this["delete"](e,t)},this),this},i.prototype.forEach=function(e){var t=arguments[1];return this.reduce(function(n,i,r,a,s){e.call(t,i,r,a,s)},void 0)},i.prototype.map=function(e){var t=arguments[1],n=[];return this.reduce(function(i,r,a,s,o){n.push(e.call(t,r,a,s,o))},void 0),n},i.prototype.enumerate=function(e){null==e&&(e=0);var t=[];return this.reduce(function(n,i){t.push([e++,i])},void 0),t},i.prototype.group=function(e,t,n){n=n||Object.equals;var i=[],r=[];return this.forEach(function(a,s,o){var l,s=e.call(t,a,s,o),c=r.indexOf(s,n);-1===c?(l=[],i.push([s,l]),r.push(s)):l=i[c][1],l.push(a)}),i},i.prototype.toArray=function(){return this.map(Function.identity)},i.prototype.toObject=function(){var e={};return this.reduce(function(t,n,i){e[i]=n},void 0),e},i.prototype.filter=function(e){var t=arguments[1],n=this.constructClone();return this.reduce(function(i,r,a,s,o){e.call(t,r,a,s,o)&&n.add(r,a)},void 0),n},i.prototype.every=function(e){var t=arguments[1];return this.reduce(function(n,i,r,a,s){return n&&e.call(t,i,r,a,s)},!0)},i.prototype.some=function(e){var t=arguments[1];return this.reduce(function(n,i,r,a,s){return n||e.call(t,i,r,a,s)},!1)},i.prototype.all=function(){return this.every(Boolean)},i.prototype.any=function(){return this.some(Boolean)},i.prototype.min=function(e){e=e||this.contentCompare||Object.compare;var t=!0;return this.reduce(function(n,i){return t?(t=!1,i):0>e(i,n)?i:n},void 0)},i.prototype.max=function(e){e=e||this.contentCompare||Object.compare;var t=!0;return this.reduce(function(n,i){return t?(t=!1,i):e(i,n)>0?i:n},void 0)},i.prototype.sum=function(e){return e=void 0===e?0:e,this.reduce(function(e,t){return e+t},e)},i.prototype.average=function(e){var t=void 0===e?0:e,n=void 0===e?0:e;return this.reduce(function(e,i){t+=i,n+=1},void 0),t/n},i.prototype.concat=function(){for(var e=this.constructClone(this),t=0;arguments.length>t;t++)e.addEach(arguments[t]);return e},i.prototype.flatten=function(){var e=this;return this.reduce(function(t,n){return n.forEach(function(e){this.push(e)},t,e),t},[])},i.prototype.zip=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this),Array.unzip(e)},i.prototype.join=function(e){return this.reduce(function(t,n){return t+e+n})},i.prototype.sorted=function(e,t,n){return e=e||this.contentCompare||Object.compare,e.by?(t=e.by,e=e.compare||this.contentCompare||Object.compare):t=t||Function.identity,void 0===n&&(n=1),this.map(function(e){return{by:t(e),value:e}}).sort(function(t,i){return e(t.by,i.by)*n}).map(function(e){return e.value})},i.prototype.reversed=function(){return this.constructClone(this).reverse()},i.prototype.clone=function(e,t){if(void 0===e)e=1/0;else if(0===e)return this;var n=this.constructClone();return this.forEach(function(i,r){n.add(Object.clone(i,e-1,t),r)},this),n},i.prototype.only=function(){return 1===this.length?this.one():void 0},i.prototype.iterator=function(){return this.iterate.apply(this,arguments)},e("./shim-array")}}),montageDefine("2a4cabc","generic-map",{dependencies:["./shim-object","./listen/map-changes","./listen/property-changes"],factory:function(e,t,n){"use strict";function i(){throw Error("Can't construct. GenericMap is a mixin.")}function r(e,t){this.key=e,this.value=t}var a=e("./shim-object"),s=e("./listen/map-changes"),o=e("./listen/property-changes");n.exports=i,a.addEach(i.prototype,s.prototype),a.addEach(i.prototype,o.prototype),i.prototype.isMap=!0,i.prototype.addEach=function(e){return e&&a(e)===e&&("function"==typeof e.forEach?e.isMap===!0?e.forEach(function(e,t){this.set(t,e)},this):e.forEach(function(e){this.set(e[0],e[1])},this):a.keys(e).forEach(function(t){this.set(t,e[t])},this)),this},i.prototype.get=function(e,t){var n=this.store.get(new this.Item(e));return n?n.value:arguments.length>1?t:this.getDefault(e)},i.prototype.set=function(e,t){var n=new this.Item(e,t),i=this.store.get(n),r=!1;return i?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,i.value),i.value=t,this.dispatchesMapChanges&&this.dispatchMapChange(e,t)):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,void 0),this.store.add(n)&&(this.length++,r=!0),this.dispatchesMapChanges&&this.dispatchMapChange(e,t)),r},i.prototype.add=function(e,t){return this.set(t,e)},i.prototype.has=function(e){return this.store.has(new this.Item(e))},i.prototype["delete"]=function(e){var t=new this.Item(e);if(this.store.has(t)){var n=this.store.get(t).value;return this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,n),this.store["delete"](t),this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(e,void 0),!0}return!1},i.prototype.clear=function(){var e;this.dispatchesMapChanges&&(this.forEach(function(e,t){this.dispatchBeforeMapChange(t,e)},this),e=this.keys()),this.store.clear(),this.length=0,this.dispatchesMapChanges&&e.forEach(function(e){this.dispatchMapChange(e)},this)},i.prototype.reduce=function(e,t,n){return this.store.reduce(function(t,i){return e.call(n,t,i.value,i.key,this)},t,this)},i.prototype.reduceRight=function(e,t,n){return this.store.reduceRight(function(t,i){return e.call(n,t,i.value,i.key,this)},t,this)},i.prototype.keys=function(){return this.map(function(e,t){return t})},i.prototype.values=function(){return this.map(Function.identity)},i.prototype.entries=function(){return this.map(function(e,t){return[t,e]})},i.prototype.items=function(){return this.entries()},i.prototype.equals=function(e,t){if(t=t||a.equals,this===e)return!0;if(e&&"function"==typeof e.every)return e.length===this.length&&e.every(function(e,n){return t(this.get(n),e)},this);var n=a.keys(e);return n.length===this.length&&a.keys(e).every(function(n){return t(this.get(n),e[n])},this)},i.prototype.Item=r,r.prototype.equals=function(e){return a.equals(this.key,e.key)&&a.equals(this.value,e.value)},r.prototype.compare=function(e){return a.compare(this.key,e.key)}}}),montageDefine("2a4cabc","listen/array-changes",{dependencies:["../shim","../list","weak-map","./property-changes","./range-changes","./map-changes"],factory:function(e){function t(e){for(var t in e)Object.defineProperty(Array.prototype,t,{value:e[t],writable:!0,configurable:!0,enumerable:!1})}e("../shim"),e("../list"),e("weak-map");var n=e("./property-changes"),i=e("./range-changes"),r=e("./map-changes");Array.prototype.splice;var a=Array.prototype.slice;Array.prototype.reverse;var s,o=Array.prototype.sort,l=Array.prototype.swap,c=[],u={}.__proto__===Object.prototype;s=u?function(){this.__proto__=d}:function(){Object.defineProperties(this,h)},Object.defineProperty(Array.prototype,"makeObservable",{value:s,writable:!0,configurable:!0,enumerable:!1}),t(n.prototype),t(i.prototype),t(r.prototype);var h={isObservable:{value:!0,writable:!0,configurable:!0},makeObservable:{value:Function.noop,writable:!0,configurable:!0},reverse:{value:function(){var e=this.constructClone(this);return e.reverse(),this.swap(0,this.length,e),this},writable:!0,configurable:!0},sort:{value:function(){this.dispatchBeforeRangeChange(this,this,0);for(var e=0;this.length>e;e++)n.dispatchBeforeOwnPropertyChange(this,e,this[e]),this.dispatchBeforeMapChange(e,this[e]);o.apply(this,arguments);for(var e=0;this.length>e;e++)n.dispatchOwnPropertyChange(this,e,this[e]),this.dispatchMapChange(e,this[e]);return this.dispatchRangeChange(this,this,0),this},writable:!0,configurable:!0},swap:{value:function(e,t,i){i?Array.isArray(i)||(i=a.call(i)):i=c,0>e&&(e=this.length+e);var r;if(0===t){if(0===i.length)return[];r=c}else r=a.call(this,e,e+t);var s=i.length-r.length,o=this.length,u=Math.max(this.length+s,e+i.length),h=Math.max(o,u);if(s&&n.dispatchBeforeOwnPropertyChange(this,"length",this.length),this.dispatchBeforeRangeChange(i,r,e),0===s)for(var d=e;e+i.length>d;d++)n.dispatchBeforeOwnPropertyChange(this,d,this[d]),this.dispatchBeforeMapChange(d,this[d]);else if(n.hasOwnPropertyChangeDescriptor(this))for(var d=e;h>d;d++)n.dispatchBeforeOwnPropertyChange(this,d,this[d]),this.dispatchBeforeMapChange(d,this[d]);e>o&&(this.length=e);var p=l.call(this,e,t,i);if(0===s)for(var d=e;e+i.length>d;d++)n.dispatchOwnPropertyChange(this,d,this[d]),this.dispatchMapChange(d,this[d]);else if(n.hasOwnPropertyChangeDescriptor(this))for(var d=e;h>d;d++)n.dispatchOwnPropertyChange(this,d,this[d]),this.dispatchMapChange(d,this[d]);return this.dispatchRangeChange(i,r,e),s&&n.dispatchOwnPropertyChange(this,"length",this.length),p},writable:!0,configurable:!0},splice:{value:function(e,t){return e>this.length&&(e=this.length),this.swap.call(this,e,t,a.call(arguments,2))},writable:!0,configurable:!0},set:{value:function(e,t){return this.splice(e,1,t),this},writable:!0,configurable:!0},shift:{value:function(){return this.splice(0,1)[0]},writable:!0,configurable:!0},pop:{value:function(){return this.length?this.splice(this.length-1,1)[0]:void 0},writable:!0,configurable:!0},push:{value:function(e){if(1===arguments.length)return this.splice(this.length,0,e);var t=a.call(arguments);return this.swap(this.length,0,t)},writable:!0,configurable:!0},unshift:{value:function(e){if(1===arguments.length)return this.splice(0,0,e);var t=a.call(arguments);return this.swap(0,0,t)},writable:!0,configurable:!0},clear:{value:function(){return this.splice(0,this.length)},writable:!0,configurable:!0}},d=Object.create(Array.prototype,h)}}),montageDefine("2a4cabc","sorted-array",{dependencies:["./shim","./generic-collection","./listen/property-changes","./listen/range-changes","sorted-array"],factory:function(e,t,n){"use strict";function i(e,t,n,r){return this instanceof i?(Array.isArray(e)?(this.array=e,e=e.splice(0,e.length)):this.array=[],this.contentEquals=t||Object.equals,this.contentCompare=n||Object.compare,this.getDefault=r||Function.noop,this.length=0,this.addEach(e),void 0):new i(e,t,n,r)}function r(e,t,n){for(var i=0,r=e.length-1;r>=i;){var a=i+r>>1,s=n(t,e[a]);if(s>0)i=a+1;else{if(!(0>s))return a;r=a-1}}return-(i+1)}function a(e,t,n,i){var a=r(e,t,n);if(0>a)return-1;for(;a>0&&i(t,e[a-1]);)a--;return i(t,e[a])?a:-1}function s(e,t,n,i){var a=r(e,t,n);if(0>a)return-1;for(;e.length-1>a&&i(t,e[a+1]);)a++;return i(t,e[a])?a:-1}function o(e,t,n){var i=r(e,t,n);if(0>i)return-i-1;for(var a=e.length-1;a>i&&0===n(t,e[i+1]);)i++;return i}n.exports=i,e("./shim");var l=e("./generic-collection"),c=e("./listen/property-changes"),u=e("./listen/range-changes");i.SortedArray=i,Object.addEach(i.prototype,l.prototype),Object.addEach(i.prototype,c.prototype),Object.addEach(i.prototype,u.prototype),i.prototype.isSorted=!0,i.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentCompare,this.getDefault)},i.prototype.has=function(e,t){if(t)throw Error("SortedSet#has does not support second argument: equals");var n=r(this.array,e,this.contentCompare);return n>=0&&this.contentEquals(this.array[n],e)},i.prototype.get=function(e,t){if(t)throw Error("SortedArray#get does not support second argument: equals");var n=a(this.array,e,this.contentCompare,this.contentEquals);return-1!==n?this.array[n]:this.getDefault(e)},i.prototype.add=function(e){var t=o(this.array,e,this.contentCompare);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([e],[],t),this.array.splice(t,0,e),this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([e],[],t),!0},i.prototype["delete"]=function(e,t){if(t)throw Error("SortedArray#delete does not support second argument: equals");var n=a(this.array,e,this.contentCompare,this.contentEquals);return-1!==n?(this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],[e],n),this.array.splice(n,1),this.length--,this.dispatchesRangeChanges&&this.dispatchRangeChange([],[e],n),!0):!1},i.prototype.indexOf=function(e){return a(this.array,e,this.contentCompare,this.contentEquals)},i.prototype.lastIndexOf=function(e){return s(this.array,e,this.contentCompare,this.contentEquals)},i.prototype.find=function(e,t,n){if(t)throw Error("SortedArray#find does not support second argument: equals");if(n)throw Error("SortedArray#find does not support third argument: index");return a(this.array,e,this.contentCompare,this.contentEquals)},i.prototype.findLast=function(e,t,n){if(t)throw Error("SortedArray#findLast does not support second argument: equals");if(n)throw Error("SortedArray#findLast does not support third argument: index");return s(this.array,e,this.contentCompare,this.contentEquals)},i.prototype.push=function(){this.addEach(arguments)},i.prototype.unshift=function(){this.addEach(arguments)},i.prototype.pop=function(){return this.array.pop()},i.prototype.shift=function(){return this.array.shift()},i.prototype.slice=function(){return this.array.slice.apply(this.array,arguments)},i.prototype.splice=function(e,t){return this.swap(e,t,Array.prototype.slice.call(arguments,2))},i.prototype.swap=function(e,t,n){if(void 0===e&&void 0===t)return[];e=e||0,0>e&&(e+=this.length),void 0===t&&(t=1/0);var i=this.slice(e,e+t);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange(n,i,e),this.array.splice(e,t),this.addEach(n),this.dispatchesRangeChanges&&this.dispatchRangeChange(n,i,e),i},i.prototype.reduce=function(e,t){var n=arguments[2];return this.array.reduce(function(t,i,r){return e.call(n,t,i,r,this)},t,this)},i.prototype.reduceRight=function(){var e=arguments[2];return this.array.reduceRight(function(t,n,i){return callback.call(e,t,n,i,this)},basis,this)},i.prototype.min=function(){return this.length?this.array[0]:void 0},i.prototype.max=function(){return this.length?this.array[this.length-1]:void 0},i.prototype.one=function(){return this.array.one()},i.prototype.clear=function(){var e;this.dispatchesRangeChanges&&(e=this.array.slice(),this.dispatchBeforeRangeChange([],e,0)),this.length=0,this.array.clear(),this.dispatchesRangeChanges&&this.dispatchRangeChange([],e,0)},i.prototype.equals=function(e,t){return this.array.equals(e,t)},i.prototype.compare=function(e,t){return this.array.compare(e,t)},i.prototype.iterate=function(e,t){return new this.Iterator(this.array,e,t)},i.prototype.Iterator=Array.prototype.Iterator}}),montageDefine("2a4cabc","sorted-set",{dependencies:["./shim","./generic-collection","./generic-set","./listen/property-changes","./listen/range-changes","./tree-log","sorted-set"],factory:function(e,t,n){"use strict";function i(e,t,n,r){return this instanceof i?(this.contentEquals=t||Object.equals,this.contentCompare=n||Object.compare,this.getDefault=r||Function.noop,this.root=null,this.length=0,this.addEach(e),void 0):new i(e,t,n,r)}function r(e){this.value=e,this.left=null,this.right=null,this.length=1}function a(e,t,n){if(this.set=e,this.prev=null,this.end=n,t){var i=this.set.findLeastGreaterThanOrEqual(t);i&&(this.set.splay(i.value),this.prev=i.getPrevious())}}n.exports=i,e("./shim");var s=e("./generic-collection"),o=e("./generic-set"),l=e("./listen/property-changes"),c=e("./listen/range-changes"),u=e("./tree-log");i.SortedSet=i,Object.addEach(i.prototype,s.prototype),Object.addEach(i.prototype,o.prototype),Object.addEach(i.prototype,l.prototype),Object.addEach(i.prototype,c.prototype),i.prototype.isSorted=!0,i.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentCompare,this.getDefault)},i.prototype.has=function(e,t){if(t)throw Error("SortedSet#has does not support second argument: equals");return this.root?(this.splay(e),this.contentEquals(e,this.root.value)):!1},i.prototype.get=function(e,t){if(t)throw Error("SortedSet#get does not support second argument: equals");return this.root&&(this.splay(e),this.contentEquals(e,this.root.value))?this.root.value:this.getDefault(e)},i.prototype.add=function(e){var t=new this.Node(e);if(!this.root)return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([e],[],0),this.root=t,this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([e],[],0),!0;if(this.splay(e),!this.contentEquals(e,this.root.value)){var n=this.contentCompare(e,this.root.value);if(0===n)throw Error("SortedSet cannot contain incomparable but inequal values: "+e+" and "+this.root.value);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([e],[],this.root.index),0>n?(t.right=this.root,t.left=this.root.left,this.root.left=null,this.root.touch()):(t.left=this.root,t.right=this.root.right,this.root.right=null,this.root.touch()),t.touch(),this.root=t,this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([e],[],this.root.index),!0}return!1},i.prototype["delete"]=function(e,t){if(t)throw Error("SortedSet#delete does not support second argument: equals");if(this.root&&(this.splay(e),this.contentEquals(e,this.root.value))){var n=this.root.index;if(this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],[e],n),this.root.left){var i=this.root.right;this.root=this.root.left,this.splay(e),this.root.right=i}else this.root=this.root.right;return this.length--,this.root&&this.root.touch(),this.dispatchesRangeChanges&&this.dispatchRangeChange([],[e],n),!0}return!1},i.prototype.indexOf=function(e,t){if(t)throw Error("SortedSet#indexOf does not support second argument: startIndex");return this.root&&(this.splay(e),this.contentEquals(e,this.root.value))?this.root.index:-1},i.prototype.find=function(e,t,n){if(t)throw Error("SortedSet#find does not support second argument: equals");if(n)throw Error("SortedSet#find does not support third argument: index");return this.root&&(this.splay(e),this.contentEquals(e,this.root.value))?this.root:void 0},i.prototype.findGreatest=function(e){if(this.root){for(e=e||this.root;e.right;)e=e.right;return e}},i.prototype.findLeast=function(e){if(this.root){for(e=e||this.root;e.left;)e=e.left;return e}},i.prototype.findGreatestLessThanOrEqual=function(e){return this.root?(this.splay(e),this.root):void 0},i.prototype.findGreatestLessThan=function(e){return this.root?(this.splay(e),this.root.getPrevious()):void 0},i.prototype.findLeastGreaterThanOrEqual=function(e){if(this.root){this.splay(e);var t=this.contentCompare(e,this.root.value);return 0===t?this.root:this.root.getNext()}},i.prototype.findLeastGreaterThan=function(e){return this.root?(this.splay(e),this.contentCompare(e,this.root.value),this.root.getNext()):void 0},i.prototype.pop=function(){if(this.root){var e=this.findGreatest();return this["delete"](e.value),e.value}},i.prototype.shift=function(){if(this.root){var e=this.findLeast();return this["delete"](e.value),e.value}},i.prototype.push=function(){this.addEach(arguments)},i.prototype.unshift=function(){this.addEach(arguments)},i.prototype.slice=function(e,t){e=e||0,t=t||this.length,0>e&&(e+=this.length),0>t&&(t+=this.length);var n=[];if(this.root)for(this.splayIndex(e);t>this.root.index&&(n.push(this.root.value),this.root.right);)this.splay(this.root.getNext().value);return n},i.prototype.splice=function(e,t){return this.swap(e,t,Array.prototype.slice.call(arguments,2))},i.prototype.swap=function(e,t,n){if(void 0===e&&void 0===t)return[];e=e||0,0>e&&(e+=this.length),void 0===t&&(t=1/0);var i=[];if(this.root){this.splayIndex(e);for(var r=0;t>r;r++){i.push(this.root.value);var a=this.root.getNext();if(this["delete"](this.root.value),!a)break;this.splay(a.value)}}return this.addEach(n),i},i.prototype.splay=function(e){var t,n,i,a,s,o;if(this.root){for(t=n=i=new this.Node,o=new this.Node,s=this.root;;){var l=this.contentCompare(e,s.value);if(0>l){if(!s.left)break;if(0>this.contentCompare(e,s.left.value)&&(a=s.left,s.left=a.right,s.touch(),a.right=s,a.touch(),s=a,!s.left))break;a=new r,a.right=s,a.left=o.left,o.left=a,i.left=s,i.touch(),i=s,s=s.left}else{if(!(l>0))break;if(!s.right)break;if(this.contentCompare(e,s.right.value)>0&&(a=s.right,s.right=a.left,s.touch(),a.left=s,a.touch(),s=a,!s.right))break;a=new r,a.left=s,a.right=o.right,o.right=a,n.right=s,n.touch(),n=s,s=s.right}}for(n.right=s.left,n.touch(),i.left=s.right,i.touch(),s.left=t.right,s.right=t.left;o.left;)o.left.right.touch(),o.left=o.left.left;for(;o.right;)o.right.left.touch(),o.right=o.right.right;s.touch(),this.root=s}},i.prototype.splayIndex=function(e){if(this.root){for(var t=this.root,n=this.root.index;n!==e;)if(n>e&&t.left)t=t.left,n-=1+(t.right?t.right.length:0);else{if(!(e>n&&t.right))break;t=t.right,n+=1+(t.left?t.left.length:0)}return this.splay(t.value),this.root.index===e}return!1},i.prototype.reduce=function(e,t,n){return this.root&&(t=this.root.reduce(e,t,0,n,this)),t},i.prototype.reduceRight=function(e,t,n){return this.root&&(t=this.root.reduceRight(e,t,this.length-1,n,this)),t},i.prototype.min=function(e){var t=this.findLeast(e);return t?t.value:void 0},i.prototype.max=function(e){var t=this.findGreatest(e);return t?t.value:void 0},i.prototype.one=function(){return this.min()},i.prototype.clear=function(){var e;this.dispatchesRangeChanges&&(e=this.toArray(),this.dispatchBeforeRangeChange([],e,0)),this.root=null,this.length=0,this.dispatchesRangeChanges&&this.dispatchRangeChange([],e,0)},i.prototype.iterate=function(e,t){return new this.Iterator(this,e,t)},i.prototype.Iterator=a,i.prototype.summary=function(){return this.root?this.root.summary():"()"},i.prototype.log=function(e,t,n,i){e=e||u.unicodeRound,t=t||this.logNode,n||(n=console.log,i=console),n=n.bind(i),this.root&&this.root.log(e,t,n,n)},i.prototype.logNode=function(e,t){t(" "+e.value)},i.logCharsets=u,i.prototype.Node=r,r.prototype.reduce=function(e,t,n,i,r,a){if(a=a||0,this.left){var s=this.left.length;t=this.left.reduce(e,t,n,i,r,a+1),n+=s}return t=e.call(i,t,this.value,n,r,this,a),n+=1,this.right&&(t=this.right.reduce(e,t,n,i,r,a+1)),t},r.prototype.reduceRight=function(e,t,n,i,r,a){return a=a||0,this.right&&(t=this.right.reduce(e,t,n,i,r,a+1),n-=this.right.length),t=e.call(i,t,this.value,this.value,r,this,a),n-=1,this.left&&(t=this.left.reduce(e,t,n,i,r,a+1)),t},r.prototype.touch=function(){this.length=1+(this.left?this.left.length:0)+(this.right?this.right.length:0),this.index=this.left?this.left.length:0},r.prototype.checkIntegrity=function(){var e=1;if(e+=this.left?this.left.checkIntegrity():0,e+=this.right?this.right.checkIntegrity():0,this.length!==e)throw Error("Integrity check failed: "+this.summary());return e},r.prototype.getNext=function(){var e=this;if(e.right){for(e=e.right;e.left;)e=e.left;return e}},r.prototype.getPrevious=function(){var e=this;if(e.left){for(e=e.left;e.right;)e=e.right;return e}},r.prototype.summary=function(){var e=this.value||"-";return e+=" <"+this.length,this.left||this.right?"("+e+" "+(this.left?this.left.summary():"()")+", "+(this.right?this.right.summary():"()")+")":"("+e+")"},r.prototype.log=function(e,t,n,i){var r,a=this;r=this.left&&this.right?e.intersection:this.left?e.branchUp:this.right?e.branchDown:e.through;var s;this.left&&this.left.log(e,t,function(t){s?i(e.strafe+" "+t):(s=!0,i(e.fromBelow+e.through+t))},function(e){i("  "+e)});var o;t(this,function(t){o?n((a.right?e.strafe:" ")+t):(o=!0,n(r+t))},function(t){i((a.left?e.strafe:" ")+t)});var l;this.right&&this.right.log(e,t,function(t){l?n("  "+t):(l=!0,n(e.fromAbove+e.through+t))},function(t){n(e.strafe+" "+t)})},a.prototype.next=function(){var e;if(e=this.prev?this.set.findLeastGreaterThan(this.prev.value):this.set.findLeast(),!e)throw StopIteration;if(void 0!==this.end&&this.set.contentCompare(e.value,this.end)>=0)throw StopIteration;return this.prev=e,e.value}}}),montageDefine("2a4cabc","heap",{dependencies:["./listen/array-changes","./shim","./generic-collection","./listen/map-changes","./listen/range-changes","./listen/property-changes","heap"],factory:function(e,t,n){function i(e,t,n){return this instanceof i?(this.contentEquals=t||Object.equals,this.contentCompare=n||Object.compare,this.content=[],this.length=0,this.addEach(e),void 0):new i(e,t,n)}e("./listen/array-changes"),e("./shim");var r=e("./generic-collection"),a=e("./listen/map-changes"),s=e("./listen/range-changes"),o=e("./listen/property-changes");n.exports=i,i.Heap=i,Object.addEach(i.prototype,r.prototype),Object.addEach(i.prototype,o.prototype),Object.addEach(i.prototype,s.prototype),Object.addEach(i.prototype,a.prototype),i.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentCompare)
},i.prototype.push=function(e){this.content.push(e),this.float(this.content.length-1),this.length++},i.prototype.pop=function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content.set(0,t),this.sink(0)),this.length--,e},i.prototype.add=function(e){this.push(e)},i.prototype.indexOf=function(e){for(var t=0;this.length>t;t++)if(this.contentEquals(this.content[t],e))return t;return-1},i.prototype["delete"]=function(e,t){if(t)throw Error("Heap#delete does not support second argument: equals");var n=this.indexOf(e);if(-1===n)return!1;var i=this.content.pop();if(n===this.content.length)return!0;this.content.set(n,i);var r=this.contentCompare(i,e);return r>0?this.float(n):0>r&&this.sink(n),this.length--,!0},i.prototype.peek=function(){return this.length?this.content[0]:void 0},i.prototype.max=function(){return this.peek()},i.prototype.one=function(){return this.peek()},i.prototype.float=function(e){for(var t=this.content[e];e>0;){var n=Math.floor((e+1)/2)-1,i=this.content[n];if(!(0>this.contentCompare(i,t)))break;this.content.set(n,t),this.content.set(e,i),e=n}},i.prototype.sink=function(e){for(var t,n,i,r,a,s,o=this.content.length,l=this.content[e];;){if(r=2*(e+1),i=r-1,s=!1,o>i){var t=this.content[i],c=this.contentCompare(t,l);c>0&&(a=i,s=!0)}if(o>r){var n=this.content[r],c=this.contentCompare(n,s?t:l);c>0&&(a=r,s=!0)}if(!s)break;this.content.set(e,this.content[a]),this.content.set(a,l),e=a}},i.prototype.clear=function(){this.content.clear(),this.length=0},i.prototype.reduce=function(e,t){var n=arguments[2];return this.content.reduce(function(t,i,r){return e.call(n,t,i,r,this)},t,this)},i.prototype.reduceRight=function(e,t){var n=arguments[2];return this.content.reduceRight(function(t,i,r){return e.call(n,t,i,r,this)},t,this)},i.prototype.makeObservable=function(){this.content.addRangeChangeListener(this,"content"),this.content.addBeforeRangeChangeListener(this,"content"),this.content.addMapChangeListener(this,"content"),this.content.addBeforeMapChangeListener(this,"content")},i.prototype.handleContentRangeChange=function(e,t,n){this.dispatchRangeChange(e,t,n)},i.prototype.handleContentRangeWillChange=function(e,t,n){this.dispatchBeforeRangeChange(e,t,n)},i.prototype.handleContentMapChange=function(e,t){this.dispatchMapChange(t,e)},i.prototype.handleContentMapWillChange=function(e,t){this.dispatchBeforeMapChange(t,e)}}}),montageDefine("2a4cabc","generic-order",{dependencies:["./shim-object"],factory:function(e,t,n){function i(){throw Error("Can't construct. GenericOrder is a mixin.")}var r=e("./shim-object");n.exports=i,i.prototype.equals=function(e,t){return t=t||this.contentEquals||r.equals,this===e?!0:e?this.length===e.length&&this.zip(e).every(function(e){return t(e[0],e[1])}):!1},i.prototype.compare=function(e,t){if(t=t||this.contentCompare||r.compare,this===e)return 0;if(!e)return 1;var n=Math.min(this.length,e.length),i=this.zip(e).reduce(function(e,i,r){return 0===e?r>=n?e:t(i[0],i[1]):e},0);return 0===i?this.length-e.length:i}}}),montageDefine("2a4cabc","list",{dependencies:["./shim","./generic-collection","./generic-order","./listen/property-changes","./listen/range-changes","list"],factory:function(e,t,n){"use strict";function i(e,t,n){if(!(this instanceof i))return new i(e,t,n);var r=this.head=new this.Node;r.next=r,r.prev=r,this.contentEquals=t||Object.equals,this.getDefault=n||Function.noop,this.length=0,this.addEach(e)}function r(e){this.head=e,this.at=e.next}function a(e){this.value=e,this.prev=null,this.next=null}n.exports=i,e("./shim");var s=e("./generic-collection"),o=e("./generic-order"),l=e("./listen/property-changes"),c=e("./listen/range-changes");i.List=i,Object.addEach(i.prototype,s.prototype),Object.addEach(i.prototype,o.prototype),Object.addEach(i.prototype,l.prototype),Object.addEach(i.prototype,c.prototype),i.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.getDefault)},i.prototype.find=function(e,t,n){t=t||this.contentEquals;for(var i=this.head,r=this.scan(n,i.next);r!==i;){if(t(r.value,e))return r;r=r.next}},i.prototype.findLast=function(e,t,n){t=t||this.contentEquals;for(var i=this.head,r=this.scan(n,i.prev);r!==i;){if(t(r.value,e))return r;r=r.prev}},i.prototype.has=function(e,t){return!!this.find(e,t)},i.prototype.get=function(e,t){var n=this.find(e,t);return n?n.value:this.getDefault(e)},i.prototype["delete"]=function(e,t){var n=this.findLast(e,t);if(n){if(this.dispatchesRangeChanges){var i=[],r=[e];this.dispatchBeforeRangeChange(i,r,n.index)}return n["delete"](),this.length--,this.dispatchesRangeChanges&&(this.updateIndexes(n.next,n.index),this.dispatchRangeChange(i,r,n.index)),!0}return!1},i.prototype.clear=function(){var e,t;this.dispatchesRangeChanges&&(t=this.toArray(),e=[],this.dispatchBeforeRangeChange(e,t,0)),this.head.next=this.head.prev=this.head,this.length=0,this.dispatchesRangeChanges&&this.dispatchRangeChange(e,t,0)},i.prototype.add=function(e){var t=new this.Node(e);return this.dispatchesRangeChanges&&(t.index=this.length,this.dispatchBeforeRangeChange([e],[],t.index)),this.head.addBefore(t),this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([e],[],t.index),!0},i.prototype.push=function(){var e=this.head;if(this.dispatchesRangeChanges){var t=Array.prototype.slice.call(arguments),n=[],i=this.length;this.dispatchBeforeRangeChange(t,n,i);var r=this.head.prev}for(var a=0;arguments.length>a;a++){var s=arguments[a],o=new this.Node(s);e.addBefore(o)}this.length+=arguments.length,this.dispatchesRangeChanges&&(this.updateIndexes(r.next,void 0===r.index?0:r.index+1),this.dispatchRangeChange(t,n,i))},i.prototype.unshift=function(){if(this.dispatchesRangeChanges){var e=Array.prototype.slice.call(arguments),t=[];this.dispatchBeforeRangeChange(e,t,0)}for(var n=this.head,i=0;arguments.length>i;i++){var r=arguments[i],a=new this.Node(r);n.addAfter(a),n=a}this.length+=arguments.length,this.dispatchesRangeChanges&&(this.updateIndexes(this.head.next,0),this.dispatchRangeChange(e,t,0))},i.prototype.pop=function(){var e,t=this.head;if(t.prev!==t){if(e=t.prev.value,this.dispatchesRangeChanges){var n=[],i=[e],r=this.length-1;this.dispatchBeforeRangeChange(n,i,r)}t.prev["delete"](),this.length--,this.dispatchesRangeChanges&&this.dispatchRangeChange(n,i,r)}return e},i.prototype.shift=function(){var e,t=this.head;if(t.prev!==t){if(e=t.next.value,this.dispatchesRangeChanges){var n=[],i=[e];this.dispatchBeforeRangeChange(n,i,0)}t.next["delete"](),this.length--,this.dispatchesRangeChanges&&(this.updateIndexes(this.head.next,0),this.dispatchRangeChange(n,i,0))}return e},i.prototype.peek=function(){return this.head!==this.head.next?this.head.next.value:void 0},i.prototype.poke=function(e){this.head!==this.head.next?this.head.next.value=e:this.push(e)},i.prototype.one=function(){return this.peek()},i.prototype.scan=function(e,t){var n=this.head;if("number"==typeof e){var i=e;if(i>=0)for(e=n.next;i&&(i--,e=e.next,e!=n););else for(e=n;0>i&&(i++,e=e.prev,e!=n););return e}return e||t},i.prototype.slice=function(e,t){var n=[],i=this.head;for(e=this.scan(e,i.next),t=this.scan(t,i);e!==t&&e!==i;)n.push(e.value),e=e.next;return n},i.prototype.splice=function(e,t){return this.swap(e,t,Array.prototype.slice.call(arguments,2))},i.prototype.swap=function(e,t,n){var i=e;e=this.scan(e,this.head),null==t&&(t=1/0),n=Array.from(n);for(var r=[],a=e;t--&&t>=0&&a!==this.head;)r.push(a.value),a=a.next;var s,o;this.dispatchesRangeChanges&&(s=e===this.head?this.length:e.prev===this.head?0:e.index,o=e.prev,this.dispatchBeforeRangeChange(n,r,s));for(var a=e,l=0,a=e;r.length>l;l++,a=a.next)a["delete"]();null==i&&a===this.head&&(a=this.head.next);for(var l=0;n.length>l;l++){var c=new this.Node(n[l]);a.addBefore(c)}return this.length+=n.length-r.length,this.dispatchesRangeChanges&&(e===this.head?this.updateIndexes(this.head.next,0):this.updateIndexes(o.next,o.index+1),this.dispatchRangeChange(n,r,s)),r},i.prototype.reverse=function(){if(this.dispatchesRangeChanges){var e=this.toArray(),t=e.reversed();this.dispatchBeforeRangeChange(t,e,0)}var n=this.head;do{var i=n.next;n.next=n.prev,n.prev=i,n=n.next}while(n!==this.head);return this.dispatchesRangeChanges&&this.dispatchRangeChange(t,e,0),this},i.prototype.sort=function(){this.swap(0,this.length,this.sorted())},i.prototype.reduce=function(e,t){for(var n=arguments[2],i=this.head,r=i.next;r!==i;)t=e.call(n,t,r.value,r,this),r=r.next;return t},i.prototype.reduceRight=function(e,t){for(var n=arguments[2],i=this.head,r=i.prev;r!==i;)t=e.call(n,t,r.value,r,this),r=r.prev;return t},i.prototype.updateIndexes=function(e,t){for(;e!==this.head;)e.index=t++,e=e.next},i.prototype.makeObservable=function(){this.head.index=-1,this.updateIndexes(this.head.next,0),this.dispatchesRangeChanges=!0},i.prototype.iterate=function(){return new r(this.head)},r.prototype.next=function(){if(this.at===this.head)throw StopIteration;var e=this.at.value;return this.at=this.at.next,e},i.prototype.Node=a,a.prototype["delete"]=function(){this.prev.next=this.next,this.next.prev=this.prev},a.prototype.addBefore=function(e){var t=this.prev;this.prev=e,e.prev=t,t.next=e,e.next=this},a.prototype.addAfter=function(e){var t=this.next;this.next=e,e.next=t,t.prev=e,e.prev=this}}}),montageDefine("2a4cabc","fast-set",{dependencies:["./shim","./dict","./list","./generic-collection","./generic-set","./tree-log","./listen/property-changes","fast-set"],factory:function(e,t,n){"use strict";function i(e,t,n,r){return this instanceof i?(t=t||Object.equals,n=n||Object.hash,r=r||Function.noop,this.contentEquals=t,this.contentHash=n,this.getDefault=r,this.buckets=new this.Buckets(null,this.Bucket),this.length=0,this.addEach(e),void 0):new i(e,t,n,r)}e("./shim");var r=e("./dict"),a=e("./list"),s=e("./generic-collection"),o=e("./generic-set"),l=e("./tree-log"),c=e("./listen/property-changes");Object.prototype.hasOwnProperty,n.exports=i,i.FastSet=i,Object.addEach(i.prototype,s.prototype),Object.addEach(i.prototype,o.prototype),Object.addEach(i.prototype,c.prototype),i.prototype.Buckets=r,i.prototype.Bucket=a,i.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentHash,this.getDefault)},i.prototype.has=function(e){var t=this.contentHash(e);return this.buckets.get(t).has(e)},i.prototype.get=function(e,t){if(t)throw Error("FastSet#get does not support second argument: equals");var n=this.contentHash(e),i=this.buckets;return i.has(n)?i.get(n).get(e):this.getDefault(e)},i.prototype["delete"]=function(e,t){if(t)throw Error("FastSet#delete does not support second argument: equals");var n=this.contentHash(e),i=this.buckets;if(i.has(n)){var r=i.get(n);if(r["delete"](e))return this.length--,0===r.length&&i["delete"](n),!0}return!1},i.prototype.clear=function(){this.buckets.clear(),this.length=0},i.prototype.add=function(e){var t=this.contentHash(e),n=this.buckets;return n.has(t)||n.set(t,new this.Bucket(null,this.contentEquals)),n.get(t).has(e)?!1:(n.get(t).add(e),this.length++,!0)},i.prototype.reduce=function(e,t){var n=arguments[2],i=this.buckets,r=0;return i.reduce(function(t,i){return i.reduce(function(t,i){return e.call(n,t,i,r++,this)},t,this)},t,this)},i.prototype.one=function(){return this.length>0?this.buckets.one().one():void 0},i.prototype.iterate=function(){return this.buckets.values().flatten().iterate()},i.prototype.log=function(e,t,n,i){e=e||l.unicodeSharp,t=t||this.logNode,n||(n=console.log,i=console),n=n.bind(i);var r=this.buckets,a=r.keys();a.forEach(function(s,o){var l,c;o===a.length-1?(l=e.fromAbove,c=" "):0===o?(l=e.branchDown,c=e.strafe):(l=e.fromBoth,c=e.strafe);var u=r.get(s);n.call(i,l+e.through+e.branchDown+" "+s),u.forEach(function(r,a){var s,o;a===u.head.prev?(s=e.fromAbove,o=" "):(s=e.fromBoth,o=e.strafe);var l;t(a,function(t){l?n.call(i,c+" "+o+"  "+t):(n.call(i,c+" "+s+e.through+e.through+t),l=!0)},function(t){n.call(i,c+" "+e.strafe+"  "+t)})})})},i.prototype.logNode=function(e,t){var n=e.value;Object(n)===n?JSON.stringify(n,null,4).split("\n").forEach(function(e){t(" "+e)}):t(" "+n)}}}),montageDefine("2a4cabc","generic-set",{dependencies:[],factory:function(e,t,n){function i(){throw Error("Can't construct. GenericSet is a mixin.")}n.exports=i,i.prototype.isSet=!0,i.prototype.union=function(e){var t=this.constructClone(this);return t.addEach(e),t},i.prototype.intersection=function(e){return this.constructClone(this.filter(function(t){return e.has(t)}))},i.prototype.difference=function(e){var t=this.constructClone(this);return t.deleteEach(e),t},i.prototype.symmetricDifference=function(e){var t=this.union(e),n=this.intersection(e);return t.difference(n)},i.prototype.equals=function(e,t){var n=this;return e&&"function"==typeof e.reduce&&this.length===e.length&&e.reduce(function(e,i){return e&&n.has(i,t)},!0)},i.prototype.contains=function(e){return this.has(e)},i.prototype.remove=function(e){return this["delete"](e)},i.prototype.toggle=function(e){this.has(e)?this["delete"](e):this.add(e)}}}),montageDefine("2a4cabc","listen/range-changes",{dependencies:["weak-map","../dict"],factory:function(e,t,n){"use strict";function i(){throw Error("Can't construct. RangeChanges is a mixin.")}var r=e("weak-map"),a=e("../dict"),s=new r;n.exports=i,i.prototype.getAllRangeChangeDescriptors=function(){return s.has(this)||s.set(this,a()),s.get(this)},i.prototype.getRangeChangeDescriptor=function(e){var t=this.getAllRangeChangeDescriptors();return e=e||"",t.has(e)||t.set(e,{isActive:!1,changeListeners:[],willChangeListeners:[]}),t.get(e)},i.prototype.addRangeChangeListener=function(e,t,n){!this.isObservable&&this.makeObservable&&this.makeObservable();var i,r=this.getRangeChangeDescriptor(t);i=n?r.willChangeListeners:r.changeListeners,i.push(e),Object.defineProperty(this,"dispatchesRangeChanges",{value:!0,writable:!0,configurable:!0,enumerable:!1});var a=this;return function(){a&&(a.removeRangeChangeListener(e,t,n),a=null)}},i.prototype.removeRangeChangeListener=function(e,t,n){var i,r=this.getRangeChangeDescriptor(t);i=n?r.willChangeListeners:r.changeListeners;var a=i.lastIndexOf(e);if(-1===a)throw Error("Can't remove range change listener: does not exist: token "+JSON.stringify(t));i.splice(a,1)},i.prototype.dispatchRangeChange=function(e,t,n,i){var r=this.getAllRangeChangeDescriptors(),a="Range"+(i?"WillChange":"Change");r.forEach(function(r,s){if(!r.isActive){r.isActive=!0;var o;o=i?r.willChangeListeners:r.changeListeners;var l="handle"+(s.slice(0,1).toUpperCase()+s.slice(1))+a;try{o.slice().forEach(function(r){if(!(0>o.indexOf(r)))if(r[l])r[l](e,t,n,this,i);else{if(!r.call)throw Error("Handler "+r+" has no method "+l+" and is not callable");r.call(this,e,t,n,this,i)}},this)}finally{r.isActive=!1}}},this)},i.prototype.addBeforeRangeChangeListener=function(e,t){return this.addRangeChangeListener(e,t,!0)},i.prototype.removeBeforeRangeChangeListener=function(e,t){return this.removeRangeChangeListener(e,t,!0)},i.prototype.dispatchBeforeRangeChange=function(e,t,n){return this.dispatchRangeChange(e,t,n,!0)}}}),montageDefine("2a4cabc","listen/map-changes",{dependencies:["weak-map","../list","../dict"],factory:function(e,t,n){"use strict";function i(){throw Error("Can't construct. MapChanges is a mixin.")}var r=e("weak-map"),a=e("../list");n.exports=i,Object.prototype.hasOwnProperty;var s=new r;i.prototype.getAllMapChangeDescriptors=function(){var t=e("../dict");return s.has(this)||s.set(this,t()),s.get(this)},i.prototype.getMapChangeDescriptor=function(e){var t=this.getAllMapChangeDescriptors();return e=e||"",t.has(e)||t.set(e,{willChangeListeners:new a,changeListeners:new a}),t.get(e)},i.prototype.addMapChangeListener=function(e,t,n){!this.isObservable&&this.makeObservable&&this.makeObservable();var i,r=this.getMapChangeDescriptor(t);i=n?r.willChangeListeners:r.changeListeners,i.push(e),Object.defineProperty(this,"dispatchesMapChanges",{value:!0,writable:!0,configurable:!0,enumerable:!1});var a=this;return function(){a&&(a.removeMapChangeListener(e,t,n),a=null)}},i.prototype.removeMapChangeListener=function(e,t,n){var i,r=this.getMapChangeDescriptor(t);i=n?r.willChangeListeners:r.changeListeners;var a=i.findLast(e);if(!a)throw Error("Can't remove map change listener: does not exist: token "+JSON.stringify(t));a["delete"]()},i.prototype.dispatchMapChange=function(e,t,n){var i=this.getAllMapChangeDescriptors(),r="Map"+(n?"WillChange":"Change");i.forEach(function(i,a){if(!i.isActive){i.isActive=!0;var s;s=n?i.willChangeListeners:i.changeListeners;var o="handle"+(a.slice(0,1).toUpperCase()+a.slice(1))+r;try{s.forEach(function(n){if(n[o])n[o](t,e,this);else{if(!n.call)throw Error("Handler "+n+" has no method "+o+" and is not callable");n.call(n,t,e,this)}},this)}finally{i.isActive=!1}}},this)},i.prototype.addBeforeMapChangeListener=function(e,t){return this.addMapChangeListener(e,t,!0)},i.prototype.removeBeforeMapChangeListener=function(e,t){return this.removeMapChangeListener(e,t,!0)},i.prototype.dispatchBeforeMapChange=function(e,t){return this.dispatchMapChange(e,t,!0)}}}),montageDefine("2a4cabc","tree-log",{dependencies:[],factory:function(e,t,n){"use strict";function i(){}n.exports=i,i.ascii={intersection:"+",through:"-",branchUp:"+",branchDown:"+",fromBelow:".",fromAbove:"'",fromBoth:"+",strafe:"|"},i.unicodeRound={intersection:"╋",through:"━",branchUp:"┻",branchDown:"┳",fromBelow:"╭",fromAbove:"╰",fromBoth:"┣",strafe:"┃"},i.unicodeSharp={intersection:"╋",through:"━",branchUp:"┻",branchDown:"┳",fromBelow:"┏",fromAbove:"┗",fromBoth:"┣",strafe:"┃"}}}),montageDefine("2a4cabc","dict",{dependencies:["./shim","./generic-collection","./generic-map","./listen/property-changes","dict"],factory:function(e,t,n){"use strict";function i(e,t){return this instanceof i?(t=t||Function.noop,this.getDefault=t,this.store={},this.length=0,this.addEach(e),void 0):new i(e,t)}function r(e){return"~"+e}function a(e){return e.slice(1)}e("./shim");var s=e("./generic-collection"),o=e("./generic-map"),l=e("./listen/property-changes");n.exports=i,i.Dict=i,Object.addEach(i.prototype,s.prototype),Object.addEach(i.prototype,o.prototype),Object.addEach(i.prototype,l.prototype),i.prototype.constructClone=function(e){return new this.constructor(e,this.mangle,this.getDefault)},i.prototype.assertString=function(e){if("string"!=typeof e)throw new TypeError("key must be a string but Got "+e)},i.prototype.get=function(e,t){this.assertString(e);var n=r(e);return n in this.store?this.store[n]:arguments.length>1?t:this.getDefault(e)},i.prototype.set=function(e,t){this.assertString(e);var n=r(e);return n in this.store?(this.dispatchesBeforeMapChanges&&this.dispatchBeforeMapChange(e,this.store[n]),this.store[n]=t,this.dispatchesMapChanges&&this.dispatchMapChange(e,t),!1):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,void 0),this.length++,this.store[n]=t,this.dispatchesMapChanges&&this.dispatchMapChange(e,t),!0)},i.prototype.has=function(e){this.assertString(e);var t=r(e);return t in this.store},i.prototype["delete"]=function(e){this.assertString(e);var t=r(e);return t in this.store?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,this.store[t]),delete this.store[r(e)],this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(e,void 0),!0):!1},i.prototype.clear=function(){var e,t;for(t in this.store)e=a(t),this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,this.store[t]),delete this.store[t],this.dispatchesMapChanges&&this.dispatchMapChange(e,void 0);this.length=0},i.prototype.reduce=function(e,t,n){for(var i in this.store)t=e.call(n,t,this.store[i],a(i),this);return t},i.prototype.reduceRight=function(e,t,n){var i=this,r=this.store;return Object.keys(this.store).reduceRight(function(t,s){return e.call(n,t,r[s],a(s),i)},t)},i.prototype.one=function(){var e;for(e in this.store)return this.store[e]}}}),montageDefine("99596c3","parse",{dependencies:["collections/shim","./grammar"],factory:function(e,t,n){function i(e,t){if(Array.isArray(e))return{type:"tuple",args:e.map(function(e){return i(e,t)})};try{return r.parse(e,t||Object.empty)}catch(n){throw n.message=n.message.replace(/[\s\.]+$/,"")+" "+" on line "+n.line+" column "+n.column,n}}e("collections/shim");var r=e("./grammar");n.exports=i}}),montageDefine("99596c3","evaluate",{dependencies:["./parse","./compile-evaluator","./scope"],factory:function(e,t,n){function i(e,t,n,i,o){var l;l="string"==typeof e?r(e):e;var c=a(l),u=new s(t);return u.parameters=n,u.document=i,u.components=o,c(u)}var r=e("./parse"),a=e("./compile-evaluator"),s=e("./scope");n.exports=i}}),montageDefine("99596c3","assign",{dependencies:["./parse","./compile-assigner","./scope"],factory:function(e,t,n){function i(e,t,n,i,o,l){var c;c="string"==typeof t?r(t):t;var u=a(c),h=new s(e);return h.parameters=i,h.document=o,h.components=l,u(n,h)}var r=e("./parse"),a=e("./compile-assigner"),s=e("./scope");n.exports=i}}),montageDefine("99596c3","observe",{dependencies:["./parse","./compile-observer","./observers","./scope"],factory:function(e,t,n){function i(e,t,n){var i;i="function"==typeof n?{change:n}:n,i=i||c,i.source=e,i.sourcePath=t;var u=i.parameters=i.parameters||e,h=i.document,d=i.components,p=i.beforeChange,f=i.contentChange,m=new l(e);m.parameters=u,m.document=h,m.components=d,m.beforeChange=p;var g=r(t),v=a(g);return f===!0&&(v=s.makeRangeContentObserver(v)),v(o(function(t){if(t){if("function"!=typeof f)return i.change.apply(e,arguments);if("function"==typeof f)return t.addRangeChangeListener(f),s.once(function(){t.removeRangeChangeListener(f)})}}),m)}var r=e("./parse"),a=e("./compile-observer"),s=e("./observers"),o=s.autoCancelPrevious,l=e("./scope");n.exports=i;var c={}}}),montageDefine("99596c3","bind",{dependencies:["./parse","./algebra","./stringify","./compile-observer","./compile-binder","./compile-assigner","./observers","./binders","./scope"],factory:function(e,t,n){function i(e,t,n){n.target=e,n.targetPath=t;var i=n.source=n.source||e,c=n["<-"]||n["<->"]||"",u=n.twoWay="<->"in n;n.sourcePath=c,n.value;var h=n.parameters=n.parameters||i,d=n.document,p=n.components,m=n.trace,g=n.sourceScope=new f(i);g.parameters=h,g.document=d,g.components=p;var v=n.targetScope=new f(e);if(v.parameters=h,v.document=d,v.components=p,n.converter){var _=n.converter;_.convert&&(n.convert=_.convert.bind(_)),_.revert&&(n.revert=_.revert.bind(_))}else if(n.reverter){var b=n.reverter;b.convert&&(n.revert=b.convert.bind(b)),b.revert&&(n.convert=b.revert.bind(b))}var y=n.convert,w=n.revert,C=n.sourceSyntax=s(c),L=n.targetSyntax=s(t),x=o(L,C);if(L=x[0],C=x[1],u&&"rangeContent"===L.type)return a(v,L.args[0],g,C,y,w,n,m?{sourcePath:l(C),targetPath:l(L.args[0])}:null);m&&console.log("DEFINE BINDING",t,"<-",c,e);var M=r(v,L,g,C,y,n,m),x=o(C,L);C=x[0],L=x[1];var E=Function.noop;return u&&(m&&console.log("DEFINE BINDING",t,"->",c,i),E=r(g,C,v,L,w,n,m)),function(){M(),E()}}function r(e,t,n,i,r,a,s){var o=c(i);r&&(o=d.makeConverterObserver(o,r,n));var h=u(t);return h(o,n,e,a,s?{sourcePath:l(i),targetPath:l(t)}:null)}function a(e,t,n,i,r,a,s,o){function l(e,t,n){g||(g=!0,o&&console.log("RANGE CONTENT PROPAGATED",o.targetPath,"<-",o.sourcePath,"PLUS",e,"MINUS",t,"AT",n),f.swap(n,t.length,e),g=!1)}function u(e,t,n){g||(g=!0,o&&console.log("RANGE CONTENT PROPAGATED",o.targetPath,"->",o.sourcePath,"PLUS",e,"MINUS",t,"AT",n),m.swap(n,t.length,e),g=!1)}function d(){if(m!==f){o&&console.log("RANGE CONTENT BOUND",o.targetPath,"<->",o.sourcePath),g=!0;var t=p(m,l,n),i=p(f,u,e);return g=!1,function(){o&&console.log("RANGE CONTENT UNBOUND",o.targetPath,"<->",o.sourcePath),t(),i()}}}var f,m,g,v=c(i),_=c(t),b=h(i),y=h(t),w=Function.noop;g=!0;var C=_(function(e){w(),w=Function.noop,o&&console.log("RANGE CONTENT TARGET",o.targetPath,"SET TO",e),e&&e.addRangeChangeListener&&(f=e,m&&f?(o&&console.log("RANGE CONTENT TARGET REPLACES SOURCE",o.targetPath,"->",o.sourcePath,"WITH",f),g=!0,m.swap(0,m.length,f),g=!1,w=d()):m||g||(o&&console.log("RANGE CONTENT TARGET INITIALIZED TO COPY OF SOURCE",o.targetPath,"<-",tarce.sourcePath,"WITH",m),b(f.clone(),n)))},e);g=!1;var L=v(function(t){w(),w=Function.noop,o&&console.log("RANGE CONTENT SOURCE",o.sourcePath,"SET TO",t),t&&t.addRangeChangeListener&&(m=t,f&&m?(o&&console.log("RANGE CONTENT SOURCE REPLACES TARGET",o.targetPath,"<-",o.sourcePath,"WITH",m),g=!0,f.swap(0,f.length,m),g=!1,w=d()):f||y(m.clone(),e))},n);return f||m||b([],n),function(){w(),C(),L()}}var s=e("./parse"),o=e("./algebra"),l=e("./stringify"),c=e("./compile-observer"),u=e("./compile-binder"),h=e("./compile-assigner"),d=e("./observers"),p=d.observeRangeChange;e("./binders");var f=e("./scope");n.exports=i}}),montageDefine("99596c3","compile-observer",{dependencies:["./observers","./operators"],factory:function(e,t,n){function i(e){return s.compile(e)}var r=e("./observers"),a=e("./operators");n.exports=i;var s=i.semantics={compilers:{property:r.makePropertyObserver,get:r.makeGetObserver,path:r.makePathObserver,"with":r.makeWithObserver,"if":r.makeConditionalObserver,parent:r.makeParentObserver,not:r.makeNotObserver,and:r.makeAndObserver,or:r.makeOrObserver,"default":r.makeDefaultObserver,defined:r.makeDefinedObserver,rangeContent:Function.identity,mapContent:Function.identity,keys:r.makeKeysObserver,values:r.makeValuesObserver,items:r.makeEntriesObserver,entries:r.makeEntriesObserver,toMap:r.makeToMapObserver,mapBlock:r.makeMapBlockObserver,filterBlock:r.makeFilterBlockObserver,everyBlock:r.makeEveryBlockObserver,someBlock:r.makeSomeBlockObserver,sortedBlock:r.makeSortedBlockObserver,sortedSetBlock:r.makeSortedSetBlockObserver,groupBlock:r.makeGroupBlockObserver,groupMapBlock:r.makeGroupMapBlockObserver,minBlock:r.makeMinBlockObserver,maxBlock:r.makeMaxBlockObserver,min:r.makeMinObserver,max:r.makeMaxObserver,enumerate:r.makeEnumerationObserver,reversed:r.makeReversedObserver,flatten:r.makeFlattenObserver,concat:r.makeConcatObserver,view:r.makeViewObserver,sum:r.makeSumObserver,average:r.makeAverageObserver,last:r.makeLastObserver,only:r.makeOnlyObserver,one:r.makeOneObserver,has:r.makeHasObserver,tuple:r.makeArrayObserver,range:r.makeRangeObserver,startsWith:r.makeStartsWithObserver,endsWith:r.makeEndsWithObserver,contains:r.makeContainsObserver,join:r.makeJoinObserver,toArray:r.makeToArrayObserver,asArray:r.makeToArrayObserver},compile:function(e){var t=this.compilers;if("literal"===e.type)return r.makeLiteralObserver(e.value);if("value"===e.type)return r.observeValue;if("parameters"===e.type)return r.observeParameters;if("element"===e.type)return r.makeElementObserver(e.id);if("component"===e.type)return r.makeComponentObserver(e.label,e);if("record"===e.type){var n={},i=e.args;for(var a in i)n[a]=this.compile(i[a]);return r.makeObjectObserver(n)}t.hasOwnProperty(e.type)||(t[e.type]=r.makeMethodObserverMaker(e.type));var s=e.args.map(this.compile,this);return t[e.type].apply(null,s)}},o=s.compilers;Object.keys(a).forEach(function(e){o[e]||(o[e]=r.makeOperatorObserverMaker(a[e]))}),o.toString=r.makeOperatorObserverMaker(a.toString)}}),montageDefine("99596c3","scope",{dependencies:[],factory:function(e,t,n){function i(e){this.parent=null,this.value=e}n.exports=i,i.prototype.nest=function(e){var t=Object.create(this);return t.value=e,t.parent=this,t}}}),montageDefine("99596c3","observers",{dependencies:["collections/shim","collections/listen/property-changes","collections/listen/array-changes","collections/sorted-array","collections/sorted-set","collections/map","collections/set","collections/heap","./scope","./operators","./parse","./compile-observer","./merge"],factory:function(e,t){function n(e){return function(t){return t(e)||Function.noop}}function i(e,t){return e(t.value)||Function.noop}function r(e,t){return e(t.parameters)||Function.noop}function a(e){return function(t,n){return t(n.document.getElementById(e))||Function.noop}}function s(e,t){return function(n,i){var r=i.components,a=r.getObjectByLabel||r.getComponentByLabel,s=a.call(r,e);return t.component=s,n(s)||Function.noop}}function o(e,t,n,i){function r(e,t,i){a(),a=n(e,t,i)||Function.noop}if(null==e)return n();var a=Function.noop;return xt.addOwnPropertyChangeListener(e,t,r,i.beforeChange),r(e[t],t,e),Lt(function(){a(),xt.removeOwnPropertyChangeListener(e,t,r,i.beforeChange)})}function l(e,t){return function(n,i){return t(Ct(function(t){return"string"!=typeof t&&"number"!=typeof t?n():e(Ct(function(e){return null==e?n():e.observeProperty?e.observeProperty(t,n,i):zt(e,t,n,i)}),i)}),i)}}function c(e,t,n,i){function r(e,i,r){s(t,i)&&(a(),a=n(e,t,r)||Function.noop)}var a=Function.noop,s=e.contentEquals||Object.equals;return r(e.get(t),t,e),e.addMapChangeListener(r,i.beforeChange),Lt(function(){a(),e.removeMapChangeListener(r)})}function u(e,t){return function(n,i){return e(Ct(function(e){return e?t(Ct(function(t){return null==t?n():e.observeGet?e.observeGet(t,n,i):Pt(e,t,n,i)}),i):n()}),i)}}function h(e,t){return function(n,i){return n=yt(n),t(Ct(function(t){return e(Ct(function(e){return e?J(e,function(){return n((e.has||e.contains).call(e,t))},i):n()}),i)}),i)}}function d(e){return function(t,n){for(var i=Array(e.length),r=0;e.length>r;r++)i[r]=void 0;var a=e.map(function(e,t){return e(function(e){i.set(t,e)},n)}),s=t(i)||Function.noop;return Lt(function(){s(),wt(a)})}}function p(e){return function(t,n){var i={},r={};for(var a in e)(function(e,t){i[e]=t(function(t){r[e]=t},n)})(a,e[a]);var s=t(r)||Function.noop;return function(){s();for(var e in i)i[e]()}}}function f(){return d(Array.prototype.slice.call(arguments))}function m(e){return function(){var t=d(Array.prototype.slice.call(arguments)),n=rt(t);return function(t,i){return n(Ct(function(n){return n.every(Tt.defined)?t(e.apply(void 0,n)):t()}),i)}}}function g(e){var t=e.slice(0,1).toUpperCase()+e.slice(1),n="make"+t+"Observer",i="observe"+t;return function(){var t=arguments[0],r=Array.prototype.slice.call(arguments,1),a=r.map(function(e){return function(t,n){return e(Ct(t),n)}}),s=d(r),o=rt(s);return function(r,s){return t(Ct(function(t){return t?t[n]?t[n].apply(t,a)(r,s):t[i]?t[i](r,s):o(Ct(function(n){return n.every(Tt.defined)?"function"==typeof t[e]?r(t[e].apply(t,n)):r():r()}),s):r()}),s)}}}function v(e){return function(t,n){return e(Ct(function(e){return t(!e)}),n)}}function _(e,t){return function(n,i){return e(Ct(function(e){return e?t(n,i):n(e)}),i)}}function b(e,t){return function(n,i){return e(Ct(function(e){return e?n(e):t(n,i)}),i)}}function y(e,t,n){return function(i,r){return e(Ct(function(e){return null==e?i():e?t(i,r):n(i,r)}),r)}}function w(e){return function(t,n){return e(Ct(function(e){return t(null!=e)}),n)}}function C(e,t){return function(n,i){return e(Ct(function(e){return null==e?t(n,i):n(e)}),i)}}function L(e,t){return function(n,i){return e(Ct(function(e){function r(t){for(;e.length>t;t++)o[t].index=t}function a(e,n,a){o.swap(a,n.length,e.map(function(e,t){return{index:a+t}})),r(a+e.length);var c,u=[];wt(l.swap(a,n.length,e.map(function(e,n){var r=o[a+n];return t(Ct(function(e){c?s.set(r.index,e):u[n]=e}),i.nest(e))}))),c=!0,s.swap(a,n.length,u)}if(!e)return n();var s=[],o=[],l=[],c=J(e,a,i),u=n(s,e)||Function.noop;return Lt(function(){u(),wt(l),c()})}),i)}}function x(e,t){var n=L(e,t);return function(e,t){return n(Ct(function(n,i){function r(e){for(;n.length>e;e++)l[e+1]=l[e]+!!n[e]}function a(e,t,n){var a=i.slice(n,n+e.length),o=t.map(Boolean).sum(),c=a.filter(function(t,n){return e[n]}),u=l[n],h=s.slice(u,u+o);(h.length!==c.length||h.some(function(e,t){return e!==c[t]}))&&s.swap(u,o,c),r(u)}if(!i)return e();var s=[],o=[],l=[0],c=J(n,a,t),u=e(s)||Function.noop;return Lt(function(){u(),wt(o),c()})}),t)}}function M(e,t){var n=O(t),i=L(e,n),r=function(e,t){return i(Ct(function(n){function i(e,t){a.addEach(e),a.deleteEach(t)}if(!n)return e();var r=[],a=Mt(r,E,S),s=J(n,i,t),o=e(r)||Function.noop;return function(){o(),s()}}),t)};return Dt(r,ut)}function E(e,t){return Object.equals(e[1],t[1])}function S(e,t){return Object.compare(e[1],t[1])}function O(e){return function(t,n){return e(Ct(function(e){return t([n.value,e])||Function.noop}),n)}}function T(e,t){var n=O(t),i=L(e,n),r=j(i,dt),a=L(r,$(dt));
return function(e,t){function n(e,t){return e=o.get(e),t=o.get(t),Object.compare(e,t)}function i(e,t){return e=o.get(e),t=o.get(t),Object.equals(e,t)}function r(e,t){t.forEach(function(e){l["delete"](e[0]),o["delete"](e[0])}),e.forEach(function(e){o.set(e[0],e[1]),l.add(e[0])})}function s(e){return l.clear(),J(e,r,t)}var o=new St,l=new Et(null,i,n),c=e(l)||Function.noop,u=a(s,t);return function(){c(),u()}}}function z(e){return function(t,n){return e(Ct(function(e){function i(e,t,n){var i=r.length-n-t.length;r.swap(i,t.length,e.reversed())}if(!e)return t();var r=[],a=J(e,i,n),s=t(r);return Lt(function(){s(),a()})}),n)}}function P(e){return function(t,n){return e(Ct(function(e){function i(t){for(var n=t;e.length>n;n++)l[n].index=n,o[n+1]=e[n]?o[n]+e[n].length:o[n]}function r(e,t,r){var c=o[r],u=o[r+t.length],h=u-c;a.swap(c,h,[]),l.swap(r,t.length,e.map(function(){return{index:null}})),i(r),wt(s.swap(r,t.length,e.map(function(e,t){function s(e,t,n){i(c.index);var r=o[c.index]+n,s=o[c.index]+n+t.length,l=s-r;a.swap(r,l,e)}var c=l[r+t];return J(e,s,n)})))}if(!e)return t();var a=[],s=[],o=[0],l=[],c=J(e,r,n),u=t(a)||Function.noop;return Lt(function(){u(),wt(s),c()})}),n)}}function D(){return At(d(Array.prototype.slice.call(arguments)))}function k(e,t){var n=kt(e,t),i=l(n,jt);return mt(i,Boolean)}function A(e,t){var n=mt(t,Tt.not),i=kt(e,n),r=l(i,jt);return mt(r,Tt.not)}function j(e,t){var n=B(e,t);return Nt(n)}function B(e,t){var n=O(t),i=L(e,n);return function(e,t){return i(Ct(function(n,i){function r(e,t){t.forEach(function(e){var t=a.get(e[1]);1===t.length?a["delete"](e[1]):t["delete"](e[0])}),e.forEach(function(e){var t,n=!a.has(e[1]);t=n?i.constructClone():a.get(e[1]),t.add(e[0]),n&&a.set(e[1],t)})}if(!n)return e();var a=St(),s=J(n,r,t),o=e(a)||Function.noop;return function(){s(),o()}}),t)}}function I(e,t,n){function i(e,t){return Object.compare(e[1],t[1])*n}var r=O(t),a=L(e,r);return function(e,t){return a(Ct(function(n){function r(e,t){s.addEach(e),s.deleteEach(t)}function a(t,n){return 0===n?t?e(t[0]):e():void 0}if(!n)return e();var s=new Ot(null,E,i),o=J(n,r,t),l=st(s,a,t);return function(){o(),l()}}),t)}}function R(e,t){return I(e,t,1)}function N(e,t){return I(e,t,-1)}function F(e){return I(e,i,1)}function q(e){return I(e,i,-1)}function V(e){return function(t){return function(n,i){return n=yt(n),t(Ct(function(t){if(!t)return n();var r=e(t,n);return J(t,function(e,t,i){return n(r(e,t,i))},i)}),i)}}}function W(e){return"number"==typeof e&&!isNaN(e)}function H(e,t,n){return n||(n=t,t=Bt),function(i,r){return e(Ct(function(e){function a(t,n,i){if(h){var r=t.length-n.length;o>=i?r>0?(u.swap(0,0,e.slice(o,o+r)),u.splice(s,u.length-s)):(u.splice(0,-r),u.swap(u.length,0,e.slice(o+u.length,o+s))):o+s>i&&(u.swap(i-o,n.length,t),r>0?u.splice(s,u.length-s):u.swap(u.length,0,e.slice(o+u.length,o+s)))}}if(!e)return i();var s,o,l,c,u=[],h=!1,d=J(e,a,r),p=n(function(t){t=+t,isNaN(t)&&(t=void 0);var n="number"==typeof t&&"number"==typeof o,i=Math.max(0,t);"number"==typeof c&&(i=Math.min(i,e.length-c)),h!==n?(n?u.swap(0,0,e.slice(c,c+i)):u.clear(),h=n):h&&l!==i&&(l>i?u.splice(t,l-i):u.swap(l,0,e.slice(c+l,c+i))),s=t,l=i},r),f=t(function(t){t=+t,isNaN(t)&&(t=void 0);var n="number"==typeof s&&"number"==typeof t,i=Math.max(0,t);"number"==typeof s&&(i=Math.min(i,e.length));var r=Math.max(0,s);if("number"==typeof i&&(r=Math.min(r,e.length-i)),h!==n)n?u.swap(0,u.length,e.slice(i,i+r)):u.clear(),h=n;else if(h&&c!==i){var a=Math.abs(i-c);l>a&&c>i?(u.swap(0,0,e.slice(i,c)),u.splice(r,u.length-r)):l>a&&i>c?(u.swap(u.length,0,e.slice(c+l,i+r)),u.splice(0,u.length-r)):u.swap(0,u.length,e.slice(i,i+r))}o=t,c=i,l=r},r),m=i(u)||Function.noop;return function(){m(),p(),f(),d()}}),r)}}function U(e){return function(t,n){return e(Ct(function(e){function i(e){for(;a.length>e;e++)a[e].set(0,e)}function r(e,t,n){a.swap(n,t.length,e.map(function(e,t){return[n+t,e]})),i(n+e.length)}if(!e)return t();var a=[],s=J(e,r,n),o=t(a)||Function.noop;return function(){o(),s()}}),n)}}function Y(e){return function(t,n){var i=[],r=t(i)||Function.noop,a=e(function(e){if(e>>>=0,null==e)i.clear();else if(e>i.length){for(var t=[],n=i.length;e>n;n++)t.push(n);i.swap(i.length,0,t)}else i.length>e&&i.splice(e,i.length)},n);return function(){r(),a()}}}function X(e,t){return function(n,i){return t(function(t){var r=RegExp("^"+RegExp.escape(t));return e(function(e){return n(r.test(e))||Function.noop},i)},i)}}function G(e,t){return function(n,i){return t(function(t){var r=RegExp(RegExp.escape(t)+"$");return e(function(e){return n(r.test(e))||Function.noop},i)},i)}}function K(e,t){return function(n,i){return t(function(t){var r=RegExp(RegExp.escape(t));return e(function(e){return n(r.test(e))||Function.noop},i)},i)}}function Z(e,t){return t=t||It,function(n,i){return e(Ct(function(e){return e?t(Ct(function(t){function r(){a=n(e.join(t))||Function.noop}if("string"!=typeof t)return n()||Function.noop;var a=Function.noop,s=J(e,r,i);return function(){s(),a()}}),i):n()||Function.noop}),i)}}function J(e,t,n){function i(e,n,i){r(),r=t(e,n,i)||Function.noop}if(!e)return Function.noop;var r=Function.noop;if(!e.toArray)return Function.noop;if(!e.addRangeChangeListener)return Function.noop;i(e.toArray(),[],0);var a=e.addRangeChangeListener(i,null,n.beforeChange);return function(){r(),a()}}function $(e){return function(t,n){return e(Ct(function(e){return Rt(e,t,n)}),n)}}function Q(e,t,n){function i(n,i,o){if(r+=n.length-i.length,!(r>o+i.length&&r>o+n.length)){var l=0>r?null:e.get(r);a(),a=t(l)||Function.noop,s=l}}var r=-1,a=Function.noop,s=null,o=J(e,i,n);return function(){a(),o()}}function et(e){return function(t,n){return e(Ct(yt(function(e){return tt(e,t,n)})),n)}}function tt(e,t,n){function i(n,i){return r+=n.length-i.length,1===r?t(e.only()):t()}var r=0;return J(e,i,n)}function nt(e){return function(t,n){return e(Ct(yt(function(e){return it(e,t,n)})),n)}}function it(e,t,n){function i(n,i){return r+=n.length-i.length,r>0?t(e.one()):t()}var r=0;return J(e,i,n)}function rt(e){return function(t,n){return e(Ct(function(e){return e&&e.addRangeChangeListener?J(e,function(){return t(e)},n):t(e)}),n)}}function at(e){return function(t,n){return e(Ct(function(e){return e&&e.addMapChangeListener?st(e,function(){return t(e)},n):t(e)}),n)}}function st(e,t,n){function i(e,n,i){var a=r.get(n)||Function.noop;r["delete"](n),a(),a=t(e,n,i)||Function.noop,void 0===e?a():r.set(n,a)}if(e.addMapChangeListener){var r=new St;e.forEach(i);var a=e.addMapChangeListener(i,n.beforeChange);return Lt(function(){r.forEach(function(e){e()}),a()})}}function ot(e){return function(t,n){return e(Ct(function(e){return e?lt(e,t,n):t()}),n)}}function lt(e,t,n){function i(e,t){var n,i;a.has(t)?null==e?(n=a.get(t),a["delete"](t),i=r.indexOf(n),r.splice(i,1)):(n=a.get(t),n.set(1,e)):(n=[t,e],a.set(t,n),r.push(n))}var r=[],a=St(),s=t(r)||Function.noop,o=st(e,i,n)||Function.noop;return Lt(function(){s(),o()})}function ct(e){var t=Nt(e);return Dt(t,ut)}function ut(e,t){return t.value?e(t.value[0])||Function.noop:e()}function ht(e){var t=Nt(e);return Dt(t,dt)}function dt(e,t){return t.value?e(t.value[1])||Function.noop:e()}function pt(e){return function(t,n){var i=new St,r=t(i)||Function.noop,a=e(Ct(function(e){function t(e,t){void 0===e?i["delete"](t):i.set(t,e)}if(i.clear(),e&&"object"==typeof e){if(e.addRangeChangeListener)return Ft(Ct(function(e){function t(e,t){t.forEach(function(e){i["delete"](e[0])}),e.forEach(function(e){i.set(e[0],e[1])})}return J(e,t,n)}),n.nest(e));if(e.addMapChangeListener)return st(e,t,n);var r=Object.keys(e).map(function(t){return zt(e,t,Ct(function(e){void 0===e?i["delete"](t):i.set(t,e)}),n)});return function(){wt(r)}}}),n);return function(){r(),a()}}}function ft(e){return function(t,n){return e(t,n.parent||n.nest())}}function mt(e,t,n){return function(i,r){return i=yt(i),e(Ct(function(e){return i(t.call(n,e))}),r)}}function gt(e,t,n){return function(i,r){return i=yt(i),e(Ct(function(e){return e&&e.every(Tt.defined)?i(t.apply(n,e)):void 0}),r)}}function vt(t,n){var i=e("./parse"),r=e("./compile-observer");return function(e,a){return e=yt(e),n(Ct(function(n){if(null==n)return e();var s,o;try{s=i(n),o=r(s)}catch(l){return e()}return t(Ct(function(t){return o(e,a.nest(t))}),a)}),a)}}function _t(e,t){return function(n,i){return e(Ct(function(e){return t(Ct(function(e){return n(e)}),i.nest(e))}),i)}}function bt(e){return function(){var t=e.apply(this,arguments);return function(e,n){var i=[],r=t(Ct(function(e){function t(e,t,n){i.swap(n,t.length,e)}if(e){qt(i,e);var r=e.addRangeChangeListener(t,null,n.beforeChange);return Lt(r)}i.clear()}),n),a=e(i)||Function.noop;return Lt(function(){r(),a()})}}}function yt(e){var t;return function(n){if(n!==t){var i=e.apply(this,arguments);return t=n,i}}}function wt(e){e.forEach(function(e){e&&e()})}function Ct(e){var t=Function.noop;return function(){return t(),t=e.apply(this,arguments)||Function.noop,function(){t()}}}function Lt(e){var t;return function(){return t?Function.noop:(t=!0,e.apply(this,arguments))}}e("collections/shim");var xt=e("collections/listen/property-changes");e("collections/listen/array-changes");var Mt=e("collections/sorted-array"),Et=e("collections/sorted-set"),St=e("collections/map");e("collections/set");var Ot=e("collections/heap");e("./scope");var Tt=e("./operators");t.makeLiteralObserver=n,t.observeValue=i,t.observeParameters=r,t.makeElementObserver=a,t.makeComponentObserver=s,t.observeProperty=o;var zt=o;t.makePropertyObserver=l,t.observeKey=c,t.observeGet=c;var Pt=c;t.makeGetObserver=u,t.makeHasObserver=h,t.makeObserversObserver=d,t.makeRecordObserver=p,t.makeObjectObserver=p,t.makeTupleObserver=f,t.makeArrayObserver=f,t.makeOperatorObserverMaker=m,t.makeMethodObserverMaker=g,t.makeNotObserver=v,t.makeAndObserver=_,t.makeOrObserver=b,t.makeConditionalObserver=y,t.makeDefinedObserver=w,t.makeDefaultObserver=C;var Dt=t.makeMapBlockObserver=bt(L),kt=t.makeFilterBlockObserver=bt(x);t.makeSortedBlockObserver=M,t.makeSortedSetBlockObserver=T,t.makeReversedObserver=bt(z);var At=t.makeFlattenObserver=bt(P);t.makeConcatObserver=D,t.makeSomeBlockObserver=k,t.makeEveryBlockObserver=A,t.makeGroupBlockObserver=j,t.makeGroupMapBlockObserver=B,t.makeMaxBlockObserver=R,t.makeMinBlockObserver=N,t.makeMaxObserver=F,t.makeMinObserver=q;var jt=n("length");t.makeSumObserver=V(function(){var e=0;return function(t,n){return t=t.filter(W),n=n.filter(W),e+=t.sum()-n.sum()}}),t.makeAverageObserver=V(function(){var e=0,t=0;return function(n,i){return n=n.filter(W),i=i.filter(W),e+=n.sum()-i.sum(),t+=n.length-i.length,e/t}}),t.makeViewObserver=bt(H);var Bt=n(0);t.makeEnumerateObserver=bt(U),t.makeEnumerationObserver=t.makeEnumerateObserver,t.makeRangeObserver=Y,t.makeStartsWithObserver=X,t.makeEndsWithObserver=G,t.makeContainsObserver=K,t.makeJoinObserver=Z;var It=n("");t.observeRangeChange=J,t.makeLastObserver=$,t.observeLast=Q;var Rt=Q;t.makeOnlyObserver=et,t.observeOnly=tt,t.makeOneObserver=nt,t.observeOne=it,t.makeRangeContentObserver=rt,t.makeMapContentObserver=at,t.observeMapChange=st;var Nt=t.makeEntriesObserver=bt(ot);t.observeEntries=lt,t.makeKeysObserver=ct,t.observeEntryKey=ut,t.makeValuesObserver=ht,t.observeEntryValue=dt,t.makeToMapObserver=pt;var Ft=Dt(j(i,ut),$(dt));t.makeParentObserver=ft,t.makeConverterObserver=mt,t.makeComputerObserver=gt,t.makePathObserver=vt,t.makeExpressionObserver=vt,t.makeWithObserver=_t,t.makeToArrayObserver=bt(Function.identity),t.makeAsArrayObserver=t.makeToArrayObserver;var qt=e("./merge").merge;t.makeUniq=yt,t.cancelEach=wt,t.autoCancelPrevious=Ct,t.once=Lt}}),montageDefine("99596c3","stringify",{dependencies:["./parse","./language"],factory:function(e,t,n){"use strict";function i(e,t){return i.semantics.stringify(e,t)}function r(e){return function(t,n,i){var r=e+"{"+i(t.args[1],n)+"}";return"value"===t.args[0].type?r:i(t.args[0],n)+"."+r}}e("./parse");var a=e("./language").precedence,s=e("./language").operatorTypes;e("./language").operatorTokens,n.exports=i,i.semantics={makeBlockStringifier:r,stringify:function(e,t,n){function i(e){var n=s(e,t);return n?n:"this"}var r,s=this.stringify.bind(this),o=this.stringifiers;if(o[e.type])r=o[e.type](e,t,s);else if(e.inline)r="&"+e.type+"("+e.args.map(i).join(", ")+")";else{var l;1===e.args.length&&"mapBlock"===e.args[0].type?(l=e.type+"{"+s(e.args[0].args[1],t)+"}",e=e.args[0]):l=e.type+"("+e.args.slice(1).map(i).join(", ")+")",r="value"===e.args[0].type?l:s(e.args[0],t)+"."+l}return!n||n.type===e.type&&"if"!==n.type||a.get(n.type).has(e.type)?r:"("+r+")"},stringifiers:{value:function(){return""},literal:function(e){return"string"==typeof e.value?"'"+e.value.replace("'","\\'")+"'":""+e.value},parameters:function(){return"$"},record:function(e,t,n){return"{"+Object.map(e.args,function(e,i){var r;return r="value"===e.type?"this":n(e,t),i+": "+r}).join(", ")+"}"},tuple:function(e,t,n){return"["+Object.map(e.args,function(e){return"value"===e.type?"this":n(e)}).join(", ")+"]"},component:function(e,t){var n;return t&&t.components&&e.component?t.components.getObjectLabel?n=t.components.getObjectLabel(e.component):t.components.getLabelForObject&&(n=t.components.getLabelForObject(e.component)):n=e.label,"@"+n},element:function(e){return"#"+e.id},mapBlock:r("map"),filterBlock:r("filter"),someBlock:r("some"),everyBlock:r("every"),sortedBlock:r("sorted"),sortedSetBlock:r("sortedSet"),groupBlock:r("group"),groupMapBlock:r("groupMap"),minBlock:r("min"),maxBlock:r("max"),property:function(e,t,n){return"value"===e.args[0].type?"string"==typeof e.args[1].value?e.args[1].value:"literal"===e.args[1].type?"."+e.args[1].value:"this["+n(e.args[1],t)+"]":"parameters"===e.args[0].type?"$"+e.args[1].value:"literal"===e.args[1].type&&/^[\w\d_]+$/.test(e.args[1].value)?n(e.args[0],t,{type:"scope"})+"."+e.args[1].value:n(e.args[0],{type:"scope"},t)+"["+n(e.args[1],t)+"]"},"with":function(e,t,n){var i=n(e.args[1],t,e);return n(e.args[0],t)+"."+i},not:function(e,t,n){return"equals"===e.args[0].type?n(e.args[0].args[0],t,{type:"equals"})+" != "+n(e.args[0].args[1],t,{type:"equals"}):"!"+n(e.args[0],t,e)},neg:function(e,t,n){return"-"+n(e.args[0],t,e)},toNumber:function(e,t,n){return"+"+n(e.args[0],t,e)},parent:function(e,t,n){return"^"+n(e.args[0],t,e)},"if":function(e,t,n){return n(e.args[0],t,e)+" ? "+n(e.args[1],t)+" : "+n(e.args[2],t)},event:function(e,t,n){return e.when+" "+e.event+" -> "+n(e.listener,t)},binding:function(e,t,n,i){var r=i(t.args[0],n)+" "+e+" "+i(t.args[1],n),a="",s=t.descriptor;if(s)for(var o in s)a+=", "+o+": "+i(s[o],n);return r+a},bind:function(e,t,n){return this.binding("<-",e,t,n)},bind2:function(e,t,n){return this.binding("<->",e,t,n)},assign:function(e,t,n){return n(e.args[0],t)+": "+n(e.args[1],t)},block:function(e,t,n){var i="@"+e.label;return e.connection&&("prototype"===e.connection?i+=" < ":"object"===e.connection&&(i+=" : "),i+=n({type:"literal",value:e.module}),e.exports&&"value"!==e.exports.type&&(i+=" "+n(e.exports,t))),i+" {\n"+e.statements.map(function(e){return"    "+n(e,t)+";\n"}).join("")+"}\n"},sheet:function(e,t,n){return"\n"+e.blocks.map(function(e){return n(e,t)}).join("\n")+"\n"}}},s.forEach(function(e,t){i.semantics.stringifiers[t]=function(t,n,i){return t.args.map(function(e){return i(e,n,t)}).join(" "+e+" ").trim()}})}}),montageDefine("99596c3","expand",{dependencies:["collections/set","collections/map","./operators"],factory:function(e,t,n){function i(e,t){var n=i.semantics.expand.bind(i.semantics);return n(e,t,n)}var r=e("collections/set"),a=e("collections/map");e("./operators"),n.exports=i,i.semantics={reflexive:r(["literal","element","rangeContent","mapContent"]),traverseLeft:r(["with","mapBlock","filterBlock","someBlock","everyBlock","sortedBlock","groupBlock","groupMapBlock"]),expanders:a({value:function(e,t){return t.value||{type:"value"}},parameters:function(e,t){return t.parameters||{type:"parameters"}},record:function(e,t,n){var i={type:"record",args:[]};for(var r in e.args)i.args[r]=n(e.args[r],t,n);return i},component:function(e,t){return t.components&&e.component?{type:"component",label:t.components.getObjectLabel(e.component)}:e}}),expand:function(e,t,n){return this.expanders.has(e.type)?this.expanders.get(e.type)(e,t,n):this.traverseLeft.has(e.type)?{type:e.type,args:[n(e.args[0],t,n)].concat(e.args.slice(1))}:this.reflexive.has(e.type)?e:{type:e.type,args:e.args.map(function(e){return n(e,t,n)})}}}}}),montageDefine("99596c3","bindings",{dependencies:["collections/map","./bind","./compute","./observe","./stringify"],factory:function(e,t){function n(e,t,n){if(t)for(var r in t)i(e,r,t[r],n);return e}function i(e,n,i,a){a=a||Object.empty;var s=r(e);if(d.call(s,n))throw Error("Can't bind to already bound target, "+JSON.stringify(n));return"<-"in i||"<->"in i||"compute"in i?(i.target=e,i.parameters=i.parameters||a.parameters,i.document=i.document||a.document,i.components=i.components||a.components,i.cancel="compute"in i?u(e,n,i):c(e,n,i),s[n]=i,t.count++):("get"in i||"set"in i||"writable"in i||(i.writable=!0),"configurable"in i||(i.configurable=!0),"enumerable"in i||(i.enumerable=!0),Object.defineProperty(e,n,i)),e}function r(e){return h.has(e)||h.set(e,{}),h.get(e)}function a(e,t){var n=r(e);return n[t]}function s(e){var t=r(e);for(var n in t)o(e,n)}function o(e,n){var i=r(e);if(!i[n])throw Error("Can't cancel non-existent binding to "+JSON.stringify(n));var a=i[n];if(a&&a.cancel){a.cancel(),delete i[n],t.count--;for(var n in i)return;h["delete"](e)}}var l=e("collections/map"),c=e("./bind"),u=e("./compute");e("./observe"),e("./stringify");var h=new l,d=Object.prototype.hasOwnProperty;t.count=0,t.bindings=h,t.defineBindings=n,t.defineBinding=i,t.getBindings=r,t.getBinding=a,t.cancelBindings=s,t.cancelBinding=o}}),montageDefine("99596c3","grammar",{dependencies:[],factory:function(e,t,n){n.exports=function(){function e(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}function t(e,t,n,i,r){function a(e,t){function n(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}var i,r;switch(e.length){case 0:i="end of input";break;case 1:i=e[0];break;default:i=e.slice(0,-1).join(", ")+" or "+e[e.length-1]}return r=t?'"'+n(t)+'"':"end of input","Expected "+i+" but "+r+" found."}this.expected=e,this.found=t,this.offset=n,this.line=i,this.column=r,this.name="SyntaxError",this.message=a(e,t)}function n(e){function n(t){function n(t,n,i){var r,a;for(r=n;i>r;r++)a=e.charAt(r),"\n"===a?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):"\r"===a||"\u2028"===a||"\u2029"===a?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}return Ur!==t&&(Ur>t&&(Ur=0,Yr={line:1,column:1,seenCR:!1}),n(Yr,Ur,t),Ur=t),Yr}function i(e){Xr>Wr||(Wr>Xr&&(Xr=Wr,Gr=[]),Gr.push(e))}function r(e){var t=0;for(e.sort();e.length>t;)e[t-1]===e[t]?e.splice(t,1):t++}function a(){var e,t;return Kr++,e=l(),Kr--,null===e&&(t=null,0===Kr&&i(Q)),e}function s(){var t,n,r,s,o,l,c;if(t=Wr,n=a(),null!==n){for(r=[],s=Wr,44===e.charCodeAt(Wr)?(o=tt,Wr++):(o=null,0===Kr&&i(nt)),null!==o?(l=F(),null!==l?(c=a(),null!==c?(o=[o,l,c],s=o):(Wr=s,s=et)):(Wr=s,s=et)):(Wr=s,s=et);null!==s;)r.push(s),s=Wr,44===e.charCodeAt(Wr)?(o=tt,Wr++):(o=null,0===Kr&&i(nt)),null!==o?(l=F(),null!==l?(c=a(),null!==c?(o=[o,l,c],s=o):(Wr=s,s=et)):(Wr=s,s=et)):(Wr=s,s=et);null!==r?(Hr=t,n=it(n,r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)}else Wr=t,t=et;return t}function o(){var t,n,r,a;return t=Wr,40===e.charCodeAt(Wr)?(n=rt,Wr++):(n=null,0===Kr&&i(at)),null!==n?(r=F(),null!==r?(41===e.charCodeAt(Wr)?(a=st,Wr++):(a=null,0===Kr&&i(ot)),null!==a?(Hr=t,n=lt(),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et),null===t&&(t=Wr,40===e.charCodeAt(Wr)?(n=rt,Wr++):(n=null,0===Kr&&i(at)),null!==n?(r=s(),null!==r?(41===e.charCodeAt(Wr)?(a=st,Wr++):(a=null,0===Kr&&i(ot)),null!==a?(Hr=t,n=ct(r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)),t}function l(){var t,n,r,s,o,l,u,h,d,p,f;return t=Wr,n=c(),null!==n?(r=F(),null!==r?(s=Wr,63===e.charCodeAt(Wr)?(o=ht,Wr++):(o=null,0===Kr&&i(dt)),null!==o?(l=F(),null!==l?(u=a(),null!==u?(h=F(),null!==h?(58===e.charCodeAt(Wr)?(d=pt,Wr++):(d=null,0===Kr&&i(ft)),null!==d?(p=F(),null!==p?(f=a(),null!==f?(o=[o,l,u,h,d,p,f],s=o):(Wr=s,s=et)):(Wr=s,s=et)):(Wr=s,s=et)):(Wr=s,s=et)):(Wr=s,s=et)):(Wr=s,s=et)):(Wr=s,s=et),null===s&&(s=ut),null!==s?(Hr=t,n=mt(n,s),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et),t}function c(){var t,n,r,a,s,o,l,c;if(t=Wr,n=u(),null!==n){for(r=[],a=Wr,s=F(),null!==s?(e.substr(Wr,2)===gt?(o=gt,Wr+=2):(o=null,0===Kr&&i(vt)),null!==o?(l=F(),null!==l?(c=u(),null!==c?(s=[s,o,l,c],a=s):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et);null!==a;)r.push(a),a=Wr,s=F(),null!==s?(e.substr(Wr,2)===gt?(o=gt,Wr+=2):(o=null,0===Kr&&i(vt)),null!==o?(l=F(),null!==l?(c=u(),null!==c?(s=[s,o,l,c],a=s):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et);null!==r?(Hr=t,n=_t(n,r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)}else Wr=t,t=et;return t}function u(){var t,n,r,a,s,o,l,c;if(t=Wr,n=h(),null!==n){for(r=[],a=Wr,s=F(),null!==s?(e.substr(Wr,2)===bt?(o=bt,Wr+=2):(o=null,0===Kr&&i(yt)),null!==o?(l=F(),null!==l?(c=h(),null!==c?(s=[s,o,l,c],a=s):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et);null!==a;)r.push(a),a=Wr,s=F(),null!==s?(e.substr(Wr,2)===bt?(o=bt,Wr+=2):(o=null,0===Kr&&i(yt)),null!==o?(l=F(),null!==l?(c=h(),null!==c?(s=[s,o,l,c],a=s):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et);null!==r?(Hr=t,n=_t(n,r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)}else Wr=t,t=et;return t}function h(){var t,n,r,a,s,o,l,c,u;return t=Wr,n=d(),null!==n?(r=Wr,a=F(),null!==a?(s=Wr,e.substr(Wr,3)===wt?(o=wt,Wr+=3):(o=null,0===Kr&&i(Ct)),null===o&&(e.substr(Wr,2)===Lt?(o=Lt,Wr+=2):(o=null,0===Kr&&i(xt)),null===o&&(e.substr(Wr,2)===Mt?(o=Mt,Wr+=2):(o=null,0===Kr&&i(Et)),null===o&&(o=Wr,60===e.charCodeAt(Wr)?(l=St,Wr++):(l=null,0===Kr&&i(Ot)),null!==l?(c=Wr,Kr++,45===e.charCodeAt(Wr)?(u=Tt,Wr++):(u=null,0===Kr&&i(zt)),Kr--,null===u?c=ut:(Wr=c,c=et),null!==c?(l=[l,c],o=l):(Wr=o,o=et)):(Wr=o,o=et),null===o&&(62===e.charCodeAt(Wr)?(o=Pt,Wr++):(o=null,0===Kr&&i(Dt)),null===o&&(e.substr(Wr,2)===kt?(o=kt,Wr+=2):(o=null,0===Kr&&i(At)),null===o&&(e.substr(Wr,2)===jt?(o=jt,Wr+=2):(o=null,0===Kr&&i(Bt)))))))),null!==o&&(o=e.substring(s,Wr)),s=o,null!==s?(o=F(),null!==o?(l=d(),null!==l?(a=[a,s,o,l],r=a):(Wr=r,r=et)):(Wr=r,r=et)):(Wr=r,r=et)):(Wr=r,r=et),null===r&&(r=ut),null!==r?(Hr=t,n=It(n,r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et),t}function d(){var t,n,r,a,s,o,l,c;if(t=Wr,n=p(),null!==n){for(r=[],a=Wr,s=F(),null!==s?(o=Wr,43===e.charCodeAt(Wr)?(l=Rt,Wr++):(l=null,0===Kr&&i(Nt)),null===l&&(45===e.charCodeAt(Wr)?(l=Tt,Wr++):(l=null,0===Kr&&i(zt))),null!==l&&(l=e.substring(o,Wr)),o=l,null!==o?(l=F(),null!==l?(c=p(),null!==c?(s=[s,o,l,c],a=s):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et);null!==a;)r.push(a),a=Wr,s=F(),null!==s?(o=Wr,43===e.charCodeAt(Wr)?(l=Rt,Wr++):(l=null,0===Kr&&i(Nt)),null===l&&(45===e.charCodeAt(Wr)?(l=Tt,Wr++):(l=null,0===Kr&&i(zt))),null!==l&&(l=e.substring(o,Wr)),o=l,null!==o?(l=F(),null!==l?(c=p(),null!==c?(s=[s,o,l,c],a=s):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et);null!==r?(Hr=t,n=_t(n,r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)}else Wr=t,t=et;return t}function p(){var t,n,r,a,s,o,l,c;if(t=Wr,n=f(),null!==n){for(r=[],a=Wr,s=F(),null!==s?(o=Wr,42===e.charCodeAt(Wr)?(l=Ft,Wr++):(l=null,0===Kr&&i(qt)),null===l&&(47===e.charCodeAt(Wr)?(l=Vt,Wr++):(l=null,0===Kr&&i(Wt)),null===l&&(37===e.charCodeAt(Wr)?(l=Ht,Wr++):(l=null,0===Kr&&i(Ut)),null===l&&(e.substr(Wr,3)===Yt?(l=Yt,Wr+=3):(l=null,0===Kr&&i(Xt))))),null!==l&&(l=e.substring(o,Wr)),o=l,null!==o?(l=F(),null!==l?(c=f(),null!==c?(s=[s,o,l,c],a=s):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et);null!==a;)r.push(a),a=Wr,s=F(),null!==s?(o=Wr,42===e.charCodeAt(Wr)?(l=Ft,Wr++):(l=null,0===Kr&&i(qt)),null===l&&(47===e.charCodeAt(Wr)?(l=Vt,Wr++):(l=null,0===Kr&&i(Wt)),null===l&&(37===e.charCodeAt(Wr)?(l=Ht,Wr++):(l=null,0===Kr&&i(Ut)),null===l&&(e.substr(Wr,3)===Yt?(l=Yt,Wr+=3):(l=null,0===Kr&&i(Xt))))),null!==l&&(l=e.substring(o,Wr)),o=l,null!==o?(l=F(),null!==l?(c=f(),null!==c?(s=[s,o,l,c],a=s):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et);null!==r?(Hr=t,n=_t(n,r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)}else Wr=t,t=et;return t}function f(){var t,n,r,a,s,o,l,c;if(t=Wr,n=m(),null!==n){for(r=[],a=Wr,s=F(),null!==s?(o=Wr,e.substr(Wr,2)===Gt?(l=Gt,Wr+=2):(l=null,0===Kr&&i(Kt)),null===l&&(e.substr(Wr,2)===Zt?(l=Zt,Wr+=2):(l=null,0===Kr&&i(Jt)),null===l&&(e.substr(Wr,2)===$t?(l=$t,Wr+=2):(l=null,0===Kr&&i(Qt)))),null!==l&&(l=e.substring(o,Wr)),o=l,null!==o?(l=F(),null!==l?(c=m(),null!==c?(s=[s,o,l,c],a=s):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et);null!==a;)r.push(a),a=Wr,s=F(),null!==s?(o=Wr,e.substr(Wr,2)===Gt?(l=Gt,Wr+=2):(l=null,0===Kr&&i(Kt)),null===l&&(e.substr(Wr,2)===Zt?(l=Zt,Wr+=2):(l=null,0===Kr&&i(Jt)),null===l&&(e.substr(Wr,2)===$t?(l=$t,Wr+=2):(l=null,0===Kr&&i(Qt)))),null!==l&&(l=e.substring(o,Wr)),o=l,null!==o?(l=F(),null!==l?(c=m(),null!==c?(s=[s,o,l,c],a=s):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et);null!==r?(Hr=t,n=_t(n,r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)}else Wr=t,t=et;return t}function m(){var t,n,r,a,s,o,l,c;if(t=Wr,n=g(),null!==n){for(r=[],a=Wr,s=F(),null!==s?(e.substr(Wr,2)===en?(o=en,Wr+=2):(o=null,0===Kr&&i(tn)),null!==o?(l=F(),null!==l?(c=g(),null!==c?(s=[s,o,l,c],a=s):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et);null!==a;)r.push(a),a=Wr,s=F(),null!==s?(e.substr(Wr,2)===en?(o=en,Wr+=2):(o=null,0===Kr&&i(tn)),null!==o?(l=F(),null!==l?(c=g(),null!==c?(s=[s,o,l,c],a=s):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et);null!==r?(Hr=t,n=_t(n,r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)}else Wr=t,t=et;return t}function g(){var t,n,r;return t=Wr,n=Wr,33===e.charCodeAt(Wr)?(r=nn,Wr++):(r=null,0===Kr&&i(rn)),null===r&&(43===e.charCodeAt(Wr)?(r=Rt,Wr++):(r=null,0===Kr&&i(Nt)),null===r&&(45===e.charCodeAt(Wr)?(r=Tt,Wr++):(r=null,0===Kr&&i(zt)))),null!==r&&(r=e.substring(n,Wr)),n=r,null!==n?(r=g(),null!==r?(Hr=t,n=an(n,r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et),null===t&&(t=v()),t}function v(){var e,t,n,i;if(e=Wr,t=y(),null!==t){for(n=[],i=_();null!==i;)n.push(i),i=_();null!==n?(Hr=e,t=sn(t,n),null===t?(Wr=e,e=t):e=t):(Wr=e,e=et)}else Wr=e,e=et;return e}function _(){var t,n,r,s;return t=Wr,46===e.charCodeAt(Wr)?(n=on,Wr++):(n=null,0===Kr&&i(ln)),null!==n?(r=b(),null!==r?(Hr=t,n=cn(r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et),null===t&&(t=Wr,91===e.charCodeAt(Wr)?(n=un,Wr++):(n=null,0===Kr&&i(hn)),null!==n?(r=a(),null!==r?(93===e.charCodeAt(Wr)?(s=dn,Wr++):(s=null,0===Kr&&i(pn)),null!==s?(Hr=t,n=fn(r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)),t}function b(){var t,n,r,s,l;return t=Wr,n=Wr,r=w(),null!==r&&(r=e.substring(n,Wr)),n=r,null!==n?(123===e.charCodeAt(Wr)?(r=mn,Wr++):(r=null,0===Kr&&i(gn)),null!==r?(s=a(),null!==s?(125===e.charCodeAt(Wr)?(l=vn,Wr++):(l=null,0===Kr&&i(_n)),null!==l?(Hr=t,n=bn(n,s),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et),null===t&&(t=Wr,n=Wr,r=w(),null!==r&&(r=e.substring(n,Wr)),n=r,null!==n?(r=o(),null!==r?(Hr=t,n=yn(n,r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et),null===t&&(t=Wr,n=B(),null!==n&&(Hr=t,n=wn(n)),null===n?(Wr=t,t=n):t=n,null===t&&(t=Wr,n=Wr,r=w(),null!==r&&(r=e.substring(n,Wr)),n=r,null!==n&&(Hr=t,n=Cn(n)),null===n?(Wr=t,t=n):t=n,null===t&&(t=Wr,n=S(),null!==n&&(Hr=t,n=Ln(n)),null===n?(Wr=t,t=n):t=n,null===t&&(t=Wr,n=O(),null!==n&&(Hr=t,n=Ln(n)),null===n?(Wr=t,t=n):t=n,null===t&&(t=Wr,40===e.charCodeAt(Wr)?(n=rt,Wr++):(n=null,0===Kr&&i(at)),null!==n?(r=a(),null!==r?(41===e.charCodeAt(Wr)?(s=st,Wr++):(s=null,0===Kr&&i(ot)),null!==s?(Hr=t,n=Ln(r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et))))))),t}function y(){var t,n,r,s;return t=S(),null===t&&(t=O(),null===t&&(t=C(),null===t&&(t=P(),null===t&&(t=Wr,e.substr(Wr,4)===xn?(n=xn,Wr+=4):(n=null,0===Kr&&i(Mn)),null!==n&&(Hr=t,n=En()),null===n?(Wr=t,t=n):t=n,null===t&&(t=Wr,e.substr(Wr,4)===Sn?(n=Sn,Wr+=4):(n=null,0===Kr&&i(On)),null!==n&&(Hr=t,n=Tn()),null===n?(Wr=t,t=n):t=n,null===t&&(t=Wr,e.substr(Wr,5)===zn?(n=zn,Wr+=5):(n=null,0===Kr&&i(Pn)),null!==n&&(Hr=t,n=Dn()),null===n?(Wr=t,t=n):t=n,null===t&&(t=Wr,e.substr(Wr,4)===kn?(n=kn,Wr+=4):(n=null,0===Kr&&i(An)),null!==n&&(Hr=t,n=jn()),null===n?(Wr=t,t=n):t=n,null===t&&(t=Wr,64===e.charCodeAt(Wr)?(n=Bn,Wr++):(n=null,0===Kr&&i(In)),null!==n?(r=Wr,s=Y(),null!==s&&(s=e.substring(r,Wr)),r=s,null!==r?(Hr=t,n=Rn(r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et),null===t&&(t=Wr,36===e.charCodeAt(Wr)?(n=Nn,Wr++):(n=null,0===Kr&&i(Fn)),null!==n?(r=Wr,s=w(),null!==s&&(s=e.substring(r,Wr)),r=s,null!==r?(Hr=t,n=qn(r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et),null===t&&(t=Wr,36===e.charCodeAt(Wr)?(n=Nn,Wr++):(n=null,0===Kr&&i(Fn)),null!==n&&(Hr=t,n=Vn()),null===n?(Wr=t,t=n):t=n,null===t&&(t=Wr,35===e.charCodeAt(Wr)?(n=Wn,Wr++):(n=null,0===Kr&&i(Hn)),null!==n?(r=Wr,s=w(),null!==s&&(s=e.substring(r,Wr)),r=s,null!==r?(Hr=t,n=Un(r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et),null===t&&(t=Wr,38===e.charCodeAt(Wr)?(n=Yn,Wr++):(n=null,0===Kr&&i(Xn)),null!==n?(r=Wr,s=w(),null!==s&&(s=e.substring(r,Wr)),r=s,null!==r?(s=o(),null!==s?(Hr=t,n=Gn(r,s),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et),null===t&&(t=Wr,94===e.charCodeAt(Wr)?(n=Kn,Wr++):(n=null,0===Kr&&i(Zn)),null!==n?(r=y(),null!==r?(Hr=t,n=Jn(r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et),null===t&&(t=Wr,40===e.charCodeAt(Wr)?(n=rt,Wr++):(n=null,0===Kr&&i(at)),null!==n?(r=a(),null!==r?(41===e.charCodeAt(Wr)?(s=st,Wr++):(s=null,0===Kr&&i(ot)),null!==s?(Hr=t,n=$n(r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et),null===t&&(t=Wr,n=b(),null!==n&&(Hr=t,n=Qn(n)),null===n?(Wr=t,t=n):t=n,null===t&&(t=Wr,n=[],null!==n&&(Hr=t,n=ei()),null===n?(Wr=t,t=n):t=n)))))))))))))))),t}function w(){var t,n;if(Kr++,t=[],ni.test(e.charAt(Wr))?(n=e.charAt(Wr),Wr++):(n=null,0===Kr&&i(ii)),null!==n)for(;null!==n;)t.push(n),ni.test(e.charAt(Wr))?(n=e.charAt(Wr),Wr++):(n=null,0===Kr&&i(ii));else t=et;return Kr--,null===t&&(n=null,0===Kr&&i(ti)),t}function C(){var t,n,r,a;if(Kr++,t=Wr,39===e.charCodeAt(Wr)?(n=ai,Wr++):(n=null,0===Kr&&i(si)),null!==n){for(r=[],a=L();null!==a;)r.push(a),a=L();null!==r?(39===e.charCodeAt(Wr)?(a=ai,Wr++):(a=null,0===Kr&&i(si)),null!==a?(Hr=t,n=oi(r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et)}else Wr=t,t=et;if(null===t)if(t=Wr,34===e.charCodeAt(Wr)?(n=li,Wr++):(n=null,0===Kr&&i(ci)),null!==n){for(r=[],a=x();null!==a;)r.push(a),a=x();null!==r?(34===e.charCodeAt(Wr)?(a=li,Wr++):(a=null,0===Kr&&i(ci)),null!==a?(Hr=t,n=oi(r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et)}else Wr=t,t=et;return Kr--,null===t&&(n=null,0===Kr&&i(ri)),t}function L(){var t,n;return ui.test(e.charAt(Wr))?(t=e.charAt(Wr),Wr++):(t=null,0===Kr&&i(hi)),null===t&&(t=Wr,e.substr(Wr,2)===di?(n=di,Wr+=2):(n=null,0===Kr&&i(pi)),null!==n&&(Hr=t,n=fi()),null===n?(Wr=t,t=n):t=n,null===t&&(t=M())),t}function x(){var t,n;return mi.test(e.charAt(Wr))?(t=e.charAt(Wr),Wr++):(t=null,0===Kr&&i(gi)),null===t&&(t=Wr,e.substr(Wr,2)===vi?(n=vi,Wr+=2):(n=null,0===Kr&&i(_i)),null!==n&&(Hr=t,n=bi()),null===n?(Wr=t,t=n):t=n,null===t&&(t=M())),t}function M(){var t,n,r,a,s,o,l,c;return t=Wr,e.substr(Wr,2)===yi?(n=yi,Wr+=2):(n=null,0===Kr&&i(wi)),null!==n&&(Hr=t,n=Ci()),null===n?(Wr=t,t=n):t=n,null===t&&(t=Wr,e.substr(Wr,2)===Li?(n=Li,Wr+=2):(n=null,0===Kr&&i(xi)),null!==n&&(Hr=t,n=Mi()),null===n?(Wr=t,t=n):t=n,null===t&&(t=Wr,e.substr(Wr,2)===Ei?(n=Ei,Wr+=2):(n=null,0===Kr&&i(Si)),null!==n&&(Hr=t,n=Oi()),null===n?(Wr=t,t=n):t=n,null===t&&(t=Wr,e.substr(Wr,2)===Ti?(n=Ti,Wr+=2):(n=null,0===Kr&&i(zi)),null!==n&&(Hr=t,n=Pi()),null===n?(Wr=t,t=n):t=n,null===t&&(t=Wr,e.substr(Wr,2)===Di?(n=Di,Wr+=2):(n=null,0===Kr&&i(ki)),null!==n&&(Hr=t,n=Ai()),null===n?(Wr=t,t=n):t=n,null===t&&(t=Wr,e.substr(Wr,2)===ji?(n=ji,Wr+=2):(n=null,0===Kr&&i(Bi)),null!==n&&(Hr=t,n=Ii()),null===n?(Wr=t,t=n):t=n,null===t&&(t=Wr,e.substr(Wr,2)===Ri?(n=Ri,Wr+=2):(n=null,0===Kr&&i(Ni)),null!==n&&(Hr=t,n=Fi()),null===n?(Wr=t,t=n):t=n,null===t&&(t=Wr,e.substr(Wr,2)===qi?(n=qi,Wr+=2):(n=null,0===Kr&&i(Vi)),null!==n&&(Hr=t,n=Wi()),null===n?(Wr=t,t=n):t=n,null===t&&(t=Wr,e.substr(Wr,2)===Hi?(n=Hi,Wr+=2):(n=null,0===Kr&&i(Ui)),null!==n?(r=Wr,a=Wr,s=E(),null!==s?(o=E(),null!==o?(l=E(),null!==l?(c=E(),null!==c?(s=[s,o,l,c],a=s):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et),null!==a&&(a=e.substring(r,Wr)),r=a,null!==r?(Hr=t,n=Yi(r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et))))))))),t
}function E(){var t;return Xi.test(e.charAt(Wr))?(t=e.charAt(Wr),Wr++):(t=null,0===Kr&&i(Gi)),t}function S(){var t,n,r,a;return t=Wr,91===e.charCodeAt(Wr)?(n=un,Wr++):(n=null,0===Kr&&i(hn)),null!==n?(r=F(),null!==r?(93===e.charCodeAt(Wr)?(a=dn,Wr++):(a=null,0===Kr&&i(pn)),null!==a?(Hr=t,n=Ki(),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et),null===t&&(t=Wr,91===e.charCodeAt(Wr)?(n=un,Wr++):(n=null,0===Kr&&i(hn)),null!==n?(r=s(),null!==r?(93===e.charCodeAt(Wr)?(a=dn,Wr++):(a=null,0===Kr&&i(pn)),null!==a?(Hr=t,n=Zi(r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)),t}function O(){var t,n,r,a,s,o;return t=Wr,123===e.charCodeAt(Wr)?(n=mn,Wr++):(n=null,0===Kr&&i(gn)),null!==n?(r=F(),null!==r?(125===e.charCodeAt(Wr)?(a=vn,Wr++):(a=null,0===Kr&&i(_n)),null!==a?(s=F(),null!==s?(Hr=t,n=Ji(),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et),null===t&&(t=Wr,123===e.charCodeAt(Wr)?(n=mn,Wr++):(n=null,0===Kr&&i(gn)),null!==n?(r=F(),null!==r?(a=T(),null!==a?(125===e.charCodeAt(Wr)?(s=vn,Wr++):(s=null,0===Kr&&i(_n)),null!==s?(o=F(),null!==o?(Hr=t,n=$i(a),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)),t}function T(){var t,n,r,a,s,o,l;if(t=Wr,n=z(),null!==n){for(r=[],a=Wr,44===e.charCodeAt(Wr)?(s=tt,Wr++):(s=null,0===Kr&&i(nt)),null!==s?(o=F(),null!==o?(l=z(),null!==l?(s=[s,o,l],a=s):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et);null!==a;)r.push(a),a=Wr,44===e.charCodeAt(Wr)?(s=tt,Wr++):(s=null,0===Kr&&i(nt)),null!==s?(o=F(),null!==o?(l=z(),null!==l?(s=[s,o,l],a=s):(Wr=a,a=et)):(Wr=a,a=et)):(Wr=a,a=et);null!==r?(Hr=t,n=Qi(n,r),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)}else Wr=t,t=et;return t}function z(){var t,n,r,s,o;return t=Wr,n=Wr,r=w(),null!==r&&(r=e.substring(n,Wr)),n=r,null!==n?(58===e.charCodeAt(Wr)?(r=pt,Wr++):(r=null,0===Kr&&i(ft)),null!==r?(s=F(),null!==s?(o=a(),null!==o?(Hr=t,n=er(n,o),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et),t}function P(){var t,n,r;return Kr++,t=Wr,n=Wr,r=D(),null!==r&&(r=e.substring(n,Wr)),n=r,null!==n&&(Hr=t,n=nr(n)),null===n?(Wr=t,t=n):t=n,Kr--,null===t&&(n=null,0===Kr&&i(tr)),t}function D(){var e,t,n,i;return e=Wr,t=k(),null!==t?(n=A(),null!==n?(i=j(),null!==i?(t=[t,n,i],e=t):(Wr=e,e=et)):(Wr=e,e=et)):(Wr=e,e=et),null===e&&(e=Wr,t=k(),null!==t?(n=A(),null!==n?(t=[t,n],e=t):(Wr=e,e=et)):(Wr=e,e=et),null===e&&(e=Wr,t=k(),null!==t?(n=j(),null!==n?(t=[t,n],e=t):(Wr=e,e=et)):(Wr=e,e=et),null===e&&(e=k()))),e}function k(){var t,n,r,a;return t=Wr,n=N(),null!==n?(r=B(),null!==r?(n=[n,r],t=n):(Wr=t,t=et)):(Wr=t,t=et),null===t&&(t=R(),null===t&&(t=Wr,45===e.charCodeAt(Wr)?(n=Tt,Wr++):(n=null,0===Kr&&i(zt)),null!==n?(r=N(),null!==r?(a=B(),null!==a?(n=[n,r,a],t=n):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et),null===t&&(t=Wr,45===e.charCodeAt(Wr)?(n=Tt,Wr++):(n=null,0===Kr&&i(zt)),null!==n?(r=R(),null!==r?(n=[n,r],t=n):(Wr=t,t=et)):(Wr=t,t=et)))),t}function A(){var t,n,r;return t=Wr,46===e.charCodeAt(Wr)?(n=on,Wr++):(n=null,0===Kr&&i(ln)),null!==n?(r=B(),null!==r?(n=[n,r],t=n):(Wr=t,t=et)):(Wr=t,t=et),t}function j(){var e,t,n;return e=Wr,t=I(),null!==t?(n=B(),null!==n?(t=[t,n],e=t):(Wr=e,e=et)):(Wr=e,e=et),e}function B(){var e,t;if(e=[],t=R(),null!==t)for(;null!==t;)e.push(t),t=R();else e=et;return e}function I(){var t,n,r;return t=Wr,ir.test(e.charAt(Wr))?(n=e.charAt(Wr),Wr++):(n=null,0===Kr&&i(rr)),null!==n?(ar.test(e.charAt(Wr))?(r=e.charAt(Wr),Wr++):(r=null,0===Kr&&i(sr)),null===r&&(r=ut),null!==r?(n=[n,r],t=n):(Wr=t,t=et)):(Wr=t,t=et),t}function R(){var t;return or.test(e.charAt(Wr))?(t=e.charAt(Wr),Wr++):(t=null,0===Kr&&i(lr)),t}function N(){var t;return cr.test(e.charAt(Wr))?(t=e.charAt(Wr),Wr++):(t=null,0===Kr&&i(ur)),t}function F(){var e,t;for(e=[],t=q(),null===t&&(t=V());null!==t;)e.push(t),t=q(),null===t&&(t=V());return e}function q(){var t,n;return Kr++,dr.test(e.charAt(Wr))?(t=e.charAt(Wr),Wr++):(t=null,0===Kr&&i(pr)),null===t&&(fr.test(e.charAt(Wr))?(t=e.charAt(Wr),Wr++):(t=null,0===Kr&&i(mr))),Kr--,null===t&&(n=null,0===Kr&&i(hr)),t}function V(){var t,n;return Kr++,vr.test(e.charAt(Wr))?(t=e.charAt(Wr),Wr++):(t=null,0===Kr&&i(_r)),Kr--,null===t&&(n=null,0===Kr&&i(gr)),t}function W(){var e,t,n,i;if(e=Wr,t=F(),null!==t){for(n=[],i=H();null!==i;)n.push(i),i=H();null!==n?(i=F(),null!==i?(Hr=e,t=br(n),null===t?(Wr=e,e=t):e=t):(Wr=e,e=et)):(Wr=e,e=et)}else Wr=e,e=et;return e}function H(){var t,n,r,a,s,o,l,c,u,h;return t=Wr,64===e.charCodeAt(Wr)?(n=Bn,Wr++):(n=null,0===Kr&&i(In)),null!==n?(r=Wr,a=Y(),null!==a&&(a=e.substring(r,Wr)),r=a,null!==r?(a=F(),null!==a?(s=U(),null===s&&(s=ut),null!==s?(123===e.charCodeAt(Wr)?(o=mn,Wr++):(o=null,0===Kr&&i(gn)),null!==o?(l=F(),null!==l?(c=X(),null!==c?(125===e.charCodeAt(Wr)?(u=vn,Wr++):(u=null,0===Kr&&i(_n)),null!==u?(h=F(),null!==h?(Hr=t,n=yr(r,s,c),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et),t}function U(){var t,n,r,s,o,l,c,u;return t=Wr,60===e.charCodeAt(Wr)?(n=St,Wr++):(n=null,0===Kr&&i(Ot)),null===n&&(58===e.charCodeAt(Wr)?(n=pt,Wr++):(n=null,0===Kr&&i(ft))),null!==n?(r=F(),null!==r?(s=C(),null===s&&(s=ut),null!==s?(o=F(),null!==o?(l=Wr,c=Wr,Kr++,123===e.charCodeAt(Wr)?(u=mn,Wr++):(u=null,0===Kr&&i(gn)),Kr--,null===u?c=ut:(Wr=c,c=et),null!==c?(u=a(),null!==u?(c=[c,u],l=c):(Wr=l,l=et)):(Wr=l,l=et),null===l&&(l=ut),null!==l?(c=F(),null!==c?(Hr=t,n=wr(n,s,l),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et),null===t&&(t=Wr,n=F(),null!==n&&(Hr=t,n=Cr()),null===n?(Wr=t,t=n):t=n),t}function Y(){var t,n,r,a,s,o,l;if(t=Wr,n=[],Lr.test(e.charAt(Wr))?(r=e.charAt(Wr),Wr++):(r=null,0===Kr&&i(xr)),null!==r)for(;null!==r;)n.push(r),Lr.test(e.charAt(Wr))?(r=e.charAt(Wr),Wr++):(r=null,0===Kr&&i(xr));else n=et;if(null!==n){if(r=[],a=Wr,58===e.charCodeAt(Wr)?(s=pt,Wr++):(s=null,0===Kr&&i(ft)),null!==s){if(o=[],Lr.test(e.charAt(Wr))?(l=e.charAt(Wr),Wr++):(l=null,0===Kr&&i(xr)),null!==l)for(;null!==l;)o.push(l),Lr.test(e.charAt(Wr))?(l=e.charAt(Wr),Wr++):(l=null,0===Kr&&i(xr));else o=et;null!==o?(s=[s,o],a=s):(Wr=a,a=et)}else Wr=a,a=et;for(;null!==a;)if(r.push(a),a=Wr,58===e.charCodeAt(Wr)?(s=pt,Wr++):(s=null,0===Kr&&i(ft)),null!==s){if(o=[],Lr.test(e.charAt(Wr))?(l=e.charAt(Wr),Wr++):(l=null,0===Kr&&i(xr)),null!==l)for(;null!==l;)o.push(l),Lr.test(e.charAt(Wr))?(l=e.charAt(Wr),Wr++):(l=null,0===Kr&&i(xr));else o=et;null!==o?(s=[s,o],a=s):(Wr=a,a=et)}else Wr=a,a=et;null!==r?(n=[n,r],t=n):(Wr=t,t=et)}else Wr=t,t=et;return t}function X(){var t,n,r,a,s,o,l,c,u;if(t=Wr,n=G(),null!==n)if(r=F(),null!==r){for(a=[],s=Wr,59===e.charCodeAt(Wr)?(o=Mr,Wr++):(o=null,0===Kr&&i(Er)),null!==o?(l=F(),null!==l?(c=G(),null!==c?(u=F(),null!==u?(o=[o,l,c,u],s=o):(Wr=s,s=et)):(Wr=s,s=et)):(Wr=s,s=et)):(Wr=s,s=et);null!==s;)a.push(s),s=Wr,59===e.charCodeAt(Wr)?(o=Mr,Wr++):(o=null,0===Kr&&i(Er)),null!==o?(l=F(),null!==l?(c=G(),null!==c?(u=F(),null!==u?(o=[o,l,c,u],s=o):(Wr=s,s=et)):(Wr=s,s=et)):(Wr=s,s=et)):(Wr=s,s=et);null!==a?(59===e.charCodeAt(Wr)?(s=Mr,Wr++):(s=null,0===Kr&&i(Er)),null===s&&(s=ut),null!==s?(o=F(),null!==o?(Hr=t,n=it(n,a),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)}else Wr=t,t=et;else Wr=t,t=et;return null===t&&(t=Wr,n=G(),null!==n?(r=F(),null!==r?(59===e.charCodeAt(Wr)?(a=Mr,Wr++):(a=null,0===Kr&&i(Er)),null===a&&(a=ut),null!==a?(s=F(),null!==s?(Hr=t,n=Sr(n),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et),null===t&&(t=Wr,n=F(),null!==n&&(Hr=t,n=lt()),null===n?(Wr=t,t=n):t=n)),t}function G(){var t,n,r,s,o,l,c,u,h,d,p,f,m,g,v,_,b;if(t=Wr,e.substr(Wr,2)===Or?(n=Or,Wr+=2):(n=null,0===Kr&&i(Tr)),null===n&&(e.substr(Wr,6)===zr?(n=zr,Wr+=6):(n=null,0===Kr&&i(Pr))),null!==n?(32===e.charCodeAt(Wr)?(r=Dr,Wr++):(r=null,0===Kr&&i(kr)),null!==r?(s=F(),null!==s?(o=Wr,l=w(),null!==l&&(l=e.substring(o,Wr)),o=l,null!==o?(l=F(),null!==l?(e.substr(Wr,2)===Ar?(c=Ar,Wr+=2):(c=null,0===Kr&&i(jr)),null!==c?(u=F(),null!==u?(h=a(),null!==h?(d=F(),null!==d?(Hr=t,n=Br(n,o,h),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et),null===t){if(t=Wr,n=a(),null!==n)if(r=F(),null!==r)if(58===e.charCodeAt(Wr)?(s=pt,Wr++):(s=null,0===Kr&&i(ft)),null===s&&(e.substr(Wr,3)===Ir?(s=Ir,Wr+=3):(s=null,0===Kr&&i(Rr)),null===s&&(e.substr(Wr,2)===Nr?(s=Nr,Wr+=2):(s=null,0===Kr&&i(Fr)))),null!==s)if(o=F(),null!==o)if(l=a(),null!==l)if(c=F(),null!==c){for(u=[],h=Wr,44===e.charCodeAt(Wr)?(d=tt,Wr++):(d=null,0===Kr&&i(nt)),null!==d?(p=F(),null!==p?(f=Wr,m=w(),null!==m&&(m=e.substring(f,Wr)),f=m,null!==f?(m=F(),null!==m?(58===e.charCodeAt(Wr)?(g=pt,Wr++):(g=null,0===Kr&&i(ft)),null!==g?(v=F(),null!==v?(_=a(),null!==_?(b=F(),null!==b?(d=[d,p,f,m,g,v,_,b],h=d):(Wr=h,h=et)):(Wr=h,h=et)):(Wr=h,h=et)):(Wr=h,h=et)):(Wr=h,h=et)):(Wr=h,h=et)):(Wr=h,h=et)):(Wr=h,h=et);null!==h;)u.push(h),h=Wr,44===e.charCodeAt(Wr)?(d=tt,Wr++):(d=null,0===Kr&&i(nt)),null!==d?(p=F(),null!==p?(f=Wr,m=w(),null!==m&&(m=e.substring(f,Wr)),f=m,null!==f?(m=F(),null!==m?(58===e.charCodeAt(Wr)?(g=pt,Wr++):(g=null,0===Kr&&i(ft)),null!==g?(v=F(),null!==v?(_=a(),null!==_?(b=F(),null!==b?(d=[d,p,f,m,g,v,_,b],h=d):(Wr=h,h=et)):(Wr=h,h=et)):(Wr=h,h=et)):(Wr=h,h=et)):(Wr=h,h=et)):(Wr=h,h=et)):(Wr=h,h=et)):(Wr=h,h=et);null!==u?(Hr=t,n=qr(n,s,l,u),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)}else Wr=t,t=et;else Wr=t,t=et;else Wr=t,t=et;else Wr=t,t=et;else Wr=t,t=et;else Wr=t,t=et;null===t&&(t=Wr,n=Wr,r=w(),null!==r&&(r=e.substring(n,Wr)),n=r,null!==n?(r=F(),null!==r?(s=a(),null!==s?(o=F(),null!==o?(Hr=t,n=Vr(n,s),null===n?(Wr=t,t=n):t=n):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et)):(Wr=t,t=et))}return t}var K,Z=arguments.length>1?arguments[1]:{},J={expression:a,sheet:W},$=a,Q="expression",et=null,tt=",",nt='","',it=function(e,t){for(var n=[e],i=0;t.length>i;i++)n.push(t[i][2]);return n},rt="(",at='"("',st=")",ot='")"',lt=function(){return[]},ct=function(e){return e},ut="",ht="?",dt='"?"',pt=":",ft='":"',mt=function(e,t){if(t){var n=t[2],i=t[6];return{type:"if",args:[e,n,i]}}return e},gt="||",vt='"||"',_t=function(e,t){for(var n=0;t.length>n;n++)e={type:Zr[t[n][1]],args:[e,t[n][3]]};return e},bt="&&",yt='"&&"',wt="<=>",Ct='"<=>"',Lt="<=",xt='"<="',Mt=">=",Et='">="',St="<",Ot='"<"',Tt="-",zt='"-"',Pt=">",Dt='">"',kt="==",At='"=="',jt="!=",Bt='"!="',It=function(e,t){if(t){var n=t[1],i=t[3];return"!="===n?{type:"not",args:[{type:"equals",args:[e,i]}]}:{type:Zr[n],args:[e,i]}}return e},Rt="+",Nt='"+"',Ft="*",qt='"*"',Vt="/",Wt='"/"',Ht="%",Ut='"%"',Yt="rem",Xt='"rem"',Gt="**",Kt='"**"',Zt="//",Jt='"//"',$t="%%",Qt='"%%"',en="??",tn='"??"',nn="!",rn='"!"',an=function(e,t){return{type:Jr[e],args:[t]}},sn=function(e,t){for(var n=0;t.length>n;n++)e=t[n](e);return e},on=".",ln='"."',cn=function(e){return e},un="[",hn='"["',dn="]",pn='"]"',fn=function(e){return function(t){return{type:"property",args:[t,e]}}},mn="{",gn='"{"',vn="}",_n='"}"',bn=function(e,t){return $r[e]?function(n){return{type:$r[e],args:[n,t]}}:"value"===t.type?function(t){return{type:e,args:[t]}}:function(n){return{type:e,args:[{type:"mapBlock",args:[n,t]}]}}},yn=function(e,t){return function(n){return{type:e,args:[n].concat(t)}}},wn=function(e){return function(t){return{type:"property",args:[t,{type:"literal",value:+e.join("")}]}}},Cn=function(e){return function(t){return{type:"property",args:[t,{type:"literal",value:e}]}}},Ln=function(e){return function(t){return{type:"with",args:[t,e]}}},xn="this",Mn='"this"',En=function(){return{type:"value"}},Sn="true",On='"true"',Tn=function(){return{type:"literal",value:!0}},zn="false",Pn='"false"',Dn=function(){return{type:"literal",value:!1}},kn="null",An='"null"',jn=function(){return{type:"literal",value:null}},Bn="@",In='"@"',Rn=function(e){return{type:"component",label:e}},Nn="$",Fn='"$"',qn=function(e){return{type:"property",args:[{type:"parameters"},{type:"literal",value:e}]}},Vn=function(){return{type:"parameters"}},Wn="#",Hn='"#"',Un=function(e){return{type:"element",id:e}},Yn="&",Xn='"&"',Gn=function(e,t){return{type:e,args:t,inline:!0}},Kn="^",Zn='"^"',Jn=function(e){return{type:"parent",args:[e]}},$n=function(e){return e},Qn=function(e){return e({type:"value"})},ei=function(){return{type:"value"}},ti="word",ni=/^[a-zA-Z_0-9\-]/,ii="[a-zA-Z_0-9\\-]",ri="string",ai="'",si='"\'"',oi=function(e){return{type:"literal",value:e.join("")}},li='"',ci='"\\""',ui=/^[^'\\\0-\x1F]/,hi="[^'\\\\\\0-\\x1F]",di="\\'",pi='"\\\\\'"',fi=function(){return"'"},mi=/^[^"\\\0-\x1F]/,gi='[^"\\\\\\0-\\x1F]',vi='\\"',_i='"\\\\\\""',bi=function(){return'"'},yi="\\\\",wi='"\\\\\\\\"',Ci=function(){return"\\"},Li="\\/",xi='"\\\\/"',Mi=function(){return"/"},Ei="\\b",Si='"\\\\b"',Oi=function(){return"\b"},Ti="\\f",zi='"\\\\f"',Pi=function(){return"\f"},Di="\\n",ki='"\\\\n"',Ai=function(){return"\n"},ji="\\r",Bi='"\\\\r"',Ii=function(){return"\r"},Ri="\\t",Ni='"\\\\t"',Fi=function(){return"	"},qi="\\0",Vi='"\\\\0"',Wi=function(){return"\0"},Hi="\\u",Ui='"\\\\u"',Yi=function(e){return String.fromCharCode(parseInt(e,16))},Xi=/^[0-9a-fA-F]/,Gi="[0-9a-fA-F]",Ki=function(){return{type:"tuple",args:[]}},Zi=function(e){return{type:"tuple",args:e}},Ji=function(){return{type:"record",args:[]}},$i=function(e){return{type:"record",args:e}},Qi=function(e,t){var n={};n[e[0]]=e[1];for(var i=0;t.length>i;i++)n[t[i][2][0]]=t[i][2][1];return n},er=function(e,t){return[e,t]},tr="number",nr=function(e){return{type:"literal",value:+e}},ir=/^[eE]/,rr="[eE]",ar=/^[+\-]/,sr="[+\\-]",or=/^[0-9]/,lr="[0-9]",cr=/^[1-9]/,ur="[1-9]",hr="whitespace",dr=/^[\t\x0B\f \xA0\uFEFF]/,pr="[\\t\\x0B\\f \\xA0\\uFEFF]",fr=/^[ \xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000]/,mr="[ \\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000]",gr="line terminator",vr=/^[\n\r\u2028\u2029]/,_r="[\\n\\r\\u2028\\u2029]",br=function(e){return{type:"sheet",blocks:e}},yr=function(e,t,n){return{type:"block",connection:t.connection,module:t.module,exports:t.exports,label:e,statements:n}},wr=function(e,t,n){return{connection:{"<":"prototype",":":"object"}[e],module:t&&t.value,exports:""!==n?n[1]:void 0}},Cr=function(){return{}},Lr=/^[a-zA-Z_0-9]/,xr="[a-zA-Z_0-9]",Mr=";",Er='";"',Sr=function(e){return[e]},Or="on",Tr='"on"',zr="before",Pr='"before"',Dr=" ",kr='" "',Ar="->",jr='"->"',Br=function(e,t,n){return{type:"event",when:e,event:t,listener:n}},Ir="<->",Rr='"<->"',Nr="<-",Fr='"<-"',qr=function(e,t,n,i){var r={type:Qr[t],args:[e,n]};if(i.length){for(var a={},s=0;i.length>s;s++)a[i[s][2]]=i[s][6];r.descriptor=a}return r},Vr=function(e,t){return{type:"unit",name:e,value:t}},Wr=0,Hr=0,Ur=0,Yr={line:1,column:1,seenCR:!1},Xr=0,Gr=[],Kr=0;if("startRule"in Z){if(!(Z.startRule in J))throw Error("Can't start parsing from rule \""+Z.startRule+'".');$=J[Z.startRule]}var Zr={"**":"pow","//":"root","%%":"log","*":"mul","/":"div","%":"mod",rem:"rem","+":"add","-":"sub","<":"lt",">":"gt","<=":"le",">=":"ge","==":"equals","<=>":"compare","??":"default","&&":"and","||":"or","<-":"bind","<->":"bind2",":":"assign"},Jr={"+":"toNumber","-":"neg","!":"not","^":"parent"},$r={map:"mapBlock",filter:"filterBlock",some:"someBlock",every:"everyBlock",sorted:"sortedBlock",sortedSet:"sortedSetBlock",group:"groupBlock",groupMap:"groupMapBlock",min:"minBlock",max:"maxBlock"},Qr={":":"assign","<-":"bind","<->":"bind2"};if(K=$(),null!==K&&Wr===e.length)return K;throw r(Gr),Hr=Math.max(Wr,Xr),new t(Gr,e.length>Hr?e.charAt(Hr):null,Hr,n(Hr).line,n(Hr).column)}return e(t,Error),{SyntaxError:t,parse:n}}()}}),montageDefine("99596c3","compile-evaluator",{dependencies:["collections/shim-object","collections/map","collections/sorted-set","./operators","./scope","./parse"],factory:function(e,t,n){function i(e){return i.semantics.compile(e)}var r=e("collections/shim-object"),a=e("collections/map"),s=e("collections/sorted-set"),o=e("./operators");e("./scope"),n.exports=i;var l={literal:function(e){return function(){return e.value}},value:function(){return function(e){return e.value}},parameters:function(){return function(e){return e.parameters}},element:function(e){return function(t){return t.document.getElementById(e.id)}},component:function(e){return function(t){return t.components.getObjectByLabel(e.label)}},tuple:function(e){var t=e.args.map(this.compile,this);return function(e){return t.map(function(t){return t(e)})}},record:function(e){var t=e.args,n={};for(var i in t)n[i]=this.compile(t[i]);return function(e){var t={};for(var i in n)t[i]=n[i](e);return t}}},c={mapBlock:function(e,t){return function(n){return e(n).map(function(e){return t(n.nest(e))})}},filterBlock:function(e,t){return function(n){return e(n).filter(function(e){return t(n.nest(e))})}},someBlock:function(e,t){return function(n){return e(n).some(function(e){return t(n.nest(e))})}},everyBlock:function(e,t){return function(n){return e(n).every(function(e){return t(n.nest(e))})}},sortedBlock:function(e,t){return function(n){return e(n).sorted(Function.by(function(e){return t(n.nest(e))}))}},sortedSetBlock:function(e,t){return function(n){function i(e){return t(n.nest(e))}function a(e,t){return r.compare(i(e),i(t))}function o(e,t){return r.equals(i(e),i(t))}return new s(e(n),o,a)}},groupBlock:function(e,t){return function(n){return e(n).group(function(e){return t(n.nest(e))})}},groupMapBlock:function(e,t){return function(n){return new a(e(n).group(function(e){return t(n.nest(e))}))}},minBlock:function(e,t){return function(n){return e(n).min(Function.by(function(e){return t(n.nest(e))}))}},maxBlock:function(e,t){return function(n){return e(n).max(Function.by(function(e){return t(n.nest(e))}))}},parent:function(e){return function(t){return e(t.parent)}},"with":function(e,t){return function(n){return t(n.nest(e(n)))}},"if":function(e,t,n){return function(i){var r=e(i);return null!=r?r?t(i):n(i):void 0}},not:function(e){return function(t){return!e(t)}},and:function(e,t){return function(n){return e(n)&&t(n)}},or:function(e,t){return function(n){return e(n)||t(n)}},"default":function(e,t){return function(n){var i=e(n);return null==i&&(i=t(n)),i}},defined:function(e){return function(t){var n=e(t);return null!=n}},path:function(t,n){return function(r){var a=t(r),s=n(r),o=e("./parse");try{var l=o(s),c=i(l);return c(r.nest(a))}catch(u){}}}},u=r.clone(o,1);r.addEach(u,{property:function(e,t){return e[t]},get:function(e,t){return e.get(t)},mapContent:Function.identity,rangeContent:Function.identity,view:function(e,t,n){return e.slice(t,t+n)}}),i.semantics={compilers:l,argCompilers:c,operators:u,compile:function(e){var t=this.compilers,n=this.argCompilers,i=this.operators;if(t.hasOwnProperty(e.type))return t[e.type].call(this,e);if(n.hasOwnProperty(e.type)){var r=e.args.map(this.compile,this);return n[e.type].apply(null,r)}i.hasOwnProperty(e.type)||(i[e.type]=function(t){var n=Array.prototype.slice.call(arguments,1);if(!t[e.type])throw new TypeError("Can't call "+JSON.stringify(e.type)+" of "+t);return t[e.type].apply(t,n)});var a=i[e.type],r=e.args.map(this.compile,this);return function(e){var t=r.map(function(t){return t(e)});return t.every(o.defined)?a.apply(null,t):void 0}}}}}),montageDefine("99596c3","compile-assigner",{dependencies:["./compile-evaluator","./algebra","./scope"],factory:function(e,t,n){function i(e){return i.semantics.compile(e)}var r=e("./compile-evaluator"),a=e("./algebra");e("./scope");var s={type:"value"},o={type:"literal",value:!0},l={type:"literal",value:!1};n.exports=i,i.semantics={compile:function(e){var t=this.compilers;if("equals"===e.type){var n=this.compile(e.args[0]),i=this.compileEvaluator(e.args[1]);return t.equals(n,i)}if("if"===e.type){var r=this.compileEvaluator(e.args[0]),o=this.compile(e.args[1]),l=this.compile(e.args[2]);return t["if"](r,o,l)}if("and"===e.type||"or"===e.type){var c=a(e.args[0],s),u=a(e.args[1],s),h=this.compileEvaluator(e.args[0]),i=this.compileEvaluator(e.args[1]),d=this.compileEvaluator(c[1]),p=this.compileEvaluator(u[1]),n=this.compile(c[0]),f=this.compile(u[0]);return t[e.type](n,f,h,i,d,p)}if("everyBlock"===e.type){var m=this.compileEvaluator(e.args[0]),g=a(e.args[1],{type:"literal",value:!0}),v=this.compile(g[0]),_=this.compileEvaluator(g[1]);return t.everyBlock(m,v,_)}if("parent"===e.type){var b=this.compile(e.args[0]);return function(e,t){return b(e,t.parent)}}if(t.hasOwnProperty(e.type)){var y=e.args.map(this.compileEvaluator,this.compileEvaluator.semantics);return t[e.type].apply(null,y)}throw Error("Can't compile assigner for "+JSON.stringify(e.type))},compileEvaluator:r,compilers:{property:function(e,t){return function(n,i){var r=e(i);if(r){var a=t(i);null!=a&&(Array.isArray(r)?r.set(a,n):r[a]=n)}}},get:function(e,t){return function(n,i){var r=e(i);if(r){var a=t(i);null!=a&&r.set(a,n)}}},has:function(e,t){return function(n,i){var r=e(i);if(r){var a=t(i);null!=n&&(n?(r.has||r.contains).call(r,a)||r.add(a):(r.has||r.contains).call(r,a)&&(r.remove||r["delete"]).call(r,a))}}},equals:function(e,t){return function(n,i){return n?e(t(i),i):void 0}},"if":function(e,t,n){return function(i,r){var a=e(r);return null!=a?a?t(i,r):n(i,r):void 0}},and:function(e,t,n,i,r,a){return function(s,l){null!=s&&(s?(e(r(o),l),t(a(o),l)):e(n(l)&&!i(l),l))}},or:function(e,t,n,i,r,a){return function(s,o){null!=s&&(s?e(n(o)||!i(o),o):(e(r(l),o),t(a(l),o)))}},rangeContent:function(e){return function(t,n){var i=e(n);i&&(t?i.swap(0,i.length,t):i.clear())}},mapContent:function(e){return function(t,n){var i=e(n);i&&(i.clear(),n.value&&i.addEach(t))}},reversed:function(e){return function(t,n){var i=e(n);i&&i.swap(0,i.length,t.reversed())}},everyBlock:function(e,t,n){return function(i,r){if(i){var a=e(r),s=n(r);a.forEach(function(e){t(s,r.nest(e))})}}}}}}}),montageDefine("99596c3","algebra",{dependencies:[],factory:function(e,t,n){function i(e,t){return i.semantics.solve(e,t)}n.exports=i,i.semantics={solve:function(e,t){for(;;){for(;this.simplifiers.hasOwnProperty(e.type);){var n=this.simplifiers[e.type](e);if(!n)break;e=n}var i=this.rotateTargetToSource.hasOwnProperty(e.type),r=this.rotateSourceToTarget.hasOwnProperty(t.type);if(!i&&!r)break;i?(t=this.rotateTargetToSource[e.type](e,t),e=e.args[0]):r&&(e=this.rotateSourceToTarget[t.type](e,t),t=t.args[0])}return[e,t]},simplifiers:{not:function(e){var t=e.args[0];return"not"===t.type?t.args[0]:void 0},add:function(e){var t=e.args[0];return"literal"===t.type&&""===t.value?{type:"toString",args:[e.args[1]]}:void 0},someBlock:function(e){return{type:"not",args:[{type:"everyBlock",args:[e.args[0],{type:"not",args:[e.args[1]]}]}]}}},rotateTargetToSource:{reflect:function(e,t){return{type:e.type,args:[t]}},invert:function(e,t,n){return{type:n,args:[t,e.args[1]]}},toNumber:function(e,t){return this.reflect(e,t)},toString:function(e,t){return this.reflect(e,t)},not:function(e,t){return this.reflect(e,t)},neg:function(e,t){return this.reflect(e,t)},add:function(e,t){return this.invert(e,t,"sub")},sub:function(e,t){return this.invert(e,t,"add")},mul:function(e,t){return this.invert(e,t,"div")},div:function(e,t){return this.invert(e,t,"mul")},pow:function(e,t){return this.invert(e,t,"root")},root:function(e,t){return this.invert(e,t,"pow")},join:function(e,t){return this.invert(e,t,"split")},split:function(e,t){return this.invert(e,t,"join")}},rotateSourceToTarget:{rangeContent:function(e,t){return"rangeContent"===e.type?e:{type:t.type,args:[e]}}}}}}),montageDefine("99596c3","compile-binder",{dependencies:["./compile-observer","./observers","./binders","./algebra"],factory:function(e,t,n){function i(e){return i.semantics.compile(e)}var r=e("./compile-observer");e("./observers");var a=e("./binders"),s=e("./algebra"),o={type:"value"},l={type:"literal",value:!0};n.exports=i,i.semantics={compilers:{property:a.makePropertyBinder,get:a.makeGetBinder,has:a.makeHasBinder,only:a.makeOnlyBinder,one:a.makeOneBinder,rangeContent:a.makeRangeContentBinder,mapContent:a.makeMapContentBinder,reversed:a.makeReversedBinder,and:a.makeAndBinder,or:a.makeOrBinder},compile:function(e){var t=this.compilers;if("default"===e.type)return this.compile(e.args[0]);if("literal"===e.type){if(null==e.value)return Function.noop;throw Error("Can't bind to literal: "+e.value)}if("equals"===e.type){var n=this.compile(e.args[0]),i=r(e.args[1]);return a.makeEqualityBinder(n,i)}if("if"===e.type){var c=r(e.args[0]),u=this.compile(e.args[1]),h=this.compile(e.args[2]);return a.makeConditionalBinder(c,u,h)}if("and"===e.type||"or"===e.type){var d=s(e.args[0],o),p=s(e.args[1],o),n=this.compile(d[0]),f=this.compile(p[0]),m=r(d[1]),g=r(p[1]),v=r(e.args[0]),i=r(e.args[1]);return this.compilers[e.type](n,f,v,i,m,g)}if("everyBlock"===e.type){var _=r(e.args[0]),b=s(e.args[1],l),y=this.compile(b[0]),w=r(b[1]);return a.makeEveryBlockBinder(_,y,w)}if("rangeContent"===e.type){var C,L=r(e.args[0]);try{C=this.compile(e.args[0])}catch(x){C=Function.noop}return a.makeRangeContentBinder(L,C)}if("defined"===e.type){var C=this.compile(e.args[0]);return a.makeDefinedBinder(C)}if("parent"===e.type){var C=this.compile(e.args[0]);return a.makeParentBinder(C)}if("with"===e.type){var L=r(e.args[0]),C=this.compile(e.args[1]);return a.makeWithBinder(L,C)}if(t.hasOwnProperty(e.type)){var M=e.args.map(r,r.semantics);return t[e.type].apply(null,M)}throw Error("Can't compile binder for "+JSON.stringify(e.type))}}}}),montageDefine("99596c3","binders",{dependencies:["./scope","./observers"],factory:function(e,t){function n(){return Error("").stack.replace(/^.*\n.*\n/,"\n")}function i(e,t,i,r,a,s){return i(x(function(i){if(!a.isActive)try{a.isActive=!0,s&&console.log("SET",s.targetPath,"TO",i,"ON",e,"BECAUSE",s.sourcePath,n()),Array.isArray(e)&&t>>>0===t?e.set(t,i):e[t]=i}finally{a.isActive=!1}}),r)}function r(e,t){return function(n,i,r,a,s){return t(x(function(t){return null!=t?e(x(function(e){return null!=e?e.bindProperty?e.bindProperty(t,n,i,a,s):A(e,t,n,i,a,s):void 0}),r):void 0}),r)}}function a(e,t,i,r,a,s){return i(x(function(i){if(!a.isActive)try{a.isActive=!0,s&&console.log("SET FOR KEY",t,"TO",i,"ON",e,"BECAUSE",s.sourcePath,n()),e.set(t,i)}finally{a.isActive=!1}}),r)}function s(e,t){return function(n,i,r,a,s){return e(x(function(e){return e?t(x(function(t){return null!=t?j(e,t,n,i,a,s):void 0}),r):void 0}),r)}}function o(e,t){return function(i,r,a,s,o){return e(x(function(e){return e?t(x(function(t){return null!=t?i(x(function(i){if(i)(e.has||e.contains).call(e,t)||(o&&console.log("ADD",t,"TO",o.targetPath,"BECAUSE",o.sourcePath,n()),e.add(t));else for(;(e.has||e.contains).call(e,t);)o&&console.log("REMOVE",t,"FROM",o.targetPath,"BECAUSE",o.sourcePath,n()),(e.remove||e["delete"]).call(e,t)}),r):void 0}),a):void 0}),a)}}function l(e,t){return function(i,r,a,s,o){return i(x(function(i){return i?(o&&console.log("BIND",o.targetPath,"TO",o.sourcePath,n()),e(t,r,r,s,o),function(){o&&console.log("UNBIND",o.targetPath,"FROM",o.sourcePath,n())}):void 0}),a)}}function c(e,t,n){return function(i,r,a,s,o){return i(x(function(i){return i?e(x(function(e){function i(e,i,l){r.swap(l,i.length,e.map(function(e){var i=a.nest(e);return t(n,i,i,s,o)}))}if(e){var r=[],l=E(e,i,a);return function(){S(r),l()}}}),a):void 0}),r)}}function u(e,t,n,i,r,a){var s=O(i),o=z(n,s);return function(n,i,s,l,c){return n(x(function(n){if(null!=n){if(n){var i=e(r,D,s,l,c),u=t(a,D,s,l,c);return function(){i(),u()}}return e(o,s,s,l,c)}}),i)}}function h(e,t,n,i,r,a){var s=O(i),o=T(n,s);return function(n,i,s,l,c){return n(x(function(n){if(null!=n){if(n)return e(o,s,s,l,c);var i=e(r,k,s,l,c),u=t(a,k,s,l,c);return function(){i(),u()}}}),i)}}function d(e,t,n){return function(i,r,a,s,o){return e(x(function(e){return null!=e?e?t(i,r,a,s,o):n(i,r,a,s,o):void 0}),r)}}function p(e){return function(t,n,i){return e(x(function(e){return e?t(x(function(t){null!=t&&(e.splice?e.splice(0,e.length,t):e.clear&&e.add&&(e.clear(),e.add(t)))}),n):void 0}),i)}}function f(e){return function(t,n,i){return e(x(function(e){return e?t(x(function(t){null!=t&&t!==e.one()&&(e.splice?e.splice(0,e.length,t):e.clear&&e.add&&(e.clear(),e.add(t)))}),n):void 0}),i)}}function m(e,t){return function(i,r,a,s,o){return e(x(function(e){return e?i(x(function(t){function i(t,i,r){w(e)||(o&&console.log("SWAPPING",i,"FOR",t,"AT",r,"ON",o.targetPath,n()),e.swap?e.swap(r,i.length,t):e.add&&(e.remove||e["delete"])&&(t.forEach(e.add,e),i.forEach(e.remove||e["delete"],e)))}if(t!==e){if(!t)return e.clear(),void 0;if(t.addRangeChangeListener)return t.addRangeChangeListener(i),i(Array.from(t),Array.from(e),0),M(function(){t.removeRangeChangeListener(i)})}}),r):t(L.makeLiteralObserver([]),r,a,s,o)}),a)}}function g(e){return function(t,i,r,a,s){return e(x(function(e){return e?t(x(function(t){function i(t,i){if(!a.isActive)try{a.isActive=!0,void 0===t?(s&&s&&console.log("DELETED",s.targetPath,"FOR KEY",i,"ON",e,"BECAUSE",s.sourcePath,n()),Array.isArray(e)?e.splice(i,1):e["delete"](i)):(s&&s&&console.log("SET",s.targetPath,"FOR KEY",i,"TO",t,"ON",e,"BECAUSE",s.sourcePath,n()),e.set(i,t))}finally{a.isActive=!1}}return t?(e.clear(),t.forEach(i),t.addMapChangeListener(i)):(e.clear(),void 0)}),i):void 0}),r)}}function v(e){return function(t,n,i){return e(x(function(e){return e?t(x(function(t){function n(t,n,i){if(!w(e)){var r=e.length-i-n.length;e.swap(r,n.length,t.reversed())}}return t?(t.addRangeChangeListener(n),n(t,e,0),M(function(){t.removeRangeChangeListener(n)})):(e.clear(),void 0)}),n):void 0}),i)}}function _(e){return function(t,n,i,r,a){return t(x(function(t){return t?Function.noop:e(P,n,i,r,a)}),i)}}function b(e){return function(t,n,i,r,a){return i.parent?e(t,n,i.parent,r,a):void 0}}function y(e,t){return function(n,i,r,a,s){return e(x(function(e){return null!=e?t(n,i,r.nest(e),a,s):void 0}),r)}}function w(e){return e.getRangeChangeDescriptor&&e.getRangeChangeDescriptor().isActive}var C=e("./scope"),L=e("./observers"),x=L.autoCancelPrevious,M=L.once,E=L.observeRangeChange,S=L.cancelEach,O=L.makeNotObserver,T=L.makeOrObserver,z=L.makeAndObserver;L.observeValue;var P=L.makeLiteralObserver(),D=new C(!0),k=new C(!1);t.bindProperty=i;var A=i;t.makePropertyBinder=r,t.bindGet=a;var j=a;t.makeGetBinder=s,t.makeHasBinder=o,t.makeEqualityBinder=l,t.makeEveryBlockBinder=c,t.makeAndBinder=u,t.makeOrBinder=h,t.makeConditionalBinder=d,t.makeOnlyBinder=p,t.makeOneBinder=f,t.makeRangeContentBinder=m,t.makeMapContentBinder=g,t.makeReversedBinder=v,t.makeDefinedBinder=_,t.makeParentBinder=b,t.makeWithBinder=y}}),montageDefine("99596c3","operators",{dependencies:["collections/shim-object","collections/shim-regexp","collections/map","collections/set"],factory:function(e,t){e("collections/shim-object"),e("collections/shim-regexp");var n=e("collections/map"),i=e("collections/set");t.toNumber=function(e){return+e},t.toString=function(e){return null==e?e:"string"==typeof e||"number"==typeof e?""+e:null},t.toArray=Array.from,t.toMap=n,t.toSet=i,t.not=function(e){return!e},t.neg=function(e){return-e},t.pow=function(e,t){return Math.pow(e,t)},t.root=function(e,t){return Math.pow(e,1/t)},t.log=function(e,t){return Math.log(e)/Math.log(t)},t.mul=function(e,t){return e*t},t.div=function(e,t){return e/t},t.mod=function(e,t){return(e%t+t)%t},t.rem=function(e,t){return e%t},t.add=function(e,t){return e+t},t.sub=function(e,t){return e-t},t.ceil=function(e){return Math.ceil(e)},t.floor=function(e){return Math.floor(e)},t.round=function(e){return Math.round(e)},t.lt=function(e,t){return 0>Object.compare(e,t)},t.gt=function(e,t){return Object.compare(e,t)>0},t.le=function(e,t){return 0>=Object.compare(e,t)},t.ge=function(e,t){return Object.compare(e,t)>=0},t.equals=Object.equals,t.compare=Object.compare,t.and=function(e,t){return e&&t},t.or=function(e,t){return e||t},t.defined=function(e){return null!=e},t.startsWith=function(e,t){var n=RegExp("^"+RegExp.escape(t));return n.test(e)},t.endsWith=function(e,t){var n=RegExp(RegExp.escape(t)+"$");return n.test(e)},t.contains=function(e,t){var n=RegExp(RegExp.escape(t));return n.test(e)},t.join=function(e,t){return e.join(t||"")
},t.split=function(e,t){return e.split(t||"")},t.range=function(e){for(var t=[],n=0;e>n;n++)t.push(n);return t},t.last=function(e){return e.get(e.length-1)}}}),montageDefine("99596c3","merge",{dependencies:["collections/shim"],factory:function(e,t){"use strict";function n(e,t){for(var n,i=(t.length+1)*(e.length+1),r=Array(i),a=Array(t.length+1),s=Array(t.length+1),o=0;e.length+1>o;o++){for(var l=0;t.length+1>l;l++){var c,u;if(0===o&&0===l)c=" ",u=0;else if(0===o)c="insert",u=l;else if(0===l)c="delete",u=o;else if(e[o-1]===t[l-1])c="retain",u=s[l-1];else{var h=a[l-1],d=s[l];h>d?(c="delete",u=d+1):(c="insert",u=h+1)}r[o+l*(e.length+1)]=c,a[l]=u}n=a,a=s,s=n}return{edges:r,cost:s[t.length],source:t,target:e}}function i(e){for(var t,n,i=[],r=e.edges,a=t=e.target.length,s=e.source.length;t||s;){var o=r[t+s*(a+1)];if("delete"===o){if(n&&"delete"===n[0])n[1]++;else{var l=["delete",1];n=l,i.push(l)}t--}else if("insert"===o){if(n&&"insert"===n[0])n[1]++;else{var l=["insert",1];n=l,i.push(l)}s--}else if("retain"===o){var l=["retain",1];n&&"retain"===n[0]?n[1]++:(n=l,i.push(l)),t--,s--}}return i.reverse(),i}function r(e,t){return i(n(e,t))}function a(e,t){for(var n=r(e,t),i=[],a=0,s=0,o=0;n.length>o;){var l=n[o++];if("insert"===l[0])i.push([s,0,t.slice(s,s+l[1])]),s+=l[1];else if("delete"===l[0])if(n.length>o&&"insert"===n[o][0]){var c=n[o++];i.push([s,l[1],t.slice(s,s+c[1])]),a+=l[1],s+=c[1]}else i.push([s,l[1]]),a+=l[1];else"retain"==l[0]&&(a+=l[1],s+=l[1])}return i}function s(e,t){for(var n=0;t.length>n;n++)e.swap.apply(e,t[n])}function o(e,t){s(e,a(e,t))}e("collections/shim"),t.graphOt=n,t.traceOt=i,t.ot=r,t.diff=a,t.apply=s,t.merge=o}}),montageDefine("99596c3","language",{dependencies:["collections/set","collections/dict"],factory:function(e,t){var n=e("collections/set"),i=e("collections/dict"),r=t.precedence=i(),a=t.precedenceLevels=[["tuple","record"],["literal","value","parameters","property","element","component","mapBlock","filterBlock","sortedBlock","groupBlock","groupMapBlock","with"],["not","neg","number","parent"],["scope"],["default"],["pow","root","log"],["mul","div","mod","rem"],["add","sub"],["equals","lt","gt","le","ge","compare"],["and"],["or"],["if"]];a.forEach(function(e){var t=n(r.keys());e.forEach(function(e){r.set(e,t)})});var s=t.operatorTokens=i({"**":"pow","//":"root","%%":"log","*":"mul","/":"div","%":"mod",rem:"rem","+":"add","-":"sub","<":"lt",">":"gt","<=":"le",">=":"ge","==":"equals","<=>":"compare","!=":"notEquals","??":"default","&&":"and","||":"or","?":"then",":":"else"});t.operatorTypes=i(s.map(function(e,t){return[e,t]}))}}),montageDefine("99596c3","compute",{dependencies:["./parse","./compile-observer","./compile-binder","./observers","./scope"],factory:function(e,t,n){function i(e,t,n){n.target=e,n.targetPath=t;var i=n.source=n.source||e,c=n.args,u=n.compute,h=n.parameters=n.parameters||i,d=n.document,p=n.components,f=n.trace,m=n.sourceScope=new l(i);m.parameters=h,m.document=d,m.components=p;var g=n.targetScope=new l(e);g.parameters=h,g.document=d,g.components=p;var v=c.map(function(e){return r(e)}).map(function(e){if("rangeContent"===e.type){var t=a(e.args[0]);return o.makeRangeContentObserver(t)}if("mapContent"===e.type){var t=a(e.args[0]);return o.makeMapContentObserver(t)}return a(e)}),_=o.makeRangeContentObserver(o.makeObserversObserver(v)),b=o.makeComputerObserver(_,u,e),y=r(t),w=s(y);return w(b,m,g,n,f?{sourcePath:c.join(", "),targetPath:t}:void 0)}var r=e("./parse"),a=e("./compile-observer"),s=e("./compile-binder"),o=e("./observers"),l=e("./scope");n.exports=i}}),montageDefine("39386c7","weak-map",{dependencies:[],factory:function(e,t,n){(function(){"use strict";function e(t){t.permitHostObjects___&&t.permitHostObjects___(e)}function t(e){return!(e.substr(0,c.length)==c&&"___"===e.substr(e.length-3))}function i(e){if(e!==Object(e))throw new TypeError("Not an object: "+e);var t=e[u];if(t&&t.key===e)return t;if(!l(e))return void 0;var n=[],i=[];return t={key:e,gets:n,vals:i},o(e,u,{value:t,writable:!1,enumerable:!1,configurable:!1}),t}function r(e){return e.prototype=null,Object.freeze(e)}if("undefined"==typeof ses||!ses.ok||ses.ok()){if("undefined"!=typeof ses&&(ses.weakMapPermitHostObjects=e),"function"==typeof WeakMap){var a=WeakMap;if("undefined"==typeof navigator||!/Firefox/.test(navigator.userAgent))return n.exports=WeakMap,void 0}Object.prototype.hasOwnProperty;var s=Object.getOwnPropertyNames,o=Object.defineProperty,l=Object.isExtensible,c="weakmap:",u=c+"ident:"+Math.random()+"___";if("undefined"!=typeof crypto&&"function"==typeof crypto.getRandomValues&&"function"==typeof ArrayBuffer&&"function"==typeof Uint8Array){var h=new ArrayBuffer(25),d=new Uint8Array(h);crypto.getRandomValues(d),u=c+"rand:"+Array.prototype.map.call(d,function(e){return(e%36).toString(36)}).join("")+"___"}if(o(Object,"getOwnPropertyNames",{value:function(e){return s(e).filter(t)}}),"getPropertyNames"in Object){var p=Object.getPropertyNames;o(Object,"getPropertyNames",{value:function(e){return p(e).filter(t)}})}(function(){var e=Object.freeze;o(Object,"freeze",{value:function(t){return i(t),e(t)}});var t=Object.seal;o(Object,"seal",{value:function(e){return i(e),t(e)}});var n=Object.preventExtensions;o(Object,"preventExtensions",{value:function(e){return i(e),n(e)}})})();var f=function(){function e(t,n){var r,a,l=i(t);return l?(r=l.gets.indexOf(e),a=l.vals):(r=s.indexOf(t),a=o),r>=0?a[r]:n}function t(t){var n,r=i(t);return n=r?r.gets.indexOf(e):s.indexOf(t),n>=0}function n(t,n){var r,a=i(t);a?(r=a.gets.indexOf(e),r>=0?a.vals[r]=n:(a.gets.push(e),a.vals.push(n))):(r=s.indexOf(t),r>=0?o[r]=n:(s.push(t),o.push(n)))}function a(t){var n,r=i(t);return r?(n=r.gets.indexOf(e),n>=0&&(r.gets.splice(n,1),r.vals.splice(n,1))):(n=s.indexOf(t),n>=0&&(s.splice(n,1),o.splice(n,1))),!0}var s=[],o=[];return Object.create(f.prototype,{get___:{value:r(e)},has___:{value:r(t)},set___:{value:r(n)},delete___:{value:r(a)}})};f.prototype=Object.create(Object.prototype,{get:{value:function(e,t){return this.get___(e,t)},writable:!0,configurable:!0},has:{value:function(e){return this.has___(e)},writable:!0,configurable:!0},set:{value:function(e,t){this.set___(e,t)},writable:!0,configurable:!0},"delete":{value:function(e){return this.delete___(e)},writable:!0,configurable:!0}}),"function"==typeof a?function(){function t(){function t(e,t){return l?o.has(e)?o.get(e):l.get___(e,t):o.get(e,t)}function n(e){return o.has(e)||(l?l.has___(e):!1)}function i(e,t){if(c)try{o.set(e,t)}catch(n){l||(l=new f),l.set___(e,t)}else o.set(e,t)}function s(e){o["delete"](e),l&&l.delete___(e)}var o=new a,l=void 0,c=!1;return Object.create(f.prototype,{get___:{value:r(t)},has___:{value:r(n)},set___:{value:r(i)},delete___:{value:r(s)},permitHostObjects___:{value:r(function(t){if(t!==e)throw Error("bogus call to permitHostObjects___");c=!0})}})}t.prototype=f.prototype,n.exports=t,Object.defineProperty(WeakMap.prototype,"constructor",{value:WeakMap,enumerable:!1,configurable:!0,writable:!0})}():("undefined"!=typeof Proxy&&(Proxy=void 0),n.exports=f)}})()}}),montageDefine("69f9379","ui/button.reel/button",{dependencies:["montage/ui/base/abstract-button"],factory:function(e,t){var n=e("montage/ui/base/abstract-button").AbstractButton;t.Button=n.specialize({hasTemplate:{value:!0},constructor:{value:function(){this.super(),this.classList.add("digit-Button")}}})}}),montageDefine("69f9379","ui/list.reel/list",{dependencies:["matte/ui/list.reel"],factory:function(e,t){var n=e("matte/ui/list.reel").List;t.List=n.specialize({constructor:{value:function n(){this.super()}},templateDidLoad:{value:function(){this._repetition=this.templateObjects.repetition}},enterDocument:{value:function(e){e&&this.element.addEventListener("touchstart",this,!1)}},handleTouchstart:{value:function(){var e=this.element,t=e.scrollTop;0>=t&&(e.scrollTop=1),t+e.offsetHeight>=e.scrollHeight&&(e.scrollTop=e.scrollHeight-e.offsetHeight-1)}}})}}),montageDefine("69f9379","ui/button.reel/button.html",{text:"<!DOCTYPE html><html><head>\n    <meta charset=utf-8>\n    <link rel=stylesheet href=button.css>\n</head>\n<body>\n\n\n</body></html>"}),montageDefine("69f9379","ui/list.reel/list.html",{text:'<!DOCTYPE html><html><head>\n    <meta charset=utf-8>\n    <link rel=stylesheet href=list.css>\n    <link rel=stylesheet href=../list-item.reel/list-item.css>\n    <script type=text/montage-serialization>{"owner":{"properties":{"element":{"#":"list"}}},"repetition":{"prototype":"montage/ui/repetition.reel","properties":{"element":{"#":"repetition"}},"bindings":{"isSelectionEnabled":{"<-":"@owner.isSelectionEnabled"}}},"scroller":{"prototype":"matte/ui/scroller.reel","properties":{"element":{"#":"scroller"}},"bindings":{"axis":{"<-":"@owner.axis"}}},":iteration":{"alias":"@repetition:iteration"}}</script>\n</head>\n<body>\n	<div data-montage-id=list class=digit-List>\n        <div data-montage-id=scroller class=digit-List-scroller>\n            <ul data-montage-id=repetition class=digit-List-repetition>\n                <li data-param=*></li>\n            </ul>\n        </div>\n	</div>\n\n\n</body></html>'}),montageDefine("ba9c197","ui/list.reel/list",{dependencies:["montage/ui/component","montage/frb/observers","montage/core/deprecate"],factory:function(e,t){var n=e("montage/ui/component").Component,i=e("montage/frb/observers").observeProperty,r=e("montage/core/deprecate").deprecationWarning;t.List=n.specialize({constructor:{value:function(){this.super(),this.defineBinding("_repetition.content",{"<-":"content"}),this.defineBinding("content.defined() ? null : _repetition.contentController",{"<-":"contentController"})}},templateDidLoad:{value:function(){this._scroller.addOwnPropertyChangeListener("scrollY",this),this._scroller.addOwnPropertyChangeListener("_maxTranslateY",this)}},_repetition:{value:null},_scroller:{value:null},delegate:{value:null},content:{value:null},contentController:{value:null},axis:{value:null},isSelectionEnabled:{value:null},listEndEventThreshold:{value:1},observeProperty:{value:function(e,t,n,a,s){return"objectAtCurrentIteration"!==e&&"currentIteration"!==e?i(this,e,t,n,a,s):(r(e,":iteration.object"),this._repetition?this._repetition.observeProperty(e,t,n,a,s):void 0)}},_fireEndEvent:{value:function(){this.dispatchEventNamed("listEnd")}},handlePropertyChange:{value:function(e,t,n){("scrollY"===t||"_maxTranslateY"===t)&&this._scroller&&n===this._scroller&&this._scroller.scrollY>=this._scroller._maxTranslateY*this.listEndEventThreshold&&this._scroller._maxTranslateY>0&&this._fireEndEvent()}}})}}),montageDefine("ba9c197","ui/scroller.reel/scroller",{dependencies:["montage/ui/component"],factory:function(e,t){var n=e("montage/ui/component").Component;t.Scroller=n.specialize({constructor:{value:function(){this.super()}},_scrollX:{value:0},scrollX:{get:function(){return this._scrollX},set:function(e){this._scrollX!==e&&(this._scrollX=e,this.needsDraw=!0)}},_scrollY:{value:0},scrollY:{get:function(){return this._scrollY},set:function(e){this._scrollY!==e&&(this._scrollY=e,this.needsDraw=!0)}},_maxTranslateX:{value:0},_maxTranslateY:{value:0},_axis:{value:"auto"},axis:{get:function(){return this._axis},set:function(e){this._axis=e,this.needsDraw=!0}},_displayScrollbars:{value:"auto"},displayScrollbars:{get:function(){return this._displayScrollbars},set:function(e){switch(e){case"vertical":case"horizontal":case"both":case"auto":this._displayScrollbars=e;break;default:this._displayScrollbars="none"}this.needsDraw=!0}},_hasMomentum:{value:!0},hasMomentum:{get:function(){return this._hasMomentum},set:function(e){this._hasMomentum=e}},_content:{value:null},_scrollBars:{value:null},handleTranslateStart:{value:function(){this._scrollBars.opacity=.5}},handleTranslateEnd:{value:function(){this._scrollBars.opacity=0}},canDraw:{value:function(){return this.needsDraw=!0,n.canDraw.apply(this,arguments)}},willDraw:{value:function(){this._left=this._element.offsetLeft,this._top=this._element.offsetTop,this._width=this._element.offsetWidth,this._height=this._element.offsetHeight;var e=this._content.scrollWidth-this._width;this._maxTranslateX=0>e?0:e;var t=this._content.offsetHeight-this._height;this._maxTranslateY=0>t?0:t;var n=this.callDelegateMethod("didSetMaxScroll",{x:this._maxTranslateX,y:this._maxTranslateY});switch(n&&(this._maxTranslateX=n.x,this._maxTranslateY=n.y),this.scrollX=Math.min(this._scrollX,this._maxTranslateX),this.scrollY=Math.min(this._scrollY,this._maxTranslateY),this._displayScrollbars){case"horizontal":this._scrollBars.displayHorizontal=!0,this._scrollBars.displayVertical=!1;break;case"vertical":this._scrollBars.displayHorizontal=!1,this._scrollBars.displayVertical=!0;break;case"both":this._scrollBars.displayHorizontal=!0,this._scrollBars.displayVertical=!0;break;case"auto":this._scrollBars.displayHorizontal=!!this._maxTranslateX,this._scrollBars.displayVertical=!!this._maxTranslateY;break;case"none":this._scrollBars.displayHorizontal=!1,this._scrollBars.displayVertical=!1}this._scrollBars.displayHorizontal&&(this._content.scrollWidth?(this._scrollBars.horizontalLength=this._width/this._content.scrollWidth,this._scrollBars.horizontalScroll=this._scrollX/this._content.scrollWidth):(this._scrollBars.horizontalLength=1,this._scrollBars.horizontalScroll=0)),this._scrollBars.displayVertical&&(this._content.offsetHeight?(this._scrollBars.verticalLength=this._height/this._content.offsetHeight,this._scrollBars.verticalScroll=this._scrollY/this._content.offsetHeight):(this._scrollBars.verticalLength=1,this._scrollBars.verticalScroll=0))}},draw:{value:function(){var e=-this._scrollX+"px, "+-this._scrollY+"px";this._content.style.webkitTransform="translate3d("+e+", 0px)",this._content.style.MozTransform="translate("+e+")",this._content.style.transform="translate("+e+")"}}})}}),montageDefine("ba9c197","ui/list.reel/list.html",{text:'<!DOCTYPE html><html><head>\n    <meta charset=utf-8>\n    <link rel=stylesheet href=list.css>\n    <script type=text/montage-serialization>{"repetition1":{"prototype":"montage/ui/repetition.reel","properties":{"element":{"#":"repetition"}},"bindings":{"isSelectionEnabled":{"<-":"@owner.isSelectionEnabled"}}},"scroller1":{"prototype":"ui/scroller.reel","properties":{"element":{"#":"scroller"}},"bindings":{"axis":{"<-":"@owner.axis"}}},"owner":{"prototype":"ui/list.reel","properties":{"element":{"#":"EA5D3E95-BA4E-4696-BBBE-B4DE2F6ED6C9"},"_repetition":{"@":"repetition1"},"_scroller":{"@":"scroller1"}}},":iteration":{"alias":"@repetition1:iteration"}}</script>\n</head>\n<body>\n    <div data-montage-id=EA5D3E95-BA4E-4696-BBBE-B4DE2F6ED6C9 class=matte-List>\n        <div data-montage-id=scroller class=matte-List-scroller>\n            <div data-montage-id=repetition><div data-param=*></div></div>\n        </div>\n    </div>\n\n\n</body></html>'}),montageDefine("ba9c197","ui/scroller.reel/scroller.html",{text:'<!DOCTYPE html><html><head>\n    <meta charset=utf-8>\n    <link rel=stylesheet href=scroller.css>\n    <script type=text/montage-serialization>{"scrollbars":{"prototype":"ui/scroll-bars.reel","properties":{"element":{"#":"scrollbars"}}},"translateComposer1":{"prototype":"montage/composer/translate-composer","properties":{"component":{"@":"owner"},"minTranslateX":0,"minTranslateY":0,"invertAxis":true,"stealChildrenPointer":true},"bindings":{"translateX":{"<->":"@owner.scrollX"},"translateY":{"<->":"@owner.scrollY"},"maxTranslateX":{"<-":"@owner._maxTranslateX"},"maxTranslateY":{"<-":"@owner._maxTranslateY"},"axis":{"<-":"@owner.axis"},"hasMomentum":{"<-":"@owner.hasMomentum"}},"listeners":[{"type":"translateStart","listener":{"@":"owner"}},{"type":"translateEnd","listener":{"@":"owner"}}]},"owner":{"prototype":"ui/scroller.reel","properties":{"_content":{"#":"content"},"element":{"#":"montage-scroller"},"_scrollBars":{"@":"scrollbars"}}}}</script>\n</head>\n<body>\n    <div data-montage-id=montage-scroller class=matte-Scroller>\n        <div data-montage-id=scrollbars></div>\n        <div data-montage-id=content class=matte-Scroller-content>\n            <div data-param=*></div>\n        </div>\n    </div>\n\n\n</body></html>'}),montageDefine("ba9c197","ui/scroll-bars.reel/scroll-bars",{dependencies:["montage/ui/component"],factory:function(e,t){var n=e("montage/ui/component").Component;t.ScrollBars=n.specialize({_verticalScroll:{value:0},_horizontalScroll:{value:0},_verticalLength:{value:0},_horizontalLength:{value:0},verticalScroll:{get:function(){return this._verticalScroll},set:function(e){this._verticalScroll=e,this.needsDraw=!0}},horizontalScroll:{get:function(){return this._horizontalScroll},set:function(e){this._horizontalScroll=e,this.needsDraw=!0}},verticalLength:{get:function(){return this._verticalLength},set:function(e){this._verticalLength=e,this.needsDraw=!0}},horizontalLength:{get:function(){return this._horizontalLength},set:function(e){this._horizontalLength=e,this.needsDraw=!0}},_opacity:{value:0},opacity:{get:function(){return this._opacity},set:function(e){this._opacity=e,this.needsDraw=!0}},_isDisplayUpdated:{value:!1},_displayVertical:{value:!1},displayVertical:{get:function(){return this._displayVertical},set:function(e){this._displayVertical!==e&&(this._displayVertical=e,this._isDisplayUpdated=!0,this.needsDraw=!0)}},_displayHorizontal:{value:!1},displayHorizontal:{get:function(){return this._displayHorizontal},set:function(e){this._displayHorizontal!==e&&(this._displayHorizontal=e,this._isDisplayUpdated=!0,this.needsDraw=!0)}},_top:{value:!1},_bottomClip:{value:!1},_bottom:{value:!1},_left:{value:!1},_rightClip:{value:!1},_right:{value:!1},_hasResizedHorizontal:{value:!1},_hasResizedVertical:{value:!1},willDraw:{value:function(){this._offsetWidth!==this._element.offsetWidth&&(this._offsetWidth=this._element.offsetWidth,this._hasResizedHorizontal=!0),this._offsetHeight!==this._element.offsetHeight&&(this._offsetHeight=this._element.offsetHeight,this._hasResizedVertical=!0)}},draw:{value:function(){var e,t,n,i;if(this._isDisplayUpdated){var r=this._displayVertical?"block":"none",a=this._displayHorizontal?"block":"none";this._top.style.display=this._bottomClip.style.display=r,this._left.style.display=this._rightClip.style.display=a,this._isDisplayUpdated=!1}if(this._hasResizedHorizontal&&this._displayHorizontal&&(this._rightClip.style.width=this._right.style.width=this._offsetWidth-4+"px",this._rightClip.style.clip="rect(-1px,"+(this._offsetWidth-3)+"px,6px,3px)",this._hasResizedHorizontal=!1),this._hasResizedVertical&&this._displayVertical&&(this._bottomClip.style.height=this._bottom.style.height=this._offsetHeight-4+"px",this._bottomClip.style.clip="rect(3px,6px,"+(this._offsetHeight-3)+"px,-1px)",this._hasResizedVertical=!1),this._opacity){if(this._displayHorizontal){n=this._offsetWidth-9-(this._displayVertical?6:0),e=Math.floor(n*this._horizontalLength),i=n-e,t=1-this._horizontalLength?Math.floor(i*this._horizontalScroll/(1-this._horizontalLength)):0,0>t&&(e+=t,0>e&&(e=0),t=0),t>i&&(e+=Math.floor(i-t),0>e&&(e=0),t=n-e);var s=e-this._offsetWidth+9+"px,0px",o=t+2+"px,0px";this._right.style.webkitTransform="translate3d("+s+",0)",this._right.style.MozTransform="translate("+s+")",this._right.style.transform="translate("+s+")",this._left.style.webkitTransform=this._rightClip.style.webkitTransform="translate3d("+o+",0)",this._left.style.MozTransform=this._rightClip.style.MozTransform="translate("+o+")",this._left.style.transform=this._rightClip.style.transform="translate("+o+")",this._left.style.webkitTransition=this._right.style.webkitTransition="none",this._left.style.MozTransition=this._right.style.MozTransition="none",this._left.style.transition=this._right.style.transition="none",this._left.style.opacity=this._right.style.opacity=this._opacity}if(this._displayVertical){n=this._offsetHeight-9-(this._displayHorizontal?6:0),e=Math.floor(n*this._verticalLength),i=n-e,t=1-this._verticalLength?Math.floor(i*this._verticalScroll/(1-this._verticalLength)):0,0>t&&(e+=t,0>e&&(e=0),t=0),t>i&&(e+=Math.floor(i-t),0>e&&(e=0),t=n-e);var l="0px,"+(e-this._offsetHeight+9)+"px",c="0px,"+(t+2)+"px";this._bottom.style.webkitTransform="translate3d("+l+",0)",this._bottom.style.MozTransform="translate("+l+")",this._bottom.style.transform="translate("+l+")",this._top.style.webkitTransform=this._bottomClip.style.webkitTransform="translate3d("+c+",0)",this._top.style.MozTransform=this._bottomClip.style.MozTransform="translate("+c+")",this._top.style.transform=this._bottomClip.style.transform="translate("+c+")",this._top.style.webkitTransition=this._bottom.style.webkitTransition="none",this._top.style.MozTransition=this._bottom.style.MozTransition="none",this._top.style.transition=this._bottom.style.transition="none",this._top.style.opacity=this._bottom.style.opacity=this._opacity}}else this._displayHorizontal&&(this._left.style.webkitTransition=this._right.style.webkitTransition="300ms opacity",this._left.style.opacity=this._right.style.opacity=0),this._displayVertical&&(this._top.style.webkitTransition=this._bottom.style.webkitTransition="300ms opacity",this._top.style.opacity=this._bottom.style.opacity=0)}}})}}),montageDefine("ba9c197","ui/scroll-bars.reel/scroll-bars.html",{text:'<!DOCTYPE html><html><head>\n    <meta charset=utf-8>\n    <link rel=stylesheet href=scroll-bars.css>\n    <script type=text/montage-serialization>{"owner":{"properties":{"element":{"#":"matte-scroll-bars"},"_top":{"#":"top"},"_bottomClip":{"#":"bottom-clip"},"_bottom":{"#":"bottom"},"_left":{"#":"left"},"_rightClip":{"#":"right-clip"},"_right":{"#":"right"}}}}</script>\n</head>\n<body>\n    <div data-montage-id=matte-scroll-bars class=matte-ScrollBars>\n        <div data-montage-id=top class=matte-ScrollBars-top></div>\n        <div data-montage-id=bottom-clip class=matte-ScrollBars-bottomClip>\n            <div data-montage-id=bottom class=matte-ScrollBars-bottom></div>\n        </div>\n        <div data-montage-id=left class=matte-ScrollBars-left></div>\n        <div data-montage-id=right-clip class=matte-ScrollBars-rightClip>\n            <div data-montage-id=right class=matte-ScrollBars-right></div>\n        </div>\n    </div>\n\n\n</body></html>'});